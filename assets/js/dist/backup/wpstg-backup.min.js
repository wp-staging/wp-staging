!function(){"use strict";function e(e,t,n,o,a,r,s){try{var i=e[r](s),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(o,a)}function t(t){return function(){var n=this,o=arguments;return new Promise((function(a,r){var s=t.apply(n,o);function i(t){e(s,a,r,i,l,"next",t)}function l(t){e(s,a,r,i,l,"throw",t)}i(void 0)}))}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function o(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(o=e[Symbol.iterator]()).next.bind(o)}function a(e,t,n,o){var a,r,s,i,l=!1,c=!1,u={},d=0,p=0,g={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function w(e){a=e.clientX,r=e.clientY}function h(e,t){if(p&&(p=clearTimeout(p)),Math.abs(s-a)+Math.abs(i-r)<g.sensitivity)return d=1,c?void 0:n(e,t);s=a,i=r,p=setTimeout((function(){h(e,t)}),g.interval)}function f(e,t){return l=!0,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",w,!1),1!==d&&(s=t.clientX,i=t.clientY,e.addEventListener("mousemove",w,!1),p=setTimeout((function(){h(e,t)}),g.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function y(e,t){return l=!1,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",w,!1),1===d&&(p=setTimeout((function(){!function(e,t){p&&(p=clearTimeout(p)),d=0,c||o(e,t)}(e,t)}),g.timeout)),this}function b(e){e.target.matches(t+", "+t+" *")&&y(e.target.closest(t),e)}function v(e){var o,a;e.target.matches(t+", "+t+" *")&&(o=e.target.closest(t),a=e,l||(c=!0,n(o,a)))}function k(e){var n,a;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),a=e,!l&&c&&(c=!1,o(n,a)))}function S(){e.removeEventListener("focus",v,!1),e.removeEventListener("blur",k,!1)}return u.options=function(t){var n=t.handleFocus!==g.handleFocus;return g=Object.assign({},g,t),n&&(g.handleFocus?(e.addEventListener("focus",v,!1),e.addEventListener("blur",k,!1)):S()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",b,!1),S())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",b,!1)),u}var r=function(e){var t={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:10,retryOnErrors:[401,403,404,429,502,503,504],performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),t.retry.performingRequest=!0,0===t.retry.currentDelay&&(t.retry.currentDelay=1e3,t.retry.count=1),t.retry.currentDelay+=500*t.retry.count*e,t.retry.count++},canRetry:function(){return t.retry.count<t.retry.max},reset:function(){t.retry.currentDelay=0,t.retry.count=0,t.retry.performingRequest=!1}},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},listenTooltip:function(){a(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="hidden"}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup centered-modal":"wpstg-swal-popup"},o={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(o)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?t.cache.get(".wpstg-loader").show():t.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},showAjaxFatalError:function(e,n,o){return n=n?n+"<br/><br/>":"Something went wrong! <br/><br/>",o=o?o+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(t.showError(n+" Error: No response."+o),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(t.showError(n+" Error: "+e.message+o),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(e){return e.ok||t.showError("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},showError:function(n){t.retry.performingRequest||(t.cache.get("#wpstg-try-again").css("display","inline-block"),t.cache.get("#wpstg-cancel-cloning").text("Reset"),t.cache.get("#wpstg-resume-cloning").show(),t.cache.get("#wpstg-error-wrapper").show(),t.cache.get("#wpstg-error-details").show().html(n),t.cache.get("#wpstg-removing-clone").removeClass("loading"),t.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(n))},resetErrors:function(){t.cache.get("#wpstg-error-details").hide().html("")},ajax:function(n,o,a,r,s,i,l){void 0===i&&(i=null),void 0===l&&(l=null),void 0===a&&(a="json"),!1!==r&&(r=!0);var c=10,u=1e4*(s=void 0===s?0:s);i=parseInt(i),isNaN(i)||(u*=i),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:a,cache:!1,data:n,error:function(e,d,p){if(console.log(e.status+" "+e.statusText+"---"+d),"function"!=typeof l||(l(e,d,p),t.continueErrorHandle))if(++s<=c)setTimeout((function(){t.ajax(n,o,a,r,s,i)}),u);else{var g=void 0===e.status?"Unknown":e.status;t.showError("Fatal Error:  "+g+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}else t.continueErrorHandle=!0},success:function(e){"function"==typeof o&&o(e)},statusCode:{404:function(){s>=c&&t.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){s>=c&&t.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){s>c&&t.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){s>=c&&t.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){s>=c&&t.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){s>=c&&t.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){s>=c&&t.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})}};return t}(jQuery);function s(e){return document.querySelector(e)}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var i=function(e){var t,n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,o){var a=t&&t.prototype instanceof f?t:f,r=Object.create(a.prototype),s=new L(o||[]);return r._invoke=function(e,t,n){var o=d;return function(a,r){if(o===g)throw new Error("Generator is already running");if(o===w){if("throw"===a)throw r;return M()}for(n.method=a,n.arg=r;;){var s=n.delegate;if(s){var i=T(s,n);if(i){if(i===h)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=w,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=g;var l=u(e,t,n);if("normal"===l.type){if(o=n.done?w:p,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=w,n.method="throw",n.arg=l.arg)}}}(e,n,s),r}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",p="suspendedYield",g="executing",w="completed",h={};function f(){}function m(){}function y(){}var b={};b[r]=function(){return this};var v=Object.getPrototypeOf,k=v&&v(v(P([])));k&&k!==n&&o.call(k,r)&&(b=k);var S=y.prototype=f.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(a,r,s,i){var l=u(e[a],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):t.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,i)}))}i(l.arg)}var a;this._invoke=function(e,o){function r(){return new t((function(t,a){n(e,o,t,a)}))}return a=a?a.then(r,r):r()}}function T(e,n){var o=e.iterator[n.method];if(o===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var a=u(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var r=a.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,s=function n(){for(;++a<e.length;)if(o.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:M}}function M(){return{value:t,done:!0}}return m.prototype=S.constructor=y,y.constructor=m,m.displayName=l(y,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,i,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},E(x.prototype),x.prototype[s]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,o,a,r){void 0===r&&(r=Promise);var s=new x(c(t,n,o,a),r);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(S),l(S,i,"Generator"),S[r]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},e.values=P,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(B),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(o,a){return i.type="throw",i.arg=e,n.next=o,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],i=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var l=o.call(s,"catchLoc"),c=o.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=e,s.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var a=o.arg;B(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={iterator:P(e),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=t),h}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=i}catch(e){Function("r","regeneratorRuntime = r")(i)}var l,c,u=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e}return e.prototype.sendRequest=function(e,t){var n=this;void 0===t&&(t=null),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){void 0!==e.status&&e.status?e.error&&"function"==typeof t&&t(e.data,e.message):console.warn(e.message)})).catch((function(e){console.warn(n.wpstgObject.i18n.somethingWentWrong,e)}))},e}(),d=function(){function e(){this.init()}var t=e.prototype;return t.init=function(){this.wpstdStagingTab=document.querySelector("#wpstg--tab--toggle--staging"),this.wpstdBackupTab=document.querySelector("#wpstg--tab--toggle--backup"),this.wpstdSidebarMenu=document.querySelector("#toplevel_page_wpstg_clone"),this.addEvents()},t.addEvents=function(){var e=this;null!==this.wpstdStagingTab&&this.wpstdStagingTab.addEventListener("click",(function(){e.setPageUrl("wpstg_clone"),e.setSidebarMenu("wpstg_clone")})),null!==this.wpstdBackupTab&&this.wpstdBackupTab.addEventListener("click",(function(){e.setPageUrl("wpstg_backup"),e.setSidebarMenu("wpstg_backup")}))},t.setPageUrl=function(e){window.history.pushState(null,null,window.location.pathname+"?page="+e)},t.setSidebarMenu=function(e){var t=this.wpstdSidebarMenu.querySelector("ul").querySelectorAll("li");if(t.length>0)for(var n=0;n<t.length;n++)t[n].classList.remove("current"),null!==t[n].querySelector("a")&&t[n].querySelector("a").getAttribute("href")==="admin.php?page="+e&&t[n].classList.add("current")},e}();c=jQuery,window.addEventListener("backups-tab",(function(){l.fetchListing(),new d})),window.addEventListener("backupListingFinished",(function(){fetch(ajaxurl+"?action=wpstg--backups--restore--file-list&_="+Math.random()+"&withTemplate=true",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--restore--file-list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(r.handleFetchErrors).then((function(e){return e.json()})).then((function(e){void 0!==e.success&&!1===e.success&&r.showError("Error: "+e.data);var t,n,o,a,i=c(".wpstg-backup-list ul");i.empty(),i.html(e),t=s("#wpstg-existing-backups"),n="click",o=".wpstg-tab-header",a=function(e){var t=s(e.getAttribute("data-id"));e.classList.toggle("expand"),e.classList.contains("expand")?(e.querySelector("span").classList.add("wpstg-rotate-90"),function(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}(t)):(e.querySelector("span").classList.remove("wpstg-rotate-90"),function(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}(t))},!t instanceof Element||t.addEventListener(n,(function(e){e.target.matches(o+", "+o+" *")&&a(e.target.closest(o),e)}),!1)})).catch((function(e){return r.showAjaxFatalError(e,"","Submit an error report.")}))})),window.addEventListener("finishedProcess",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),window.addEventListener("finishedProcessWithError",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)}));var p,g,w,h,f,m,y,b=l={performingCancelRequest:!1,isCancelled:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return l.messages.data.error.length>0||l.messages.data.critical.length>0},countByType:function(e){return void 0===e&&(e=l.messages.ERROR),l.messages.data[e].length},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){l.messages.addMessage(e)}));else{var t=e.type.toLowerCase()||"info";l.messages.data[t]||(l.messages.data[t]=[]),l.messages.data.all.push(e),l.messages.data[t].push(e)}},reset:function(){l.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:{totalSeconds:0,interval:null,start:function(){null===l.timer.interval&&(l.timer.interval=setInterval((function(){var e;c(".wpstg--modal--process--elapsed-time").text((e=l.timer.totalSeconds,console.log("Process running for "+e+" seconds"),""+new Date(1e3*e).toISOString().substr(11,8))),l.timer.totalSeconds++}),1e3))},stop:function(){l.timer.totalSeconds=0,l.timer.interval&&(clearInterval(l.timer.interval),l.timer.interval=null)}},status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(e){return void 0===e&&(e=!0),r.isLoading(!0),c("#backup-messages").text(""),e&&r.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(r.handleFetchErrors).then((function(e){return e.json()})).then((function(e){if(r.cache.get("#wpstg--tab--backup").html(e),void 0===e.success||!1!==e.success)return r.showAjaxFatalError(e,"","Submit an error report."),r.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),e;r.showError("Error: "+e.data)})).catch((function(e){return r.showAjaxFatalError(e,"","Submit an error report.")}))},cancel:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),l.timer.stop(),clearInterval(l.processInfo.interval),l.isCancelled=!0,l.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),r.closeSwalModal(),r.getSwalModal(!0).fire({title:"Cancelling & Cleaning up",text:"This modal will close automatically when done...",icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){l.sendCancelRequest(Object.assign({isInit:"yes"},e),t)}})},sendCancelRequest:function(e,t){l.performingCancelRequest||(l.performingCancelRequest=!0,r.ajax(Object.assign({action:"wpstg--backups--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,jobIdBeingCancelled:r.getJobId()},e),(function(n){l.performingCancelRequest=!1,l.isCancelled=!1,r.showAjaxFatalError(n,"","Submit an error report."),n.hasOwnProperty("status")||r.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),!0===n.status?(r.closeSwalModal(),null!=t&&t()):(e.isInit="no",l.sendCancelRequest(e,t))}),"json",!1,10,1.25,(function(n,o,a){l.performingCancelRequest=!1,r.continueErrorHandle=!1,423!==n.status?(r.closeSwalModal(),r.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),null!=t&&t()):setTimeout((function(){l.sendCancelRequest(e,t)}),1e3)})))},process:function(e){if(!("function"==typeof e.execute||e.data&&e.onResponse))return r.closeSwalModal(),void r.showError("process.data and / or process.onResponse is not set");if(!l.modal.process.html||!l.modal.process.cancelBtnTxt){var t=c("#wpstg--modal--backup--process"),n=t.html(),o=t.attr("data-cancelButtonText");l.modal.process.html=n||null,l.modal.process.cancelBtnTxt=o||null,t.remove()}c("body").off("click",".wpstg--modal--process--logs--tail").on("click",".wpstg--modal--process--logs--tail",(function(e){var t=c(this);e.preventDefault();var n=r.getSwalContainer(),o=c(n).find(".wpstg--modal--process--logs");o.toggle(),o.is(":visible")?(t.text(wpstg.i18n.hideLogs),n.childNodes[0].style.width="97%",n.style["z-index"]=9999):(t.text(wpstg.i18n.showLogs),n.childNodes[0].style.width="600px")})),e.isShowCancelButton=!1!==e.isShowCancelButton,l.modal.process.modal=r.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:l.modal.process.html,cancelButtonText:l.modal.process.cancelBtnTxt,showCancelButton:e.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var t=r.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);if(t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(e){confirm("Do you want to cancel the process?")&&l.cancel()})),"function"!=typeof e.execute)return e.data&&e.onResponse?void r.ajax(e.data,e.onResponse):(r.closeSwalModal(),void r.showError("process.data and / or process.onResponse is not set"));e.execute()},onAfterClose:function(){return"function"==typeof e.onAfterClose&&e.onAfterClose()}})},processResponse:function(e){if(null===e)throw r.closeSwalModal(),r.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var t=c(r.getSwalContainer());(e.title||e.statusTitle)&&t.find(".wpstg--modal--process--title").text(e.title||e.statusTitle),e.percentage&&t.find(".wpstg--modal--process--percent").text(e.percentage),function(){if(e.messages){for(var n,a=t.find(".wpstg--modal--process--logs"),r=[l.messages.ERROR,l.messages.CRITICAL],s=function e(t){if(Array.isArray(t))for(var n,s=o(t);!(n=s()).done;)e(n.value);else{var i="wpstg--modal--process--msg--"+t.type.toLowerCase();a.append('<p class="'+i+'">['+t.type+"] - ["+t.date+"] - "+t.message+"</p>"),r.includes(t.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:t.message}})),l.cancel({},(function(){setTimeout(l.logsModal,500)})))}},i=o(e.messages);!(n=i()).done;){var c=n.value;c&&(l.messages.addMessage(c),s(c))}if(a.is(":visible")&&a.scrollTop(a[0].scrollHeight),l.messages.shouldWarn()){var u=t.find(".wpstg--modal--process--logs--tail");u.html(u.attr("data-txt-bad")),u.find(".wpstg--modal--logs--critical-count").text(l.messages.countByType(l.messages.CRITICAL)),u.find(".wpstg--modal--logs--error-count").text(l.messages.countByType(l.messages.ERROR)),u.find(".wpstg--modal--logs--warning-count").text(l.messages.countByType(l.messages.WARNING))}}}(),e.jobId&&r.setJobId(e.jobId),!0===e.status&&!0===e.job_done&&(l.timer.stop(),l.isCancelled=!0,window.dispatchEvent(new CustomEvent("finishedProcess",{response:e})))},logsModal:function(){r.getSwalModal(!0,{popup:"wpstg-swal-popup centered-modal"}).fire({html:'<div class="wpstg--modal--error--logs" style="display:block"></div><div class="wpstg--modal--process--logs" style="display:block"></div>',width:"97%",onRender:function(){var e=c(r.getSwalContainer());e[0].style["z-index"]=9999;var t=e.find(".wpstg--modal--process--logs"),n=e.find(".wpstg--modal--error--logs"),a=c("#wpstg--js--translations"),s=l.messages,i=a.attr("data-modal-logs-title").replace("{critical}",s.countByType(s.CRITICAL)).replace("{errors}",s.countByType(s.ERROR)).replace("{warnings}",s.countByType(s.WARNING));n.before("<h3>"+i+"</h3>");var u=[l.messages.CRITICAL,l.messages.ERROR,l.messages.WARNING];l.messages.shouldWarn()||n.hide();for(var d,p=o(s.data.all);!(d=p()).done;){var g=d.value,w="wpstg--modal--process--msg--"+g.type.toLowerCase();u.includes(g.type)&&n.append('<p class="'+w+'">['+g.type+"] - ["+g.date+"] - "+g.message+"</p>"),t.append('<p class="'+w+'">['+g.type+"] - ["+g.date+"] - "+g.message+"</p>")}},onOpen:function(e){var t=c(e).find(".wpstg--modal--process--logs");t.scrollTop(t[0].scrollHeight)}})},downloadModal:function(e){var t=e.title,n=void 0===t?null:t,o=e.bodyText,a=void 0===o?null:o;if(null===l.modal.download.html){var s=c("#wpstg--modal--backup--download");l.modal.download.html=s.html(),s.remove()}r.getSwalModal(!0).fire({icon:"success",html:l.modal.download.html.replace("{title}",n).replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>').replace("{text}",null!==a?a:"You can download or restore this backup at any time on this website or even on another website to transfer this site."),confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0})},checkMemoryExhaustion:function(e,t){(new u).sendRequest(t,(function(t,n){e.messages=[{type:"critical",date:t.time,message:n+'. Visit <a target="_blank" href="'+r.memoryExhaustArticleLink+'">this article</a> for more detail. Please contact WP Staging support if you need help.'}],l.processResponse(e)}))},statusStop:function(){clearInterval(l.processInfo.interval),l.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(e){null===l.processInfo.interval&&(l.processInfo.interval=setInterval((function(){!0!==l.isCancelled?!1!==l.status.hasResponse&&(l.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&"+e+"=restore",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()})).then((function(e){if(l.status.hasResponse=!0,void 0===e&&l.statusStop(),l.processInfo.title!==e.currentStatusTitle){l.processInfo.title=e.currentStatusTitle;var t=c(r.getSwalContainer());t.find(".wpstg--modal--process--title").text(e.currentStatusTitle),t.find(".wpstg--modal--process--percent").text("0")}})).catch((function(e){l.status.hasResponse=!0,r.showAjaxFatalError(e,"","Submit an error report.")}))):l.statusStop()}),5e3))}};!function(e){window.addEventListener("backups-tab",(function(){p.listen()})),window.addEventListener("startedCreatingBackup",(function(){window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),p={listen:function(){e("body").off("click","#wpstg-new-backup",p.clickedBackup).on("click","#wpstg-new-backup",p.clickedBackup).off("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]").on("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]",p.warnExportMediaWithoutDatabase).off("change",'[name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent').on("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent',p.disableButtonIfNoSelection)},clickedBackup:function(n){return t(regeneratorRuntime.mark((function t(){var a,s,i,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.resetErrors(),n.preventDefault(),b.isCancelled=!1,b.modal.create.html&&b.modal.create.confirmBtnTxt||(a=e("#wpstg--modal--backup--new"),s=a.html(),i=a.attr("data-confirmButtonText"),b.modal.create.html=s||null,b.modal.create.confirmBtnTxt=i||null,a.remove()),t.next=6,r.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:"",html:b.modal.create.html,focusConfirm:!1,confirmButtonText:b.modal.create.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){var e=r.getSwalContainer();b.modal.create.hasBackupSchedule=!!b.modal.create.hasBackupSchedule||!e.querySelector("#repeatBackupOnSchedule").checked,b.processInfo.isOnlySchedule=!e.querySelector("#repeatBackupOnSchedule").checked&&!e.querySelector("#backupScheduleLaunch").checked;for(var t,n=[],a=o(e.querySelectorAll('input[name="storages"]:checked'));!(t=a()).done;){var s=t.value;n.push(s.value)}return{name:e.querySelector('input[name="backup_name"]').value||null,isExportingPlugins:null!==e.querySelector("#includePluginsInBackup:checked"),isExportingMuPlugins:null!==e.querySelector("#includeMuPluginsInBackup:checked"),isExportingThemes:null!==e.querySelector("#includeThemesInBackup:checked"),isExportingUploads:null!==e.querySelector("#includeMediaLibraryInBackup:checked"),isExportingOtherWpContentFiles:null!==e.querySelector("#includeOtherFilesInWpContent:checked"),isExportingDatabase:null!==e.querySelector("#includeDatabaseInBackup:checked"),repeatBackupOnSchedule:null!==e.querySelector("#repeatBackupOnSchedule:not(:checked)"),scheduleRecurrence:e.querySelector("#backupScheduleRecurrence").value||null,scheduleTime:e.querySelector("#backupScheduleTime").value||null,scheduleRotation:e.querySelector("#backupScheduleRotation").value||null,storages:n,isCreateScheduleBackupNow:null!==e.querySelector("#backupScheduleLaunch:checked")}},onRender:function(){!0===b.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!0})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="block"}))),!1===b.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!1})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="none"})))}});case 6:if(l=t.sent,c=l.value){t.next=10;break}return t.abrupt("return");case 10:b.process({execute:function(){b.messages.reset(),p.prepareBackup(c)}});case 11:case"end":return t.stop()}}),t)})))()},prepareBackup:function(e){r.ajax({action:"wpstg--backups--prepare-backup",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgBackupData:e},(function(e){e.success?(window.dispatchEvent(new Event("startedCreatingBackup")),b.timer.start(),p.createBackup()):r.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(r.continueErrorHandle=!1,b.shouldCleanUp=!1,r.closeSwalModal(),setTimeout((function(){b.shouldCleanUp=!0}),1e3),r.showErrorModal(e.responseJSON.data)):r.continueErrorHandle=!0}))},createBackup:function(){var t=0;r.resetErrors(),b.isCancelled?b.statusStop():r.ajax({action:"wpstg--backups--create",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(n){if(t=0,!b.isCancelled)if(void 0!==n)if(b.processResponse(n),b.processInfo.interval||b.statusStart("create"),"JOB_FAIL"===n.status&&b.checkMemoryExhaustion(n,"wpstg_backup"),!1===n.status)p.createBackup();else if(!0===n.status){if(e("#wpstg--progress--status").text("Backup successfully created!"),b.messages.shouldWarn())return b.fetchListing(),void b.logsModal();b.statusStop(),r.closeSwalModal(),b.fetchListing().then((function(){if(n.backupMd5||b.processInfo.isOnlySchedule)var t="",o=0,a=setInterval((function(){if(!b.processInfo.isOnlySchedule&&n.isLocalBackup){o++;var r=!1;if(n.isMultipartBackup?n.backupMd5.forEach((function(n){(t=e('.wpstg-backup[data-md5="'+n+'"] .wpstg--backup--download')).length&&(r=!0)})):(t=e('.wpstg-backup[data-md5="'+n.backupMd5+'"] .wpstg--backup--download'),r=t.length>0),!r)return void(o>=20&&clearInterval(a));clearInterval(a),n.hasOwnProperty("backupSize")&&n.backupSize}else clearInterval(a);b.downloadModal({title:b.processInfo.isOnlySchedule?"Backup Schedule Created":"Backup Complete",bodyText:b.processInfo.isOnlySchedule?"Backup is scheduled according to the provided settings.":null}),e(".wpstg--modal--download--logs--wrapper").show();var s=e(".wpstg--modal--process--logs");b.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase();s.append('<p class="'+t+'">['+e.type+"] - ["+e.date+"] - "+e.message+"</p>")}))}),500);else r.showError("Failed to get backup md5 from response")}))}else setTimeout((function(){p.createBackup()}),wpstg.delayReq);else setTimeout((function(){p.createBackup()}),wpstg.delayReq)}),"json",!1,0,1.25,(function(e,n,o){r.continueErrorHandle=!1,console.log(e);var a={messages:[]};++t<=10?p.createBackup():(a.messages.push({type:"critical",message:"There was a PHP fatal error while processing the backup. You might need to check your PHP error log to find out the reason. Please contact WPSTAGING support if you need help."}),b.processResponse(a),b.cancel(),setTimeout(b.logsModal,500))}))},warnExportMediaWithoutDatabase:function(){var e=document.getElementById("includeDatabaseInBackup").checked,t=document.getElementById("includeMediaLibraryInBackup").checked;document.getElementById("backupUploadsWithoutDatabaseWarning").style.display=t&&!e?"block":"none"},disableButtonIfNoSelection:function(){var t=e('[type="checkbox"][name="includedDirectories[]"]:checked').length>0,n=1===e("input#includeDatabaseInBackup:checked").length,o=1===e("input#includeOtherFilesInWpContent:checked").length;t||n||o?e(".wpstg--swal2-confirm").prop("disabled",!1):e(".wpstg--swal2-confirm").prop("disabled",!0)}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){g.listen()})),g={listen:function(){e("#wpstg--tab--backup").off("click",".wpstg-delete-backup[data-md5]",g.delete).on("click",".wpstg-delete-backup[data-md5]",g.delete)},delete:function(e){var t=this;e.preventDefault(),r.resetErrors();var n="Are you sure you want to delete this backup: "+this.getAttribute("data-name")+"?";r.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-btn-danger wpstg-link-btn"}).fire({showConfirmButton:!0,showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"warning",title:"Delete Backup!",html:'<div class="wpstg--modal--delete">'+n+"</div>"}).then((function(e){if(e.value){r.isLoading(!0),r.cache.get("#wpstg-existing-backups").hide();var n=t.getAttribute("data-md5");r.ajax({action:"wpstg--backups--delete",md5:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){r.showAjaxFatalError(e,""," Please submit an error report by using the REPORT ISSUE button."),r.isLoading(!1),b.fetchListing()}))}}))}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){w.listen()})),w={listen:function(){e("#wpstg--tab--backup").off("click",".wpstg--backup--edit[data-md5]",w.edit).on("click",".wpstg--backup--edit[data-md5]",w.edit)},edit:function(n){var o=this;return t(regeneratorRuntime.mark((function t(){var a,s,i,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),a=e(o),s=a.data("name"),i=a.data("notes"),t.next=6,r.getSwalModal().fire({title:"",html:'\n                    <label id="wpstg-backup-edit-name">Backup Name</label>\n                    <input id="wpstg-backup-edit-name-input" class="wpstg--swal2-input" value="'+s+'" maxlength="100">\n                    <label>Additional Notes</label>\n                    <textarea id="wpstg-backup-edit-notes-textarea" class="wpstg--swal2-textarea" maxlength="1000">'+i+"</textarea>\n                  ",focusConfirm:!1,confirmButtonText:"Save",showCancelButton:!0,preConfirm:function(){return{name:document.getElementById("wpstg-backup-edit-name-input").value||null,notes:document.getElementById("wpstg-backup-edit-notes-textarea").value||null}}});case 6:if(l=t.sent,c=l.value){t.next=10;break}return t.abrupt("return");case 10:r.ajax({action:"wpstg--backups--edit",accessToken:wpstg.accessToken,nonce:wpstg.nonce,md5:a.data("md5"),name:c.name,notes:c.notes},(function(e){r.showAjaxFatalError(e,"","Submit an error report."),b.fetchListing()}));case 11:case"end":return t.stop()}}),t)})))()}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){h.listen()})),h={listen:function(){e("body").off("click",".wpstg--backup--restore",h.clickedRestore).on("click",".wpstg--backup--restore",h.clickedRestore)},clickedRestore:function(e){var t=this;WPStaging.checkUserDbPermissions("restore").then((function(){r.resetErrors(),e.preventDefault(),b.isCancelled=!1,b.modal.restore.data.file=t.getAttribute("data-filePath"),h.selectedBackup()}))},selectedBackup:function(){r.ajax({action:"wpstg--backups--read-backup-metadata",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg:{file:b.modal.restore.data.file}},(function(t){var n;try{var o=(n=JSON.parse(r.getDataFromWordPressResponse(t))).networks[Object.keys(n.networks)[0]];n=o.blogs[Object.keys(o.blogs)[0]]}catch(e){r.showError(e)}b.modal.restore.data.backupMetadata=n;var a=new FormData;a.append("action","wpstg--backups--restore--file-info"),a.append("accessToken",wpstg.accessToken),a.append("nonce",wpstg.nonce),a.append("filePath",b.modal.restore.data.file),fetch(ajaxurl,{method:"POST",body:a}).then(r.handleFetchErrors).then((function(e){return e.json()})).then((function(e){b.modal.restore.retryCount=0,h.importModal(e,a)})).catch((function(e){return r.showAjaxFatalError(e,"","Submit an error report.")})),e(".wpstg--modal--actions .wpstg--swal2-confirm").show(),e(".wpstg--modal--actions .wpstg--swal2-confirm").prop("disabled",!1)}))},importModal:function(n){var o=function n(o,a,s){void 0===a&&(a=!1),void 0===s&&(s=null),r.resetErrors(),b.isCancelled?b.statusStop():(b.timer.start(),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),r.ajax({action:"wpstg--backups--restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,retry:a,errorCode:s},(function(t){if(!b.isCancelled)if(r.retry.reset(),void 0!==t)if(b.processResponse(t),b.processInfo.interval||b.statusStart("restore"),"JOB_FAIL"===t.status&&b.checkMemoryExhaustion(t,"wpstg_restore"),!1===t.status)n(o);else if(!0===t.status){if(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),e("#wpstg--progress--status").text("Backup successfully imported!"),b.messages.shouldWarn())return void b.logsModal();b.statusStop();var a='<div class="wpstg--modal--process--logs">'+e(".wpstg--modal--process--logs").get(1).innerHTML+"</div>",s=a.includes("wpstg--modal--process--msg--warning")||a.includes("wpstg--modal--process--msg--error")?"Issues(s) found!<br> ":"",i=b.modal.restore.data.backupMetadata.isExportingDatabase?"You will be redirected to the login page after closing this modal.":"";r.getSwalModal(!0,{container:"wpstg-restore-finished-container"}).fire({icon:"success",title:"Finished Successfully",html:'<div id="wpstg-restore-success" class="wpstg--grey">Site has been restored from backup. '+i+'  <br/><br/><span class="wpstg--modal--process--msg-found">'+s+'</span><button class="wpstg--modal--process--logs--tail" data-txt-bad="">Show Logs</button></div><br/>'+a,onClose:function(){b.modal.restore.data.backupMetadata.isExportingDatabase?(document.getElementById("wpstg-restore-wait").style.display="flex",setTimeout((function(){document.location.reload(!0)}),15e3),r.ajax({action:"raw_wpstg--backups--login-url",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){var t=new URL(e.data.loginUrl);t.searchParams.set("accessToken",wpstg.accessToken),t.searchParams.set("wpstgAfterRestore","yes"),window.location.href=t.toString()}))):b.fetchListing()}})}else setTimeout((function(){n(o)}),wpstg.delayReq);else setTimeout((function(){n(o)}),wpstg.delayReq)}),"json",!1,10,1.25,(function(e,a,s){var i=parseInt(e.status);if(b.checkMemoryExhaustion({messages:[]},"wpstg_restore"),r.retry.retryOnErrors.includes(i)&&r.retry.canRetry()){r.continueErrorHandle=!1,r.retry.incrementRetry();var l=r.retry.currentDelay;setTimeout(t(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(o,!0,i);case 1:case"end":return e.stop()}}),e)}))),l)}})))},a=e("#wpstg--modal--backup--restore");b.modal.restore.html=a.html(),b.modal.restore.baseDirectory=a.attr("data-baseDirectory"),b.modal.restore.btnTxtNext=a.attr("data-nextButtonText"),b.modal.restore.btnTxtConfirm=a.attr("data-confirmButtonText"),b.modal.restore.btnTxtCancel=a.attr("data-cancelButtonText"),r.getSwalModal().mixin({progressSteps:["1","2"]}).queue([{html:e(".wpstg--modal--backup--restore--introduction").first(),confirmButtonText:"Next",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:600,onRender:function(){e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").hide(),b.modal.restore.data.backupMetadata.isExportingDatabase&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").show(),console.log(b.modal.restore.data.backupMetadata),b.modal.restore.data.backupMetadata.isExportingDatabase&&"multi"===b.modal.restore.data.backupMetadata.singleOrMulti&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").show(),(b.modal.restore.data.backupMetadata.isExportingMuPlugins||b.modal.restore.data.backupMetadata.isExportingPlugins||b.modal.restore.data.backupMetadata.isExportingThemes||b.modal.restore.data.backupMetadata.isExportingUploads||b.modal.restore.data.backupMetadata.isExportingOtherWpContentFiles)&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").show()}},{html:n,confirmButtonText:"Restore",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:650}]).then((function(e){if(e&&e.value&&e.value[1]&&!0===e.value[1]){b.isCancelled=!1;var t=b.modal.restore.data;b.modal.restore.data.fileObject=null,t.file=b.modal.restore.baseDirectory+t.file,r.ajax({action:"wpstg--backups--prepare-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgRestoreData:t},(function(e){e.success?b.process({execute:function(){b.messages.reset(),o(t)}}):r.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(r.continueErrorHandle=!1,b.shouldCleanUp=!1,r.closeSwalModal(),setTimeout((function(){b.shouldCleanUp=!0}),1e3),r.showErrorModal(e.responseJSON.data)):r.continueErrorHandle=!0}))}}))}}}(jQuery),jQuery,window.addEventListener("backups-tab",(function(){f.listen()})),f={isUploading:!1,resumable:null,resumableFile:null,listen:function(){document.body.addEventListener("click",(function(e){"wpstg-upload-backup"===e.target.id&&f.uploadModal()}))},uploadNotSupported:function(){r.showErrorModal("Your browser do not support the File API, needed for the uploads. Please try a different/updated browser, or upload the Backup using FTP to the folder <strong>wp-content/uploads/wp-staging/backups</strong>")},setModalStateStart:function(){f.isUploading=!1,s(".wpstg--swal2-container #wpstg-upload-select").style.display="block",s(".wpstg--swal2-container #wpstg-upload-progress").style.display="none",s(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="none"},setModalStateUploading:function(){f.isUploading=!0,s(".wpstg--swal2-container #wpstg-upload-select").style.display="none",s(".wpstg--swal2-container #wpstg-upload-progress").style.display="block",s(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="block",s(".wpstg--swal2-container .wpstg--modal--upload--process").style.display="flex";var e=r.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",f.eventListenerConfirmCancelUpload)},eventListenerConfirmCancelUpload:function(){confirm("Do you want to abort the upload?")&&(f.resumable.cancel(),r.closeSwalModal(),f.deleteUnfinishedUploads())},deleteUnfinishedUploads:function(){r.ajax({action:"wpstg--backups--uploads-delete-unfinished",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){}))},uploadModal:function(){r.getSwalModal(!0).fire({html:document.getElementById("wpstg--modal--backup--upload").innerHTML,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!0,width:650,allowEscapeKey:function(){return!f.isUploading},allowOutsideClick:function(){return!f.isUploading},onRender:function(){if(f.deleteUnfinishedUploads(),f.setModalStateStart(),f.resumable=new Resumable({target:wpstg.ajaxUrl,chunkSize:wpstg.maxUploadChunkSize,query:{accessToken:wpstg.accessToken,action:"wpstg--backups--restore--file-upload",uniqueIdentifierSuffix:Math.floor(99999999*Math.random())},permanentErrors:[400,401,403,404,409,415,500,501,507,413],fileType:["wpstg",wpstg.backupDBExtension],simultaneousUploads:1,prioritizeFirstAndLastChunk:!1,testChunks:!1,forceChunkSize:!0}),f.resumable.resumableFile=null,!f.resumable.support)return r.closeSwalModal(),void f.uploadNotSupported();f.resumable.assignBrowse(s(".wpstg--swal2-container .resumable-browse")),f.resumable.assignDrop(s(".wpstg--swal2-container .resumable-drop")),f.resumable.on("fileAdded",f.handleFileAdded),f.resumable.on("fileSuccess",f.handleFileSuccess),f.resumable.on("error",f.handleError),f.resumable.on("progress",f.handleProgress)}})},handleFileAdded:function(e){f.setModalStateUploading(),f.resumable.resumableFile=e,f.resumable.upload()},handleFileSuccess:function(e,t){r.closeSwalModal(),r.showSuccessModal(s("#wpstg--modal--backup--upload").getAttribute("data-uploadSuccessMessage","Upload finished")),b.fetchListing()},handleProgress:function(){var e=Math.floor(100*f.resumable.progress());s(".wpstg--swal2-container .wpstg--modal--upload--progress").style.width=e+"%",s(".wpstg--swal2-container .wpstg--modal--upload--progress--title > span").textContent=e+"%"},handleError:function(e,t){try{var n=JSON.parse(e);if(n.hasOwnProperty("data")&&n.data.hasOwnProperty("message")){if(n.data.hasOwnProperty("isDiskFull")&&n.data.isDiskFull)return f.resumable.cancel(),r.closeSwalModal(),void r.showErrorModal(n.data.message);if(n.data.hasOwnProperty("backupFailedValidation")&&n.data.backupFailedValidation)return f.resumable.cancel(),r.closeSwalModal(),void r.showErrorModal(n.data.message)}}catch(e){}var o=Math.max(262144,.1*f.resumable.opts.chunkSize);f.resumable.opts.chunkSize=Math.ceil(f.resumable.opts.chunkSize-o),f.resumable.opts.chunkSize<65536&&(r.closeSwalModal(),r.showErrorModal("We could not upload the backup file, please try uploading it directly using FTP to the folder wp-content/uploads/wp-staging/backups. Please also make sure you have enough free disk space on the server.")),f.deleteUnfinishedUploads(),console.log(f.resumable.opts.chunkSize),f.resumable.files[0].retry()}},function(e){window.addEventListener("backups-tab",(function(){m.listen()})),m={listen:function(){e("body").off("click",".wpstg--backup--download-modal",m.clickedDownload).on("click",".wpstg--backup--download-modal",m.clickedDownload)},clickedDownload:function(e){r.resetErrors(),e.preventDefault(),b.isCancelled=!1,b.modal.download.data.indexFile=this.getAttribute("data-filePath"),m.downloadModal()},renderPart:function(t,n){var o='<div class="wpstg--backups--part">\n        <h2>'+t.name+"</h2>\n        <p>File Size: "+t.fileSize+'</p>\n        <a download href="'+t.downloadLink+'">Download</a>\n      </div>';e(n).append(o)},downloadModal:function(){r.resetErrors();var t=e("#wpstg--modal--backup--download-modal");b.modal.download.html=t.html(),r.getSwalModal(!1).fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Cancel",title:"Download Backup",html:b.modal.download.html,onRender:function(){e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").html(""),e(".wpstg--modal--download--parts-container").show(),r.ajax({action:"wpstg--backups--parts",accessToken:wpstg.accessToken,nonce:wpstg.nonce,filePath:b.modal.download.data.indexFile},(function(t){if(!b.isCancelled){if(void 0===t)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();if(!0===t.error)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();t.parts.forEach((function(e){m.renderPart(e,".wpstg--modal--download--parts-container .wpstg--modal--download--parts")})),e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").show()}}),"json",!1,0,1.25)}}).then()}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){y.listen()})),y={listen:function(){document.body.addEventListener("click",(function(e){"wpstg-manage-backup-schedules"===e.target.id&&y.manageSchedulesModal()})),e("body").on("click",".wpstg--edit-schedule-basic",y.showAlertForBasic)},showAlertForBasic:function(e){r.resetErrors(),e.preventDefault(),alert("Please upgrade to WP Staging Pro to edit existing backup plans. You can delete this plan and create a new one if you want to change it.")},manageSchedulesModal:function(){y.fetchSchedules(),r.getSwalModal(!1).fire({html:document.getElementById("wpstg--modal--backup--manage--schedules").innerHTML,showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,cancelButtonText:"Close",confirmButtonText:"Save",width:750,allowEscapeKey:!0,allowOutsideClick:!0})},fetchSchedules:function(){r.ajax({action:"wpstg--backups-fetch-schedules",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){s(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content").innerHTML=e.data,document.querySelectorAll(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content .wpstg--dismiss-schedule").forEach((function(e){e.addEventListener("click",(function(e){confirm("Do you really want to delete this schedule?")&&y.dismissSchedule(e.target)}))}))}))},dismissSchedule:function(e){var t=e.dataset.scheduleId;r.ajax({action:"wpstg--backups-dismiss-schedule",accessToken:wpstg.accessToken,nonce:wpstg.nonce,scheduleId:t},(function(e){e.success?(y.fetchSchedules(),b.fetchListing(),b.modal.create.hasBackupSchedule=!1,console.log(e)):r.showErrorModal(e.data)}))}}}(jQuery)}();
//# sourceMappingURL=wpstg-backup.min.js.map
