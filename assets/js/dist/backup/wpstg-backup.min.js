!function(){"use strict";function e(){e=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",i=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var s=t&&t.prototype instanceof h?t:h,a=Object.create(s.prototype),i=new L(r||[]);return o(a,"_invoke",{value:S(e,n,i)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p={};function h(){}function g(){}function f(){}var w={};l(w,a,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(T([])));y&&y!==n&&r.call(y,a)&&(w=y);var b=f.prototype=h.prototype=Object.create(w);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(o,s,a,i){var c=d(e[o],e,s);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var s;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return s=s?s.then(o,o):o()}})}function S(e,t,n){var r="suspendedStart";return function(o,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw s;return B()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var i=E(a,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function E(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=d(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var s=o.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function T(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:B}}function B(){return{value:void 0,done:!0}}return g.prototype=f,o(b,"constructor",{value:f,configurable:!0}),o(f,"constructor",{value:g,configurable:!0}),g.displayName=l(f,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},t.awrap=function(e){return{__await:e}},v(k.prototype),l(k.prototype,i,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,o,s){void 0===s&&(s=Promise);var a=new k(u(e,n,r,o),s);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},v(b),l(b,c,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=T,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var i=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(i&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function t(e,t,n,r,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(o,s){var a=e.apply(n,r);function i(e){t(a,o,s,i,c,"next",e)}function c(e){t(a,o,s,i,c,"throw",e)}i(void 0)}))}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t,n,r){var o,s,a,i,c=!1,l=!1,u={},d=0,p=0,h={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function g(e){o=e.clientX,s=e.clientY}function f(e,t){if(p&&(p=clearTimeout(p)),Math.abs(a-o)+Math.abs(i-s)<h.sensitivity)return d=1,l?void 0:n(e,t);a=o,i=s,p=setTimeout((function(){f(e,t)}),h.interval)}function w(e,t){return c=!0,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",g,!1),1!==d&&(a=t.clientX,i=t.clientY,e.addEventListener("mousemove",g,!1),p=setTimeout((function(){f(e,t)}),h.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&w(e.target.closest(t),e)}function y(e,t){return c=!1,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",g,!1),1===d&&(p=setTimeout((function(){!function(e,t){p&&(p=clearTimeout(p)),d=0,l||r(e,t)}(e,t)}),h.timeout)),this}function b(e){e.target.matches(t+", "+t+" *")&&y(e.target.closest(t),e)}function v(e){var r,o;e.target.matches(t+", "+t+" *")&&(r=e.target.closest(t),o=e,c||(l=!0,n(r,o)))}function k(e){var n,o;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),o=e,!c&&l&&(l=!1,r(n,o)))}function S(){e.removeEventListener("focus",v,!1),e.removeEventListener("blur",k,!1)}return u.options=function(t){var n=t.handleFocus!==h.handleFocus;return h=Object.assign({},h,t),n&&(h.handleFocus?(e.addEventListener("focus",v,!1),e.addEventListener("blur",k,!1)):S()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",b,!1),S())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",b,!1)),u}var a=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e}return t.prototype.sendRequest=function(){var t=n(e().mark((function t(n){var r,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:n,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return r=e.sent,e.next=6,r.json();case 6:if(void 0===(o=e.sent).status||!o.status||!o.error){e.next=9;break}return e.abrupt("return",o);case 9:console.warn(o.message),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.somethingWentWrong,e.t0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),t,this,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),t}(),i=function(t){var r={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),r.retry.performingRequest=!0,0===r.retry.currentDelay&&(r.retry.currentDelay=1e3,r.retry.count=1),r.retry.currentDelay+=500*r.retry.count*e,r.retry.count++},canRetry:function(){return r.retry.count<r.retry.max},reset:function(){r.retry.currentDelay=0,r.retry.count=0,r.retry.performingRequest=!1}},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(e){return-1!==t.inArray(e,this.elements)||(this.elements[e]=t(e)),this.elements[e]},refresh:function(e){e.elements[e]=t(e)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(t){return n(e().mark((function n(){var r,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new a,e.next=3,r.sendRequest(t);case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),n)})))()},listenTooltip:function(){s(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){t.target.closest(".wpstg--tooltiptext a")||(e.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},r={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(r)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?r.cache.get(".wpstg-loader").show():r.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(e){return null===e?e:e.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(e){return null===e?e:e.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(e,t,n){return t=t?t+"<br/><br/>":"Something went wrong! <br/><br/>",n=n?n+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(r.showError(t+" Error: No response."+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(r.showError(t+" Error: "+e.message+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},showFirewallError:function(){return"Please whitelist all ajax requests coming from <code>action=wpstg_</code>. ","If possible put your firewall into learning mode and try again.<br><br>","Please ask your hosting provider or security plugin to permanetely ","whitelist WP Staging requests. If it still fails, please contact us.","WP Staging is blocked by a security plugin or firewall setting. Please whitelist all ajax requests coming from <code>action=wpstg_</code>. If possible put your firewall into learning mode and try again.<br><br>Please ask your hosting provider or security plugin to permanetely whitelist WP Staging requests. If it still fails, please contact us."},handleFetchErrors:function(e){if(!e.ok){var t=!1,n="Error: "+e.status+" - "+e.statusText+". ";403===e.status||405===e.status||406===e.status?(n+=r.showFirewallError(),t=!0):n+="Please try again or contact support.",t&&r.showErrorModal(n),r.showError(n)}return e},showError:function(e){r.retry.performingRequest||(r.cache.get("#wpstg-try-again").css("display","inline-block"),r.cache.get("#wpstg-cancel-cloning").text("Reset"),r.cache.get("#wpstg-resume-cloning").show(),r.cache.get("#wpstg-error-wrapper").show(),r.cache.get("#wpstg-error-details").show().html(e),r.cache.get("#wpstg-removing-clone").removeClass("loading"),r.cache.get(".wpstg-loader").hide(),t(".wpstg--modal--process--generic-problem").show().html(e))},resetErrors:function(){r.cache.get("#wpstg-error-details").hide().html("")},ajax:function(e,n,o,s,a,i,c){void 0===i&&(i=null),void 0===c&&(c=null),void 0===o&&(o="json"),!1!==s&&(s=!0),a=void 0===a?0:a;var l=wpstg.maxFailedRetries,u=1e4*a;i=parseInt(i),isNaN(i)||(u*=i),t.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:o,cache:!1,data:e,error:function(t,d,p){if(console.log(t.status+" "+t.statusText+"---"+d),"function"!=typeof c||(c(t,d,p),r.continueErrorHandle))if(++a<=l)setTimeout((function(){r.ajax(e,n,o,s,a,i)}),u);else{var h=void 0===t.status?"Unknown":t.status,g="Fatal Error:  "+h+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.";403!==h&&405!==h&&406!==h||(g="Fatal Error:  "+h+" "+r.showFirewallError()),r.showError(g)}else r.continueErrorHandle=!0},success:function(e){"function"==typeof n&&n(e)},statusCode:{404:function(){a>=l&&r.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){a>=l&&r.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){a>l&&r.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},502:function(){a>=l&&r.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},503:function(){a>=l&&r.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},429:function(){a>=l&&r.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},403:function(){showError("Error 403 - "+r.showFirewallError())},405:function(){showError("Error 405 - "+r.showFirewallError())},406:function(){showError("Error 406 - "+r.showFirewallError())}}})}};return r}(jQuery),c=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",i=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var s=t&&t.prototype instanceof m?t:m,a=Object.create(s.prototype),i=new I(r||[]);return o(a,"_invoke",{value:L(e,n,i)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",h="suspendedYield",g="executing",f="completed",w={};function m(){}function y(){}function b(){}var v={};l(v,a,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(U([])));S&&S!==n&&r.call(S,a)&&(v=S);var E=b.prototype=m.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,s,a,i){var c=d(e[o],e,s);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var s;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return s=s?s.then(o,o):o()}})}function L(e,t,n){var r=p;return function(o,s){if(r===g)throw new Error("Generator is already running");if(r===f){if("throw"===o)throw s;return M()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var i=T(a,n);if(i){if(i===w)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var c=d(e,t,n);if("normal"===c.type){if(r=n.done?f:h,c.arg===w)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=f,n.method="throw",n.arg=c.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),w;var s=d(o,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,w;var a=s.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,w):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,w)}function B(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(B,this),this.reset(!0)}function U(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,s=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:M}}function M(){return{value:t,done:!0}}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=l(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},x(C.prototype),l(C.prototype,i,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,r,o,s){void 0===s&&(s=Promise);var a=new C(u(t,n,r,o),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(E),l(E,c,"Generator"),l(E,a,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=U,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return i.type="throw",i.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,w):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:U(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),w}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=c}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}function l(e){return document.querySelector(e)}function u(e,t,n,r){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&r(e.target.closest(n),e)}),!1)}function d(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function p(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function h(e,t){for(var n=e.previousElementSibling;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function g(e){document.querySelectorAll(e).forEach((function(e){e.style.display="none"}))}function f(e){document.querySelectorAll(e).forEach((function(e){e.style.display="block"}))}function w(e){var t,n=function(e){return"string"==typeof e?e:e&&"object"==typeof e&&e.target&&e.target.getAttribute("data-copy-content")?e.target.getAttribute("data-copy-content"):e instanceof Element&&e.getAttribute("data-wpstg-source")?document.querySelector(e.getAttribute("data-wpstg-source")).value:null}(e);n||m("error","No content to copy"),navigator.clipboard&&window.isSecureContext?(t=n,navigator.clipboard.writeText(t).then((function(){m("success","Copied to clipboard")})).catch((function(e){m("error","Unable to copy to clipboard")}))):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();var n=document.execCommand("copy");m(n?"success":"error",n?"Copied to clipboard":"Unable to copy to clipboard"),document.body.removeChild(t)}(n)}function m(e,t){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:e,message:t})}function y(e){void 0===e&&(e="visible");var t,n=(t=".wpstg-loading-placeholder-container",document.querySelectorAll(t));n.forEach((function(t){t&&(t.style.visibility=e)})),setTimeout((function(){n.forEach((function(e){e&&"visible"===e.style.visibility&&(e.style.visibility="hidden")})),k()}),5e3);var r=l(".wpstg--tab--contents");if("visible"===e)return function(e){void 0===e&&(e="visible"),document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(t){t&&(t.style.visibility=e)}))}(),void(r&&(r.style.overflow="hidden"));k(),r&&(r.style.overflow="unset")}function b(e){return v.apply(this,arguments)}function v(){return(v=n(e().mark((function t(n){var r,o,s,a,i,c;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=""),""===n&&(n=l(".wpstg--tab--contents")),null!==n){e.next=4;break}return e.abrupt("return");case 4:if(r=n.querySelector(".wpstg-loading-placeholder-container"),o=r.querySelector(".wpstg-dom-loading-wrapper")){e.next=8;break}return e.abrupt("return");case 8:if(o.offsetHeight===n.offsetHeight){e.next=19;break}o.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(e){return e.remove()})),null==(s=o.querySelector(".wpstg-loading-line"))||s.remove(),null==(a=o.querySelector(".wpstg-loading-last-line-bar"))||a.remove();case 13:return o.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),e.next=16,new Promise((function(e){return setTimeout(e,0)}));case 16:if(o.offsetHeight<=n.offsetHeight-40){e.next=13;break}case 17:null==(i=o.firstElementChild)||i.classList.add("wpstg-loading-first-line-bar"),null==(c=o.lastElementChild)||c.classList.add("wpstg-loading-last-line-bar");case 19:return e.next=21,new Promise((function(e){return setTimeout(e,0)}));case 21:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function k(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(e){e&&(e.style.visibility="hidden")}))}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var S,E,x=function(){function e(e,t){void 0===e&&(e="contact-us"),void 0===t&&(t=wpstg),this.wpstgObject=t,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=e,this.init()}var t=e.prototype;return t.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.askInTheForumForm=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-form",this.contactUsSuccessPopup=this.contactUsModal+" #wpstg-"+this.modalType+"-success-form",this.contactUsLoader=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-loader",this.contactUsSupport=this.contactUsModal+" #wpstg-"+this.modalType+"-support-forum",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.reportIssueButton=document.querySelector("#wpstg-contact-us-report-issue"),this.successForm=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" #wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector("#wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()},t.addEvents=function(){var e=this;document.addEventListener("keydown",(function(t){"Escape"===t.key&&(g(e.contactUsModal),g(e.askInTheForumForm),g(e.contactUsSuccessPopup),g(e.contactUsSupport),e.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){f(e.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){f(e.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){e.isDebugWindowOpened?g(e.askInTheForumForm):f(e.askInTheForumForm),e.isDebugWindowOpened=!e.isDebugWindowOpened,e.toggleActiveClass()})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){e.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){g(e.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){g(e.contactUsModal),g(e.contactUsSupport),g(e.askInTheForumForm),e.isDebugWindowOpened=!1,e.toggleActiveClass()})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){e.contactUsDebugCodeField.select(),e.contactUsDebugCodeField.setSelectionRange(0,99999),w(e.contactUsDebugCodeField.value)}))},t.generateDebugCode=function(e){for(var t="",n=0;n<e;n++)t+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+t+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},t.sendDebugInfo=function(){var e=this;f(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0;var t=this.generateDebugCode(8),n=!1;this.contactUsForceSendDebugLog&&(n=this.contactUsForceSendDebugLog.checked),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_send_debug_log_report",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,debugCode:t,forceSend:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(e.contactUsReportIssueBtn.disabled=!1,t.ok)return t.json()})).then((function(n){var r,o;!0===(null==(r=n.response)?void 0:r.sent)&&(e.contactUsDebugCodeField.value=t,f(e.contactUsSuccessPopup),window.debugCode=t,g(e.contactUsForceSendDebugLogContainer),e.contactUsForceSendDebugLog.checked=!1),!1===(null==(o=n.response)?void 0:o.sent)&&"already_submitted"===n.response.status&&(f(e.contactUsForceSendDebugLogContainer),m("error",n.response.message)),g(e.contactUsLoader)})).catch((function(t){g(e.contactUsLoader),f(e.contactUsSupport),console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},t.toggleActiveClass=function(){this.isDebugWindowOpened||!this.reportIssueButton.classList.contains("active")?this.isDebugWindowOpened&&this.reportIssueButton.classList.add("active"):this.reportIssueButton.classList.remove("active")},e}(),C=new(function(){function e(){this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}var t=e.prototype;return t.setCallbackOnHide=function(e){this.callbackOnHide=e},t.shows=function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()},t.addUnloadEvent=function(){window.addEventListener("beforeunload",(function(e){e.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))},t.createIframeElement=function(){var e=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return e.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement},t.handleIframeLoad=function(){var e,t;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{e=(t=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(e){return void this.handleIframeLoadError()}t&&e?t.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=e+40+"px":this.handleIframeLoadError()},t.handleIframeLoadError=function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()},t.openModal=function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")},t.focusIframe=function(){this.iframeElement.focus()},t.setIframeLoadTimeout=function(){var e=this;setTimeout((function(){e.isIframeLoaded||(e.wrapElement.classList.add("fallback"),e.formElement.remove(),e.noFrameElement.focus())}),2e3)},t.focusFallbackElement=function(){this.noFrameElement.focus()},t.hide=function(){var e,t;window.removeEventListener("beforeunload",(function(e){e.returnValue=null})),e=this.wrap,void 0===(t=200)&&(t=300),e.style.opacity=1,e.style.transitionProperty="opacity",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.opacity=0,window.setTimeout((function(){e.style.display="none",e.style.removeProperty("opacity"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0),this.callbackOnHide&&this.callbackOnHide()},e}()),L=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.count=0,this.status=!0,this.isAuthenticated=!0}var r=t.prototype;return r.start=function(){var e=this;this.status&&setTimeout((function(){e.checkUserAuthentication()}),1e3)},r.stop=function(){this.resetCount(),this.status=!1},r.resetCount=function(){this.count=0},r.checkUserAuthentication=function(){var t=n(e().mark((function t(){var n=this;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(!1===e.wpAuthCheck&&n.count++,n.isAuthenticated=e.wpAuthCheck,2===n.count)return n.stop(),void n.createAuthCheckElements(e.redirectUrl);n.start()})).catch((function(e){console.error("Error:",e)}));case 1:case"end":return e.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.createAuthCheckElements=function(e){var t=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var n=document.createElement("div");n.id="wpstg-auth-check-wrap",n.classList.add("hidden");var r=document.createElement("div");r.id="wpstg-auth-check-bg";var o=document.createElement("div");o.id="wpstg-auth-check";var s=document.createElement("div");s.id="wpstg-auth-check-form",s.classList.add("loading"),s.dataset.src=e+"?interim-login=1&wp_lang=en_US";var a=document.createElement("div");a.classList.add("wpstg-auth-fallback");var i=document.createElement("p");i.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var c=document.createElement("p");c.innerHTML='<a href="'+e+'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.';var l=document.createElement("button");l.type="button",l.classList.add("wpstg-auth-check-close","button-link"),l.innerHTML='<span class="screen-reader-text">Close dialog</span>',l.addEventListener("click",(function(){n.classList.add("hidden")})),o.append(l,s,a),a.append(i,c),n.append(r,o),document.body.appendChild(n),C.setCallbackOnHide((function(){t.checkUserAuthentication()})),C.shows()},t}(),T=new L;E=jQuery,window.addEventListener("backups-tab",(function(){var e=l("#wpstg--tab--backup");e.style.minHeight=e.offsetHeight,S.fetchListing()})),window.addEventListener("backupListingFinished",(function(){fetch(ajaxurl+"?action=wpstg--backups--restore--file-list&_="+Math.random()+"&withTemplate=true",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--restore--file-list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(i.handleFetchErrors).then((function(e){return e.json()})).then((function(e){void 0!==e.success&&!1===e.success&&i.showError("Error: "+e.data);var t=document.querySelector(".wpstg-backup-list ul");t&&(t.innerHTML=e,function(e){void 0===e&&(e=""),null!==e&&e||(e=document);var t=e.querySelector(".wpstg-corrupted-backup");t&&document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-corrupted-backups-min-height")}));var n=e.querySelector(".wpstg-invalid-backup-tabs");!e.querySelector(".wpstg-automated-backup")&&!n||t||document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-multiparts-backups-min-height")}))}(t)),y("hidden"),document.getElementById("wpstg--tab--backup").style.minHeight="max-content",u(l("#wpstg-existing-backups"),"click",".wpstg-tab-header",(function(e,t){var n=l(e.getAttribute("data-id"));e.classList.toggle("expand"),e.classList.contains("expand")?(e.querySelector("span").classList.add("wpstg-rotate-90"),d(n)):(e.querySelector("span").classList.remove("wpstg-rotate-90"),p(n)),t.stopImmediatePropagation()}))})).catch((function(e){return i.showAjaxFatalError(e,"","Submit an error report.")}))})),window.addEventListener("finishedProcess",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),window.addEventListener("finishedProcessWithError",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)}));var B,P,I,U,M=S={performingCancelRequest:!1,isBackupSlowerThanUsual:!1,isBackupSpeedModalDisplayed:!1,isCancelled:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1,isBackupCreationInBackground:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},upload:{html:null,confirmBtnTxt:null,retryCount:0,data:{file:null}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return S.messages.data.error.length>0||S.messages.data.critical.length>0},countByType:function(e){return void 0===e&&(e=S.messages.ERROR),S.messages.data[e].length},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){S.messages.addMessage(e)}));else if(e.type){var t=e.type.toLowerCase()||"info";S.messages.data[t]||(S.messages.data[t]=[]),S.messages.data.all.push(e),S.messages.data[t].push(e)}},reset:function(){S.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:{totalSeconds:0,interval:null,start:function(){null===S.timer.interval&&(S.timer.interval=setInterval((function(){var e;E(".wpstg-backup-process-elapsed-time").text((e=S.timer.totalSeconds,""+new Date(1e3*e).toISOString().substr(11,8))),T.isAuthenticated&&S.timer.totalSeconds++}),1e3))},stop:function(){S.timer.totalSeconds=0,S.timer.interval&&(clearInterval(S.timer.interval),S.timer.interval=null)}},status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(e){return void 0===e&&(e=!0),i.isLoading(!0),E("#backup-messages").text(""),e&&i.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(i.handleFetchErrors).then((function(e){return e.json()})).then((function(e){var t=l("#wpstg--tab--backup");return t.style.minHeight=t.offsetHeight+"px",E("#wpstg--tab--backup").empty(),S.modal.create.html=null,i.cache.get("#wpstg--tab--backup").html(e),void 0!==e.success&&!1===e.success?(i.showError("Error: "+e.data),void y("hidden")):(i.showAjaxFatalError(e,"","Submit an error report."),i.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),E("#local-backup-title").show(),E("#cloud-backup-title").hide(),e)})).catch((function(e){return i.showAjaxFatalError(e,"","Submit an error report.")}))},cancel:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),S.timer.stop(),clearInterval(S.processInfo.interval),S.isCancelled=!0,S.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),i.closeSwalModal(),i.getSwalModal(!0).fire({title:"Cancelling & Cleaning up",text:"This modal will close automatically when done...",icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){S.sendCancelRequest(Object.assign({isInit:"yes"},e),t)}})},sendCancelRequest:function(e,t){S.performingCancelRequest||(S.performingCancelRequest=!0,i.ajax(Object.assign({action:"wpstg--backups--cancel",accessToken:wpstg.accessToken,nonce:wpstg.nonce,jobIdBeingCancelled:i.getJobId()},e),(function(n){S.performingCancelRequest=!1,S.isCancelled=!1,i.showAjaxFatalError(n,"","Submit an error report."),n.hasOwnProperty("isRunning")||i.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),!1===n.isRunning?(T.stop(),i.closeSwalModal(),null!=t&&t()):(e.isInit="no",S.sendCancelRequest(e,t))}),"json",!1,1,1.25,(function(n,r,o){S.performingCancelRequest=!1,i.continueErrorHandle=!1,423!==n.status?(i.closeSwalModal(),i.showErrorModal("Cancel process did not finish gracefully. Some temporary files might not have been cleaned up."),null!=t&&t()):setTimeout((function(){S.sendCancelRequest(e,t)}),1e3)})))},process:function(e){if(!("function"==typeof e.execute||e.data&&e.onResponse))return i.closeSwalModal(),void i.showError("process.data and / or process.onResponse is not set");if(!S.modal.process.html||!S.modal.process.cancelBtnTxt){var t=E("#wpstg-backup-process-modal"),n=t.html(),r=t.attr("data-cancelButtonText");S.modal.process.html=n||null,S.modal.process.cancelBtnTxt=r||null,t.remove()}E("body").off("click",".wpstg-backup-process-logs-button").on("click",".wpstg-backup-process-logs-button",(function(e){S.showLogsInModal(e)})).off("click",".wpstg-backup-success-logs-button").on("click",".wpstg-backup-success-logs-button",(function(e){S.showLogsInModal(e,"success")})),e.isShowCancelButton=!1!==e.isShowCancelButton,S.modal.process.modal=i.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:S.modal.process.html,cancelButtonText:S.modal.process.cancelBtnTxt,showCancelButton:e.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var t=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);if(t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(e){confirm("Do you want to cancel the process?")&&S.cancel()})),"function"!=typeof e.execute)return e.data&&e.onResponse?void i.ajax(e.data,e.onResponse):(i.closeSwalModal(),void i.showError("process.data and / or process.onResponse is not set"));e.execute()},onAfterClose:function(){return"function"==typeof e.onAfterClose&&e.onAfterClose()}})},processResponse:function(e){if(null===e)throw i.closeSwalModal(),i.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var t=E(i.getSwalContainer());(e.title||e.statusTitle)&&t.find(".wpstg-backup-process-title").text(e.title||e.statusTitle),e.percentage&&t.find(".wpstg-backup-process-percent").text(e.percentage),S.addResponseMessagesToLog(e),e.jobId&&i.setJobId(e.jobId),!1===e.isRunning&&!0===e.job_done&&("Backup"===e.job&&S.calculateBackupSpeedIndex(e.backupSize,S.timer.totalSeconds),S.timer.stop(),S.isCancelled=!0,e.status=!e.isRunning,window.dispatchEvent(new CustomEvent("finishedProcess",{response:e})))},logsModal:function(){i.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--modal--error--logs" style="display:block"></div><div class="wpstg-backup-process-logs" style="display:block"></div>',width:"97%",onRender:function(){var e=E(i.getSwalContainer());e[0].style["z-index"]=9999;var t=e.find(".wpstg-backup-process-logs"),n=e.find(".wpstg--modal--error--logs"),r=E("#wpstg--js--translations"),s=S.messages,a=r.attr("data-modal-logs-title").replace("{critical}",s.countByType(s.CRITICAL)).replace("{errors}",s.countByType(s.ERROR)).replace("{warnings}",s.countByType(s.WARNING));n.before("<h3>"+a+"</h3>");var c=[S.messages.CRITICAL,S.messages.ERROR,S.messages.WARNING];S.messages.shouldWarn()||n.hide();for(var l,u=o(s.data.all);!(l=u()).done;){var d=l.value,p="wpstg--modal--process--msg--"+d.type.toLowerCase();c.includes(d.type)&&n.append('<p class="'+p+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>"),t.append('<p class="'+p+'">['+d.type+"] - ["+d.date+"] - "+d.message+"</p>")}},onOpen:function(e){var t=E(e).find(".wpstg-backup-process-logs");t.scrollTop(t[0].scrollHeight)}})},addResponseMessagesToLog:function(e){if(e.messages){for(var t,n=E(".wpstg-backup-process-logs"),r=[S.messages.ERROR,S.messages.CRITICAL],s=function e(t){if(Array.isArray(t))for(var s,a=o(t);!(s=a()).done;)e(s.value);else if(t.type){var i="wpstg--modal--process--msg--"+t.type.toLowerCase();n.append('<p class="'+i+'">['+t.type+"] - ["+t.date+"] - "+t.message+"</p>"),r.includes(t.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:t.message}})),S.cancel({},(function(){setTimeout(S.logsModal,500)})))}},a=o(e.messages);!(t=a()).done;){var c=t.value;c&&(S.messages.addMessage(c),s(c))}if(n.is(":visible")&&n.scrollTop(n[0].scrollHeight),S.messages.shouldWarn()){var l=E(i.getSwalContainer()).find(".wpstg-backup-process-logs-button");l.html(l.attr("data-txt-bad")),l.find(".wpstg--modal--logs--critical-count").text(S.messages.countByType(S.messages.CRITICAL)),l.find(".wpstg--modal--logs--error-count").text(S.messages.countByType(S.messages.ERROR)),l.find(".wpstg--modal--logs--warning-count").text(S.messages.countByType(S.messages.WARNING))}}},downloadModal:function(e){var t=e.title,n=void 0===t?null:t,r=e.bodyText,o=void 0===r?null:r;if(!S.isBackupSlowerThanUsual||!1!==S.isBackupSpeedModalDisplayed){if(null===S.modal.download.html){var s=E("#wpstg-backup-success-modal");S.modal.download.html=s.html()}if(i.getSwalModal(!0).fire({icon:"success",html:S.modal.download.html.replace("{title}",n).replace("{btnTxtLog}","Show Logs").replace("{text}",null!==o?o:"You can restore this backup anytime or upload it to another website and restore it there."),confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0}),"Backup Complete"===n){var a=i.getSwalContainer().querySelector(".wpstg-rate-us");a&&a.classList.add("show")}}},checkMemoryExhaustion:function(t,r){return n(e().mark((function n(){var o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.checkMemoryExhaustion(r);case 2:if(!1!==(o=e.sent)){e.next=5;break}return e.abrupt("return");case 5:s=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">CONTACT US</button> for help in solving this issue.',wpstg.isPro&&(s=' Read <a target="_blank" href="'+i.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),t.messages=[{type:"critical",date:o.data.time,message:o.message+"."+s}],S.processResponse(t);case 9:case"end":return e.stop()}}),n)})))()},statusStop:function(){clearInterval(S.processInfo.interval),S.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(e){null===S.processInfo.interval&&(S.processInfo.interval=setInterval((function(){!0!==S.isCancelled?!1!==S.status.hasResponse&&(S.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&"+e+"=restore",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()})).then((function(e){if(S.status.hasResponse=!0,void 0===e&&S.statusStop(),S.processInfo.title!==e.currentStatusTitle){S.processInfo.title=e.currentStatusTitle;var t=E(i.getSwalContainer());t.find(".wpstg-backup-process-title").text(e.currentStatusTitle),t.find(".wpstg-backup-process-percent").text("0")}})).catch((function(e){S.status.hasResponse=!0,i.showAjaxFatalError(e,"","Submit an error report.")}))):S.statusStop()}),5e3))},showLogsInModal:function(e,t){if(void 0===t&&(t="process"),S.messages.data.all){var n=i.getSwalContainer().querySelector(".wpstg-backup-"+t+"-logs");n.innerHTML="",S.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase(),r=document.createElement("p");r.className=t,r.textContent="["+e.type+"] - ["+e.date+"] - "+e.message,n.appendChild(r)}))}var r=i.getSwalContainer(),o=E(r).find(".wpstg-backup-"+t+"-logs");o.toggle();var s=E(r).find(".wpstg-backup-"+t+"-logs-button");e.preventDefault(),o.is(":visible")?(s.text(wpstg.i18n.hideLogs),r.childNodes[0].style.width="97%",r.style["z-index"]=9999):(s.text(wpstg.i18n.showLogs),r.childNodes[0].style.width="600px")},calculateBackupSpeedIndex:function(e,t){fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_calculate_backup_speed_index",accessToken:wpstg.accessToken,nonce:wpstg.nonce,size:e,time:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){if(S.isBackupSlowerThanUsual=e.isBackupSlowerThanUsual,S.isBackupSpeedModalDisplayed=e.isBackupSpeedModalDisplayed,e.isBackupSlowerThanUsual&&!1===e.isBackupSpeedModalDisplayed){var t=document.querySelector("#wpstg-general-error-modal");null!=t&&null!=t&&(f("#wpstg-general-error-modal"),new x("general-error"))}})).catch((function(e){console.log(e)}))}},O=function(){function e(e,t,n){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=i),void 0===n&&(n=null),this.directoryListingContainer=l(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=n,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(u(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),u(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,n){n.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),u(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),u(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),u(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,n){n.preventDefault(),e.toggleDirectoryNavigation(t)})),u(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: Unable to add directory navigation events.")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){this.currentParentDiv=e.parentElement;var t=h(e,"span");return this.currentCheckboxElement=t.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed"),r=this.currentCheckboxElement.getAttribute("data-path"),o=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:r,prefix:o,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(n),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void d(n)}null!==t.notyf?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):alert("Error: "+t.wpstgObject.i18n.somethingWentWrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},t.getExcludedDirectories=function(){var e,t=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(e){t.isParentExcluded(e.value)||t.excludedDirectories.push(e.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(e){t.isParentExcluded(e)||t.isScanned(e)||t.excludedDirectories.push(e)})),this.excludedDirectories.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(n){e.startsWith(n+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t,n=l("#wpstg_extraDirectories");if(null===n||""===n.value)return e.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator);var r=n.value.split(/\r?\n/);return e.concat(r).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(n){n.value===e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=h(e,"span"),n=t.querySelector('input[type="checkbox"]');if("false"!==n.getAttribute("data-navigatable","false")&&"false"!==n.getAttribute("data-scanned","false")){var r=function(e,t){for(var n=e.nextElementSibling;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(t,".wpstg-subdir");"none"===r.style.display?d(r):p(r)}},t.updateDirectorySelection=function(e){var t=e.parentElement.parentElement;e.setAttribute("data-changed","true"),e.checked?(function(e,t){for(var n=[],r=e&&e.parentElement;r;r=r.parentElement)r.matches(t)&&n.push(r);return n}(t.parentElement,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg--checkbox-wrapper")&&(e.children[t].children[t].checked=!0)})),t.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,n=this.directoryListingContainer.querySelectorAll('[data-dir-type="other"]:checked'),r=0;n.forEach((function(e){var t,n;null!=(t=e.getAttribute("data-path"))&&t.includes("wp-content/plugins")||null!=(n=e.getAttribute("data-path"))&&n.includes("wp-content/themes")||r++}));var o=l("#wpstg-files-count");0===e&&0===t&&0===r?o.classList.add("danger"):o.classList.remove("danger"),o.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",e).replace("{ts}",1===e?"":"s").replace("{p}",t).replace("{ps}",1===t?"":"s").replace("{o}",r).replace("{os}",1===r?"":"s")},e}();!function(t){window.addEventListener("backups-tab",(function(){B.listen()})),window.addEventListener("startedCreatingBackup",(function(){window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),B={listen:function(){t("body").off("click","#wpstg-new-backup",B.clickedBackup).on("click","#wpstg-new-backup",B.clickedBackup).off("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]").on("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]",B.warnBackupMediaWithoutDatabase).off("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent, input#wpstgIncludeOtherFilesInWpRoot, [type="checkbox"][name="storages"]').on("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent, input#wpstgIncludeOtherFilesInWpRoot, [type="checkbox"][name="storages"]',B.disableBackupButtonIfNoSelection).on("click","#wpstg-copy-backup-url",w).off("change",".wpstg-wproot-files-selection input.wpstg-check-dir").on("change",".wpstg-wproot-files-selection input.wpstg-check-dir",B.selectWpRootDirs)},clickedBackup:function(s){return n(e().mark((function n(){var a,c,l,u,d;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.resetErrors(),s.preventDefault(),M.isCancelled=!1,M.modal.create.html&&M.modal.create.confirmBtnTxt||(a=t("#wpstg--modal--backup--new"),c=a.html(),l=a.attr("data-confirmButtonText"),M.modal.create.html=c||null,M.modal.create.confirmBtnTxt=l||null,a.remove()),e.next=6,i.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:"",html:M.modal.create.html,focusConfirm:!1,confirmButtonText:M.modal.create.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){var e=i.getSwalContainer();M.modal.create.hasBackupSchedule=!!M.modal.create.hasBackupSchedule||!e.querySelector("#repeatBackupOnSchedule").checked,M.processInfo.isOnlySchedule=!e.querySelector("#repeatBackupOnSchedule").checked&&!e.querySelector("#backupScheduleLaunch").checked,M.processInfo.isBackupCreationInBackground=null!==e.querySelector("#wpstg-run-in-background:checked");for(var t,n=[],r=o(e.querySelectorAll('input[name="storages"]:checked'));!(t=r()).done;){var s=t.value;n.push(s.value)}i.selectedStorages=n;var a="";return Array.from(e.querySelectorAll(".wpstg-wproot-files-selection input.wpstg-check-dir:checked")).length>0&&(a=new O("#wpstg-directories-listing",i).getExcludedDirectories()),{name:i.sanitizeEventAttribute(e.querySelector('input[name="backup_name"]').value)||null,isExportingPlugins:null!==e.querySelector("#includePluginsInBackup:checked"),isExportingMuPlugins:null!==e.querySelector("#includeMuPluginsInBackup:checked"),isExportingThemes:null!==e.querySelector("#includeThemesInBackup:checked"),isExportingUploads:null!==e.querySelector("#includeMediaLibraryInBackup:checked"),isExportingOtherWpContentFiles:null!==e.querySelector("#includeOtherFilesInWpContent:checked"),isExportingOtherWpRootFiles:null!==e.querySelector("#wpstgIncludeOtherFilesInWpRoot:checked"),isExportingDatabase:null!==e.querySelector("#includeDatabaseInBackup:checked"),repeatBackupOnSchedule:null!==e.querySelector("#repeatBackupOnSchedule:not(:checked)"),scheduleRecurrence:e.querySelector("#backupScheduleRecurrence").value||null,scheduleTime:e.querySelector("#backupScheduleTime").value||null,scheduleRotation:e.querySelector("#backupScheduleRotation").value||null,storages:n,isCreateBackupInBackground:null!==e.querySelector("#wpstg-run-in-background:checked"),isValidateBackupFiles:null!==e.querySelector("#wpstg-validate-backup-files:checked"),isCreateScheduleBackupNow:null!==e.querySelector("#backupScheduleLaunch:checked"),backupType:e.querySelector('[name="backupType"]').value||null,isSmartExclusion:null!==e.querySelector("#wpstgSmartExclusion:checked"),isExcludingSpamComments:null!==e.querySelector("#wpstgExcludeSpamComments:checked"),isExcludingPostRevision:null!==e.querySelector("#wpstgExcludePostRevision:checked"),isExcludingDeactivatedPlugins:null!==e.querySelector("#wpstgExcludeDeactivatedPlugins:checked"),isExcludingUnusedThemes:null!==e.querySelector("#wpstgExcludeUnusedThemes:checked"),isExcludingLogs:null!==e.querySelector("#wpstgExcludeLogs:checked"),isExcludingCaches:null!==e.querySelector("#wpstgExcludeCaches:checked"),backupExcludedDirectories:a}},onRender:function(){r(),!0===M.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!0})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="block"}))),!1===M.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!1})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="none"})));var e=document.querySelector("#repeatBackupOnSchedule"),t=document.querySelector("#wpstg-run-in-background"),n=t.parentElement.nextElementSibling;e.addEventListener("change",(function(){e.checked?(t.disabled=!1,n.classList.remove("wpstg-storage-settings-disabled")):(t.checked=!1,t.disabled=!0,n.classList.add("wpstg-storage-settings-disabled"))}))}});case 6:if(u=e.sent,d=u.value){e.next=10;break}return e.abrupt("return");case 10:M.process({execute:function(){M.messages.reset(),B.prepareBackup(d)}});case 11:case"end":return e.stop()}}),n)})))()},prepareBackup:function(e){i.ajax({action:"wpstg--backups--prepare-backup",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgBackupData:e},(function(e){e.success?(window.dispatchEvent(new Event("startedCreatingBackup")),M.timer.start(),T.status=!0,T.start(),B.createBackup()):i.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(i.continueErrorHandle=!1,M.shouldCleanUp=!1,i.closeSwalModal(),setTimeout((function(){M.shouldCleanUp=!0}),1e3),i.showErrorModal(e.responseJSON.data)):i.continueErrorHandle=!0}))},createBackup:function(){var r=wpstg.maxFailedRetries,o=0;i.resetErrors(),M.isCancelled?M.statusStop():i.ajax({action:"wpstg--backups--create",accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){var r=n(e().mark((function n(r){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=0,!M.isCancelled){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==r){e.next=6;break}return setTimeout((function(){B.createBackup()}),wpstg.delayReq),e.abrupt("return");case 6:if(M.processResponse(r),M.processInfo.interval||M.statusStart("create"),!0!==r.isRunning){e.next=12;break}B.createBackup(),e.next=28;break;case 12:if("JOB_FAIL"!==r.jobStatus){e.next=18;break}return e.next=15,M.checkMemoryExhaustion(r,"wpstg_backup");case 15:setTimeout((function(){B.createBackup()}),wpstg.delayReq),e.next=28;break;case 18:if(t("#wpstg--progress--status").text("Backup successfully created!"),T.stop(),b().then((function(){return y()})),!M.messages.shouldWarn()){e.next=25;break}return M.fetchListing(),M.logsModal(),e.abrupt("return");case 25:M.statusStop(),i.closeSwalModal(),M.fetchListing().then((function(){if(r.backupMd5||M.processInfo.isOnlySchedule||M.processInfo.isBackupCreationInBackground){!M.processInfo.isOnlySchedule&&Array.isArray(i.selectedStorages)&&(i.selectedStorages.includes("localStorage")&&i.selectedStorages.length>=2||!i.selectedStorages.includes("localStorage")&&i.selectedStorages.length>=1)&&t("#wpstg-show-cloud-backup").click();var e="",n=0,o=setInterval((function(){if(M.processInfo.isOnlySchedule||M.processInfo.isBackupCreationInBackground||!r.isLocalBackup)clearInterval(o);else{n++;var s=!1;if(r.isMultipartBackup?r.backupMd5.forEach((function(n){(e=t('.wpstg-backup[data-md5="'+n+'"] .wpstg--backup--download')).length&&(s=!0)})):(e=t('.wpstg-backup[data-md5="'+r.backupMd5+'"] .wpstg--backup--download'),s=e.length>0),!s)return void(n>=20&&clearInterval(o));clearInterval(o)}M.downloadModal({title:M.processInfo.isOnlySchedule?wpstg.i18n.backupSchedule.title:M.processInfo.isBackupCreationInBackground?wpstg.i18n.backupCreationBG.title:wpstg.i18n.backupCreated.title,bodyText:M.processInfo.isOnlySchedule?wpstg.i18n.backupSchedule.body:M.processInfo.isBackupCreationInBackground?wpstg.i18n.backupCreationBG.body:wpstg.i18n.backupCreated.body}),t(".wpstg-backup-success-logs-wrapper").show();var a=t(".wpstg-backup-success-logs");M.messages.data.all.forEach((function(e){var t="wpstg--modal--process--msg--"+e.type.toLowerCase();a.append('<p class="'+t+'">['+e.type+"] - ["+e.date+"] - "+e.message+"</p>")}))}),500)}else i.showError("<strong>Warning</strong>: Failed to get backup md5 from response!<br/>Response content: "+JSON.stringify(r)+'<br/><br/>Please report this warning <a href="https://wp-staging.com/support/" target="_blank">to our support</a> and keep using WP Staging!')}));case 28:case"end":return e.stop()}}),n)})));return function(e){return r.apply(this,arguments)}}(),"json",!1,0,1.25,(function(e,t,n){i.continueErrorHandle=!1;var s={messages:[]};++o<=r?B.createBackup():(s.messages.push({type:"critical",message:"There was a PHP fatal error while processing the backup. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}),M.processResponse(s),M.cancel(),setTimeout(M.logsModal,500))}))},selectWpRootDirs:function(e){var t;e.preventDefault();var n=e.currentTarget.closest(".wpstg--swal2-container"),r=Array.from(n.querySelectorAll(".wpstg-wproot-files-selection input.wpstg-check-dir:checked"));n.querySelector("#wpstgIncludeOtherFilesInWpRoot").checked=null==(t=r.length>0)||t;var o=new Event("change",{bubbles:!0});n.querySelector("#wpstgIncludeOtherFilesInWpRoot").dispatchEvent(o)},warnBackupMediaWithoutDatabase:function(e){var t=e.currentTarget.closest(".wpstg--swal2-container");if(e.preventDefault(),null!==t.querySelector("#includeDatabaseInBackup")||null!==t.querySelector("#includeMediaLibraryInBackup")){var n=t.querySelector("#includeDatabaseInBackup").checked,r=t.querySelector("#includeMediaLibraryInBackup").checked;t.querySelector("#backupUploadsWithoutDatabaseWarning").style.display=r&&!n?"block":"none"}},disableBackupButtonIfNoSelection:function(e){var t=e.currentTarget.closest(".wpstg--swal2-container");e.preventDefault();var n=Array.from(t.querySelectorAll('[type="checkbox"][name="storages"]:checked')).length>0;if(null!==t.querySelector("#includeDatabaseInBackup")||null!==t.querySelector("#includeMediaLibraryInBackup")){var r=Array.from(t.querySelectorAll('[type="checkbox"][name="includedDirectories[]"]:checked')).length>0,o=1===Array.from(t.querySelectorAll("input#includeDatabaseInBackup:checked")).length,s=1===Array.from(t.querySelectorAll("input#includeOtherFilesInWpContent:checked")).length,a=1===Array.from(t.querySelectorAll("input#wpstgIncludeOtherFilesInWpRoot:checked")).length;t.querySelector(".wpstg--swal2-confirm").disabled=!r&&!o&&!s&&!a||!n}else t.querySelector(".wpstg--swal2-confirm").disabled=!n}};var r=function(){var e=document.querySelectorAll("#wpstgIncludeOtherFilesInWpRoot"),n=e[e.length-1];null==n||n.addEventListener("click",(function(n){n.preventDefault();var r=t(this),o=document.querySelectorAll(r.data("id"))[e.length-1];r.toggleClass("expand"),r.hasClass("expand")?d(o):p(o)}))}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){P.listen()})),P={listen:function(){e("#wpstg--tab--backup").off("click",".wpstg-delete-backup[data-md5]",P.delete).on("click",".wpstg-delete-backup[data-md5]",P.delete)},delete:function(e){var t=this;e.preventDefault(),i.resetErrors();var n="Do you want to delete the backup <br>"+this.getAttribute("data-name")+"?";i.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-btn-danger wpstg-link-btn"}).fire({showConfirmButton:!0,showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonText:"Delete",icon:"warning",title:"Delete Backup?",html:'<div class="wpstg--modal--delete">'+n+"</div>"}).then((function(e){if(e.value){b().then((function(){return y()})),i.isLoading(!0),i.cache.get("#wpstg-existing-backups").hide();var n=t.getAttribute("data-md5");i.ajax({action:"wpstg--backups--delete",md5:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){i.showAjaxFatalError(e,""," Please submit an error report by using the CONTACT US button."),i.isLoading(!1),M.fetchListing()}))}}))}}}(jQuery),function(t){window.addEventListener("backups-tab",(function(){I.listen()})),I={listen:function(){t("#wpstg--tab--backup").off("click",".wpstg--backup--edit[data-md5]",I.edit).on("click",".wpstg--backup--edit[data-md5]",I.edit)},edit:function(r){var o=this;return n(e().mark((function n(){var s,a,c,l,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),s=t(o),a=i.htmlEntityQuotesDecode(i.sanitizeEventAttribute(s.data("name"))),c=i.htmlEntityQuotesDecode(i.sanitizeEventAttribute(s.data("notes"))),e.next=6,i.getSwalModal().fire({title:"",html:'\n                    <label id="wpstg-backup-edit-name">Backup Name</label>\n                    <input id="wpstg-backup-edit-name-input" class="wpstg--swal2-input" maxlength="100" value="'+a+'">\n                    <label>Additional Notes</label>\n                    <textarea id="wpstg-backup-edit-notes-textarea" class="wpstg--swal2-textarea" maxlength="1000">'+c+"</textarea>\n                  ",focusConfirm:!1,confirmButtonText:"Save",showCancelButton:!0,preConfirm:function(){return{name:i.sanitizeEventAttribute(document.getElementById("wpstg-backup-edit-name-input").value)||null,notes:i.sanitizeEventAttribute(document.getElementById("wpstg-backup-edit-notes-textarea").value)||null}}});case 6:if(l=e.sent,u=l.value){e.next=10;break}return e.abrupt("return");case 10:i.ajax({action:"wpstg--backups--edit",accessToken:wpstg.accessToken,nonce:wpstg.nonce,md5:s.data("md5"),name:i.sanitizeEventAttribute(u.name),notes:i.sanitizeEventAttribute(u.notes)},(function(e){i.showAjaxFatalError(e,"","Submit an error report."),b().then((function(){return y()})),M.fetchListing()}));case 11:case"end":return e.stop()}}),n)})))()}}}(jQuery),function(t){window.addEventListener("backups-tab",(function(){U.listen()})),U={listen:function(){t("body").off("click",".wpstg--backup--restore",U.clickedRestore).on("click",".wpstg--backup--restore",U.clickedRestore)},timer:{totalSeconds:0,interval:null,start:function(){if(null===U.timer.interval){U.timer.interval=setInterval((function(){var e;t(".wpstg--modal--process--elapsed-time").text((e=U.timer.totalSeconds,""+new Date(1e3*e).toISOString().substr(11,8))),U.timer.totalSeconds++}),1e3)}},stop:function(){U.timer.totalSeconds=0,U.timer.interval&&(clearInterval(U.timer.interval),U.timer.interval=null)}},clickedRestore:function(e){var t=this;WPStaging.checkUserDbPermissions("restore").then((function(){i.resetErrors(),e.preventDefault(),M.isCancelled=!1,M.modal.restore.data.file=t.getAttribute("data-filePath"),U.selectedBackup()}))},selectedBackup:function(){i.ajax({action:"wpstg--backups--read-backup-metadata",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg:{file:M.modal.restore.data.file}},(function(e){var n;try{var r=(n=JSON.parse(i.getDataFromWordPressResponse(e))).networks[Object.keys(n.networks)[0]];n=r.blogs[Object.keys(r.blogs)[0]]}catch(e){i.showError(e)}M.modal.restore.data.backupMetadata=n;var o=new FormData;o.append("action","wpstg--backups--restore--file-info"),o.append("accessToken",wpstg.accessToken),o.append("nonce",wpstg.nonce),o.append("filePath",M.modal.restore.data.file),fetch(ajaxurl,{method:"POST",body:o}).then(i.handleFetchErrors).then((function(e){return e.json()})).then((function(e){M.modal.restore.retryCount=0,U.importModal(e,o)})).catch((function(e){return i.showAjaxFatalError(e,"","Submit an error report.")})),t(".wpstg--modal--actions .wpstg--swal2-confirm").show(),t(".wpstg--modal--actions .wpstg--swal2-confirm").prop("disabled",!1)}))},importModal:function(r){var o=function r(o,s,a){void 0===s&&(s=!1),void 0===a&&(a=null),i.resetErrors(),M.isCancelled?M.statusStop():(M.timer.start(),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),i.ajax({action:"wpstg--backups--restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,retry:s,errorCode:a},function(){var s=n(e().mark((function n(s){var a,c,l,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M.isCancelled){e.next=2;break}return e.abrupt("return");case 2:if(i.retry.reset(),void 0!==s){e.next=6;break}return setTimeout((function(){r(o)}),wpstg.delayReq),e.abrupt("return");case 6:if(M.processResponse(s),M.processInfo.interval||M.statusStart("restore"),!0!==s.isRunning){e.next=12;break}r(o),e.next=29;break;case 12:if("JOB_FAIL"!==s.jobStatus){e.next=18;break}return e.next=15,M.checkMemoryExhaustion(s,"wpstg_restore");case 15:setTimeout((function(){r(o)}),wpstg.delayReq),e.next=29;break;case 18:if(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),t("#wpstg--progress--status").text("Backup successfully imported!"),!M.messages.shouldWarn()){e.next=23;break}return M.logsModal(),e.abrupt("return");case 23:M.statusStop(),a=t(".wpstg-backup-success-logs").innerHTML,l=(c='<div class="wpstg-backup-success-logs">'+a+"</div>").includes("wpstg--modal--process--msg--warning")||c.includes("wpstg--modal--process--msg--error")?"Issues(s) found!<br> ":"",u=M.modal.restore.data.backupMetadata.isExportingDatabase?"You will be redirected to the login page after closing this modal.":"",i.getSwalModal(!0,{container:"wpstg-restore-finished-container"}).fire({icon:"success",title:"Finished Successfully",html:'<div id="wpstg-restore-success" class="wpstg--grey">Site has been restored from backup. '+u+'  <br/><br/><span class="wpstg--modal--process--msg-found">'+l+'</span><button class="wpstg-backup-success-logs-button" data-txt-bad="">Show Logs</button></div><br/>'+c,onClose:function(){M.modal.restore.data.backupMetadata.isExportingDatabase?(document.getElementById("wpstg-restore-wait").style.display="flex",setTimeout((function(){document.location.reload(!0)}),15e3),i.ajax({action:"raw_wpstg--backups--login-url",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(void 0!==e.data.loginUrl||"private_site"!==e.data.code){var t=new URL(e.data.loginUrl);t.searchParams.set("accessToken",wpstg.accessToken),t.searchParams.set("wpstgAfterRestore","yes"),M.modal.restore.data.backupMetadata.isCreatedOnWordPressCom&&t.searchParams.set("wpstgIsBackupCreatedOnWordPressCom","yes"),window.location.href=t.toString()}}))):M.fetchListing()}});case 29:case"end":return e.stop()}}),n)})));return function(e){return s.apply(this,arguments)}}(),"json",!1,10,1.25,function(){var t=n(e().mark((function t(s,a,c){var l,u;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=parseInt(s.status),t.next=3,M.checkMemoryExhaustion({messages:[]},"wpstg_restore");case 3:if(i.retry.retryOnErrors.includes(l)){t.next=5;break}return t.abrupt("return");case 5:if(i.retry.canRetry()){t.next=7;break}return t.abrupt("return");case 7:i.continueErrorHandle=!1,i.retry.incrementRetry(),u=i.retry.currentDelay,setTimeout(n(e().mark((function t(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(o,!0,l);case 1:case"end":return e.stop()}}),t)}))),u);case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()))},s=t("#wpstg--modal--backup--restore");M.modal.restore.html=s.html(),M.modal.restore.baseDirectory=s.attr("data-baseDirectory"),M.modal.restore.btnTxtNext=s.attr("data-nextButtonText"),M.modal.restore.btnTxtConfirm=s.attr("data-confirmButtonText"),M.modal.restore.btnTxtCancel=s.attr("data-cancelButtonText"),i.getSwalModal().mixin({progressSteps:["1","2"]}).queue([{html:t(".wpstg--modal--backup--restore--introduction").first(),confirmButtonText:"Next",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:600,onRender:function(){t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").hide(),t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").hide(),t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").hide(),M.modal.restore.data.backupMetadata.isExportingDatabase&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").show(),M.modal.restore.data.backupMetadata.isExportingDatabase&&"multi"===M.modal.restore.data.backupMetadata.singleOrMulti&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").show(),(M.modal.restore.data.backupMetadata.isExportingMuPlugins||M.modal.restore.data.backupMetadata.isExportingPlugins||M.modal.restore.data.backupMetadata.isExportingThemes||M.modal.restore.data.backupMetadata.isExportingUploads||M.modal.restore.data.backupMetadata.isExportingOtherWpContentFiles||M.modal.restore.data.backupMetadata.isExportingOtherWpRootFiles)&&t(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").show()}},{html:r,confirmButtonText:"Restore",showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:650}]).then((function(e){if(e&&e.value&&e.value[1]&&!0===e.value[1]){M.isCancelled=!1;var t=M.modal.restore.data;M.modal.restore.data.fileObject=null,t.file=M.modal.restore.baseDirectory+t.file,i.ajax({action:"wpstg--backups--prepare-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgRestoreData:t},(function(e){e.success?M.process({execute:function(){M.messages.reset(),o(t)}}):i.showAjaxFatalError(e.data,"","Submit an error report.")}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(i.continueErrorHandle=!1,M.shouldCleanUp=!1,i.closeSwalModal(),setTimeout((function(){M.shouldCleanUp=!0}),1e3),i.showErrorModal(e.responseJSON.data)):i.continueErrorHandle=!0}))}}))}}}(jQuery);var j,D,A,R=function(){function t(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.currentBackupName="",this.uploadProcessPercentage=0,this.isUploadCompleted=!1,this.isUploadCanceled=!1,this.isProcessStarted=!1,this.isWpstgBackupFile=!1,this.uploadBackupFromUrl=this.uploadBackupFromUrl.bind(this),this.deleteUnfinishedUploadsCallback=null}var r=t.prototype;return r.setDeleteUnfinishedUploadsCallback=function(e){this.deleteUnfinishedUploadsCallback=e},r.startUploadProcess=function(){g(".wpstg--swal2-container #wpstg-upload-select"),f(".wpstg--swal2-container #wpstg-upload-progress"),f(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader"),l(".wpstg--swal2-container .wpstg--modal--upload--process").style.display="flex"},r.stopUploadProcess=function(){var e=this;setTimeout((function(){e.currentBackupName="",e.uploadProcessPercentage=0,e.isUploadCompleted=!1,e.isUploadCanceled=!1,e.isProcessStarted=!1}),2e3)},r.updateUploadProcess=function(){l(".wpstg--swal2-container .wpstg--modal--upload--progress").style.width=parseInt(this.uploadProcessPercentage)+"%",l(".wpstg--swal2-container .wpstg--modal--upload--progress--title > span").textContent=this.uploadProcessPercentage+"%"},r.hasWpstgExtension=function(){return this.currentBackupName.endsWith(".wpstg")},r.extractBackupNameFromUrl=function(e){try{var t=new URL(e);this.currentBackupName=t.pathname.split("/").pop()}catch(e){m("error",e.message)}},r.handleSuccessResponse=function(e){i.closeSwalModal();var t=e.message?e.message:"";e.success?i.showSuccessModal(t||"Upload finished"):i.showErrorModal(t||"Invalid request data"),b().then((function(){return y()})),M.fetchListing(),this.stopUploadProcess()},r.handleInProgressResponse=function(e){this.uploadProcessPercentage=Math.round(e.startByte/e.fileSize*100,1),this.uploadProcessPercentage>100&&(this.uploadProcessPercentage=100),this.updateUploadProcess(),this.uploadBackupFromUrl(e.fileSize,e.startByte)},r.handleErrorResponse=function(e,t){!1!==this.isProcessStarted&&(confirm("An error occurred during the download. Do you want to resume the download?")?this.uploadBackupFromUrl(e,t):(i.closeSwalModal(),b().then((function(){return y()})),M.fetchListing(),this.stopUploadProcess()))},r.addEvent=function(){var e=this,t=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(){return e.handleCancelProcess()}))},r.handleCancelProcess=function(){var e=confirm("Do you want to abort the upload?");if(this.isUploadCanceled=!0,e)return i.closeSwalModal(),this.deleteUnfinishedUploadsCallback&&this.deleteUnfinishedUploadsCallback(),b().then((function(){return y()})),M.fetchListing(),void this.stopUploadProcess();this.isUploadCanceled=!1},r.uploadBackupFromUrl=function(){var t=n(e().mark((function t(n,r){var o,s,a=this;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=0),void 0===r&&(r=0),!this.isUploadCanceled){e.next=4;break}return e.abrupt("return",!1);case 4:if(o=i.getSwalContainer(),s=o.querySelector('input[name="wpstg-backup-url"]').value,!(null==(t=s)||"string"==typeof t&&""===t.trim()||Array.isArray(t)&&0===t.length)){e.next=9;break}return m("error","Backup file URL is empty"),e.abrupt("return",!1);case 9:if(!1===this.isProcessStarted&&(this.extractBackupNameFromUrl(s),this.isWpstgBackupFile=this.hasWpstgExtension()),""!==this.currentBackupName){e.next=13;break}return m("error","Please enter a valid backup file url."),e.abrupt("return",!1);case 13:if(this.isWpstgBackupFile){e.next=16;break}return m("error","Please enter correct backup file url"),e.abrupt("return",!1);case 16:!1===this.isProcessStarted&&(this.isProcessStarted=!0,this.startUploadProcess(),this.addEvent()),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg-backups-download-url",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,backupUrl:s,fileSize:n,startByte:r}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){a.isUploadCompleted=e.complete,!1===e.complete&&e.success?a.handleInProgressResponse(e):a.handleSuccessResponse(e)})).catch((function(e){!1===a.isUploadCompleted&&a.handleErrorResponse(n,r)}));case 18:case"end":return e.stop()}var t}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),t}();jQuery,window.addEventListener("backups-tab",(function(){j.listen()})),j={isUploading:!1,resumable:null,resumableFile:null,wpstgBackupUploadUrl:null,upload:{html:null,successMessage:null},listen:function(){document.body.addEventListener("click",(function(e){"wpstg-upload-backup"===e.target.id&&(j.uploadModal(),j.wpstgBackupUploadUrl=new R,j.wpstgBackupUploadUrl.setDeleteUnfinishedUploadsCallback((function(){j.deleteUnfinishedUploads()})))}))},uploadNotSupported:function(){i.showErrorModal("Your browser do not support the File API, needed for the uploads. Please try a different/updated browser, or upload the Backup using FTP to the folder <strong>wp-content/uploads/wp-staging/backups</strong>")},setModalStateStart:function(){j.isUploading=!1,l(".wpstg--swal2-container #wpstg-upload-select").style.display="block",l(".wpstg--swal2-container #wpstg-upload-progress").style.display="none",l(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="none"},setModalStateUploading:function(){j.isUploading=!0,l(".wpstg--swal2-container #wpstg-upload-select").style.display="none",l(".wpstg--swal2-container #wpstg-upload-progress").style.display="block",l(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="block",l(".wpstg--swal2-container .wpstg--modal--upload--process").style.display="flex";var e=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",j.eventListenerConfirmCancelUpload)},eventListenerConfirmCancelUpload:function(){confirm("Do you want to abort the upload?")&&(j.resumable.cancel(),i.closeSwalModal(),j.deleteUnfinishedUploads())},deleteUnfinishedUploads:function(){i.ajax({action:"wpstg--backups--uploads-delete-unfinished",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){}))},uploadModal:function(){return n(e().mark((function t(){var n,r,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.upload.html&&j.upload.successMessage&&!document.getElementById("wpstg--modal--backup--upload")||(n=document.getElementById("wpstg--modal--backup--upload"))&&(r=n.innerHTML,o=n.getAttribute("data-uploadSuccessMessage"),j.upload.html=r||null,j.upload.successMessage=o||null,n.parentNode.removeChild(n)),e.next=3,i.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-backup-download-button"}).fire({html:j.upload.html,showConfirmButton:!0,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Upload",width:650,allowEscapeKey:function(){return!j.isUploading},allowOutsideClick:function(){return!j.isUploading},onRender:function(){var e=i.getSwalContainer().getElementsByClassName("wpstg-backup-download-button")[0],t=e.cloneNode(!0);if(e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(){j.wpstgBackupUploadUrl.uploadBackupFromUrl()})),j.deleteUnfinishedUploads(),j.setModalStateStart(),j.resumable=new Resumable({target:wpstg.ajaxUrl,chunkSize:wpstg.maxUploadChunkSize,query:{accessToken:wpstg.accessToken,action:"wpstg--backups--restore--file-upload",uniqueIdentifierSuffix:Math.floor(99999999*Math.random())},permanentErrors:[400,401,403,404,409,415,500,501,507,413],fileType:["wpstg",wpstg.backupDBExtension],simultaneousUploads:1,prioritizeFirstAndLastChunk:!1,testChunks:!1,forceChunkSize:!0}),j.resumable.resumableFile=null,!j.resumable.support)return i.closeSwalModal(),void j.uploadNotSupported();j.resumable.assignBrowse(l(".wpstg--swal2-container .resumable-browse")),j.resumable.assignDrop(l(".wpstg--swal2-container .resumable-drop")),j.resumable.on("fileAdded",j.handleFileAdded),j.resumable.on("fileSuccess",j.handleFileSuccess),j.resumable.on("error",j.handleError),j.resumable.on("progress",j.handleProgress)}});case 3:case"end":return e.stop()}}),t)})))()},handleFileAdded:function(e){var t=i.getSwalContainer().getElementsByClassName("wpstg-backup-download-button")[0];t&&(t.style.display="none"),j.setModalStateUploading(),j.resumable.resumableFile=e,j.resumable.upload()},handleFileSuccess:function(e,t){i.closeSwalModal(),i.showSuccessModal(j.upload.successMessage),b().then((function(){return y()})),M.fetchListing()},handleProgress:function(){var e=Math.floor(100*j.resumable.progress());l(".wpstg--swal2-container .wpstg--modal--upload--progress").style.width=e+"%",l(".wpstg--swal2-container .wpstg--modal--upload--progress--title > span").textContent=e+"%"},handleError:function(e,t){try{var n=JSON.parse(e);if(n.hasOwnProperty("data")&&n.data.hasOwnProperty("message")){if(n.data.hasOwnProperty("isDiskFull")&&n.data.isDiskFull)return j.resumable.cancel(),i.closeSwalModal(),void i.showErrorModal(n.data.message);if(n.data.hasOwnProperty("backupFailedValidation")&&n.data.backupFailedValidation)return j.resumable.cancel(),i.closeSwalModal(),void i.showErrorModal(n.data.message);if(!n.success)return j.resumable.cancel(),i.closeSwalModal(),void i.showErrorModal(n.data.message)}}catch(e){}var r=Math.max(262144,.1*j.resumable.opts.chunkSize);j.resumable.opts.chunkSize=Math.ceil(j.resumable.opts.chunkSize-r),j.resumable.opts.chunkSize<65536&&(i.closeSwalModal(),i.showErrorModal("We could not upload the backup file, please try uploading it directly using FTP to the folder wp-content/uploads/wp-staging/backups. Please also make sure you have enough free disk space on the server.")),j.deleteUnfinishedUploads(),j.resumable.files[0].retry()}},function(e){window.addEventListener("backups-tab",(function(){D.listen()})),D={listen:function(){e("body").off("click",".wpstg--backup--download-modal",D.clickedDownload).on("click",".wpstg--backup--download-modal",D.clickedDownload)},clickedDownload:function(e){i.resetErrors(),e.preventDefault(),M.isCancelled=!1,M.modal.download.data.indexFile=this.getAttribute("data-filePath"),D.downloadModal()},renderPart:function(t,n){var r='<div class="wpstg--backups--part">\n        <h2>'+t.name+"</h2>\n        <p>File Size: "+t.fileSize+'</p>\n        <a download href="'+t.downloadLink+'">Download</a>\n      </div>';e(n).append(r)},downloadModal:function(){i.resetErrors();var t=e("#wpstg--modal--backup--download-modal");M.modal.download.html=t.html(),i.getSwalModal(!1).fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"Cancel",title:"Download Backup",html:M.modal.download.html,onRender:function(){e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").html(""),e(".wpstg--modal--download--parts-container").show(),i.ajax({action:"wpstg--backups--parts",accessToken:wpstg.accessToken,nonce:wpstg.nonce,filePath:M.modal.download.data.indexFile},(function(t){if(!M.isCancelled){if(void 0===t)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();if(!0===t.error)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();t.parts.forEach((function(e){D.renderPart(e,".wpstg--modal--download--parts-container .wpstg--modal--download--parts")})),e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").show()}}),"json",!1,0,1.25)}}).then()}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){A.listen()})),A={listen:function(){document.body.addEventListener("click",(function(e){"wpstg-manage-backup-schedules"===e.target.id&&A.manageSchedulesModal()})),e("body").on("click",".wpstg--edit-schedule-basic",A.showAlertForBasic)},showAlertForBasic:function(e){i.resetErrors(),e.preventDefault(),alert("Please upgrade to WP Staging Pro to edit existing backup plans. You can delete this plan and create a new one if you want to change it.")},manageSchedulesModal:function(){A.fetchSchedules();var e=document.getElementById("wpstg-backup--manage--schedules-loader");e?e.classList.add("show-loader"):document.getElementById("wpstg--modal--backup--manage--schedules").innerHTML+='<div id="wpstg-backup--manage--schedules-loader" class="wpstg-loader show-loader"></div>',i.getSwalModal(!1).fire({html:document.getElementById("wpstg--modal--backup--manage--schedules").innerHTML,showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,cancelButtonText:"Close",confirmButtonText:"Save",width:750,allowEscapeKey:!0,allowOutsideClick:!0})},fetchSchedules:function(){i.ajax({action:"wpstg--backups-fetch-schedules",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){l(".wpstg--swal2-container #wpstg-backup--manage--schedules-loader").classList.remove("show-loader"),l(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content").innerHTML=e.data,document.querySelectorAll(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content .wpstg--dismiss-schedule").forEach((function(e){e.addEventListener("click",(function(e){confirm("Do you really want to delete this schedule?")&&A.dismissSchedule(e.target)}))}))}))},dismissSchedule:function(e){var t=e.dataset.scheduleId;b().then((function(){return l(".wpstg--swal2-container #wpstg-backup--manage--schedules-loader").classList.add("show-loader")})),i.ajax({action:"wpstg--backups-dismiss-schedule",accessToken:wpstg.accessToken,nonce:wpstg.nonce,scheduleId:t},(function(e){e.success?(A.fetchSchedules(),M.fetchListing(),M.modal.create.hasBackupSchedule=!1):i.showErrorModal(e.data)}))}}}(jQuery)}();
