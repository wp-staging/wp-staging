!function(){"use strict";function t(){t=function(){return e};var e={},n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),i=new L(s||[]);return r(a,"_invoke",{value:S(e,n,i)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function g(){}function h(){}function f(){}var w={};l(w,a,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(_([])));b&&b!==n&&s.call(b,a)&&(w=b);var v=f.prototype=g.prototype=Object.create(w);function y(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(r,o,a,i){var c=p(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var o;r(this,"_invoke",{value:function(e,s){function r(){return new t((function(t,r){n(e,s,t,r)}))}return o=o?o.then(r,r):r()}})}function S(e,t,n){var s="suspendedStart";return function(r,o){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw o;return T()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var i=x(a,n);if(i){if(i===d)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===s)throw s="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s="executing";var c=p(e,t,n);if("normal"===c.type){if(s=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s="completed",n.method="throw",n.arg=c.arg)}}}function x(e,t){var n=t.method,s=e.iterator[n];if(void 0===s)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=p(s,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function _(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(s.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return h.prototype=f,r(v,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:h,configurable:!0}),h.displayName=l(f,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,c,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(k.prototype),l(k.prototype,i,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,s,r,o){void 0===o&&(o=Promise);var a=new k(u(t,n,s,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),l(v,c,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=_,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,s){return a.type="throw",a.arg=e,t.next=n,s&&(t.method="next",t.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var i=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var r=s.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:_(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function n(e,t,n,s,r,o,a){try{var i=e[o](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(s,r)}function s(e){return function(){var t=this,s=arguments;return new Promise((function(r,o){var a=e.apply(t,s);function i(e){n(a,r,o,i,c,"next",e)}function c(e){n(a,r,o,i,c,"throw",e)}i(void 0)}))}}function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},r.apply(this,arguments)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t,n,s){var r,o,a,i,c=!1,l=!1,u={},p=0,d=0,g={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(e){r=e.clientX,o=e.clientY}function f(e,t){if(d&&(d=clearTimeout(d)),Math.abs(a-r)+Math.abs(i-o)<g.sensitivity)return p=1,l?void 0:n(e,t);a=r,i=o,d=setTimeout((function(){f(e,t)}),g.interval)}function w(e,t){return c=!0,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1!==p&&(a=t.clientX,i=t.clientY,e.addEventListener("mousemove",h,!1),d=setTimeout((function(){f(e,t)}),g.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&w(e.target.closest(t),e)}function b(e,t){return c=!1,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1===p&&(d=setTimeout((function(){!function(e,t){d&&(d=clearTimeout(d)),p=0,l||s(e,t)}(e,t)}),g.timeout)),this}function v(e){e.target.matches(t+", "+t+" *")&&b(e.target.closest(t),e)}function y(e){e.target.matches(t+", "+t+" *")&&function(e,t){c||(l=!0,n(e,t))}(e.target.closest(t),e)}function k(e){e.target.matches(t+", "+t+" *")&&function(e,t){!c&&l&&(l=!1,s(e,t))}(e.target.closest(t),e)}function S(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",k,!1)}return u.options=function(t){var n=t.handleFocus!==g.handleFocus;return g=Object.assign({},g,t),n&&(g.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",k,!1)):S()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",v,!1),S())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",v,!1)),u}var c=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e}return e.prototype.sendRequest=function(){var e=s(t().mark((function e(n){var s,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:n,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return s=e.sent,e.next=6,s.json();case 6:if(void 0===(r=e.sent).status||!r.status||!r.error){e.next=9;break}return e.abrupt("return",r);case 9:console.warn(r.message),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),e}();function l(e,t,n){return u.apply(this,arguments)}function u(){return(u=s(t().mark((function e(n,s,r){var o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s={}),void 0===r&&(r="json"),e.next=4,p(n,s,r);case 4:if(o=e.sent,null===(a=o.response)){e.next=8;break}return e.abrupt("return",a);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t,n){return d.apply(this,arguments)}function d(){return(d=s(t().mark((function e(n,s,o){var a,i,c,l,u,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s={}),void 0===o&&(o="json"),a=r({},s,{action:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce}),i=null,e.prev=4,e.next=7,fetch(wpstg.ajaxUrl,{method:"POST",credentials:"same-origin",body:g(a),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:if(c=e.sent,i=c.status,c.ok){e.next=14;break}return e.next=12,c.json();case 12:return l=e.sent,e.abrupt("return",{response:null,error:l,code:i});case 14:if("json"!==o){e.next=21;break}return e.next=17,c.json();case 17:return u=e.sent,e.abrupt("return",{response:u,error:null,code:i});case 21:return e.next=23,c.text();case 23:return p=e.sent,e.abrupt("return",{response:p,error:null,code:i});case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(4),e.abrupt("return",{response:null,error:e.t0,code:i});case 30:case"end":return e.stop()}}),e,null,[[4,27]])})))).apply(this,arguments)}function g(e){var t=new URLSearchParams;return h(e,t),t}function h(e,t,n){for(var s in void 0===n&&(n=""),e)if(e.hasOwnProperty(s)){var r=n?n+"["+s+"]":s;"object"!=typeof e[s]||e[s]instanceof File?t.append(r,e[s]):h(e[s],t,r)}}var f=function(){function e(e){if(this.container="string"==typeof e?document.querySelector(e):e,!(this.container instanceof HTMLElement))throw console.error("Container not found."),new Error("Container not found.");this.emptyChar=" ",this.inputs=this.container.querySelectorAll("input[type=text], input[type=number], input[type=password]"),this.inputCount=this.inputs.length,this.init()}var t=e.prototype;return t.reset=function(){this.inputs.forEach((function(e){e.value="",e.dataset.otpInputRestore=""}))},t.init=function(){for(var e=this,t=function(t){var n=e.inputs[t];n.addEventListener("input",(function(){e.bindInputEvent(n,t)})),n.addEventListener("keydown",(function(s){e.bindKeyEvent(n,t,s)})),0===t&&n.addEventListener("paste",(function(t){t.preventDefault();var n=(t.clipboardData||window.clipboardData).getData("Text");n&&e.setValue(n)}))},n=0;n<this.inputCount;n++)t(n)},t.bindInputEvent=function(e,t){if(Number.isNaN(Number(e.value)))e.value=e.dataset.otpInputRestore||"";else{if(0===e.value.length)return this._saveInputValue(t);if(1===e.value.length)return this._saveInputValue(t),void(t+1<this.inputCount&&this.inputs[t+1].focus());if(t===this.inputCount-1)return this._setInputValue(t,e.value);for(var n=e.value.split(""),s=0;s<n.length&&!(s+t>=this.inputCount);s++)this._setInputValue(s+t,n[s]);var r=Math.min(this.inputCount-1,t+n.length);this.inputs[r].focus()}},t.bindKeyEvent=function(e,t,n){if("Backspace"===n.key&&""===e.value&&0!==t)return this._setInputValue(t-1,""),void this.inputs[t-1].focus();if("Delete"===n.key&&t!==this.inputCount-1){for(var s=e.selectionStart||0,r=t+s;r<this.inputCount-1;r++)this._setInputValue(r,this.inputs[r+1].value);return this._setInputValue(this.inputCount-1,""),e.selectionStart&&(e.selectionStart=s),void n.preventDefault()}"ArrowLeft"!==n.key||null!=e.selectionStart&&0!==e.selectionStart?"ArrowRight"!==n.key||null!=e.selectionStart&&e.selectionEnd!==e.value.length||t+1<this.inputCount&&(n.preventDefault(),this.inputs[t+1].focus(),this.inputs[t+1].select()):t>0&&(n.preventDefault(),this.inputs[t-1].focus(),this.inputs[t-1].select())},t.getValue=function(){var e=this,t="";return this.inputs.forEach((function(n){t+=""===n.value?e.emptyChar:n.value})),t},t.setValue=function(e){if(Number.isNaN(e))console.error("Please enter an integer value.");else for(var t=(""+e).split(""),n=0;n<this.inputs.length;n++)this._setInputValue(n,t[n]||"")},t._setInputValue=function(e,t){return Number.isNaN(Number(t))?console.error("Please enter an integer value."):this.inputs[e]?(this.inputs[e].value=String(t).substring(0,1),void this._saveInputValue(e)):console.error("Index not found.")},t._saveInputValue=function(e,t){if(!this.inputs[e])return console.error("Index not found.");this.inputs[e].dataset.otpInputRestore=t||this.inputs[e].value},e}();function w(e){return document.querySelector(e)}function m(e,t,n,s){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&s(e.target.closest(n),e)}),!1)}function b(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function v(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function y(e,t){for(var n=e.previousElementSibling;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function k(e){document.querySelectorAll(e).forEach((function(e){e.style.display="none"}))}function S(e){document.querySelectorAll(e).forEach((function(e){e.style.display="block"}))}function x(e){var t,n=function(e){return"string"==typeof e?e:e&&"object"==typeof e&&e.target&&e.target.getAttribute("data-copy-content")?e.target.getAttribute("data-copy-content"):e instanceof Element&&e.getAttribute("data-wpstg-source")?document.querySelector(e.getAttribute("data-wpstg-source")).value:null}(e);n||E("error","No content to copy"),navigator.clipboard&&window.isSecureContext?(t=n,navigator.clipboard.writeText(t).then((function(){E("success","Copied to clipboard")})).catch((function(e){E("error","Unable to copy to clipboard")}))):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();var n=document.execCommand("copy");E(n?"success":"error",n?"Copied to clipboard":"Unable to copy to clipboard"),document.body.removeChild(t)}(n)}function E(e,t){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:e,message:t})}function C(e){return null==e||("string"==typeof e&&""===e.trim()||!(!Array.isArray(e)||0!==e.length))}function L(e){void 0===e&&(e="visible"),document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(t){t&&(t.style.visibility=e)}))}function _(e){void 0===e&&(e="visible");var t,n=(t=".wpstg-loading-placeholder-container",document.querySelectorAll(t));n.forEach((function(t){t&&(t.style.visibility=e)})),setTimeout((function(){n.forEach((function(e){e&&"visible"===e.style.visibility&&(e.style.visibility="hidden")})),I()}),5e3);var s=w(".wpstg--tab--contents");if("visible"===e)return L(),void(s&&(s.style.overflow="hidden"));I(),s&&(s.style.overflow="unset")}function T(e){return B.apply(this,arguments)}function B(){return(B=s(t().mark((function e(n){var s,r,o,a,i,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=""),""===n&&(n=w(".wpstg--tab--contents")),null!==n){e.next=4;break}return e.abrupt("return");case 4:if(s=n.querySelector(".wpstg-loading-placeholder-container"),r=s.querySelector(".wpstg-dom-loading-wrapper")){e.next=8;break}return e.abrupt("return");case 8:if(r.offsetHeight===n.offsetHeight){e.next=19;break}r.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(e){return e.remove()})),null==(o=r.querySelector(".wpstg-loading-line"))||o.remove(),null==(a=r.querySelector(".wpstg-loading-last-line-bar"))||a.remove();case 13:return r.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),e.next=16,new Promise((function(e){return setTimeout(e,0)}));case 16:if(r.offsetHeight<=n.offsetHeight+300){e.next=13;break}case 17:null==(i=r.firstElementChild)||i.classList.add("wpstg-loading-first-line-bar"),null==(c=r.lastElementChild)||c.classList.add("wpstg-loading-last-line-bar");case 19:return e.next=21,new Promise((function(e){return setTimeout(e,0)}));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(e){e&&(e.style.visibility="hidden")}))}function M(e){return new Date(1e3*e).toISOString().slice(11,19)+"s"}function P(e){for(var t=["B","KB","MB","GB","TB"],n=0;e>=1e3&&n<t.length-1;)e/=1e3,n++;return e.toFixed(2)+" "+t[n]}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var O=function(){function e(){}var n=e.prototype;return n.init=function(){var e=this;this.otpScreen=document.querySelector("#wpstg--otp--overlay-screen"),this.otpContainer=this.otpScreen.querySelector(".wpstg-otp-container"),this.otpInput=new f(this.otpContainer),this.verifyButton=this.otpScreen.querySelector(".wpstg-otp-verify-btn"),this.closeButton=this.otpScreen.querySelector(".wpstg-otp-overlay-close-btn"),this.resendButton=this.otpScreen.querySelector(".wpstg-otp-resend-btn"),this.otpMessageContainer=this.otpScreen.querySelector(".wpstg-otp-message"),this.reset(),this.addEventListener(".wpstg-otp-overlay-close-btn",(function(){e.otpScreen.style.display="none",e.onCancel(),e.reset()})),this.addEventListener(".wpstg-otp-verify-btn",s(t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.verifyOtp();case 2:case"end":return t.stop()}}),n)})))),this.addEventListener(".wpstg-otp-resend-btn",s(t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.resendOtp();case 2:case"end":return t.stop()}}),n)}))))},n.addEventListener=function(e,t){this.otpScreen.querySelector(e).addEventListener("click",(function(e){t(e)}))},n.createSession=function(){return Date.now().toString(36)+Math.random().toString(36).substring(0,2)},n.reset=function(){this.sessionId=null,this.otpAction=null,this.otpMessageContainer.innerHTML="",this.onVerification=null,this.onRequest=null,this.onCancel=function(){},this.additionalData={},this.otpInput.reset()},n.verifyOtp=function(){var e=s(t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this.otpInput.getValue()).length<this.otpInput.inputCount)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.processOtpVerification(n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.processOtpVerification=function(){var e=s(t().mark((function e(n){var s,o,a,i,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.closeButton.disabled=!0,this.verifyButton.disabled=!0,this.resendButton.style.display="none",e.next=5,p(this.otpAction,r({},this.additionalData,{sessionId:this.sessionId,otp:n}));case 5:if(o=e.sent,a=o.response,i=o.error,c=o.code,this.closeButton.disabled=!1,this.verifyButton.disabled=!1,this.resendButton.style.display="block",403!==c||null==i||null==(s=i.data)||!s.message){e.next=15;break}return E("error",null==i||null==(l=i.data)?void 0:l.message),e.abrupt("return");case 15:this.otpScreen.style.display="none",this.onVerification(a,i,c),this.reset();case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.resendOtp=function(){var e=s(t().mark((function e(){var n,s,r,o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p("wpstg--send--otp",{sessionId:this.sessionId,resend:"true"});case 2:if(n=e.sent,s=n.response,r=n.error,n.code,!r){e.next=9;break}return E("error",null!=(o=null==r||null==(a=r.data)?void 0:a.message)?o:wpstg.i18n.something_went_wrong),e.abrupt("return");case 9:if(s){e.next=11;break}return e.abrupt("return");case 11:this.initResendTimer(s.data.message,s.data.reRequestAt);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.setOnOtpRequest=function(e){this.onRequest=e},n.setOnOtpVerification=function(e){this.onVerification=e},n.setOnOtpCancelled=function(e){this.onCancel=e},n.start=function(){var e=s(t().mark((function e(n,s){var r,o,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===s&&(s={}),this.onRequest&&this.onRequest instanceof Function){e.next=3;break}return e.abrupt("return");case 3:if(this.onVerification&&this.onVerification instanceof Function){e.next=5;break}return e.abrupt("return");case 5:return this.otpAction=n,this.additionalData=s,e.next=9,this.requestOtp();case 9:if(r=e.sent,o=r.response,a=r.error,202!==(i=r.code)){e.next=17;break}return e.next=16,this.processOtpVerification("");case 16:return e.abrupt("return");case 17:null!=o&&o.success&&(this.otpScreen.style.display="flex"),this.onRequest(o,a,i);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.requestOtp=function(){var e=s(t().mark((function e(){var n,s,r,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sessionId=this.createSession(),e.next=3,p("wpstg--send--otp",{sessionId:this.sessionId});case 3:return n=e.sent,s=n.response,r=n.error,o=n.code,e.abrupt("return",{response:s,error:r,code:o});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.initResendTimer=function(e,t){var n=this;this.resendButton.style.display="none",this.otpMessageContainer.innerHTML="",this.otpMessageContainer.style.display="block",this.interval=setInterval((function(){var s=(new Date).getTime()/1e3,r=Math.ceil(t-s);r<=0?(clearInterval(n.interval),n.resendButton.style.display="block",n.otpMessageContainer.style.display="none"):n.otpMessageContainer.innerHTML=e.replace("%s",r+"s")}),1e3)},e}(),q=function(e){var n={OTP_DISABLE_ARTICLE:"https://wp-staging.com/docs/disable-verification-code",continueErrorHandle:!0,otp:new O,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],oneTimeRetry:!1,performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),n.retry.performingRequest=!0,0===n.retry.currentDelay&&(n.retry.currentDelay=1e3,n.retry.count=1),n.retry.currentDelay+=1e3*n.retry.count*e,n.retry.count++},canRetry:function(){return n.retry.count<n.retry.max},reset:function(){n.retry.currentDelay=0,n.retry.count=0,n.retry.performingRequest=!1,n.retry.oneTimeRetry=!1}},delay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(e){return s(t().mark((function n(){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new c,t.next=3,s.sendRequest(e);case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return",!1);case 6:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),n)})))()},listenTooltip:function(){i(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){t.target.closest(".wpstg--tooltiptext a")||(e.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},s={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(s)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"success",title:wpstg.i18n.success+"!",html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},showOtpGenerationErrorModal:function(){n.showErrorModal(wpstg.i18n.cannot_generate_otp_error.replace("%s",n.OTP_DISABLE_ARTICLE),wpstg.i18n.something_went_wrong)},showErrorModal:function(e,t){void 0===t&&(t=null),void 0!==t&&""!==t&&null!==t||(t=wpstg.i18n.error+"!"),this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"error",title:t,html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},processAndShowErrorModal:function(e,t,s){var r,o,a=wpstg.i18n.error+(null==s?"!":" "+s+"!");if(null!=e&&e.message)n.showErrorModal(e.message,a);else if(null!=e&&null!=(r=e.data)&&r.message)n.showErrorModal(e.data.message,a);else if(null!=e&&e.data)n.showErrorModal(e.data,a);else if(null!=t&&t.message)n.showErrorModal(t.message,a);else if(null!=t&&null!=(o=t.data)&&o.message)n.showErrorModal(t.data.message,a);else if(null!=t&&t.data)n.showErrorModal(t.data,a);else{var i=wpstg.i18n.something_went_wrong;n.showErrorModal(i,a)}},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},confirmModal:function(e,t,s,r){return n.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:r+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:s,showCancelButton:!0})},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?n.cache.get(".wpstg-loader").show():n.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(e){return null===e?e:e.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(e){return null===e?e:e.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(e,t,s){return t=t?t+"<br/><br/>":wpstg.i18n.something_went_wrong+"<br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===e?(n.showError(t+" Error: No response."+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(n.showError(t+" Error: "+e.message+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},showFirewallError:function(){return wpstg.i18n.common.firewall_error_text},handleFetchErrors:function(e){if(!e.ok){var t=!1,s="Error: "+e.status+" - "+e.statusText+". ";403===e.status||405===e.status||406===e.status?(s+=n.showFirewallError(),t=!0):s+=wpstg.i18n.common.fetch_errors_error_text,t&&n.showErrorModal(s),n.showError(s)}return e},showError:function(t){n.retry.performingRequest||(n.cache.get("#wpstg-try-again").css("display","inline-block"),n.cache.get("#wpstg-cancel-cloning").text("Reset"),n.cache.get("#wpstg-resume-cloning").show(),n.cache.get("#wpstg-error-wrapper").show(),n.cache.get("#wpstg-error-details").show().html(t),n.cache.get("#wpstg-removing-clone").removeClass("loading"),n.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(t))},resetErrors:function(){n.cache.get("#wpstg-error-details").hide().html("")},ajax:function(t,s,r,o,a,i,c){void 0===i&&(i=null),void 0===c&&(c=null),void 0===r&&(r="json"),!1!==o&&(o=!0),a=void 0===a?0:a;var l=wpstg.maxFailedRetries,u=1e4*a;i=parseInt(i),isNaN(i)||(u*=i),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:r,cache:!1,data:t,error:function(e,p,d){if(console.log(e.status+" "+e.statusText+"---"+p),"function"!=typeof c||(c(e,p,d),n.continueErrorHandle))if(++a<=l)setTimeout((function(){n.ajax(t,s,r,o,a,i)}),u);else{var g=void 0===e.status?"Unknown":e.status,h=wpstg.i18n.common.ajax_error_fatal_error+g+wpstg.i18n.common.ajax_error_error_text;403!==g&&405!==g&&406!==g||(h=wpstg.i18n.common.ajax_error_fatal_error+g+" "+n.showFirewallError()),n.showError(h)}else n.continueErrorHandle=!0},success:function(e){"function"==typeof s&&s(e)},statusCode:{404:function(){a>=l&&n.showError(wpstg.i18n.ajax_status_code_404)},500:function(){a>=l&&n.showError(wpstg.i18n.status_code_500)},504:function(){a>l&&n.showError(wpstg.i18n.common.ajax_status_code_504)},502:function(){a>=l&&n.showError(wpstg.i18n.common.ajax_status_code_502)},503:function(){a>=l&&n.showError(wpstg.i18n.common.ajax_status_code_503)},429:function(){a>=l&&n.showError(wpstg.i18n.common.ajax_status_code_429)},403:function(){showError("Error 403 - "+n.showFirewallError())},405:function(){showError("Error 405 - "+n.showFirewallError())},406:function(){showError("Error 406 - "+n.showFirewallError())}}})}};return n}(jQuery),j=function(e){var t,n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),i=new I(s||[]);return r(a,"_invoke",{value:L(e,n,i)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",g="suspendedYield",h="executing",f="completed",w={};function m(){}function b(){}function v(){}var y={};l(y,a,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(M([])));S&&S!==n&&s.call(S,a)&&(y=S);var x=v.prototype=m.prototype=Object.create(y);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(r,o,a,i){var c=p(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,i)}),(function(e){n("throw",e,a,i)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,i)}))}i(c.arg)}var o;r(this,"_invoke",{value:function(e,s){function r(){return new t((function(t,r){n(e,s,t,r)}))}return o=o?o.then(r,r):r()}})}function L(e,t,n){var s=d;return function(r,o){if(s===h)throw new Error("Generator is already running");if(s===f){if("throw"===r)throw o;return P()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var i=_(a,n);if(i){if(i===w)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=h;var c=p(e,t,n);if("normal"===c.type){if(s=n.done?f:g,c.arg===w)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=f,n.method="throw",n.arg=c.arg)}}}function _(e,n){var s=n.method,r=e.iterator[s];if(r===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),w;var o=p(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,w;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,w):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,w)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function M(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(s.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return b.prototype=v,r(x,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:b,configurable:!0}),b.displayName=l(v,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,c,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},E(C.prototype),l(C.prototype,i,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,s,r,o){void 0===o&&(o=Promise);var a=new C(u(t,n,s,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(x),l(x,c,"Generator"),l(x,a,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(B),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(s,r){return i.type="throw",i.arg=e,n.next=s,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=s.call(a,"catchLoc"),l=s.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,w):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var r=s.arg;B(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:M(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),w}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=j}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=j:Function("r","regeneratorRuntime = r")(j)}var R,U=function(){function e(e,t){void 0===e&&(e="contact-us"),void 0===t&&(t=wpstg),this.wpstgObject=t,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=e,this.init()}var n=e.prototype;return n.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.askInTheForumForm=this.contactUsModal+" .wpstg-contact-us-report-issue",this.contactUsSuccessPopup=this.contactUsModal+" .wpstg-contact-us-success-form",this.contactUsLoader=this.contactUsModal+" .wpstg-contact-us-report-issue-loader",this.contactUsSupport=this.contactUsModal+" .wpstg-contact-us-support-forum",this.reportIssueButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-open-debug-log"),this.successForm=document.querySelector(this.contactUsModal+" .wpstg-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" .wpstg-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" .wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" .wpstg-contact-us-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" .wpstg-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code"),this.contactUsModalCloseBtn=document.querySelector(this.contactUsModal+" .wpstg-contact-us-close-btn"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector(this.contactUsModal+" #wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()},n.addEvents=function(){var e=this;document.addEventListener("keydown",(function(t){"Escape"===t.key&&(k(e.contactUsModal),k(e.askInTheForumForm),k(e.contactUsSuccessPopup),k(e.contactUsSupport),e.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){S(e.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){S(e.contactUsModal)})),null!==this.contactUsModalCloseBtn&&this.contactUsModalCloseBtn.addEventListener("click",(function(){k(e.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){e.isDebugWindowOpened?k(e.askInTheForumForm):S(e.askInTheForumForm),e.isDebugWindowOpened=!e.isDebugWindowOpened,e.toggleActiveClass()})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){e.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){k(e.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){k(e.contactUsModal),k(e.contactUsSupport),k(e.askInTheForumForm),e.isDebugWindowOpened=!1,e.toggleActiveClass()})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){e.contactUsDebugCodeField.select(),e.contactUsDebugCodeField.setSelectionRange(0,99999),x(e.contactUsDebugCodeField.value)}))},n.generateDebugCode=function(e){for(var t="",n=0;n<e;n++)t+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+t+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},n.sendDebugInfo=function(){var e=s(t().mark((function e(){var n,s,r,o,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0,n=this.generateDebugCode(8),s=!1,this.contactUsForceSendDebugLog&&(s=this.contactUsForceSendDebugLog.checked),r={debugCode:n,forceSend:s,wpstg_action:"bypass_optimizer"},e.prev=6,e.next=9,l("wpstg_send_debug_log_report",r);case 9:i=e.sent,this.contactUsReportIssueBtn.disabled=!1,!0===(null==(o=i.response)?void 0:o.sent)&&(this.contactUsDebugCodeField.value=n,S(this.contactUsSuccessPopup),window.debugCode=n,this.contactUsForceSendDebugLog&&(k(this.contactUsForceSendDebugLogContainer),this.contactUsForceSendDebugLog.checked=!1)),!1===(null==(a=i.response)?void 0:a.sent)&&"already_submitted"===i.response.status&&(this.contactUsForceSendDebugLog&&S(this.contactUsForceSendDebugLogContainer),E("error",i.response.message)),k(this.contactUsLoader),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(6),k(this.contactUsLoader),S(this.contactUsSupport),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 21:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(){return e.apply(this,arguments)}}(),n.toggleActiveClass=function(){this.isDebugWindowOpened||!this.reportIssueButton.classList.contains("active")?this.isDebugWindowOpened&&this.reportIssueButton.classList.add("active"):this.reportIssueButton.classList.remove("active")},e}(),A=new(function(){function e(){this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}var t=e.prototype;return t.setCallbackOnHide=function(e){this.callbackOnHide=e},t.shows=function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()},t.addUnloadEvent=function(){window.addEventListener("beforeunload",(function(e){e.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))},t.createIframeElement=function(){var e=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return e.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement},t.handleIframeLoad=function(){var e,t;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{e=(t=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(e){return void this.handleIframeLoadError()}t&&e?t.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=e+40+"px":this.handleIframeLoadError()},t.handleIframeLoadError=function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()},t.openModal=function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")},t.focusIframe=function(){this.iframeElement.focus()},t.setIframeLoadTimeout=function(){var e=this;setTimeout((function(){e.isIframeLoaded||(e.wrapElement.classList.add("fallback"),e.formElement.remove(),e.noFrameElement.focus())}),2e3)},t.focusFallbackElement=function(){this.noFrameElement.focus()},t.hide=function(){var e,t;window.removeEventListener("beforeunload",(function(e){e.returnValue=null})),e=this.wrap,void 0===(t=200)&&(t=300),e.style.opacity=1,e.style.transitionProperty="opacity",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.opacity=0,window.setTimeout((function(){e.style.display="none",e.style.removeProperty("opacity"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0),this.callbackOnHide&&this.callbackOnHide()},e}()),D=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.count=0,this.status=!0,this.isAuthenticated=!0}var n=e.prototype;return n.start=function(){var e=this;this.status&&setTimeout((function(){e.checkUserAuthentication()}),1e3)},n.stop=function(){this.resetCount(),this.status=!1},n.resetCount=function(){this.count=0},n.checkUserAuthentication=function(){var e=s(t().mark((function e(){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(!1===e.wpAuthCheck&&n.count++,n.isAuthenticated=e.wpAuthCheck,2===n.count)return n.stop(),void n.createAuthCheckElements(e.redirectUrl);n.start()})).catch((function(e){console.error("Error:",e)}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.createAuthCheckElements=function(e){var t=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var n=document.createElement("div");n.id="wpstg-auth-check-wrap",n.classList.add("hidden");var s=document.createElement("div");s.id="wpstg-auth-check-bg";var r=document.createElement("div");r.id="wpstg-auth-check";var o=document.createElement("div");o.id="wpstg-auth-check-form",o.classList.add("loading"),o.dataset.src=e+"?interim-login=1&wp_lang=en_US";var a=document.createElement("div");a.classList.add("wpstg-auth-fallback");var i=document.createElement("p");i.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var c=document.createElement("p");c.innerHTML='<a href="'+e+'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.';var l=document.createElement("button");l.type="button",l.classList.add("wpstg-auth-check-close","button-link"),l.innerHTML='<span class="screen-reader-text">Close dialog</span>',l.addEventListener("click",(function(){n.classList.add("hidden")})),r.append(l,o,a),a.append(i,c),n.append(s,r),document.body.appendChild(n),A.setCallbackOnHide((function(){t.checkUserAuthentication()})),A.shows()},e}(),F=new D,N=function(){function e(e){var n=this;void 0===e&&(e=wpstg),this.wpstgObject=e,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval=null,this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl="",this.shouldSetupTimerInterval=!0,this.processStartTime=null,document.addEventListener("visibilitychange",s(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(document.hidden){e.next=3;break}return e.next=3,n.maybeUpdateElapsedTimeFromLogs();case 3:case"end":return e.stop()}}),e)}))))}var n=e.prototype;return n.setSetupTimerInterval=function(e){this.shouldSetupTimerInterval=e},n.maybeSetupTimerInterval=function(){var e=this;if(this.shouldSetupTimerInterval){this.processStartTime=Date.now();requestAnimationFrame((function t(){if(!document.hidden&&(F.isAuthenticated||"wpstg_push_processing"===e.action)){var n=Date.now();e.processTime=Math.floor((n-e.processStartTime)/1e3),e.updateElapsedTime()}null!==e.processInterval&&requestAnimationFrame(t)})),this.processInterval=setInterval((function(){if(document.hidden&&(F.isAuthenticated||"wpstg_push_processing"===e.action)){var t=Date.now();e.processTime=Math.floor((t-e.processStartTime)/1e3),e.updateElapsedTime()}}),1e3)}},n.start=function(){(this.showCancelButton=!0,this.maybeSetupTimerInterval(),"wpstg_delete_clone"===this.action)&&(k(".wpstg--process-modal--logs-button"),this.showCancelButton=!1,q.getSwalContainer().querySelector(".wpstg--process-modal--percent").textContent=100);"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||(F.status=!0,F.start()),k(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),k(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")},n.stop=function(){this.processTime=0,this.processStartTime=null,this.modal=null,this.percentage="",this.resetCancelChecks(),this.processInterval&&(clearInterval(this.processInterval),this.processInterval=null),q.closeSwalModal(),L(),k("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader"),"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||F.stop()},n.resetCancelChecks=function(){var e=this;null!==document.getElementById("wpstg-new-clone")?(setTimeout((function(){e.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),I()):setTimeout((function(){e.resetCancelChecks()}),1e3)},n.cancelProcess=function(){confirm(this.wpstgObject.i18n.module_process_modal.cancel_process_confirm)&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(q.getSwalContainer().querySelector(".wpstg--process-modal--title").textContent=this.wpstgObject.i18n.module_process_modal.cancel_process_text,this.stop(),S("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())},n.setTitle=function(e){this.title=e.job,"database"===e.job||"jobCopyDatabaseTmp"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_database,this.disableCancelButton=!1):"SearchReplace"===e.job||"jobSearchReplace"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_search_replace,this.disableCancelButton=!1):"PreserveDataSecondStep"===e.job||"PreserveDataFirstStep"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_preserve_data,this.disableCancelButton=!1):"directories"===e.job||"jobFileScanning"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_scanning_files,this.disableCancelButton=!1):"files"===e.job||"data"===e.job||"jobCopy"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_files,this.disableCancelButton=!1):"Backup"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_backup_files_scanning,this.disableCancelButton=!1):"finish"===e.job||"finished"===e.status?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_process_finished,this.disableCancelButton=!1):"jobDatabaseRename"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_renaming_database,this.disableCancelButton=!0):"jobData"===e.job&&(this.title=this.wpstgObject.i18n.module_process_modal.set_title_updating_database_data,this.disableCancelButton=!0)},n.setPercentage=function(e){null!==e.percentage&&(this.percentage=e.percentage)},n.initializeProcessModal=function(e){var t=this;void 0===e&&(e=null);var n=document.getElementById("wpstg--process-modal");if(n){null===e&&(e=this.showCancelButton);var s=n.innerHTML;n.remove(),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:q.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:s,cancelButtonText:this.wpstgObject.i18n.cancel,showCancelButton:e,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var e=q.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(){t.cancelProcess()}));var s=q.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0],r=s.cloneNode(!0);s.parentNode.replaceChild(r,s),r.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}})},this.start()}},n.setProcessModal=function(){var e=q.getSwalContainer(),t=e.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.querySelector(".wpstg--process-modal--title"),s=e.querySelector(".wpstg--process-modal--percent");n.textContent=this.title,s.textContent=this.percentage,t.disabled=this.disableCancelButton},n.openProcessModal=function(e,t,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0),this.isProcessCancelled||WPStaging.isCancelled||(void 0!==e&&(this.action=e.action,this.cloneId=e.cloneID),this.showCancelButton=s,this.showLogs=n,this.modal?t.job?(this.setTitle(t),this.setPercentage(t),this.setProcessModal(),"finish"===t.job&&this.stop()):"finished"===t.status&&this.stop():(q.resetErrors(),this.initializeProcessModal()))},n.updateElapsedTime=function(){null!==this.processInterval&&(q.getSwalContainer().querySelector(".wpstg--process-modal--elapsed-time").textContent=M(this.processTime))},n.getCancelCloneAction=function(){var e=this;if(""!==this.action){var t=[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(t){return t.name===e.action}));return null==t?void 0:t.cancel}},n.cancelCloneAction=function(){var e=s(t().mark((function e(){var n,s,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.action){e.next=2;break}return e.abrupt("return");case 2:try{null!==WPStaging.onGoingRequest&&(WPStaging.onGoingRequest.abort(),WPStaging.onGoingRequest=null)}catch(e){console.error(this.wpstgObject.i18n.something_went_wrong,e),WPStaging.onGoingRequest=null}return e.prev=3,e.next=6,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:null!=(n=this.getCancelCloneAction())?n:"wpstg_cancel_clone",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){(e&&void 0!==e.delete&&"finished"===e.delete||!0===e)&&(r.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==e&&r.cancelCloneAction()})).catch((function(e){console.log(r.wpstgObject.i18n.something_went_wrong,e)}));case 6:(s=e.sent).ok||(console.error(this.wpstgObject.i18n.something_went_wrong,s),this.stop()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(this.wpstgObject.i18n.something_went_wrong,e.t0),this.stop();case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),n.initializeSuccessModal=function(){var e=s(t().mark((function e(n){var s,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setSuccessModalContent(n);case 2:this.successModal=e.sent,(s=document.getElementById("wpstg-workflow"))&&(s.innerHTML=""),q.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=q.getSwalContainer().querySelector(".wpstg--success-modal--logs-button"),t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(e){e.value&&(q.closeSwalModal(),k(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),"wpstg_push_processing"===r.action&&(localStorage.setItem("wpstgPushProcessCompleted","true"),location.reload()),"wpstg_delete_clone"!==r.action&&WPStaging.loadOverview(),r.action="")})),this.showProcessLogs&&S(".wpstg--success-modal--logs-wrapper"),k(".wpstg-loader");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setSuccessModalContent=function(){var e=s(t().mark((function e(n){var s,r,o,a,i,c,l,u,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=document.getElementById("wpstg--success-modal"),null!==n.title&&(s.innerHTML=s.innerHTML.replace("{title}",n.title)),this.showProcessLogs&&(s.innerHTML=s.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null===n.body||void 0===n.body){e.next=20;break}if(r=n.body,null===this.stagingSiteUrl){e.next=15;break}if(a=this.stagingSiteUrl,"wpstg_cloning"!==this.action||"undefined"==typeof wpstgPro||"function"!=typeof(null==(o=wpstgPro)?void 0:o.saveGeneratedLinkData)){e.next=14;break}return i=Date.now().toString(),c=this.cloneId,e.next=12,wpstgPro.saveGeneratedLinkData({cloneID:c,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:i});case 12:null!=(l=e.sent)&&l.success&&(a=this.stagingSiteUrl+"/wp-login.php?wpstg_login="+i);case 14:r+='<br><strong><a href="'+a+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>";case 15:"wpstg_push_processing"===this.action&&(r+='<a href="https://wp-staging.com/refresh-and-clear-cache/" target="_blank">How to delete the cache.</a>',(u=s.querySelector(".wpstg--success-modal--text"))&&u.classList.add("wpstg--red")),"wpstg_cloning"===this.action&&(p=s.querySelector(".wpstg-rate-us"))&&p.classList.add("show"),s.innerHTML=s.innerHTML.replace("{text}",r+"<br/><br/>"),e.next=21;break;case 20:s.innerHTML=s.innerHTML.replace("{text}","");case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.openSuccessModal=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),this.stagingSiteUrl=n,this.showProcessLogs=t,this.initializeSuccessModal(e)},n.logEventFailure=function(){var e=s(t().mark((function e(n){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),e.prev=1,e.next=4,l("wpstg_log_event_failure",{process:n});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(wpstg.i18n.something_went_wrong,e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),n.openErrorModal=function(){var e=s(t().mark((function e(n,s){var r,o,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===s&&(s=""),this.stop(),k(".wpstg-loader"),_("hidden"),this.showProcessLogs=!0,s||(s="Memory exhaust issue is detected during the process"),e.next=9,this.setSuccessModalContent({title:"Error",body:s});case 9:this.successModal=e.sent,(r=document.getElementById("wpstg-workflow"))&&(r.innerHTML=""),q.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"error",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=q.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(e){e.value&&(q.closeSwalModal(),k(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.loadOverview(),a.action="")})),S(".wpstg--success-modal--logs-wrapper"),(o=q.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0])&&(o.click(),document.querySelectorAll(".wpstg--logs--body").forEach((function(e){e.scrollTop=e.scrollHeight})));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.logEventSuccess=function(){var e=s(t().mark((function e(n){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),e.next=3,l("wpstg_log_event_success",{process:n});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.convertTimeStringToSeconds=function(){var e=s(t().mark((function e(n){var s,r,o,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",0);case 2:return s=n.slice(0,-1).split(":").map(Number),r=s[0],o=s[1],a=s[2],e.abrupt("return",3600*r+60*o+a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.maybeUpdateElapsedTimeFromLogs=function(){var e=s(t().mark((function e(){var n,s,r,o,a,i,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(r=window.WPStaging.wpstgProcessLogs.getLogs())&&null!=(n=r.all)&&n.length){e.next=3;break}return e.abrupt("return");case 3:if(o=null==(s=q.getSwalContainer())?void 0:s.querySelector(".wpstg--process-modal--elapsed-time")){e.next=6;break}return e.abrupt("return");case 6:return a=new Date(r.all[0].date),i=new Date(r.all[r.all.length-1].date),c=Math.floor((i-a)/1e3),e.next=11,this.convertTimeStringToSeconds(o.textContent);case 11:if(l=e.sent,!(this.processTime===l||c<l)){e.next=14;break}return e.abrupt("return");case 14:o.textContent=M(c);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}(),W=function(){function e(){this.messages={WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",INFO_SUB:"info_sub",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},this.stoppingTypes=[this.messages.ERROR,this.messages.CRITICAL]}var t=e.prototype;return t.resetLogs=function(){this.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},t.getLogs=function(){return this.messages.data},t.shouldStop=function(e){return this.stoppingTypes.includes(e.toLowerCase())},t.logMessages=function(e){var t=this,n=q.getSwalContainer(),s=function(e){var s,r;t.messages.data.all.find((function(t){return t.message===e.message}))||(e.type=null==e||null==(s=e.type)?void 0:s.toLowerCase(),t.messages.data.all.push(e),null==(r=t.messages.data[e.type])||r.push(e),null!==n&&t.renderLogs(e))};Array.isArray(e)?e.forEach((function(e){return e&&s(e)})):e&&s(e),document.querySelectorAll(".wpstg--logs--body").forEach((function(e){e.scrollTop=e.scrollHeight}))},t.renderLogs=function(e){var t,n=this;""===e&&(e=this.messages.data.all);var s=null==(t=q.getSwalContainer())?void 0:t.querySelector(".wpstg--logs--container");s&&(Array.isArray(e)?e.forEach((function(e){n.appendLogRow(s,e)})):this.appendLogRow(s,e))},t.appendLogRow=function(e,t){var n,s=e.querySelector(".wpstg--logs-table--body");if(s){var r=s.querySelector(".wpstg--logs-table--template-row");if(r){var o=r.cloneNode(!0);o.classList.remove("wpstg--logs-table--template-row");var a=null==t||null==(n=t.type)?void 0:n.toLowerCase(),i=e.querySelector(".wpstg--logs--selector").value;(i===a||"all"===i||i===this.messages.INFO&&a===this.messages.INFO_SUB)&&o.classList.remove("hidden"),o.classList.add("wpstg--logs--row-"+a);var c=s.querySelectorAll("tr"),l=c[c.length-1];a===this.messages.INFO_SUB&&l.classList.contains("wpstg--logs--row-info")&&l.classList.add("wpstg-no-border"),a===this.messages.INFO&&l.classList.contains("wpstg--logs--row-info_sub")&&l.classList.add("wpstg--logs--row-last");var u,p=o.querySelectorAll("td");if(a===this.messages.INFO_SUB){var d=document.createElement("div");return d.innerHTML=t.message,p[3].textContent=d.textContent||d.innerText,d.remove(),s.appendChild(o),void this.updateLogCounter(e,a)}4===p.length&&(p[0].classList.add("wpstg--logs--icon-"+a),p[1].textContent=0===(u=t.type).length?u:u.toLowerCase().split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" "),p[1].classList.add("wpstg--logs--log-"+a),p[2].textContent=t.date,p[3].innerHTML=t.message),s.appendChild(o),this.updateLogCounter(e,a)}}},t.updateLogCounter=function(e,t){var n=e.querySelector(".wpstg--logs--counter-"+t);if(n){var s=parseInt(n.textContent,10);n.textContent=isNaN(s)?1:s+1;var r=e.querySelector(".wpstg--logs--button-"+t);null==r||r.classList.remove("hidden")}},t.resetLogContainer=function(e){var t=e.querySelector(".wpstg--logs-table--body");t&&(t.querySelectorAll("tr").forEach((function(e){e.classList.contains("wpstg--logs-table--template-row")||e.remove()})),Object.values(this.messages).forEach((function(t){if("object"!=typeof t||null===t){var n=e.querySelector(".wpstg--logs--counter-"+t);n&&(n.textContent="0");var s=e.querySelector(".wpstg--logs--button-"+t);null==s||s.classList.add("hidden")}})))},t.toggleProcessLogs=function(e){void 0===e&&(e=null);var t=q.getSwalContainer(),n=t.querySelector(".wpstg--logs--container");if(n){this.resetLogContainer(n),this.renderLogs("");var s="block"===n.style.display;n.style.display=s?"none":"block",e&&(e.textContent=s?wpstg.i18n.show_logs:wpstg.i18n.hide_logs),t.childNodes[0].style.width=s?"600px":"97%",t.style.zIndex=9999,n.classList.contains("wpstg--process-modal--logs")&&this.adjustProcessLogsWindow(t),this.addEvents(t)}},t.addEvents=function(e){var t=this;e||(e=q.getSwalContainer()),e.querySelector(".wpstg--logs--selector").addEventListener("change",(function(n){t.filterLogs(e,n)})),e.querySelector(".wpstg--logs--button-info").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.INFO)})),e.querySelector(".wpstg--logs--button-debug").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.DEBUG)})),e.querySelector(".wpstg--logs--button-warning").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.WARNING)})),e.querySelector(".wpstg--logs--button-error").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.ERROR)})),e.querySelector(".wpstg--logs--button-critical").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.CRITICAL)}))},t.filterLogsByButton=function(e,t){var n=e.target.closest(".wpstg--logs--header").querySelector(".wpstg--logs--selector");n.value=t;var s=new Event("change");n.dispatchEvent(s)},t.filterLogs=function(e,t){var n=this,s=t.target.value;e.querySelectorAll(".wpstg--logs-table--body tr").forEach((function(e){("all"===s||e.classList.contains("wpstg--logs--row-"+s)||s===n.messages.INFO&&e.classList.contains("wpstg--logs--row-"+n.messages.INFO_SUB))&&!e.classList.contains("wpstg--logs-table--template-row")?e.classList.remove("hidden"):e.classList.add("hidden")})),t.target.closest(".wpstg--logs--header").querySelectorAll("button").forEach((function(e){"all"==s||e.classList.contains("wpstg--logs--button-"+s)?e.style.setProperty("--wpstg-logs-button-before-display","inline-block"):e.style.setProperty("--wpstg-logs-button-before-display","none")}))},t.adjustProcessLogsWindow=function(e){var t=e.querySelector(".wpstg--swal2-html-container"),n=e.querySelector(".wpstg--logs--container"),s=e.querySelector(".wpstg--logs--body");if("block"===n.style.display)return t.style.setProperty("padding","0 2em","important"),n.style.setProperty("height","350px"),void s.style.setProperty("height","300px");t.style.setProperty("padding","4em 2em","important"),n.style.setProperty("height","300px"),s.style.setProperty("height","250px")},t.shouldWarn=function(){return this.messages.data.error.length>0||this.messages.data.critical.length>0},e}(),H=function(){function e(e){void 0===e&&(e=".wpstg--process-modal--elapsed-time"),this.totalSeconds=0,this.interval=null,this.outputTimeSelector=e,this.processStartTime=null}var t=e.prototype;return t.start=function(){var e=this;if(null===this.interval){this.processStartTime=Date.now();requestAnimationFrame((function t(){if(!document.hidden){var n=Date.now();e.totalSeconds=Math.floor((n-e.processStartTime)/1e3),e.updateElapsedTime()}null!==e.interval&&requestAnimationFrame(t)})),this.interval=setInterval((function(){if(document.hidden){var t=Date.now();e.totalSeconds=Math.floor((t-e.processStartTime)/1e3),e.updateElapsedTime()}}),1e3)}},t.stop=function(){this.totalSeconds=0,this.interval&&(clearInterval(this.interval),this.interval=null)},t.getTimeElapsed=function(){return this.totalSeconds},t.updateElapsedTime=function(){var e=this;document.querySelectorAll(this.outputTimeSelector).forEach((function(t){t.innerText=M(e.totalSeconds)}))},e}(),z={processModal:new N,processModalLogs:new W,timer:new H,isCancelled:!1,isFinished:!1,performingCancelRequest:!1,processInfo:{title:null,interval:null,maxTotalRetries:0,maxSequentialRetries:0,totalTimeRetried:0,sequentialRetried:0},job:{action:null,name:null,type:null},status:{hasResponse:null,reTryAfter:5e3,STATUS_FAIL:"JOB_FAIL"},onSuccess:function(){},incrementRetry:function(){z.processInfo.totalTimeRetried++,z.processInfo.sequentialRetried++},resetJob:function(){z.resetRetry(),z.isCancelled=!1,z.isFinished=!1,z.performingCancelRequest=!1},resetRetry:function(){z.processInfo.totalTimeRetried=0,z.processInfo.sequentialRetried=0},canRetry:function(){return!(z.processInfo.totalTimeRetried>=z.processInfo.maxTotalRetries)&&!(z.processInfo.sequentialRetried>=z.processInfo.maxSequentialRetries)},setJob:function(e){z.job.action=e.action||null,z.job.name=e.name||null,z.job.type=e.type||null},statusStop:function(){var e;clearInterval(z.processInfo.interval),z.processInfo.interval=null,window.removeEventListener("beforeunload",null==(e=WPStaging)?void 0:e.warnIfClosingDuringProcess)},statusStart:function(){var n;null===z.processInfo.interval&&(z.processInfo.interval=setInterval(s(t().mark((function n(){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==z.isCancelled){t.next=3;break}return z.statusStop(),t.abrupt("return");case 3:if(!1!==z.status.hasResponse){t.next=5;break}return t.abrupt("return");case 5:return z.status.hasResponse=!1,t.prev=6,t.next=9,l("wpstg--job--status",{type:z.job.type,name:z.job.name});case 9:if(s=t.sent,z.status.hasResponse=!0,void 0===s&&z.statusStop(),z.processInfo.title!==s.currentStatusTitle){t.next=14;break}return t.abrupt("return");case 14:z.processInfo.title=res.currentStatusTitle,(r=q.getSwalContainer()).querySelector(".wpstg--process-modal--title").innerText=res.currentStatusTitle,r.querySelector(".wpstg--process-modal--process-percent").innerText="0",t.next=24;break;case 20:t.prev=20,t.t0=t.catch(6),z.status.hasResponse=!0,WPStagingCommom.showAjaxFatalError(e,"","Submit an error report.");case 24:case"end":return t.stop()}}),n,null,[[6,20]])}))),null!=(n=wpstg.jobStatusInterval)?n:5e3))},prepareJob:function(e,n,r){var o=this;return s(t().mark((function s(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n={}),void 0===r&&(r=null),z.resetJob(),t.prev=3,t.next=6,l(e,n);case 6:if((a=t.sent)&&a.success){t.next=9;break}return t.abrupt("return",!1);case 9:return r&&window.dispatchEvent(new Event(r)),o.processModal.setSetupTimerInterval(!1),z.timer.start(),t.abrupt("return",!0);case 15:return t.prev=15,t.t0=t.catch(3),console.warn(wpstgi18n.something_went_wrong,t.t0),E("warning",wpstgi18n.something_went_wrong),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),s,null,[[3,15]])})))()},runJob:function(){return s(t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q.resetErrors(),!z.isCancelled){e.next=4;break}return z.statusStop(),e.abrupt("return");case 4:return e.next=6,l(z.job.action);case 6:if(n=e.sent){e.next=11;break}return e.next=10,z.onJobFail();case 10:return e.abrupt("return");case 11:if(!z.isCancelled){e.next=13;break}return e.abrupt("return");case 13:if(void 0!==n){e.next=17;break}return e.next=16,z.onJobFail();case 16:return e.abrupt("return");case 17:if(z.processResponse(n),z.processInfo.interval||z.statusStart(),!0!==n.isRunning){e.next=23;break}return z.processInfo.sequentialRetried=0,z.runJob(),e.abrupt("return");case 23:if(z.processModal.stop(),z.statusStop(),n.jobStatus!==z.status.STATUS_FAIL){e.next=29;break}return e.next=28,z.onJobFail(n);case 28:return e.abrupt("return");case 29:q.closeSwalModal();case 31:case"end":return e.stop()}}),e)})))()},onJobFail:function(e){return s(t().mark((function n(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=null),t.next=3,z.checkMemoryExhaustion(e,z.job.name);case 3:if(!t.sent){t.next=6;break}return t.abrupt("return");case 6:if(z.processInfo.canRetry()){t.next=14;break}return t.next=9,z.processModal.logEventFailure(z.job.name);case 9:return s={messages:[{type:"critical",message:"There was a PHP fatal error while processing this job. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}]},z.processResponse(s),z.cancel(),setTimeout(z.logsModal,500),t.abrupt("return");case 14:return t.next=16,q.delay(wpstg.delayReq);case 16:return z.processInfo.incrementRetry(),t.next=19,z.runJob();case 19:case"end":return t.stop()}}),n)})))()},cancel:function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t=null),z.timer.stop(),clearInterval(z.processInfo.interval),z.isCancelled=!0,z.processInfo.interval=null,window.removeEventListener("beforeunload",null==(n=WPStaging)?void 0:n.warnIfClosingDuringProcess),q.closeSwalModal(),q.getSwalModal(!0).fire({title:wpstg.i18n.cancel_modal_title,text:wpstg.i18n.cancel_modal_text,icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){z.sendCancelRequest(e,t,!0)}})},sendCancelRequest:function(e,n,r,o){return s(t().mark((function s(){var a,i,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===r&&(r=!1),void 0===o&&(o=10),!z.performingCancelRequest){t.next=4;break}return t.abrupt("return");case 4:return z.performingCancelRequest=!0,t.prev=5,a=r?"wpstg--job--prepare-cancel":"wpstg--job--cancel",t.next=9,p(a,e);case 9:if(i=t.sent,c=i.response,i.error,!(423===i.code&&o>0)){t.next=17;break}return z.performingCancelRequest=!1,setTimeout((function(){z.sendCancelRequest(e,n,r,o-1)}),3e3),t.abrupt("return");case 17:if(!r||null==c||!c.success){t.next=21;break}return z.performingCancelRequest=!1,z.sendCancelRequest(e,n),t.abrupt("return");case 21:if(z.performingCancelRequest=!1,z.isCancelled=!1,q.showAjaxFatalError(c,"",wpstg.i18n.submit_error_report),c.hasOwnProperty("isRunning")||q.showErrorModal(wpstg.i18n.cancel_modal_error),!0!==(null==c?void 0:c.isRunning)){t.next=28;break}return z.sendCancelRequest(e,n),t.abrupt("return");case 28:z.performingCancelRequest=!1,q.continueErrorHandle=!1,F.stop(),q.closeSwalModal(),null!=n&&n(),t.next=43;break;case 35:t.prev=35,t.t0=t.catch(5),z.performingCancelRequest=!1,q.continueErrorHandle=!1,F.stop(),q.closeSwalModal(),q.showErrorModal(wpstg.i18n.cancel_modal_error),null!=n&&n();case 43:case"end":return t.stop()}}),s,null,[[5,35]])})))()},checkMemoryExhaustion:function(e,n){return s(t().mark((function s(){var r,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q.checkMemoryExhaustion(n);case 2:if(!1!==(r=t.sent)){t.next=5;break}return t.abrupt("return");case 5:o=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(o=' Read <a target="_blank" href="'+q.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),e.messages=[{type:"critical",date:r.data.time,message:r.message+"."+o}],z.processResponse(e);case 9:case"end":return t.stop()}}),s)})))()},processResponse:function(e){if(null===e)throw q.closeSwalModal(),q.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var t=q.getSwalContainer();(e.title||e.statusTitle)&&(t.querySelector(".wpstg--process-modal--title").innerText=e.title||e.statusTitle),e.percentage&&(t.querySelector(".wpstg--process-modal--percent").innerText=e.percentage),z.addResponseMessagesToLog(e),e.jobId&&q.setJobId(e.jobId),!1===e.isRunning&&!0===e.job_done&&(z.timer.stop(),z.isCancelled=!0,e.status=!e.isRunning,window.dispatchEvent(new CustomEvent("wpstgJobDone",{response:e,job:z.job})))},addResponseMessagesToLog:function(e){if(e.messages)for(var t,n=function e(t){if(Array.isArray(t))for(var n,s=a(t);!(n=s()).done;){e(n.value)}else t.type&&(z.processModalLogs.logMessages(t),z.processModalLogs.shouldStop(t.type)&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:t.message}})),z.cancel({},(function(){setTimeout(z.logsModal,500)}))))},s=a(e.messages);!(t=s()).done;){var r=t.value;r&&n(r)}},logsModal:function(){return s(t().mark((function e(){var n,s,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),s=n?n.innerHTML:null,e.next=4,q.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'+s+"</div>",width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){q.getSwalContainer()[0].style["z-index"]=9999;var e=z.processModalLogs.getLogs();e.all&&(z.processModalLogs.renderLogs(e.all),z.processModalLogs.addEvents())},onOpen:function(e){var t=$(e).find(".wpstg--process-modal--logs");t.scrollTop(t.scrollHeight)}});case 4:return(r=e.sent).value&&q.closeSwalModal(),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))()},shouldWarn:function(){return z.processModalLogs.shouldWarn()},successModal:function(e){return s(t().mark((function n(){var s,r,o,a,i,c,l,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.title,r=void 0===s?null:s,o=e.bodyText,a=void 0===o?null:o,i=e.onSuccessModalRender,c=void 0===i?function(){}:i,l=document.querySelector("#wpstg--success-modal").innerHTML,t.next=4,q.getSwalModal(!0).fire({icon:"success",html:l.replace("{title}",r).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==a?a:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){var e=q.getSwalContainer();z.registerLogsToggle(e),S(".wpstg--success-modal--logs-wrapper"),c()},allowEscapeKey:!1,allowOutsideClick:!1});case 4:return(u=t.sent).value&&q.closeSwalModal(),t.abrupt("return",u);case 7:case"end":return t.stop()}}),n)})))()},registerLogsToggle:function(e){m(e,"click",".wpstg--success-modal--logs-button",(function(e,t){z.showLogsInModal(t)}))},showLogsInModal:function(e){e.preventDefault(),z.processModalLogs.toggleProcessLogs(e.target)}};!function(e){R={processModal:new N,wpstgProcessLogs:new W,isBackupSlowerThanUsual:!1,isBackupSpeedModalDisplayed:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1,isBackupCreationInBackground:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},upload:{html:null,confirmBtnTxt:null,retryCount:0,data:{file:null}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return R.messages.data.error.length>0||R.messages.data.critical.length>0},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){R.messages.addMessage(e)}));else if(e.type){var t=e.type.toLowerCase()||"info";R.messages.data[t]||(R.messages.data[t]=[]),R.messages.data.all.push(e),R.messages.data[t].push(e)}},reset:function(){R.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:new H,status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(t){return void 0===t&&(t=!0),_(),q.isLoading(!0),e("#backup-messages").text(""),t&&q.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(q.handleFetchErrors).then((function(e){return e.json()})).then((function(t){var n=w("#wpstg--tab--backup");return n.style.minHeight=n.offsetHeight+"px",e("#wpstg--tab--backup").empty(),R.modal.create.html=null,q.cache.get("#wpstg--tab--backup").html(t),void 0!==t.success&&!1===t.success?(q.showError("Error: "+t.data),void _("hidden")):(null===R.modal.download.html&&(R.modal.download.html=e("#wpstg--success-modal").html()),q.showAjaxFatalError(t,"",wpstg.i18n.submit_error_report),q.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),e("#local-backup-title").show(),e("#cloud-backup-title").hide(),t)})).catch((function(e){return q.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))},cancel:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),R.timer.stop(),clearInterval(R.processInfo.interval),R.processInfo.interval=null,z.cancel(e,t)},process:function(t){if(!("function"==typeof t.execute||t.data&&t.onResponse))return q.closeSwalModal(),void q.showError("process.data and / or process.onResponse is not set");if(!R.modal.process.html||!R.modal.process.cancelBtnTxt){var n=e("#wpstg--process-modal"),s=n.html(),r=n.attr("data-cancelButtonText");R.modal.process.html=s||null,R.modal.process.cancelBtnTxt=r||null,n.remove()}R.modal.process.html&&e("#wpstg--process-modal").remove(),e("body").off("click",".wpstg--process-modal--logs-button").on("click",".wpstg--process-modal--logs-button",(function(e){R.showLogsInModal(e)})).off("click",".wpstg--success-modal--logs-button").on("click",".wpstg--success-modal--logs-button",(function(e){R.showLogsInModal(e,"success")})),t.isShowCancelButton=!1!==t.isShowCancelButton,R.modal.process.modal=q.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:R.modal.process.html,cancelButtonText:R.modal.process.cancelBtnTxt,showCancelButton:t.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var e=q.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.cloneNode(!0);if(e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(e){confirm(wpstg.i18n.cancel_modal_confirm_text)&&R.cancel()})),"function"!=typeof t.execute)return t.data&&t.onResponse?void q.ajax(t.data,t.onResponse):(q.closeSwalModal(),void q.showError("process.data and / or process.onResponse is not set"));t.execute()},onAfterClose:function(){return"function"==typeof t.onAfterClose&&t.onAfterClose()}})},processResponse:function(t){if(null===t)throw q.closeSwalModal(),q.showError("Invalid Response; null"),new Error("Invalid Response; "+t);var n=e(q.getSwalContainer());(t.title||t.statusTitle)&&n.find(".wpstg--process-modal--title").text(t.title||t.statusTitle),t.percentage&&n.find(".wpstg--process-modal--percent").text(t.percentage),R.addResponseMessagesToLog(t),t.jobId&&q.setJobId(t.jobId),!1===t.isRunning&&!0===t.job_done&&("Backup"!==t.job||null!=t&&t.isGlitchInBackup||R.calculateBackupSpeedIndex(t.backupSize,R.timer.getTimeElapsed()),R.timer.stop(),z.isCancelled=!0,t.status=!t.isRunning,window.dispatchEvent(new CustomEvent("finishedProcess",{response:t})))},logsModal:function(){var t=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),n=t?t.innerHTML:null;q.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'+n+"</div>",width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){e(q.getSwalContainer())[0].style["z-index"]=9999,R.messages.data.all&&(R.wpstgProcessLogs.renderLogs(R.messages.data.all),R.wpstgProcessLogs.addEvents())},onOpen:function(t){var n=e(t).find(".wpstg--process-modal--logs");n.scrollTop(n[0].scrollHeight)}}).then((function(e){e.value&&(q.closeSwalModal(),R.fetchListing())}))},addResponseMessagesToLog:function(t){if(t.messages){for(var n,s=e(".wpstg--process-modal--logs"),r=[R.messages.ERROR,R.messages.CRITICAL],o=function e(t){if(Array.isArray(t))for(var n,s=a(t);!(n=s()).done;){e(n.value)}else t.type&&(R.wpstgProcessLogs.logMessages(t),r.includes(t.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:t.message}})),R.cancel({},(function(){setTimeout(R.logsModal,500)}))))},i=a(t.messages);!(n=i()).done;){var c=n.value;c&&(R.messages.addMessage(c),o(c))}s.is(":visible")&&s.scrollTop(s[0].scrollHeight)}},successModal:function(t){var n=t.title,s=void 0===n?null:n,r=t.bodyText,o=void 0===r?null:r,a=t.processResponse,i=void 0===a?null:a;if(!R.isBackupSlowerThanUsual||!1!==R.isBackupSpeedModalDisplayed){var c=e("#wpstg--success-modal");if(null===R.modal.download.html&&(R.modal.download.html=c.html()),c.remove(),q.getSwalModal(!0).fire({icon:"success",html:R.modal.download.html.replace("{title}",s).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==o?o:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){wpstg.isPro||(document.querySelector(".wpstg--swal2-html-container").querySelector(".wpstg--success-modal--additional-content").innerHTML=document.querySelector("#wpstg-backup-success-content").innerHTML)},allowEscapeKey:!1,allowOutsideClick:!1}).then((function(t){t.value&&(q.closeSwalModal(),T().then((function(){_()})),R.fetchListing().then((function(){if(s===wpstg.i18n.backup_remote_upload.backup_upload_complete&&e("#wpstg-show-cloud-backup").click(),s===wpstg.i18n.backup_success.created.title||i)if(i.backupMd5||R.processInfo.isOnlySchedule||R.processInfo.isBackupCreationInBackground){!R.processInfo.isOnlySchedule&&Array.isArray(q.selectedStorages)&&(q.selectedStorages.includes("localStorage")&&q.selectedStorages.length>=2||!q.selectedStorages.includes("localStorage")&&q.selectedStorages.length>=1)&&e("#wpstg-show-cloud-backup").click();var t="",n=0,r=setInterval((function(){if(R.processInfo.isOnlySchedule||R.processInfo.isBackupCreationInBackground||!i.isLocalBackup)clearInterval(r);else{n++;var s=!1;if(i.isMultipartBackup?i.backupMd5.forEach((function(n){(t=e('.wpstg-backup[data-md5="'+n+'"] .wpstg--backup--download')).length&&(s=!0,console.log("remote backup found"))})):(t=e('.wpstg-backup[data-md5="'+i.backupMd5+'"] .wpstg--backup--download'),s=t.length>0),!s)return void(n>=20&&clearInterval(r));clearInterval(r)}R.wpstgProcessLogs.logMessages(R.messages.data.all)}),500)}else q.showError("<strong>%s</strong>:".replace("%s",wpstg.i18n.warning)+wpstg.i18n.backup_create.create_backup_fetch_listing_error_md5+JSON.stringify(i)+"<br/><br/>"+wpstg.i18n.report_this_warning)})))})),e(".wpstg--success-modal--logs-wrapper").show(),s===wpstg.i18n.backup_success.created.title){var l=q.getSwalContainer().querySelector(".wpstg-rate-us");l&&l.classList.add("show")}}},checkMemoryExhaustion:function(e,n){return s(t().mark((function s(){var r,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q.checkMemoryExhaustion(n);case 2:if(!1!==(r=t.sent)){t.next=5;break}return t.abrupt("return");case 5:o=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(o=wpstg.i18n.memory_exhaust_error.replace("%s",q.memoryExhaustArticleLink)),e.messages=[{type:"critical",date:r.data.time,message:r.message+". "+o}],R.processResponse(e);case 9:case"end":return t.stop()}}),s)})))()},statusStop:function(){clearInterval(R.processInfo.interval),R.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(t){null===R.processInfo.interval&&(R.processInfo.interval=setInterval((function(){!0!==z.isCancelled?!1!==R.status.hasResponse&&(R.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&"+t+"=restore",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()})).then((function(t){if(R.status.hasResponse=!0,void 0===t&&R.statusStop(),R.processInfo.title!==t.currentStatusTitle){R.processInfo.title=t.currentStatusTitle;var n=e(q.getSwalContainer());n.find(".wpstg--process-modal--title").text(t.currentStatusTitle),n.find(".wpstg--process-modal--percent").text("0")}})).catch((function(e){R.status.hasResponse=!0,q.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))):R.statusStop()}),wpstg.backupStatusInterval))},showLogsInModal:function(e,t){e.preventDefault(),R.wpstgProcessLogs.toggleProcessLogs(e.target)},showGeneralErrorModal:function(){var e=document.querySelector("#wpstg-general-error-modal");null!=e&&null!=e&&(S("#wpstg-general-error-modal"),new U("general-error"))},removeLogsListeners:function(){e("body").off("click",".wpstg--process-modal--logs-button").off("click",".wpstg--success-modal--logs-button")},calculateBackupSpeedIndex:function(e,t){fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_calculate_backup_speed_index",accessToken:wpstg.accessToken,nonce:wpstg.nonce,size:e,time:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){R.isBackupSlowerThanUsual=e.isBackupSlowerThanUsual,R.isBackupSpeedModalDisplayed=e.isBackupSpeedModalDisplayed,e.isBackupSlowerThanUsual&&!1===e.isBackupSpeedModalDisplayed&&R.showGeneralErrorModal()})).catch((function(e){console.log(e)}))}}}(jQuery);var G=R;jQuery,window.addEventListener("backups-tab",(function(){var e=w("#wpstg--tab--backup");e.style.minHeight=e.offsetHeight,G.fetchListing()})),window.addEventListener("backupListingFinished",(function(){fetch(ajaxurl+"?action=wpstg--backups--restore--file-list&_="+Math.random()+"&withTemplate=true",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--restore--file-list",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(q.handleFetchErrors).then((function(e){return e.json()})).then((function(e){void 0!==e.success&&!1===e.success&&q.showError("Error: "+e.data);var t=document.querySelector(".wpstg-backup-list ul");t&&(function(e,t){if(window.MutationObserver){var n=new MutationObserver((function(e){for(var n,s=a(e);!(n=s()).done;){var r=n.value;"childList"===r.type&&t(r)}}));return n.observe(e,{childList:!0,subtree:!1}),n}console.warn("MutationObserver is not supported in your browser.")}(t,(function(){T().then((function(){_("hidden")})),function(e){void 0===e&&(e=""),null!==e&&e||(e=document);var t=e.querySelector(".wpstg-corrupted-backup");t&&document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-corrupted-backups-min-height")}));var n=e.querySelector(".wpstg-invalid-backup-tabs");!e.querySelector(".wpstg-automated-backup")&&!n||t||document.querySelectorAll(".wpstg-clone.wpstg-backup").forEach((function(e){e.classList.add("wpstg-multiparts-backups-min-height")}))}(t)})),t.innerHTML=e),document.getElementById("wpstg--tab--backup").style.minHeight="max-content",m(w("#wpstg-existing-backups"),"click",".wpstg-tab-header",(function(e,t){var n=w(e.getAttribute("data-id"));e.classList.toggle("expand"),e.classList.contains("expand")?(e.querySelector("span").classList.add("wpstg-rotate-90"),b(n)):(e.querySelector("span").classList.remove("wpstg-rotate-90"),v(n)),t.stopImmediatePropagation()})),q.otp.init()})).catch((function(e){return q.showAjaxFatalError(e,"","Submit an error report.")}))})),window.addEventListener("finishedProcess",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),window.addEventListener("finishedProcessWithError",(function(){window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)}));var V,J,Q,K,Y=function(){function e(e,t){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=q),this.directoryListingContainer=w(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(m(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),m(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,n){n.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),m(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),m(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),m(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,n){n.preventDefault(),e.toggleDirectoryNavigation(t)})),m(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: Unable to add directory navigation events.")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){this.currentParentDiv=e.parentElement;var t=y(e,"span");return this.currentCheckboxElement=t.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed"),s=this.currentCheckboxElement.getAttribute("data-path"),r=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:s,prefix:r,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(n),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void b(n)}E("error",t.wpstgObject.i18n.something_went_wrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.something_went_wrong,e)}))},t.getExcludedDirectories=function(){var e,t=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(e){t.isParentExcluded(e.value)||t.excludedDirectories.push(e.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(e){t.isParentExcluded(e)||t.isScanned(e)||t.excludedDirectories.push(e)})),this.excludedDirectories.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(n){e.startsWith(n+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t,n=w("#wpstg_extraDirectories");if(null===n||""===n.value)return e.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator);var s=n.value.split(/\r?\n/);return e.concat(s).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(n){n.value===e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=y(e,"span"),n=t.querySelector('input[type="checkbox"]');if("false"!==n.getAttribute("data-navigatable","false")&&"false"!==n.getAttribute("data-scanned","false")){var s=function(e,t){for(var n=e.nextElementSibling;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(t,".wpstg-subdir");"none"===s.style.display?b(s):v(s)}},t.updateDirectorySelection=function(e){var t=e.parentElement.parentElement;e.setAttribute("data-changed","true"),e.checked?(function(e,t){for(var n=[],s=e&&e.parentElement;s;s=s.parentElement)s.matches(t)&&n.push(s);return n}(t.parentElement,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg--checkbox-wrapper")&&(e.children[t].children[t].checked=!0)})),t.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,n=this.directoryListingContainer.querySelectorAll('[data-dir-type="other"]:checked'),s=0;n.forEach((function(e){var t,n;null!=(t=e.getAttribute("data-path"))&&t.includes("wp-content/plugins")||null!=(n=e.getAttribute("data-path"))&&n.includes("wp-content/themes")||s++}));var r=w("#wpstg-files-count");0===e&&0===t&&0===s?r.classList.add("danger"):r.classList.remove("danger"),r.innerHTML=this.wpstgObject.i18n.files_selected.replace("{t}",e).replace("{ts}",1===e?"":"s").replace("{p}",t).replace("{ps}",1===t?"":"s").replace("{o}",s).replace("{os}",1===s?"":"s")},e}();!function(e){window.addEventListener("backups-tab",(function(){V.listen()})),window.addEventListener("startedCreatingBackup",(function(){window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)})),V={listen:function(){e("body").off("click","#wpstg-new-backup",V.clickedBackup).on("click","#wpstg-new-backup",V.clickedBackup).off("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]").on("change",".wpstg--swal2-container .wpstg-advanced-options-site input[type=checkbox]",V.warnBackupMediaWithoutDatabase).off("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent, input#wpstgIncludeOtherFilesInWpRoot, [type="checkbox"][name="storages"]').on("change",'[type="checkbox"][name="includedDirectories[]"], input#includeDatabaseInBackup, input#includeOtherFilesInWpContent, input#wpstgIncludeOtherFilesInWpRoot, [type="checkbox"][name="storages"]',V.disableBackupButtonIfNoSelection).on("click","#wpstg-copy-backup-url",x).off("change",".wpstg-wproot-files-selection input.wpstg-check-dir").on("change",".wpstg-wproot-files-selection input.wpstg-check-dir",V.selectWpRootDirsWillSelectParent).off("change","input#wpstgIncludeOtherFilesInWpRoot").on("change","input#wpstgIncludeOtherFilesInWpRoot",V.selectWpRootDirsBySelectingParent).off("click",".wpstg--wproot-expand-folder, .wpstg-wproot-tooltip",V.clickExpandSubFolders).on("click",".wpstg--wproot-expand-folder, .wpstg-wproot-tooltip",V.clickExpandSubFolders).off("click","#wpstg-calculate-backup-size",V.calculateBackupSize).on("click","#wpstg-calculate-backup-size",V.calculateBackupSize)},clickedBackup:function(r){return s(t().mark((function s(){var o,i,c,l,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return q.resetErrors(),r.preventDefault(),z.isCancelled=!1,G.modal.create.html&&G.modal.create.confirmBtnTxt||(o=e("#wpstg--modal--backup--new"),i=o.html(),c=o.attr("data-confirmButtonText"),G.modal.create.html=i||null,G.modal.create.confirmBtnTxt=c||null,o.remove()),t.next=6,q.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:"",html:G.modal.create.html,focusConfirm:!1,confirmButtonText:G.modal.create.confirmBtnTxt,showCancelButton:!0,preConfirm:function(){var e=q.getSwalContainer();G.modal.create.hasBackupSchedule=!!G.modal.create.hasBackupSchedule||!e.querySelector("#repeatBackupOnSchedule").checked,G.processInfo.isOnlySchedule=!e.querySelector("#repeatBackupOnSchedule").checked&&!e.querySelector("#backupScheduleLaunch").checked,G.processInfo.isBackupCreationInBackground=null!==e.querySelector("#wpstg-run-in-background:checked");for(var t,n=[],s=a(e.querySelectorAll('input[name="storages"]:checked'));!(t=s()).done;){var r=t.value;n.push(r.value)}q.selectedStorages=n;var o="";return Array.from(e.querySelectorAll(".wpstg-wproot-files-selection input.wpstg-check-dir:checked")).length>0&&(o=new Y("#wpstg-directories-listing",q).getExcludedDirectories()),{name:q.sanitizeEventAttribute(e.querySelector('input[name="backup_name"]').value)||null,isExportingPlugins:null!==e.querySelector("#includePluginsInBackup:checked"),isExportingMuPlugins:null!==e.querySelector("#includeMuPluginsInBackup:checked"),isExportingThemes:null!==e.querySelector("#includeThemesInBackup:checked"),isExportingUploads:null!==e.querySelector("#includeMediaLibraryInBackup:checked"),isExportingOtherWpContentFiles:null!==e.querySelector("#includeOtherFilesInWpContent:checked"),isExportingOtherWpRootFiles:null!==e.querySelector("#wpstgIncludeOtherFilesInWpRoot:checked"),isExportingDatabase:null!==e.querySelector("#includeDatabaseInBackup:checked"),repeatBackupOnSchedule:null!==e.querySelector("#repeatBackupOnSchedule:not(:checked)"),scheduleRecurrence:e.querySelector("#backupScheduleRecurrence").value||null,scheduleTime:e.querySelector("#backupScheduleTime").value||null,scheduleRotation:e.querySelector("#backupScheduleRotation").value||null,storages:n,isCreateBackupInBackground:null!==e.querySelector("#wpstg-run-in-background:checked"),isValidateBackupFiles:null!==e.querySelector("#wpstg-validate-backup-files:checked"),isCreateScheduleBackupNow:null!==e.querySelector("#backupScheduleLaunch:checked"),backupType:e.querySelector('[name="backupType"]').value||null,isSmartExclusion:null!==e.querySelector("#wpstgSmartExclusion:checked"),isExcludingSpamComments:null!==e.querySelector("#wpstgExcludeSpamComments:checked"),isExcludingPostRevision:null!==e.querySelector("#wpstgExcludePostRevision:checked"),isExcludingDeactivatedPlugins:null!==e.querySelector("#wpstgExcludeDeactivatedPlugins:checked"),isExcludingUnusedThemes:null!==e.querySelector("#wpstgExcludeUnusedThemes:checked"),isExcludingLogs:null!==e.querySelector("#wpstgExcludeLogs:checked"),isExcludingCaches:null!==e.querySelector("#wpstgExcludeCaches:checked"),backupExcludedDirectories:o}},onRender:function(){n(),!0===G.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!0})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="block"}))),!1===G.modal.create.hasBackupSchedule&&(document.querySelectorAll("#repeatBackupOnSchedule.wpstg-is-basic").forEach((function(e){e.disabled=!1})),document.querySelectorAll(".wpstg-basic-schedule-notice.wpstg-is-basic").forEach((function(e){e.style.display="none"})));var e=document.querySelector("#repeatBackupOnSchedule"),t=document.querySelector("#wpstg-run-in-background"),s=t.parentElement.nextElementSibling;e.addEventListener("change",(function(){e.checked?(t.disabled=!1,s.classList.remove("wpstg-storage-settings-disabled")):(t.checked=!1,t.disabled=!0,s.classList.add("wpstg-storage-settings-disabled"))}))}});case 6:if(l=t.sent,u=l.value){t.next=10;break}return t.abrupt("return");case 10:G.process({execute:function(){G.messages.reset(),G.wpstgProcessLogs.resetLogs(),V.prepareBackup(u)}});case 11:case"end":return t.stop()}}),s)})))()},prepareBackup:function(e){q.ajax({action:"wpstg--backups--prepare-backup",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgBackupData:e},(function(e){e.success?(window.dispatchEvent(new Event("startedCreatingBackup")),G.timer.start(),F.status=!0,F.start(),V.createBackup()):q.showAjaxFatalError(e.data,"",wpstg.i18n.submit_error_report)}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(q.continueErrorHandle=!1,G.shouldCleanUp=!1,q.closeSwalModal(),setTimeout((function(){G.shouldCleanUp=!0}),1e3),q.showErrorModal(e.responseJSON.data)):q.continueErrorHandle=!0}))},createBackup:function(n){void 0===n&&(n=!1);var r=wpstg.maxFailedRetries,o=0;q.resetErrors(),z.isCancelled?G.statusStop():q.ajax({action:"wpstg--backups--create",accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){var r=s(t().mark((function s(r){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=0,!z.isCancelled){t.next=3;break}return t.abrupt("return");case 3:if(void 0!==r){t.next=6;break}return setTimeout((function(){V.createBackup()}),wpstg.delayReq),t.abrupt("return");case 6:if(G.processResponse(r),G.processInfo.interval||G.statusStart("create"),!0!==r.isRunning){t.next=12;break}V.createBackup(),t.next=31;break;case 12:if("JOB_FAIL"!==r.jobStatus){t.next=21;break}return t.next=15,G.checkMemoryExhaustion(r,"wpstg_backup");case 15:if(!n){t.next=18;break}return t.next=18,G.processModal.logEventFailure("backup");case 18:setTimeout((function(){V.createBackup(!0)}),wpstg.delayReq),t.next=31;break;case 21:if(e("#wpstg--progress--status").text(wpstg.i18n.backup_success.created.title),F.stop(),T().then((function(){return _()})),!G.messages.shouldWarn()){t.next=27;break}return G.logsModal(),t.abrupt("return");case 27:G.statusStop(),q.closeSwalModal(),r.isGlitchInBackup&&G.showGeneralErrorModal(),G.successModal({title:G.processInfo.isOnlySchedule?wpstg.i18n.backup_success.scheduled.title:G.processInfo.isBackupCreationInBackground?wpstg.i18n.backup_success.run_in_bg.title:wpstg.i18n.backup_success.created.title,bodyText:G.processInfo.isOnlySchedule?wpstg.i18n.backup_success.scheduled.body:G.processInfo.isBackupCreationInBackground?wpstg.i18n.backup_success.run_in_bg.body:wpstg.i18n.backup_success.created.body,processResponse:r});case 31:case"end":return t.stop()}}),s)})));return function(e){return r.apply(this,arguments)}}(),"json",!1,0,1.25,(function(e,t,n){q.continueErrorHandle=!1;var s={messages:[]};++o<=r?V.createBackup():(s.messages.push({type:"critical",message:"There was a PHP fatal error while processing the backup. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}),G.processResponse(s),G.cancel(),setTimeout(G.logsModal,500))}))},selectWpRootDirsBySelectingParent:function(e){var t;e.preventDefault();var n=e.currentTarget.closest(".wpstg--swal2-container"),s=Array.from(n.querySelectorAll(".wpstg-wproot-files-selection input.wpstg-check-dir"));!n.querySelector("#wpstgIncludeOtherFilesInWpRoot").checked||null!=(t=document.querySelector("#wpstg-wproot-other-files-span"))&&t.classList.contains("expand")||document.querySelector("#wpstg-wproot-other-files-span").click(),document.querySelector(".wpstg-no-custom-dirs")?n.querySelector("#wpstgIncludeOtherFilesInWpRoot").checked=!1:s.forEach((function(e){null!=e&&e.disabled||(e.checked=n.querySelector("#wpstgIncludeOtherFilesInWpRoot").checked)}))},selectWpRootDirsWillSelectParent:function(e){var t;e.preventDefault();var n=e.currentTarget.closest(".wpstg--swal2-container"),s=Array.from(n.querySelectorAll(".wpstg-wproot-files-selection input.wpstg-check-dir:checked"));n.querySelector("#wpstgIncludeOtherFilesInWpRoot").checked=null==(t=s.length>0)||t,V.disableBackupButtonIfNoSelection(e)},clickExpandSubFolders:function(e){e.preventDefault(),document.querySelector("#wpstg-wproot-other-files-span").click()},warnBackupMediaWithoutDatabase:function(e){var t=e.currentTarget.closest(".wpstg--swal2-container");if(e.preventDefault(),null!==t.querySelector("#includeDatabaseInBackup")||null!==t.querySelector("#includeMediaLibraryInBackup")){var n=t.querySelector("#includeDatabaseInBackup").checked,s=t.querySelector("#includeMediaLibraryInBackup").checked;t.querySelector("#backupUploadsWithoutDatabaseWarning").style.display=s&&!n?"block":"none"}},disableBackupButtonIfNoSelection:function(e){var t=e.currentTarget.closest(".wpstg--swal2-container");e.preventDefault();var n=Array.from(t.querySelectorAll('[type="checkbox"][name="storages"]:checked')).length>0;if(null!==t.querySelector("#includeDatabaseInBackup")||null!==t.querySelector("#includeMediaLibraryInBackup")){var s=Array.from(t.querySelectorAll('[type="checkbox"][name="includedDirectories[]"]:checked')).length>0,r=1===Array.from(t.querySelectorAll("input#includeDatabaseInBackup:checked")).length,o=1===Array.from(t.querySelectorAll("input#includeOtherFilesInWpContent:checked")).length,a=1===Array.from(t.querySelectorAll("input#wpstgIncludeOtherFilesInWpRoot:checked")).length;t.querySelector(".wpstg--swal2-confirm").disabled=!s&&!r&&!o&&!a||!n}else t.querySelector(".wpstg--swal2-confirm").disabled=!n},calculateBackupSize:function(e){return s(t().mark((function n(){var r,o,a,i,c,u,p;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.preventDefault(),r=e.currentTarget.closest(".wpstg--swal2-container"),o={includePluginsInBackup:"#includePluginsInBackup",includeMuPluginsInBackup:"#includeMuPluginsInBackup",includeThemesInBackup:"#includeThemesInBackup",includeMediaLibraryInBackup:"#includeMediaLibraryInBackup",includeOtherFilesInWpContent:"#includeOtherFilesInWpContent",wpstgIncludeOtherFilesInWpRoot:"#wpstgIncludeOtherFilesInWpRoot"},!Object.values(o).every((function(e){return null===r.querySelector(e+":checked")}))){n.next=8;break}return k("#wpstg-total-backup-size-container"),E("error","Please select at least one backup option (excluding the database) to proceed with size calculation."),n.abrupt("return");case 8:return S("#wpstg-calculate-backup-size-loader"),a={},null!==r.querySelector("#wpstgSmartExclusion:checked")&&(a.wpstgExcludeLogs=null!==r.querySelector("#wpstgExcludeLogs:checked"),a.wpstgExcludeCaches=null!==r.querySelector("#wpstgExcludeCaches:checked"),a.wpstgExcludePostRevision=null!==r.querySelector("#wpstgExcludePostRevision:checked"),a.wpstgExcludeSpamComments=null!==r.querySelector("#wpstgExcludeSpamComments:checked"),a.wpstgExcludeUnusedThemes=null!==r.querySelector("#wpstgExcludeUnusedThemes:checked"),a.wpstgExcludeDeactivatedPlugins=null!==r.querySelector("#wpstgExcludeDeactivatedPlugins:checked")),i=0,c=document.querySelector("#wpstg-total-estimated-backup-size"),u=r.querySelector('[name="backupType"]').value||null,n.next=17,Promise.all(Object.entries(o).map(function(){var e=s(t().mark((function e(n){var s,o,c,p,d,g,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n[0],o=n[1],c=r.querySelector("#"+s+"Size"),null===r.querySelector(o+":checked")){e.next=10;break}return e.next=5,l("wpstg--backups--calculate-backup-size",{backup_part:s,advanceExclusion:a,backup_type:u});case 5:if((g=e.sent).success&&null!=g&&null!=(p=g.data)&&p.size_raw&&(h=Number(g.data.size_raw),isNaN(h)||(i+=h)),!(g.success&&null!=g&&null!=(d=g.data)&&d.size&&c)){e.next=10;break}return c.textContent=g.data.size,e.abrupt("return",!0);case 10:return c&&(c.textContent=""),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:p=n.sent,c&&(S("#wpstg-total-backup-size-container"),c.textContent=P(i)),p.some((function(e){return e}))&&k("#wpstg-calculate-backup-size-loader");case 20:case"end":return n.stop()}}),n)})))()}};var n=function(){var t=document.querySelectorAll("#wpstg-wproot-other-files-span"),n=t[t.length-1],s=document.querySelector(".wpstg--expand-folder-img");null==n||n.addEventListener("click",(function(n){n.preventDefault();var r=e(this),o=document.querySelectorAll(r.data("id"))[t.length-1];o&&(r.toggleClass("expand"),r.hasClass("expand")?(b(o),s.classList.add("wpstg-rotate-90")):(v(o),s.classList.remove("wpstg-rotate-90")))}))}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){J.listen()})),J={listen:function(){e("#wpstg--tab--backup").off("click",".wpstg-delete-backup[data-md5]",J.delete).on("click",".wpstg-delete-backup[data-md5]",J.delete)},delete:function(e){var t=this;e.preventDefault(),q.resetErrors();var n=this.getAttribute("data-name"),s=wpstg.i18n.backup_delete.delete_html+'<br /><b>"'+n+'"</b>?';q.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-btn-danger wpstg-link-btn"}).fire({showConfirmButton:!0,showCancelButton:!0,cancelButtonText:wpstg.i18n.cancel,confirmButtonText:wpstg.i18n.delete,icon:"warning",title:wpstg.i18n.backup_delete.delete_title,html:'<div class="wpstg--modal--delete" style="text-align: center;">'+s+"</div>"}).then((function(e){if(e.value){T().then((function(){return _()})),q.isLoading(!0),q.cache.get("#wpstg-existing-backups").hide();var n=t.getAttribute("data-md5");q.ajax({action:"wpstg--backups--delete",md5:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){_(),q.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report),q.isLoading(!1),G.fetchListing()}))}}))}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){Q.listen()})),Q={listen:function(){e("#wpstg--tab--backup").off("click",".wpstg--backup--edit[data-md5]",Q.edit).on("click",".wpstg--backup--edit[data-md5]",Q.edit)},edit:function(n){var r=this;return s(t().mark((function s(){var o,a,i,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),o=e(r),a=q.htmlEntityQuotesDecode(q.sanitizeEventAttribute(o.data("name"))),i=q.htmlEntityQuotesDecode(q.sanitizeEventAttribute(o.data("notes"))),t.next=6,q.getSwalModal().fire({title:"",html:'\n                    <label id="wpstg-backup-edit-name">'+wpstg.i18n.backup_edit.edit_html_name+'</label>\n                    <input id="wpstg-backup-edit-name-input" class="wpstg--swal2-input" maxlength="100" value="'+a+'">\n                    <label>'+wpstg.i18n.backup_edit.edit_html_notes+'</label>\n                    <textarea id="wpstg-backup-edit-notes-textarea" class="wpstg--swal2-textarea" maxlength="1000">'+i+"</textarea>\n                  ",focusConfirm:!1,confirmButtonText:wpstg.i18n.save,showCancelButton:!0,preConfirm:function(){return{name:q.sanitizeEventAttribute(document.getElementById("wpstg-backup-edit-name-input").value)||null,notes:q.sanitizeEventAttribute(document.getElementById("wpstg-backup-edit-notes-textarea").value)||null}}});case 6:if(c=t.sent,l=c.value){t.next=10;break}return t.abrupt("return");case 10:q.ajax({action:"wpstg--backups--edit",accessToken:wpstg.accessToken,nonce:wpstg.nonce,md5:o.data("md5"),name:q.sanitizeEventAttribute(l.name),notes:q.sanitizeEventAttribute(l.notes)},(function(e){q.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report),T().then((function(){return _()})),G.fetchListing()}));case 11:case"end":return t.stop()}}),s)})))()}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){K.listen()})),window.addEventListener("wpstg--restore--cloud--backup",(function(e){G.modal.restore.data.file=e.detail.file,K.selectedBackup()})),K={listen:function(){e("body").off("click",".wpstg--backup--restore",K.clickedRestore).on("click",".wpstg--backup--restore",K.clickedRestore)},timer:new H,clickedRestore:function(e){var t=this;WPStaging.checkUserDbPermissions("restore").then((function(){q.resetErrors(),e.preventDefault(),z.isCancelled=!1,G.modal.restore.data.file=t.getAttribute("data-filePath"),K.selectedBackup()}))},selectedBackup:function(){q.ajax({action:"wpstg--backups--read-backup-metadata",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg:{file:G.modal.restore.data.file}},(function(t){var n;try{var s=(n=JSON.parse(q.getDataFromWordPressResponse(t))).networks[Object.keys(n.networks)[0]];n=s.blogs[Object.keys(s.blogs)[0]]}catch(e){q.showError(e)}G.modal.restore.data.backupMetadata=n;var r=new FormData;r.append("action","wpstg--backups--restore--file-info"),r.append("accessToken",wpstg.accessToken),r.append("nonce",wpstg.nonce),r.append("filePath",G.modal.restore.data.file),fetch(ajaxurl,{method:"POST",body:r}).then(q.handleFetchErrors).then((function(e){return e.json()})).then((function(e){G.modal.restore.retryCount=0,K.importModal(e,r)})).catch((function(e){return q.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)})),e(".wpstg--modal--actions .wpstg--swal2-confirm").show(),e(".wpstg--modal--actions .wpstg--swal2-confirm").prop("disabled",!1)}))},importModal:function(n){var r=function n(r,o,a){void 0===o&&(o=!1),void 0===a&&(a=null),q.resetErrors(),z.isCancelled?G.statusStop():(G.timer.start(),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),q.ajax({action:"wpstg--backups--restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,retry:o,errorCode:a},function(){var a=s(t().mark((function s(a){var i,c,l,u,p,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!z.isCancelled){t.next=2;break}return t.abrupt("return");case 2:if(q.retry.reset(),void 0!==a){t.next=6;break}return setTimeout((function(){n(r)}),wpstg.delayReq),t.abrupt("return");case 6:if(G.processResponse(a),G.processInfo.interval||G.statusStart("restore"),!0!==a.isRunning){t.next=12;break}n(r),t.next=33;break;case 12:if("JOB_FAIL"!==a.jobStatus){t.next=21;break}return t.next=15,G.checkMemoryExhaustion(a,"wpstg_restore");case 15:if(setTimeout((function(){n(r)}),wpstg.delayReq),!o){t.next=19;break}return t.next=19,G.processModal.logEventFailure("restore");case 19:t.next=33;break;case 21:if(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),e("#wpstg--progress--status").text(wpstg.i18n.backup_restore.import_modal_progress_status),!G.messages.shouldWarn()){t.next=26;break}return G.logsModal(),t.abrupt("return");case 26:G.statusStop(),i=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),(c=i?i.outerHTML:null)&&i.remove(),!c&&G.modal.download.html&&(l=new DOMParser,u=l.parseFromString(G.modal.download.html,"text/html"),p=u.querySelector(".wpstg--success-modal--logs"),c=p?p.outerHTML:null),d=G.modal.restore.data.backupMetadata.isExportingDatabase&&!a.isDatabaseRestoreSkipped?wpstg.i18n.backup_restore.import_modal_login_text:"",q.getSwalModal(!0,{container:"wpstg-restore-finished-container"}).fire({icon:"success",title:wpstg.i18n.backup_restore.import_modal_modal_title,html:'<div id="wpstg-restore-success" class="wpstg--grey"><p class="wpstg--success-modal--text">'+wpstg.i18n.backup_restore.import_modal_modal_html+d+'<button class="wpstg--success-modal--logs-button" data-txt-bad="">'+wpstg.i18n.show_logs+"</button></p></div>"+c,onClose:function(){G.modal.restore.data.backupMetadata.isExportingDatabase&&!a.isDatabaseRestoreSkipped?(document.getElementById("wpstg-restore-wait").style.display="flex",setTimeout((function(){document.location.reload(!0)}),15e3),q.ajax({action:"raw_wpstg--backups--login-url",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(void 0!==e.data.loginUrl||"private_site"!==e.data.code){var t=new URL(e.data.loginUrl);t.searchParams.set("accessToken",wpstg.accessToken),t.searchParams.set("wpstgAfterRestore","yes"),G.modal.restore.data.backupMetadata.isCreatedOnWordPressCom&&t.searchParams.set("wpstgIsBackupCreatedOnWordPressCom","yes"),window.location.href=t.toString()}}))):G.fetchListing()}});case 33:case"end":return t.stop()}}),s)})));return function(e){return a.apply(this,arguments)}}(),"json",!1,10,1.25,function(){var e=s(t().mark((function e(o,a,i){var c,l,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=parseInt(o.status),l=void 0,503!==c&&423!==c&&429===c){e.next=6;break}l=o.getResponseHeader("Retry-After"),e.next=8;break;case 6:return e.next=8,G.checkMemoryExhaustion({messages:[]},"wpstg_restore");case 8:if(q.retry.retryOnErrors.includes(c)){e.next=12;break}if(!q.retry.oneTimeRetry){e.next=11;break}return e.abrupt("return");case 11:q.retry.oneTimeRetry=!0;case 12:if(q.retry.canRetry()){e.next=14;break}return e.abrupt("return");case 14:q.continueErrorHandle=!1,q.retry.incrementRetry(),u=q.retry.currentDelay,l=void 0!==l?1e3*(parseInt(l)+1):u,setTimeout(s(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(r,!0,c);case 1:case"end":return e.stop()}}),e)}))),l);case 19:case"end":return e.stop()}}),e)})));return function(t,n,s){return e.apply(this,arguments)}}()))},o=e("#wpstg--modal--backup--restore");G.modal.restore.html=o.html(),G.modal.restore.baseDirectory=o.attr("data-baseDirectory"),G.modal.restore.btnTxtNext=o.attr("data-nextButtonText"),G.modal.restore.btnTxtConfirm=o.attr("data-confirmButtonText"),G.modal.restore.btnTxtCancel=o.attr("data-cancelButtonText"),q.getSwalModal().mixin({progressSteps:["1","2"]}).queue([{html:e(".wpstg--modal--backup--restore--introduction").first(),confirmButtonText:wpstg.i18n.next,showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:600,onRender:function(){e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-subsite").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").hide(),e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files-subsite").hide();var t="multi"===G.modal.restore.data.backupMetadata.singleOrMulti||"multi"===G.modal.restore.data.backupMetadata.backupType;!G.modal.restore.data.backupMetadata.isExportingDatabase||wpstg.isMultisite&&!t||e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database").show(),G.modal.restore.data.backupMetadata.isExportingDatabase&&wpstg.isMultisite&&!t&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-subsite").show(),G.modal.restore.data.backupMetadata.isExportingDatabase&&t&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-database-multisite").show();var n=G.modal.restore.data.backupMetadata.isExportingMuPlugins||G.modal.restore.data.backupMetadata.isExportingPlugins||G.modal.restore.data.backupMetadata.isExportingThemes||G.modal.restore.data.backupMetadata.isExportingUploads||G.modal.restore.data.backupMetadata.isExportingOtherWpContentFiles||G.modal.restore.data.backupMetadata.isExportingOtherWpRootFiles;!n||wpstg.isMultisite&&!t||e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files").show(),n&&wpstg.isMultisite&&!t&&e(".wpstg--modal--backup--restore--introduction .wpstg-backup-restore-contains-files-subsite").show()}},{html:n,confirmButtonText:wpstg.i18n.restore,showCancelButton:!0,showConfirmButton:!0,reverseButtons:!0,width:650}]).then((function(e){if(e&&e.value&&e.value[1]&&!0===e.value[1]){z.isCancelled=!1;var t=G.modal.restore.data;G.modal.restore.data.fileObject=null,t.file=G.modal.restore.baseDirectory+t.file,q.ajax({action:"wpstg--backups--prepare-restore",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstgRestoreData:t},(function(e){e.success?G.process({execute:function(){G.messages.reset(),G.wpstgProcessLogs.resetLogs(),r(t)}}):q.showAjaxFatalError(e.data,"",wpstg.i18n.submit_error_report)}),"json",!1,10,1.25,(function(e,t,n){423===e.status?(q.continueErrorHandle=!1,G.shouldCleanUp=!1,q.closeSwalModal(),setTimeout((function(){G.shouldCleanUp=!0}),1e3),q.showErrorModal(e.responseJSON.data)):q.continueErrorHandle=!0}))}}))}}}(jQuery);var X,Z,ee,te=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.currentBackupName="",this.uploadProcessPercentage=0,this.isUploadCompleted=!1,this.isUploadCanceled=!1,this.isProcessStarted=!1,this.isWpstgBackupFile=!1,this.uploadBackupFromUrl=this.uploadBackupFromUrl.bind(this),this.deleteUnfinishedUploadsCallback=null}var n=e.prototype;return n.setDeleteUnfinishedUploadsCallback=function(e){this.deleteUnfinishedUploadsCallback=e},n.startUploadProcess=function(){k(".wpstg--swal2-container #wpstg-upload-select"),S(".wpstg--swal2-container #wpstg-upload-progress"),S(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader"),w(".wpstg--swal2-container .wpstg--modal--upload--process").style.display="flex"},n.stopUploadProcess=function(){var e=this;setTimeout((function(){e.currentBackupName="",e.uploadProcessPercentage=0,e.isUploadCompleted=!1,e.isUploadCanceled=!1,e.isProcessStarted=!1}),2e3)},n.updateUploadProcess=function(){w(".wpstg--swal2-container .wpstg--modal--upload--progress").style.width=parseInt(this.uploadProcessPercentage)+"%",w(".wpstg--swal2-container .wpstg--modal--upload--progress--title > span").textContent=this.uploadProcessPercentage+"%"},n.hasWpstgExtension=function(){return this.currentBackupName.endsWith(".wpstg")},n.extractBackupNameFromUrl=function(e){try{var t=new URL(e);this.currentBackupName=t.pathname.split("/").pop()}catch(e){E("error",e.message)}},n.handleSuccessResponse=function(e){q.closeSwalModal();var t=e.message?e.message:"";e.success?q.showSuccessModal(t||this.wpstgObject.i18n.backup_upload_url.handle_success_response_success):q.showErrorModal(t||this.wpstgObject.i18n.backup_upload_url.handle_success_response_error),T().then((function(){return _()})),G.fetchListing(),this.stopUploadProcess()},n.handleInProgressResponse=function(e){this.uploadProcessPercentage=Math.round(e.startByte/e.fileSize*100,1),this.uploadProcessPercentage>100&&(this.uploadProcessPercentage=100),this.updateUploadProcess(),this.uploadBackupFromUrl(e.fileSize,e.startByte)},n.handleErrorResponse=function(e,t){!1!==this.isProcessStarted&&(confirm(this.wpstgObject.i18n.backup_upload_url.handle_error_response_confirm)?this.uploadBackupFromUrl(e,t):(q.closeSwalModal(),T().then((function(){return _()})),G.fetchListing(),this.stopUploadProcess()))},n.addEvent=function(){var e=this,t=q.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(){return e.handleCancelProcess()}))},n.handleCancelProcess=function(){var e=confirm(this.wpstgObject.i18n.backup_upload_url.handle_cancel_process_confirm);if(this.isUploadCanceled=!0,e)return q.closeSwalModal(),this.deleteUnfinishedUploadsCallback&&this.deleteUnfinishedUploadsCallback(),T().then((function(){return _()})),G.fetchListing(),void this.stopUploadProcess();this.isUploadCanceled=!1},n.prepareUploadBackupFromUrl=function(){var e=s(t().mark((function e(){var n,s,r,o=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=q.getSwalContainer().getElementsByClassName("wpstg-backup-download-button")[0],s=q.getSwalContainer(),!C(r=s.querySelector('input[name="wpstg-backup-url"]').value)){e.next=6;break}return E("error",this.wpstgObject.i18n.backup_upload_url.upload_backup_from_url_empty_error),e.abrupt("return",!1);case 6:return n.style.display="none",q.otp.setOnOtpRequest((function(e,t,s){null!=e&&e.success||(q.otp.reset(),n.style.display="block",423===s&&null!=t&&t.data?E("error",null==t?void 0:t.data):q.showOtpGenerationErrorModal())})),q.otp.setOnOtpVerification((function(e,t,s){if(null==e||!e.success)return n.style.display="block",q.closeSwalModal(),void q.processAndShowErrorModal(e,t,s);o.uploadBackupFromUrl()})),q.otp.setOnOtpCancelled((function(){n.style.display="block"})),e.next=12,q.otp.start("wpstg--backups--prepare-url-upload",{backupUrl:r});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.uploadBackupFromUrl=function(){var e=s(t().mark((function e(n,s){var r,o,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n=0),void 0===s&&(s=0),!this.isUploadCanceled){e.next=4;break}return e.abrupt("return",!1);case 4:if(r=q.getSwalContainer(),!C(o=r.querySelector('input[name="wpstg-backup-url"]').value)){e.next=9;break}return E("error",this.wpstgObject.i18n.backup_upload_url.upload_backup_from_url_empty_error),e.abrupt("return",!1);case 9:if(!1===this.isProcessStarted&&(this.extractBackupNameFromUrl(o),this.isWpstgBackupFile=this.hasWpstgExtension()),""!==this.currentBackupName){e.next=13;break}return E("error",this.wpstgObject.i18n.backup_upload_url.upload_backup_from_url_valid_url_error),e.abrupt("return",!1);case 13:if(this.isWpstgBackupFile){e.next=16;break}return E("error",this.wpstgObject.i18n.backup_upload_url.upload_backup_from_url_correct_url_error),e.abrupt("return",!1);case 16:!1===this.isProcessStarted&&(this.isProcessStarted=!0,this.startUploadProcess(),this.addEvent()),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--url-file-upload",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,backupUrl:o,fileSize:n,startByte:s}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){a.isUploadCompleted=e.complete,!1===e.complete&&e.success?a.handleInProgressResponse(e):a.handleSuccessResponse(e)})).catch((function(e){!1===a.isUploadCompleted&&a.handleErrorResponse(n,s)}));case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),e}();jQuery,window.addEventListener("backups-tab",(function(){X.listen()})),X={isUploading:!1,resumable:null,resumableFile:null,wpstgBackupUploadUrl:null,upload:{html:null,successMessage:null},listen:function(){document.body.addEventListener("click",(function(e){"wpstg-upload-backup"===e.target.id&&(X.uploadModal(),X.wpstgBackupUploadUrl=new te,X.wpstgBackupUploadUrl.setDeleteUnfinishedUploadsCallback((function(){X.deleteUnfinishedUploads()})))}))},uploadNotSupported:function(){q.showErrorModal(wpstg.i18n.backup_upload.upload_not_supported_error)},setModalStateStart:function(){X.isUploading=!1,w(".wpstg--swal2-container #wpstg-upload-select").style.display="block",w(".wpstg--swal2-container #wpstg-upload-progress").style.display="none",w(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="none"},setModalStateUploading:function(){X.isUploading=!0,w(".wpstg--swal2-container #wpstg-upload-select").style.display="none",w(".wpstg--swal2-container #wpstg-upload-progress").style.display="block",w(".wpstg--swal2-container .wpstg--modal--backup--upload--content .wpstg-linear-loader").style.display="block",w(".wpstg--swal2-container .wpstg--modal--upload--process").style.display="flex";var e=q.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",X.eventListenerConfirmCancelUpload)},eventListenerConfirmCancelUpload:function(){confirm(wpstg.i18n.backup_upload.event_listener_confirm_cancel_upload_confirm)&&(X.resumable.cancel(),q.closeSwalModal(),X.deleteUnfinishedUploads())},deleteUnfinishedUploads:function(){q.ajax({action:"wpstg--backups--uploads-delete-unfinished",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){}))},uploadModal:function(){return s(t().mark((function e(){var n,s,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.upload.html&&X.upload.successMessage&&!document.getElementById("wpstg--modal--backup--upload")||(n=document.getElementById("wpstg--modal--backup--upload"))&&(s=n.innerHTML,r=n.getAttribute("data-uploadSuccessMessage"),X.upload.html=s||null,X.upload.successMessage=r||null,n.parentNode.removeChild(n)),e.next=3,q.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-backup-download-button"}).fire({html:X.upload.html,showConfirmButton:!0,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!0,focusConfirm:!1,confirmButtonText:wpstg.i18n.upload,width:650,allowEscapeKey:function(){return!X.isUploading},allowOutsideClick:function(){return!X.isUploading},onRender:function(){var e=q.getSwalContainer(),t=e.getElementsByClassName("wpstg-backup-download-button")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t);var s=e.querySelector('input[name="wpstg-backup-url"]');if(n.disabled=!0,s.addEventListener("input",(function(e){e.target.value.trim()?n.disabled=!1:n.disabled=!0})),n.addEventListener("click",(function(){X.wpstgBackupUploadUrl.prepareUploadBackupFromUrl()})),X.deleteUnfinishedUploads(),X.setModalStateStart(),X.resumable=new Resumable({target:wpstg.ajaxUrl,chunkSize:wpstg.maxUploadChunkSize,query:{accessToken:wpstg.accessToken,action:"wpstg--backups--restore--file-upload",uniqueIdentifierSuffix:Math.floor(99999999*Math.random())},permanentErrors:[400,401,403,404,409,415,500,501,507,413],fileType:["wpstg",wpstg.backupDBExtension],simultaneousUploads:1,prioritizeFirstAndLastChunk:!1,testChunks:!1,forceChunkSize:!0}),X.resumable.resumableFile=null,!X.resumable.support)return q.closeSwalModal(),void X.uploadNotSupported();X.resumable.assignBrowse(w(".wpstg--swal2-container .resumable-browse")),X.resumable.assignDrop(w(".wpstg--swal2-container .resumable-drop")),X.resumable.on("fileAdded",X.handleFileAdded),X.resumable.on("fileSuccess",X.handleFileSuccess),X.resumable.on("error",X.handleError),X.resumable.on("progress",X.handleProgress)}});case 3:case"end":return e.stop()}}),e)})))()},handleFileAdded:function(e){return s(t().mark((function n(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(s=q.getSwalContainer().getElementsByClassName("wpstg-backup-download-button")[0])&&(s.style.display="none"),X.resumable.resumableFile=e,q.otp.setOnOtpRequest((function(e,t,n){null!=e&&e.success||(q.otp.reset(),s.style.display="block",X.resumable.resumableFile=null,X.resumable.cancel(),423===n&&null!=t&&t.data?E("error",null==t?void 0:t.data):q.showOtpGenerationErrorModal())})),q.otp.setOnOtpVerification((function(e,t,n){if(null==e||!e.success)return X.resumable.resumableFile=null,X.resumable.cancel(),s.style.display="block",q.closeSwalModal(),void q.processAndShowErrorModal(e,t,n);X.setModalStateUploading(),X.resumable.upload()})),q.otp.setOnOtpCancelled((function(){s.style.display="block",X.resumable.resumableFile=null,X.resumable.cancel()})),t.next=8,q.otp.start("wpstg--backups--prepare-upload");case 8:case"end":return t.stop()}}),n)})))()},handleFileSuccess:function(e,t){q.closeSwalModal(),q.showSuccessModal(X.upload.successMessage),T().then((function(){return _()})),G.fetchListing()},handleProgress:function(){var e=Math.floor(100*X.resumable.progress());w(".wpstg--swal2-container .wpstg--modal--upload--progress").style.width=e+"%",w(".wpstg--swal2-container .wpstg--modal--upload--progress--title > span").textContent=e+"%"},handleError:function(e,t){try{var n=JSON.parse(e);if(n.hasOwnProperty("data")&&n.data.hasOwnProperty("message")){if(n.data.hasOwnProperty("isDiskFull")&&n.data.isDiskFull)return X.resumable.cancel(),q.closeSwalModal(),void q.showErrorModal(n.data.message);if(n.data.hasOwnProperty("backupFailedValidation")&&n.data.backupFailedValidation)return X.resumable.cancel(),q.closeSwalModal(),void q.showErrorModal(n.data.message);if(!n.success)return X.resumable.cancel(),q.closeSwalModal(),void q.showErrorModal(n.data.message)}}catch(e){}var s=Math.max(262144,.1*X.resumable.opts.chunkSize);X.resumable.opts.chunkSize=Math.ceil(X.resumable.opts.chunkSize-s),X.resumable.opts.chunkSize<65536&&(q.closeSwalModal(),q.showErrorModal(wpstg.i18n.backup_upload.handle_error_modal)),X.deleteUnfinishedUploads(),X.resumable.files[0].retry()}},function(e){window.addEventListener("backups-tab",(function(){Z.listen()})),Z={listen:function(){e("body").off("click",".wpstg--backup--download-modal",Z.clickedDownload).on("click",".wpstg--backup--download-modal",Z.clickedDownload)},clickedDownload:function(e){q.resetErrors(),e.preventDefault(),z.isCancelled=!1,G.modal.download.data.indexFile=this.getAttribute("data-filePath"),Z.downloadModal()},renderPart:function(t,n){var s='<div class="wpstg--backups--part">\n        <h2>'+t.name+"</h2>\n        <p>"+wpstg.i18n.backup_download.render_part_html_file_size+": "+t.fileSize+'</p>\n        <a download href="'+t.downloadLink+'">'+wpstg.i18n.backup_download.render_part_html_download+"</a>\n      </div>";e(n).append(s)},downloadModal:function(){q.resetErrors();var t=e("#wpstg--modal--backup--download-modal");G.modal.download.html=t.html(),q.getSwalModal(!1).fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.cancel,title:wpstg.i18n.backup_download.download_modal_title,html:G.modal.download.html,onRender:function(){e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").html(""),e(".wpstg--modal--download--parts-container").show(),q.ajax({action:"wpstg--backups--parts",accessToken:wpstg.accessToken,nonce:wpstg.nonce,filePath:G.modal.download.data.indexFile},(function(t){if(!z.isCancelled){if(void 0===t)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();if(!0===t.error)return e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),void e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show();t.parts.forEach((function(e){Z.renderPart(e,".wpstg--modal--download--parts-container .wpstg--modal--download--parts")})),e(".wpstg--modal--download--parts-container .wpstg--modal--fetching--data").hide(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--text").show(),e(".wpstg--modal--download--parts-container .wpstg--modal--download--parts").show()}}),"json",!1,0,1.25)}}).then()}}}(jQuery),function(e){window.addEventListener("backups-tab",(function(){ee.listen()})),ee={listen:function(){document.body.addEventListener("click",(function(e){"wpstg-manage-backup-schedules"===e.target.id&&ee.manageSchedulesModal()})),e("body").on("click",".wpstg--edit-schedule-basic",ee.showAlertForBasic)},showAlertForBasic:function(e){q.resetErrors(),e.preventDefault(),alert(wpstg.i18n.backup_manage_schedules.show_alert_for_basic_alert)},manageSchedulesModal:function(){ee.fetchSchedules();var e=document.getElementById("wpstg-backup--manage--schedules-loader");e?e.classList.add("show-loader"):document.getElementById("wpstg--modal--backup--manage--schedules").innerHTML+='<div id="wpstg-backup--manage--schedules-loader" class="wpstg-loader show-loader"></div>',q.getSwalModal(!1).fire({html:document.getElementById("wpstg--modal--backup--manage--schedules").innerHTML,showConfirmButton:!1,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.close,confirmButtonText:wpstg.i18n.save,width:750,allowEscapeKey:!0,allowOutsideClick:!0})},fetchSchedules:function(){q.ajax({action:"wpstg--backups-fetch-schedules",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){w(".wpstg--swal2-container #wpstg-backup--manage--schedules-loader").classList.remove("show-loader"),w(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content").innerHTML=e.data,document.querySelectorAll(".wpstg--swal2-container #wpstg--modal--backup--manage--schedules--content .wpstg--dismiss-schedule").forEach((function(e){e.addEventListener("click",(function(e){confirm("Do you really want to delete this schedule?")&&ee.dismissSchedule(e.target)}))}))}))},dismissSchedule:function(e){var t=e.dataset.scheduleId;T().then((function(){return w(".wpstg--swal2-container #wpstg-backup--manage--schedules-loader").classList.add("show-loader")})),q.ajax({action:"wpstg--backups-dismiss-schedule",accessToken:wpstg.accessToken,nonce:wpstg.nonce,scheduleId:t},(function(e){e.success?(ee.fetchSchedules(),G.fetchListing(),G.modal.create.hasBackupSchedule=!1):q.showErrorModal(e.data)}))}}}(jQuery)}();
