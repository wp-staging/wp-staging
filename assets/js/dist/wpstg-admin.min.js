!function(){"use strict";function t(){t=function(){return e};var e={},n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,s){var o=e&&e.prototype instanceof g?e:g,i=Object.create(o.prototype),a=new C(s||[]);return r(i,"_invoke",{value:_(t,n,a)}),i}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var p={};function g(){}function h(){}function w(){}var f={};l(f,i,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(T([])));b&&b!==n&&s.call(b,i)&&(f=b);var v=w.prototype=g.prototype=Object.create(f);function y(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(r,o,i,a){var c=d(t[r],t,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,i,a)}),(function(t){n("throw",t,i,a)})):e.resolve(u).then((function(t){l.value=t,i(l)}),(function(t){return n("throw",t,i,a)}))}a(c.arg)}var o;r(this,"_invoke",{value:function(t,s){function r(){return new e((function(e,r){n(t,s,e,r)}))}return o=o?o.then(r,r):r()}})}function _(t,e,n){var s="suspendedStart";return function(r,o){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw o;return L()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var a=k(i,n);if(a){if(a===p)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===s)throw s="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s="executing";var c=d(t,e,n);if("normal"===c.type){if(s=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s="completed",n.method="throw",n.arg=c.arg)}}}function k(t,e){var n=e.method,s=t.iterator[n];if(void 0===s)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var r=d(s,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,p;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function T(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(s.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return h.prototype=w,r(v,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:h,configurable:!0}),h.displayName=l(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,l(t,c,"GeneratorFunction")),t.prototype=Object.create(v),t},e.awrap=function(t){return{__await:t}},y(x.prototype),l(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,s,r,o){void 0===o&&(o=Promise);var i=new x(u(t,n,s,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},y(v),l(v,c,"Generator"),l(v,i,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var s in e)n.push(s);return n.reverse(),function t(){for(;n.length;){var s=n.pop();if(s in e)return t.value=s,t.done=!1,t}return t.done=!0,t}},e.values=T,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,s){return i.type="throw",i.arg=t,e.next=n,s&&(e.method="next",e.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var s=n.completion;if("throw"===s.type){var r=s.arg;E(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:T(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function n(t,e,n,s,r,o,i){try{var a=t[o](i),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(s,r)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(r,o){var i=t.apply(e,s);function a(t){n(i,r,o,a,c,"next",t)}function c(t){n(i,r,o,a,c,"throw",t)}a(void 0)}))}}function r(){return r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},r.apply(this,arguments)}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=(Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(t){var e=this;do{if(Element.prototype.matches.call(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}),function(t,e){return t instanceof Element?t.closest(e):null});function c(t,e,n,s){var r,o,i,a,c=!1,l=!1,u={},d=0,p=0,g={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(t){r=t.clientX,o=t.clientY}function w(t,e){if(p&&(p=clearTimeout(p)),Math.abs(i-r)+Math.abs(a-o)<g.sensitivity)return d=1,l?void 0:n(t,e);i=r,a=o,p=setTimeout((function(){w(t,e)}),g.interval)}function f(t,e){return c=!0,p&&(p=clearTimeout(p)),t.removeEventListener("mousemove",h,!1),1!==d&&(i=e.clientX,a=e.clientY,t.addEventListener("mousemove",h,!1),p=setTimeout((function(){w(t,e)}),g.interval)),this}function m(t){t.target.matches(e+", "+e+" *")&&f(t.target.closest(e),t)}function b(t,e){return c=!1,p&&(p=clearTimeout(p)),t.removeEventListener("mousemove",h,!1),1===d&&(p=setTimeout((function(){!function(t,e){p&&(p=clearTimeout(p)),d=0,l||s(t,e)}(t,e)}),g.timeout)),this}function v(t){t.target.matches(e+", "+e+" *")&&b(t.target.closest(e),t)}function y(t){t.target.matches(e+", "+e+" *")&&function(t,e){c||(l=!0,n(t,e))}(t.target.closest(e),t)}function x(t){t.target.matches(e+", "+e+" *")&&function(t,e){!c&&l&&(l=!1,s(t,e))}(t.target.closest(e),t)}function _(){t.removeEventListener("focus",y,!1),t.removeEventListener("blur",x,!1)}return u.options=function(e){var n=e.handleFocus!==g.handleFocus;return g=Object.assign({},g,e),n&&(g.handleFocus?(t.addEventListener("focus",y,!1),t.addEventListener("blur",x,!1)):_()),u},u.remove=function(){t&&(t.removeEventListener("mouseover",m,!1),t.removeEventListener("mouseout",v,!1),_())},t&&(t.addEventListener("mouseover",m,!1),t.addEventListener("mouseout",v,!1)),u}var l=function(){function e(t){void 0===t&&(t=wpstg),this.wpstgObject=t}return e.prototype.sendRequest=function(){var e=s(t().mark((function e(n){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:n,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return s=t.sent,t.next=6,s.json();case 6:if(void 0===(r=t.sent).status||!r.status||!r.error){t.next=9;break}return t.abrupt("return",r);case 9:console.warn(r.message),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,t.t0);case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),e}(),u=function(e){var n={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],oneTimeRetry:!1,performingRequest:!1,incrementRetry:function(t){void 0===t&&(t=1.25),n.retry.performingRequest=!0,0===n.retry.currentDelay&&(n.retry.currentDelay=1e3,n.retry.count=1),n.retry.currentDelay+=1e3*n.retry.count*t,n.retry.count++},canRetry:function(){return n.retry.count<n.retry.max},reset:function(){n.retry.currentDelay=0,n.retry.count=0,n.retry.performingRequest=!1,n.retry.oneTimeRetry=!1}},delay:function(t){return new Promise((function(e){return setTimeout(e,t)}))},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(t){localStorage.setItem("jobIdBeingProcessed",t)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(e){return s(t().mark((function n(){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new l,t.next=3,s.sendRequest(e);case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return",!1);case 6:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),n)})))()},listenTooltip:function(){c(document,".wpstg--tooltip",(function(t,e){t.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(t,e){e.target.closest(".wpstg--tooltiptext a")||(t.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(t,e){void 0===t&&(t=!1),void 0===e&&(e={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:t?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},s={customClass:Object.assign(n,e),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(s)},showSuccessModal:function(t){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"success",title:wpstg.i18n.success+"!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+t+"</div>"})},showWarningModal:function(t){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+t+"</div>"})},showErrorModal:function(t){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"error",title:wpstg.i18n.error+"!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+t+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(t){if("object"!=typeof t)throw new Error("Unexpected response (ERR 1341)");if(!t.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!t.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===t.success)throw t.data instanceof Array&&t.data.length>0?new Error(t.data.shift()):new Error("Response was not successful");return t.data},isLoading:function(t){t&&!1!==t?n.cache.get(".wpstg-loader").show():n.cache.get(".wpstg-loader").hide()},slugify:function(t){return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(t){return null===t?t:t.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(t){return null===t?t:t.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(t,e,s){return e=e?e+"<br/><br/>":wpstg.i18n.something_went_wrong+"<br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===t?(n.showError(e+" Error: No response."+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==t.error&&t.error?(n.showError(e+" Error: "+t.message+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},showFirewallError:function(){return wpstg.i18n.common.firewall_error_text},handleFetchErrors:function(t){if(!t.ok){var e=!1,s="Error: "+t.status+" - "+t.statusText+". ";403===t.status||405===t.status||406===t.status?(s+=n.showFirewallError(),e=!0):s+=wpstg.i18n.common.fetch_errors_error_text,e&&n.showErrorModal(s),n.showError(s)}return t},showError:function(t){n.retry.performingRequest||(n.cache.get("#wpstg-try-again").css("display","inline-block"),n.cache.get("#wpstg-cancel-cloning").text("Reset"),n.cache.get("#wpstg-resume-cloning").show(),n.cache.get("#wpstg-error-wrapper").show(),n.cache.get("#wpstg-error-details").show().html(t),n.cache.get("#wpstg-removing-clone").removeClass("loading"),n.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(t))},resetErrors:function(){n.cache.get("#wpstg-error-details").hide().html("")},ajax:function(t,s,r,o,i,a,c){void 0===a&&(a=null),void 0===c&&(c=null),void 0===r&&(r="json"),!1!==o&&(o=!0),i=void 0===i?0:i;var l=wpstg.maxFailedRetries,u=1e4*i;a=parseInt(a),isNaN(a)||(u*=a),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:r,cache:!1,data:t,error:function(e,d,p){if(console.log(e.status+" "+e.statusText+"---"+d),"function"!=typeof c||(c(e,d,p),n.continueErrorHandle))if(++i<=l)setTimeout((function(){n.ajax(t,s,r,o,i,a)}),u);else{var g=void 0===e.status?"Unknown":e.status,h=wpstg.i18n.common.ajax_error_fatal_error+g+wpstg.i18n.common.ajax_error_error_text;403!==g&&405!==g&&406!==g||(h=wpstg.i18n.common.ajax_error_fatal_error+g+" "+n.showFirewallError()),n.showError(h)}else n.continueErrorHandle=!0},success:function(t){"function"==typeof s&&s(t)},statusCode:{404:function(){i>=l&&n.showError(wpstg.i18n.ajax_status_code_404)},500:function(){i>=l&&n.showError(wpstg.i18n.status_code_500)},504:function(){i>l&&n.showError(wpstg.i18n.common.ajax_status_code_504)},502:function(){i>=l&&n.showError(wpstg.i18n.common.ajax_status_code_502)},503:function(){i>=l&&n.showError(wpstg.i18n.common.ajax_status_code_503)},429:function(){i>=l&&n.showError(wpstg.i18n.common.ajax_status_code_429)},403:function(){showError("Error 403 - "+n.showFirewallError())},405:function(){showError("Error 405 - "+n.showFirewallError())},406:function(){showError("Error 406 - "+n.showFirewallError())}}})}};return n}(jQuery);function d(t){return document.querySelector(t)}function p(t){return document.querySelectorAll(t)}function g(t,e,n,s){!t instanceof Element||t.addEventListener(e,(function(t){t.target.matches(n+", "+n+" *")&&s(t.target.closest(n),t)}),!1)}function h(t,e){void 0===e&&(e=400),t.style.display="block",t.style.overflow="hidden";var n=t.offsetHeight;t.style.height="0px",t.style.transitionProperty="height",t.style.transitionDuration=e+"ms",setTimeout((function(){t.style.height=n+"px",window.setTimeout((function(){t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)}),0)}function w(t,e){void 0===e&&(e=400),t.style.display="block",t.style.overflow="hidden";var n=t.offsetHeight;t.style.height=n+"px",t.style.transitionProperty="height",t.style.transitionDuration=e+"ms",setTimeout((function(){t.style.height="0px",window.setTimeout((function(){t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)}),0)}function f(t,e){for(var n=t.previousElementSibling;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function m(t){if(!(!t instanceof Element)&&t.id){var e="hidden";if("checkbox"!==t.getAttribute("type"));else{var n=a(t,".wpstg-container");if(null===n)return;var s=n.querySelectorAll('[data-show-if-checked="'+t.id+'"]'),r=n.querySelectorAll('[data-show-if-unchecked="'+t.id+'"]'),o=t.checked;if(s.length)for(var c,l=i(s);!(c=l()).done;){var u=c.value;o?u.classList.remove(e):u.classList.add(e)}if(r.length)for(var d,p=i(r);!(d=p()).done;){var g=d.value;o?g.classList.add(e):g.classList.remove(e)}}}}function b(t){if(!(!t instanceof Element)&&t.getAttribute("data-wpstg-target")){var e=a(t,".wpstg_admin");if(null!==e){var n=e.querySelectorAll(t.getAttribute("data-wpstg-target"));if(n.length)for(var s,r=i(n);!(s=r()).done;){s.value.classList.toggle("hidden")}}}}function v(t){if(!(!t instanceof Element)&&t.getAttribute("data-wpstg-target")&&t.getAttribute("data-wpstg-copy")){var e=a(t,".wpstg_admin");if(null!==e){navigator.clipboard.writeText(t.getAttribute("data-wpstg-copy"));var n=e.querySelectorAll(t.getAttribute("data-wpstg-target"));if(n.length)for(var s,r=i(n);!(s=r()).done;){s.value.value=t.getAttribute("data-wpstg-copy","")}}}}function y(t){document.querySelectorAll(t).forEach((function(t){t.style.display="none"}))}function x(t){document.querySelectorAll(t).forEach((function(t){t.style.display="block"}))}function _(t){var e,n=function(t){return"string"==typeof t?t:t&&"object"==typeof t&&t.target&&t.target.getAttribute("data-copy-content")?t.target.getAttribute("data-copy-content"):t instanceof Element&&t.getAttribute("data-wpstg-source")?document.querySelector(t.getAttribute("data-wpstg-source")).value:null}(t);n||k("error","No content to copy"),navigator.clipboard&&window.isSecureContext?(e=n,navigator.clipboard.writeText(e).then((function(){k("success","Copied to clipboard")})).catch((function(t){k("error","Unable to copy to clipboard")}))):function(t){var e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();var n=document.execCommand("copy");k(n?"success":"error",n?"Copied to clipboard":"Unable to copy to clipboard"),document.body.removeChild(e)}(n)}function k(t,e){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:t,message:e})}function S(t){void 0===t&&(t="visible"),document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(e){e&&(e.style.visibility=t)}))}function E(t){void 0===t&&(t="visible");var e=p(".wpstg-loading-placeholder-container");e.forEach((function(e){e&&(e.style.visibility=t)})),setTimeout((function(){e.forEach((function(t){t&&"visible"===t.style.visibility&&(t.style.visibility="hidden")})),j()}),5e3);var n=d(".wpstg--tab--contents");if("visible"===t)return S(),void(n&&(n.style.overflow="hidden"));j(),n&&(n.style.overflow="unset")}function C(){return(window.location.search.match(/[\?&]page=([^&]*)/)||[])[1]||null}function T(t){return L.apply(this,arguments)}function L(){return(L=s(t().mark((function e(n){var s,r,o,i,a,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=""),""===n&&(n=d(".wpstg--tab--contents")),null!==n){t.next=4;break}return t.abrupt("return");case 4:if(s=n.querySelector(".wpstg-loading-placeholder-container"),r=s.querySelector(".wpstg-dom-loading-wrapper")){t.next=8;break}return t.abrupt("return");case 8:if(r.offsetHeight===n.offsetHeight){t.next=19;break}r.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(t){return t.remove()})),null==(o=r.querySelector(".wpstg-loading-line"))||o.remove(),null==(i=r.querySelector(".wpstg-loading-last-line-bar"))||i.remove();case 13:return r.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),t.next=16,new Promise((function(t){return setTimeout(t,0)}));case 16:if(r.offsetHeight<=n.offsetHeight-40){t.next=13;break}case 17:null==(a=r.firstElementChild)||a.classList.add("wpstg-loading-first-line-bar"),null==(c=r.lastElementChild)||c.classList.add("wpstg-loading-last-line-bar");case 19:return t.next=21,new Promise((function(t){return setTimeout(t,0)}));case 21:case"end":return t.stop()}}),e)})))).apply(this,arguments)}function j(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(t){t&&(t.style.visibility="hidden")}))}var P=function(){function t(t,e){void 0===t&&(t="contact-us"),void 0===e&&(e=wpstg),this.wpstgObject=e,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=t,this.init()}var e=t.prototype;return e.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.askInTheForumForm=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-form",this.contactUsSuccessPopup=this.contactUsModal+" #wpstg-"+this.modalType+"-success-form",this.contactUsLoader=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-loader",this.contactUsSupport=this.contactUsModal+" #wpstg-"+this.modalType+"-support-forum",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.reportIssueButton=document.querySelector("#wpstg-contact-us-report-issue"),this.successForm=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" #wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector("#wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()},e.addEvents=function(){var t=this;document.addEventListener("keydown",(function(e){"Escape"===e.key&&(y(t.contactUsModal),y(t.askInTheForumForm),y(t.contactUsSuccessPopup),y(t.contactUsSupport),t.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){x(t.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){x(t.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){t.isDebugWindowOpened?y(t.askInTheForumForm):x(t.askInTheForumForm),t.isDebugWindowOpened=!t.isDebugWindowOpened,t.toggleActiveClass()})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){t.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){y(t.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){y(t.contactUsModal),y(t.contactUsSupport),y(t.askInTheForumForm),t.isDebugWindowOpened=!1,t.toggleActiveClass()})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){t.contactUsDebugCodeField.select(),t.contactUsDebugCodeField.setSelectionRange(0,99999),_(t.contactUsDebugCodeField.value)}))},e.generateDebugCode=function(t){for(var e="",n=0;n<t;n++)e+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+e+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},e.sendDebugInfo=function(){var t=this;x(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0;var e=this.generateDebugCode(8),n=!1;this.contactUsForceSendDebugLog&&(n=this.contactUsForceSendDebugLog.checked),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_send_debug_log_report",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,debugCode:e,forceSend:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(t.contactUsReportIssueBtn.disabled=!1,e.ok)return e.json()})).then((function(n){var s,r;!0===(null==(s=n.response)?void 0:s.sent)&&(t.contactUsDebugCodeField.value=e,x(t.contactUsSuccessPopup),window.debugCode=e,y(t.contactUsForceSendDebugLogContainer),t.contactUsForceSendDebugLog.checked=!1),!1===(null==(r=n.response)?void 0:r.sent)&&"already_submitted"===n.response.status&&(x(t.contactUsForceSendDebugLogContainer),k("error",n.response.message)),y(t.contactUsLoader)})).catch((function(e){y(t.contactUsLoader),x(t.contactUsSupport),console.warn(t.wpstgObject.i18n.something_went_wrong,e)}))},e.toggleActiveClass=function(){this.isDebugWindowOpened||!this.reportIssueButton.classList.contains("active")?this.isDebugWindowOpened&&this.reportIssueButton.classList.add("active"):this.reportIssueButton.classList.remove("active")},t}(),O=function(){function t(t,e){void 0===t&&(t="#wpstg-clonepage-wrapper"),void 0===e&&(e=wpstg),this.pageWrapper=d(t),this.wpstgObject=e,this.enableButtonId="#wpstg-enable-staging-cloning",this.enableAction="wpstg_enable_staging_cloning",this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}var e=t.prototype;return e.addEvents=function(){var t=this;null!==this.pageWrapper&&g(this.pageWrapper,"click",this.enableButtonId,(function(){t.sendRequest(t.enableAction)}))},e.init=function(){this.addEvents()},e.sendRequest=function(t){var e=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:t,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(t){void 0!==t.success&&t.success?location.reload():void 0===t.message?e.notyf.error(e.wpstgObject.i18n.something_went_wrong):e.notyf.error(t.message)})).catch((function(t){console.warn(e.wpstgObject.i18n.something_went_wrong,t)}))},t}(),B=function(){function t(t,e,n){void 0===t&&(t="#wpstg-directories-listing"),void 0===e&&(e=u),void 0===n&&(n=null),this.directoryListingContainer=d(t),this.wpstgObject=e,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=n,this.init()}var e=t.prototype;return e.addEvents=function(){var t=this;null!==this.directoryListingContainer?(g(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(t,e){e.preventDefault()})),g(this.directoryListingContainer,"click",this.dirExpandSelector,(function(e,n){n.preventDefault(),t.toggleDirExpand(e)&&t.sendRequest(t.fetchChildrenAction,e)})),g(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){t.unselectAll()})),g(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){t.selectDefault()})),g(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(e,n){n.preventDefault(),t.toggleDirectoryNavigation(e)})),g(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(e){t.updateDirectorySelection(e)}))):console.log("Error: Unable to add directory navigation events.")},e.init=function(){this.addEvents(),this.parseExcludes()},e.toggleDirExpand=function(t){this.currentParentDiv=t.parentElement;var e=f(t,"span");return this.currentCheckboxElement=e.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},e.sendRequest=function(t){var e=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed"),s=this.currentCheckboxElement.getAttribute("data-path"),r=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:t,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:s,prefix:r,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(t){if(void 0!==t.success&&t.success){e.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(t.directoryListing),e.currentParentDiv.appendChild(n),null!==e.currentLoader&&(e.currentLoader.style.display="none"),void h(n)}null!==e.notyf?e.notyf.error(e.wpstgObject.i18n.something_went_wrong):alert("Error: "+e.wpstgObject.i18n.something_went_wrong)})).catch((function(t){console.warn(e.wpstgObject.i18n.something_went_wrong,t)}))},e.getExcludedDirectories=function(){var t,e=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(t){e.isParentExcluded(t.value)||e.excludedDirectories.push(t.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(t){e.isParentExcluded(t)||e.isScanned(t)||e.excludedDirectories.push(t)})),this.excludedDirectories.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator)},e.isParentExcluded=function(t){var e=!1;return this.excludedDirectories.forEach((function(n){t.startsWith(n+"/")&&(e=!0)})),e},e.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var t=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(e){t.push(e.value)}));var e,n=d("#wpstg_extraDirectories");if(null===n||""===n.value)return t.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator);var s=n.value.split(/\r?\n/);return t.concat(s).join(this.wpstgObject.settings.directorySeparator)},e.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(t){t.checked=!1})),this.countSelectedFiles()},e.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(t){t.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(t){t.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(t){t.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},e.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var t=this.existingExcludes.split(",");this.existingExcludes=t.map((function(t){return"/"===t.substr(0,1)?t.slice(1):t}))}else this.existingExcludes=[];else this.existingExcludes=[]},e.isScanned=function(t){var e=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(n){n.value===t&&(e=!0)})),e},e.toggleDirectoryNavigation=function(t){var e=f(t,"span"),n=e.querySelector('input[type="checkbox"]');if("false"!==n.getAttribute("data-navigatable","false")&&"false"!==n.getAttribute("data-scanned","false")){var s=function(t,e){for(var n=t.nextElementSibling;n;){if(n.matches(e))return n;n=n.nextElementSibling}}(e,".wpstg-subdir");"none"===s.style.display?h(s):w(s)}},e.updateDirectorySelection=function(t){var e=t.parentElement.parentElement;t.setAttribute("data-changed","true"),t.checked?(function(t,e){for(var n=[],s=t&&t.parentElement;s;s=s.parentElement)s.matches(e)&&n.push(s);return n}(e.parentElement,".wpstg-dir").forEach((function(t){for(var e=0;e<t.children.length;e++)t.children[e].matches(".wpstg--checkbox-wrapper")&&(t.children[e].children[e].checked=!0)})),e.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(t){"wp-admin"!==t.textContent&&"wp-includes"!==t.textContent&&t.classList.remove("disabled")})),e.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(t){t.checked=!0}))):(e.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(t){t.classList.add("disabled")})),e.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(t){t.checked=!1}))),this.countSelectedFiles()},e.countSelectedFiles=function(){var t=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,e=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,n=this.directoryListingContainer.querySelectorAll('[data-dir-type="other"]:checked'),s=0;n.forEach((function(t){var e,n;null!=(e=t.getAttribute("data-path"))&&e.includes("wp-content/plugins")||null!=(n=t.getAttribute("data-path"))&&n.includes("wp-content/themes")||s++}));var r=d("#wpstg-files-count");0===t&&0===e&&0===s?r.classList.add("danger"):r.classList.remove("danger"),r.innerHTML=this.wpstgObject.i18n.files_selected.replace("{t}",t).replace("{ts}",1===t?"":"s").replace("{p}",e).replace("{ps}",1===e?"":"s").replace("{o}",s).replace("{os}",1===s?"":"s")},t}(),M=function(){function t(t,e,n,s,r){void 0===t&&(t="#wpstg-scanning-db"),void 0===e&&(e="#wpstg-workflow"),void 0===n&&(n="#wpstg_network_clone"),void 0===s&&(s="#wpstg_select_tables_cloning"),void 0===r&&(r=wpstg),this.databaseTableSection=d(t),this.workflow=d(e),this.networkCloneSelector=n,this.networkCloneCheckbox=d(n),this.wpstgObject=r,this.isAllTablesChecked=!0,this.isMultisite="1"===this.wpstgObject.isMultisite,this.isNetworkClone=!1,this.inputSelector=s,this.input=d(this.inputSelector),this.init()}var e=t.prototype;return e.setNetworkClone=function(t){this.isNetworkClone=t},e.addEvents=function(){var t=this;null!==this.workflow?(g(this.workflow,"change",this.networkCloneSelector,(function(){t.selectDefaultTables()})),g(this.workflow,"change",this.inputSelector,(function(){t.countSelectedTables()})),g(this.workflow,"click",".wpstg-button-select",(function(e,n){n.preventDefault(),t.selectDefaultTables()})),g(this.workflow,"click",".wpstg-button-unselect",(function(e,n){n.preventDefault(),t.toggleTableSelection()})),g(this.workflow,"click",".wpstg-button-unselect-wpstg",(function(e,n){n.preventDefault(),t.unselectWPSTGTables()}))):console.log("Error: database table section is null. Cannot register events")},e.init=function(){this.addEvents()},e.getRegexPattern=function(){var t="^"+this.wpstgObject.tblprefix,e=!1;return void 0!==this.networkCloneCheckbox&&null!==this.networkCloneCheckbox&&(e=this.networkCloneCheckbox.checked),this.isNetworkClone&&(e=!0),this.isMultisite&&!e&&(t+="([^0-9])_*"),t},e.selectDefaultTables=function(){var t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table"),e=this.getRegexPattern();t.forEach((function(t){t.getAttribute("name","").match(e)?t.selected=!0:t.selected=!1})),this.countSelectedTables()},e.toggleTableSelection=function(){!1===this.isAllTablesChecked?(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(t){t.selected=!0})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.isAllTablesChecked=!0):(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(t){t.selected=!1})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.isAllTablesChecked=!1),this.countSelectedTables()},e.unselectWPSTGTables=function(){var t=this,e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table");e.forEach((function(e){var n=e.getAttribute("name","");n.match("wpstg")&&!n.match(t.wpstgObject.tblprefix+"wpstg_queue")&&(e.selected=!1)})),this.countSelectedTables()},e.getSelectedTablesWithoutPrefix=function(){var t=[],e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),n=this.getRegexPattern();return e.forEach((function(e){e.getAttribute("name","").match(n)||t.push(e.value)})),t.join(this.wpstgObject.settings.directorySeparator)},e.getIncludedTables=function(){var t=[],e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),n=this.getRegexPattern();return e.forEach((function(e){e.getAttribute("name","").match(n)&&t.push(e.value)})),t.join(this.wpstgObject.settings.directorySeparator)},e.getExcludedTables=function(){var t=[],e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:not(:checked)"),n=this.getRegexPattern();return e.forEach((function(e){e.getAttribute("name","").match(n)&&t.push(e.value)})),t.join(this.wpstgObject.settings.directorySeparator)},e.getTotalTables=function(){var t=0,e=this.getRegexPattern();return this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option").forEach((function(n){n.getAttribute("name","").match(e)&&t++})),t},e.countSelectedTables=function(){var t=this.getTotalTables(),e=this.input.querySelectorAll("option:checked").length,n=d("#wpstg-tables-count");0===e?(n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.tables_not_selected):(n.classList.remove("danger"),n.innerHTML=this.wpstgObject.i18n.tables_selected.replace("{d}",e).replace("{t}",t)),t!==e&&n.classList.add("danger")},t}(),I=function(){function t(t,e){void 0===t&&(t="#wpstg-exclude-filters-container"),void 0===e&&(e=wpstg),this.excludeContainer=d(t),this.excludeTableBody=d(t+" tbody"),this.wpstgObject=e,this.init()}var e=t.prototype;return e.addEvents=function(){var t=this;g(this.excludeContainer,"click",".wpstg-file-size-rule",(function(){t.addFileSizeExclude()})),g(this.excludeContainer,"click",".wpstg-file-ext-rule",(function(){t.addFileExtExclude()})),g(this.excludeContainer,"click",".wpstg-file-name-rule",(function(){t.addFileNameExclude()})),g(this.excludeContainer,"click",".wpstg-dir-name-rule",(function(){t.addDirNameExclude()})),g(this.excludeContainer,"click",".wpstg-clear-all-rules",(function(){t.clearExcludes()})),g(this.excludeContainer,"click",".wpstg-remove-exclude-rule",(function(e){t.removeExclude(e.parentElement)}))},e.init=function(){null!==this.excludeContainer?this.addEvents():console.log("Error: Given table selector not found!")},e.addFileSizeExclude=function(){this.addExcludeRuleRow("#wpstg-file-size-exclude-filter-template")},e.addFileExtExclude=function(){this.addExcludeRuleRow("#wpstg-file-ext-exclude-filter-template")},e.addFileNameExclude=function(){this.addExcludeRuleRow("#wpstg-file-name-exclude-filter-template")},e.addDirNameExclude=function(){this.addExcludeRuleRow("#wpstg-dir-name-exclude-filter-template")},e.addExcludeRuleRow=function(t){var e=d(t);if(null!==e){var n=e.content.cloneNode(!0).querySelector("tr");this.excludeTableBody.appendChild(n),p(".wpstg-has-exclude-rules").forEach((function(t){t.style.display="inherit"}))}},e.clearExcludes=function(){this.excludeTableBody.innerHTML="",p(".wpstg-has-exclude-rules").forEach((function(t){t.style.display="none"}))},e.removeExclude=function(t){null!==t.parentElement&&null!==t.parentElement.parentElement&&this.excludeTableBody.removeChild(t.parentElement.parentElement),""===this.excludeTableBody.innerHTML.trim()&&p(".wpstg-has-exclude-rules").forEach((function(t){t.style.display="none"}))},e.getExcludeFilters=function(){for(var t=this,e=[],n=[],s=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleCompare[]"]'),r=this.excludeTableBody.querySelectorAll('input[name="wpstgFileSizeExcludeRuleSize[]"]'),o=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleByte[]"]'),i=0,a=Object.entries(r);i<a.length;i++){var c=a[i],l=c[0],u=c[1];""!==u.value&&n.push(s[l].value+" "+u.value+o[l].value)}this.excludeTableBody.querySelectorAll('input[name="wpstgFileExtExcludeRule[]"]').forEach((function(n){var s=t.cleanStringForGlob(n.value);""!==s&&e.push("ext:"+s.trim())}));for(var d=this.excludeTableBody.querySelectorAll('select[name="wpstgFileNameExcludeRulePos[]"]'),p=this.excludeTableBody.querySelectorAll('input[name="wpstgFileNameExcludeRulePath[]"]'),g=0,h=Object.entries(p);g<h.length;g++){var w=h[g],f=w[0],m=w[1],b=this.cleanStringForGlob(m.value);""!==b&&e.push("file:"+d[f].value+" "+b.trim())}for(var v=this.excludeTableBody.querySelectorAll('select[name="wpstgDirNameExcludeRulePos[]"]'),y=this.excludeTableBody.querySelectorAll('input[name="wpstgDirNameExcludeRulePath[]"]'),x=0,_=Object.entries(y);x<_.length;x++){var k=_[x],S=k[0],E=k[1],C=this.cleanStringForGlob(E.value);""!==C&&e.push("dir:"+v[S].value+" "+C.trim())}return{sizes:n.filter(this.onlyUnique).join(","),globs:e.filter(this.onlyUnique).join(",")}},e.onlyUnique=function(t,e,n){return n.indexOf(t)===e},e.cleanStringForGlob=function(t){return t.replace(/[*^//!\[?]/g,"")},t}(),A=function(){function t(t,e){void 0===e&&(e=wpstg),this.confirmAction=t,this.wpstgObject=e}var e=t.prototype;return e.show=function(t,e,n){var s=this;void 0===e&&(e={}),void 0===n&&(n=null),wpstgSwal.fire(t).then((function(t){t.value&&null!==s.error&&s.triggerConfirmAction(e,n)}))},e.triggerConfirmAction=function(t,e){var n=this;void 0===t&&(t={}),void 0===e&&(e=null),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams(Object.assign({action:this.confirmAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce},t)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(t){null!==e&&e(t)})).catch((function(t){console.log(n.wpstgObject.i18n.something_went_wrong,t)}))},t}(),q=function(){function t(t,e,n,s,r){void 0===e&&(e="#wpstg-workflow"),void 0===n&&(n="wpstg_clone_excludes_settings"),void 0===s&&(s="wpstg_modal_error"),void 0===r&&(r=wpstg),this.cloneID=t,this.workflow=d(e),this.wpstgObject=r,this.fetchExcludeSettingsAction=n,this.modalErrorAction=s,this.resetButtonClass="wpstg-confirm-reset-clone",this.resetModalContainerClass="wpstg-reset-confirmation",this.resetTabSelector=".wpstg-reset-exclude-tab",this.directoryNavigator=null,this.excludeFilters=null,this.tableSelector=null,this.isNetworkClone=!1}var e=t.prototype;return e.addEvents=function(){var t=this,e=d("."+this.resetModalContainerClass);null!==e?g(e,"click",this.resetTabSelector,(function(e){t.toggleContent(e)})):console.log("Exit")},e.init=function(){this.addEvents()},e.setNetworkClone=function(t){this.isNetworkClone=t},e.toggleContent=function(t){var e=d("."+this.resetModalContainerClass),n=t.getAttribute("data-id"),s=t.querySelector(".wpstg-tab-triangle"),r=t.getAttribute("data-collapsed","true"),o=d(n);"true"===r?(e.classList.contains("has-collapsible-open")?e.classList.add("has-collapsible-open-2"):e.classList.add("has-collapsible-open"),h(o),s.style.transform="rotate(90deg)",t.setAttribute("data-collapsed","false")):(e.classList.contains("has-collapsible-open-2")?e.classList.remove("has-collapsible-open-2"):e.classList.remove("has-collapsible-open"),w(o),s.style.removeProperty("transform"),t.setAttribute("data-collapsed","true"))},e.showModal=function(){var t=this.loadModal();return this.init(),this.fetchCloneExcludes(),t},e.loadModal=function(){return u.getSwalModal(!1,{confirmButton:this.resetButtonClass+" wpstg-confirm-reset-clone wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",container:this.resetModalContainerClass+" wpstg-swal2-container wpstg-swal2-loading"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"400px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.reset.confirm_button,showCancelButton:!0})},e.fetchCloneExcludes=function(){var t=this;this.error=null,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.fetchExcludeSettingsAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,job:"resetting"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(e){if(e.success){var n=d(".wpstg-reset-confirmation");n.classList.remove("wpstg-swal2-loading"),n.querySelector(".wpstg--swal2-popup").style.width="540px",n.querySelector(".wpstg--swal2-content").innerHTML=e.html,t.directoryNavigator=new B("#wpstg-directories-listing",wpstg,null),t.directoryNavigator.countSelectedFiles(),t.excludeFilters=new I,t.tableSelector=new M("#wpstg-reset-excluded-tables","."+t.resetModalContainerClass),t.tableSelector.setNetworkClone(t.isNetworkClone),t.tableSelector.countSelectedTables()}else{new A(t.modalErrorAction,t.wpstgObject).show(Object.assign({title:"Error",icon:"error",html:t.wpstgObject.i18n.something_went_wrong,width:"500px",confirmButtonText:"Ok",showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},e.swalOptions),{type:e.type})}})).catch((function(e){t.renderError({html:t.wpstgObject.i18n.something_went_wrong+" "+e})}))},e.getDirectoryNavigator=function(){return this.directoryNavigator},e.getExcludeFilters=function(){return this.excludeFilters},e.getTableSelector=function(){return this.tableSelector},e.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><span class="wpstg-loader"></span></div>'},t}(),D=function(){function t(t){void 0===t&&(t="#wpstg-clonepage-wrapper"),this.baseContainer=d(t),this.checkBoxSettingTogglerSelector=".wpstg-toggle-advance-settings-section",this.init()}var e=t.prototype;return e.addEvents=function(){var t=this;null!==this.baseContainer&&g(this.baseContainer,"change",this.checkBoxSettingTogglerSelector,(function(e){t.toggleSettings(e)}))},e.init=function(){this.addEvents()},e.toggleSettings=function(t){var e=d("#"+t.getAttribute("data-id"));t.checked?h(e):w(e)},t}(),R=function(){function t(){this.activeTabClass="wpstg--tab--active",this.mainMenu()}var e=t.prototype;return e.mainMenu=function(){var t=this;if(null!==d(".wpstg--tab--header")){var e=d("#wpstg-workflow");null!==e&&g(e,"click",".wpstg-navigate-button",(function(t){var e=t.getAttribute("data-target");""!==e&&"#wpstg--tab--backup"===e&&d('.wpstg--tab--header a[data-target="#wpstg--tab--backup"]').click()})),g(d(".wpstg--tab--header"),"click",".wpstg-button:not(.wpstg-navigation-menu-mobile .wpstg-button)",(function(e){var n=e,s=n.getAttribute("data-target");if(""!==s)if("#wpstg--tab--staging"!==s&&"#wpstg--tab--backup"!==s){u.resetErrors();var r=p(s),o=p(".wpstg--tab--header a[data-target]");p(".wpstg--tab--contents > .wpstg--tab--content").forEach((function(e){e.matches("."+t.activeTabClass+":not("+s+")")&&e.classList.remove(t.activeTabClass)})),o.forEach((function(e){e!==n&&e.classList.remove(t.activeTabClass)})),n.classList.add(t.activeTabClass),r.forEach((function(e){e.classList.add(t.activeTabClass)})),"#wpstg--tab--backup"===s&&window.dispatchEvent(new Event("backups-tab"))}else window.location.reload()})),g(d(".wpstg--tab--header"),"click",".wpstg-navigation-menu-mobile .wpstg-button",(function(e){var n=e,s=n.getAttribute("data-target-id");if(s){var r=d("#"+s);r?r.click():window.location.href=n.getAttribute("data-target-url");var o=document.getElementById("wpstg-navbar-menu");o&&o.classList.toggle("hidden"),p(".wpstg--tab--header a[data-target-id]").forEach((function(e){e!==n&&e.classList.remove(t.activeTabClass)})),n.classList.add(t.activeTabClass)}})),window.addEventListener("resize",(function(){t.adjustWrapperWidth()})),this.adjustWrapperWidth()}},e.adjustWrapperWidth=function(){var t=window.innerWidth,e=document.getElementById("wpstg-clonepage-wrapper");t>640?e.style.width="100%":t<=640&&t>=480?e.style.width=68+22*(t-480)/160+"%":t<480&&t>=320?e.style.width=47+18*(t-320)/160+"%":t<320&&(e.style.width=30+20*t/320+"%"),document.querySelector(".wpstg-navbar-toggler").style.padding=t<640?"15px":"12px 15px 12px 15px"},t}(),U=function(t){var e,n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,s){var o=e&&e.prototype instanceof m?e:m,i=Object.create(o.prototype),a=new P(s||[]);return r(i,"_invoke",{value:C(t,n,a)}),i}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p="suspendedStart",g="suspendedYield",h="executing",w="completed",f={};function m(){}function b(){}function v(){}var y={};l(y,i,(function(){return this}));var x=Object.getPrototypeOf,_=x&&x(x(O([])));_&&_!==n&&s.call(_,i)&&(y=_);var k=v.prototype=m.prototype=Object.create(y);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(r,o,i,a){var c=d(t[r],t,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,i,a)}),(function(t){n("throw",t,i,a)})):e.resolve(u).then((function(t){l.value=t,i(l)}),(function(t){return n("throw",t,i,a)}))}a(c.arg)}var o;r(this,"_invoke",{value:function(t,s){function r(){return new e((function(e,r){n(t,s,e,r)}))}return o=o?o.then(r,r):r()}})}function C(t,e,n){var s=p;return function(r,o){if(s===h)throw new Error("Generator is already running");if(s===w){if("throw"===r)throw o;return B()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var a=T(i,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===p)throw s=w,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=h;var c=d(t,e,n);if("normal"===c.type){if(s=n.done?w:g,c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=w,n.method="throw",n.arg=c.arg)}}}function T(t,n){var s=n.method,r=t.iterator[s];if(r===e)return n.delegate=null,"throw"===s&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),f;var o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,f;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function O(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(s.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:B}}function B(){return{value:e,done:!0}}return b.prototype=v,r(k,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:b,configurable:!0}),b.displayName=l(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,c,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},S(E.prototype),l(E.prototype,a,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,s,r,o){void 0===o&&(o=Promise);var i=new E(u(e,n,s,r),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},S(k),l(k,c,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var s in e)n.push(s);return n.reverse(),function t(){for(;n.length;){var s=n.pop();if(s in e)return t.value=s,t.done=!1,t}return t.done=!0,t}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(s,r){return a.type="throw",a.arg=t,n.next=s,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=s.call(i,"catchLoc"),l=s.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var s=n.completion;if("throw"===s.type){var r=s.arg;j(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,s){return this.delegate={iterator:O(t),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=e),f}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=U}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=U:Function("r","regeneratorRuntime = r")(U)}var F=new(function(){function t(){this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}var e=t.prototype;return e.setCallbackOnHide=function(t){this.callbackOnHide=t},e.shows=function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()},e.addUnloadEvent=function(){window.addEventListener("beforeunload",(function(t){t.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))},e.createIframeElement=function(){var t=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return t.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement},e.handleIframeLoad=function(){var t,e;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{t=(e=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(t){return void this.handleIframeLoadError()}e&&t?e.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=t+40+"px":this.handleIframeLoadError()},e.handleIframeLoadError=function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()},e.openModal=function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")},e.focusIframe=function(){this.iframeElement.focus()},e.setIframeLoadTimeout=function(){var t=this;setTimeout((function(){t.isIframeLoaded||(t.wrapElement.classList.add("fallback"),t.formElement.remove(),t.noFrameElement.focus())}),2e3)},e.focusFallbackElement=function(){this.noFrameElement.focus()},e.hide=function(){var t,e;window.removeEventListener("beforeunload",(function(t){t.returnValue=null})),t=this.wrap,void 0===(e=200)&&(e=300),t.style.opacity=1,t.style.transitionProperty="opacity",t.style.transitionDuration=e+"ms",setTimeout((function(){t.style.opacity=0,window.setTimeout((function(){t.style.display="none",t.style.removeProperty("opacity"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)}),0),this.callbackOnHide&&this.callbackOnHide()},t}()),N=function(){function e(t){void 0===t&&(t=wpstg),this.wpstgObject=t,this.count=0,this.status=!0,this.isAuthenticated=!0}var n=e.prototype;return n.start=function(){var t=this;this.status&&setTimeout((function(){t.checkUserAuthentication()}),1e3)},n.stop=function(){this.resetCount(),this.status=!1},n.resetCount=function(){this.count=0},n.checkUserAuthentication=function(){var e=s(t().mark((function e(){var n=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(t){if(!1===t.wpAuthCheck&&n.count++,n.isAuthenticated=t.wpAuthCheck,2===n.count)return n.stop(),void n.createAuthCheckElements(t.redirectUrl);n.start()})).catch((function(t){console.error("Error:",t)}));case 1:case"end":return t.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.createAuthCheckElements=function(t){var e=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var n=document.createElement("div");n.id="wpstg-auth-check-wrap",n.classList.add("hidden");var s=document.createElement("div");s.id="wpstg-auth-check-bg";var r=document.createElement("div");r.id="wpstg-auth-check";var o=document.createElement("div");o.id="wpstg-auth-check-form",o.classList.add("loading"),o.dataset.src=t+"?interim-login=1&wp_lang=en_US";var i=document.createElement("div");i.classList.add("wpstg-auth-fallback");var a=document.createElement("p");a.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var c=document.createElement("p");c.innerHTML='<a href="'+t+'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.';var l=document.createElement("button");l.type="button",l.classList.add("wpstg-auth-check-close","button-link"),l.innerHTML='<span class="screen-reader-text">Close dialog</span>',l.addEventListener("click",(function(){n.classList.add("hidden")})),r.append(l,o,i),i.append(a,c),n.append(s,r),document.body.appendChild(n),F.setCallbackOnHide((function(){e.checkUserAuthentication()})),F.shows()},e}(),W=new N;function H(t,e){return G.apply(this,arguments)}function G(){return(G=s(t().mark((function e(n,s){var o,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===s&&(s={}),o=r({},s,{action:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce}),t.prev=2,t.next=5,fetch(wpstg.ajaxUrl,{method:"POST",credentials:"same-origin",body:z(o),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 5:if((i=t.sent).ok){t.next=9;break}return console.warn(wpstg.i18n.something_went_wrong,i),t.abrupt("return",!1);case 9:return t.next=11,i.json();case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t0=t.catch(2),console.warn(wpstg.i18n.something_went_wrong,t.t0),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function z(t){var e=new URLSearchParams;return J(t,e),e}function J(t,e,n){for(var s in void 0===n&&(n=""),t)if(t.hasOwnProperty(s)){var r=n?n+"["+s+"]":s;"object"!=typeof t[s]||t[s]instanceof File?e.append(r,t[s]):J(t[s],e,r)}}var Y=function(){function e(t){void 0===t&&(t=wpstg),this.wpstgObject=t,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval="",this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl="",this.shouldSetupTimerInterval=!0}var n=e.prototype;return n.setSetupTimerInterval=function(t){this.shouldSetupTimerInterval=t},n.maybeSetupTimerInterval=function(){var t=this;this.shouldSetupTimerInterval&&(this.processInterval=setInterval((function(){(W.isAuthenticated||"wpstg_push_processing"===t.action)&&(t.processTime++,t.updateElapsedTime())}),1e3))},n.start=function(){(this.showCancelButton=!0,this.maybeSetupTimerInterval(),"wpstg_delete_clone"===this.action)&&(y(".wpstg--process-modal--logs-button"),this.showCancelButton=!1,u.getSwalContainer().querySelector(".wpstg--process-modal--percent").textContent=100);"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||(W.status=!0,W.start()),y(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),y(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")},n.stop=function(){this.processTime=0,this.modal=null,this.percentage="",this.resetCancelChecks(),clearInterval(this.processInterval),u.closeSwalModal(),S(),y("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader"),"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||W.stop()},n.resetCancelChecks=function(){var t=this;null!==document.getElementById("wpstg-new-clone")?(setTimeout((function(){t.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),j()):setTimeout((function(){t.resetCancelChecks()}),1e3)},n.cancelProcess=function(){confirm(this.wpstgObject.i18n.module_process_modal.cancel_process_confirm)&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(u.getSwalContainer().querySelector(".wpstg--process-modal--title").textContent=this.wpstgObject.i18n.module_process_modal.cancel_process_text,this.stop(),x("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())},n.setTitle=function(t){this.title=t.job,"database"===t.job||"jobCopyDatabaseTmp"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_database,this.disableCancelButton=!1):"SearchReplace"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_processing_data,this.disableCancelButton=!1):"PreserveDataSecondStep"===t.job||"PreserveDataFirstStep"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_preserve_data,this.disableCancelButton=!1):"directories"===t.job||"jobFileScanning"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_scanning_files,this.disableCancelButton=!1):"files"===t.job||"data"===t.job||"jobCopy"===t.job||"jobSearchReplace"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_files,this.disableCancelButton=!1):"Backup"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_backup_files_scanning,this.disableCancelButton=!1):"finish"===t.job||"finished"===t.status?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_process_finished,this.disableCancelButton=!1):"jobDatabaseRename"===t.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_renaming_database,this.disableCancelButton=!0):"jobData"===t.job&&(this.title=this.wpstgObject.i18n.module_process_modal.set_title_updating_database_data,this.disableCancelButton=!0)},n.setPercentage=function(t){null!==t.percentage&&(this.percentage=t.percentage)},n.initializeProcessModal=function(t){var e=this;void 0===t&&(t=null);var n=document.getElementById("wpstg--process-modal");if(n){null===t&&(t=this.showCancelButton);var s=n.innerHTML;n.remove(),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:u.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:s,cancelButtonText:this.wpstgObject.i18n.cancel,showCancelButton:t,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var t=u.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(){e.cancelProcess()}));var s=u.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0],r=s.cloneNode(!0);s.parentNode.replaceChild(r,s),r.addEventListener("click",(function(t){window.WPStaging.wpstgProcessLogs.toggleProcessLogs(t)}))}})},this.start()}},n.setProcessModal=function(){var t=u.getSwalContainer(),e=t.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.querySelector(".wpstg--process-modal--title"),s=t.querySelector(".wpstg--process-modal--percent");n.textContent=this.title,s.textContent=this.percentage,e.disabled=this.disableCancelButton},n.openProcessModal=function(t,e,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0),this.isProcessCancelled||WPStaging.isCancelled||(void 0!==t&&(this.action=t.action,this.cloneId=t.cloneID),this.showCancelButton=s,this.showLogs=n,this.modal?e.job?(this.setTitle(e),this.setPercentage(e),this.setProcessModal(),"finish"===e.job&&this.stop()):"finished"===e.status&&this.stop():(u.resetErrors(),this.initializeProcessModal()))},n.formatTimeDuration=function(){return new Date(1e3*this.processTime).toISOString().slice(11,19)+"s"},n.updateElapsedTime=function(){null!==this.processInterval&&(u.getSwalContainer().querySelector(".wpstg--process-modal--elapsed-time").textContent=this.formatTimeDuration())},n.getCancelCloneAction=function(){var t=this;if(""!==this.action){var e=[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(e){return e.name===t.action}));return null==e?void 0:e.cancel}},n.cancelCloneAction=function(){var e=s(t().mark((function e(){var n,s,r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.action){t.next=2;break}return t.abrupt("return");case 2:try{null!==WPStaging.onGoingRequest&&(WPStaging.onGoingRequest.abort(),WPStaging.onGoingRequest=null)}catch(t){console.error(this.wpstgObject.i18n.something_went_wrong,t),WPStaging.onGoingRequest=null}return t.prev=3,t.next=6,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:null!=(n=this.getCancelCloneAction())?n:"wpstg_cancel_clone",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((function(t){(t&&void 0!==t.delete&&"finished"===t.delete||!0===t)&&(r.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==t&&r.cancelCloneAction()})).catch((function(t){console.log(r.wpstgObject.i18n.something_went_wrong,t)}));case 6:if((s=t.sent).ok){t.next=11;break}return console.error(this.wpstgObject.i18n.something_went_wrong,s),this.stop(),t.abrupt("return");case 11:t.next=17;break;case 13:t.prev=13,t.t0=t.catch(3),console.error(this.wpstgObject.i18n.something_went_wrong,t.t0),this.stop();case 17:case"end":return t.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}(),n.initializeSuccessModal=function(){var e=s(t().mark((function e(n){var s,r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.setSuccessModalContent(n);case 2:this.successModal=t.sent,(s=document.getElementById("wpstg-workflow"))&&(s.innerHTML=""),u.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var t=u.getSwalContainer().querySelector(".wpstg--success-modal--logs-button"),e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",(function(t){window.WPStaging.wpstgProcessLogs.toggleProcessLogs(t)}))}}).then((function(t){t.value&&(u.closeSwalModal(),y(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),"wpstg_push_processing"===r.action&&(localStorage.setItem("wpstgPushProcessCompleted","true"),location.reload()),"wpstg_delete_clone"!==r.action&&WPStaging.loadOverview(),r.action="")})),this.showProcessLogs&&x(".wpstg--success-modal--logs-wrapper"),y(".wpstg-loader");case 8:case"end":return t.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setSuccessModalContent=function(){var e=s(t().mark((function e(n){var s,r,o,i,a,c,l,u,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=document.getElementById("wpstg--success-modal"),null!==n.title&&(s.innerHTML=s.innerHTML.replace("{title}",n.title)),this.showProcessLogs&&(s.innerHTML=s.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null===n.body||void 0===n.body){t.next=20;break}if(r=n.body,null===this.stagingSiteUrl){t.next=15;break}if(i=this.stagingSiteUrl,"wpstg_cloning"!==this.action||"undefined"==typeof wpstgPro||"function"!=typeof(null==(o=wpstgPro)?void 0:o.saveGeneratedLinkData)){t.next=14;break}return a=Date.now().toString(),c=this.cloneId,t.next=12,wpstgPro.saveGeneratedLinkData({cloneID:c,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:a});case 12:null!=(l=t.sent)&&l.success&&(i=this.stagingSiteUrl+"/wp-login.php?wpstg_login="+a);case 14:r+='<br><strong><a href="'+i+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>";case 15:"wpstg_push_processing"===this.action&&(r+='<a href="https://wp-staging.com/refresh-and-clear-cache/" target="_blank">How to delete the cache.</a>',(u=s.querySelector(".wpstg--success-modal--text"))&&u.classList.add("wpstg--red")),"wpstg_cloning"===this.action&&(d=s.querySelector(".wpstg-rate-us"))&&d.classList.add("show"),s.innerHTML=s.innerHTML.replace("{text}",r+"<br/><br/>"),t.next=21;break;case 20:s.innerHTML=s.innerHTML.replace("{text}","");case 21:return t.abrupt("return",s);case 22:case"end":return t.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.openSuccessModal=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=null),this.stagingSiteUrl=n,this.showProcessLogs=e,this.initializeSuccessModal(t)},n.logEventFailure=function(){var e=s(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=""),t.prev=1,t.next=4,H("wpstg_log_event_failure",{process:n});case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.error(wpstg.i18n.something_went_wrong,t.t0);case 9:case"end":return t.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),n.openErrorModal=function(){var e=s(t().mark((function e(n,s){var r,o,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===s&&(s=""),this.stop(),y(".wpstg-loader"),E("hidden"),this.showProcessLogs=!0,s||(s="Memory exhaust issue is detected during the process"),t.next=9,this.setSuccessModalContent({title:"Error",body:s});case 9:this.successModal=t.sent,(r=document.getElementById("wpstg-workflow"))&&(r.innerHTML=""),u.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width"}).fire({icon:"error",html:this.successModal.innerHTML,confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var t=u.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0],e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",(function(t){window.WPStaging.wpstgProcessLogs.toggleProcessLogs(t)}))}}).then((function(t){t.value&&(u.closeSwalModal(),y(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.loadOverview(),i.action="")})),x(".wpstg--success-modal--logs-wrapper"),(o=u.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0])&&(o.click(),document.querySelectorAll(".wpstg--logs--body").forEach((function(t){t.scrollTop=t.scrollHeight})));case 16:case"end":return t.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.logEventSuccess=function(){var e=s(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=""),t.next=3,H("wpstg_log_event_success",{process:n});case 3:case"end":return t.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e}();new(function(){function t(t){void 0===t&&(t=wpstg),this.wpstgObject=t,this.wpstgBackupNoticeCloseButton=null,this.wpstgBackupNoticeReminderButton=null,this.init()}var e=t.prototype;return e.init=function(){var t=this;document.addEventListener("DOMContentLoaded",(function(){t.wpstgBackupNoticeCloseButton=document.getElementById("wpstg-backup-plugin-notice-close"),t.wpstgBackupNoticeReminderButton=document.getElementById("wpstg-backup-plugin-notice-remind-me"),t.addEvent()}))},e.addEvent=function(){var t=this;null!==this.wpstgBackupNoticeCloseButton&&this.wpstgBackupNoticeCloseButton.addEventListener("click",(function(){t.closeBackupPluginNotice()})),null!==this.wpstgBackupNoticeReminderButton&&this.wpstgBackupNoticeReminderButton.addEventListener("click",(function(){t.closeBackupPluginNotice("wpstg_backup_plugin_notice_remind_me")}))},e.closeBackupPluginNotice=function(t){void 0===t&&(t="wpstg_backup_plugin_notice_close"),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:t,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(t.ok)return t.json()})).then((function(t){t.success&&(d(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){y(".wpstg-backup-plugin-notice-container")}),500))})).catch((function(t){d(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){y(".wpstg-backup-plugin-notice-container")}),500)}))},t}());var Q=function(){function t(t){void 0===t&&(t=wpstg),this.wpstgObject=t,this.wpstgPurgeBackupQueueButton=d("#wpstg-purge-backup-queue-btn"),this.init()}var e=t.prototype;return e.init=function(){var t=this;null!==this.wpstgPurgeBackupQueueButton&&this.wpstgPurgeBackupQueueButton.addEventListener("click",(function(){t.confirmAndProceedPurge()}))},e.confirmAndProceedPurge=function(){var t=this;u.getSwalModal(!0,{container:"wpstg-swal-push-container",confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_title,icon:"warning",html:"<p>"+this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_html.replace("%s","<code>"+this.wpstgObject.tblprefix+"wpstg_queue</code>")+"</p>",width:"550px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.system_info.confirm_button_text,showCancelButton:!0}).then((function(e){e.isConfirmed&&t.ajaxPurgeQueueTable()}))},e.ajaxPurgeQueueTable=function(){var t=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_purge_queue_table",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json();404===e.status&&k("error",t.wpstgObject.i18n.something_went_wrong+t.wpstgObject.i18n.ajax_status_code_404),500===e.status&&k("error",t.wpstgObject.i18n.something_went_wrong+t.wpstgObject.i18n.status_code_500)})).then((function(t){t.success&&!0===t.success&&k("success",t.message),t.success&&!1===t.success&&k("error",t.message)})).catch((function(e){k("error",t.wpstgObject.i18n.something_went_wrong+" "+e),console.warn(t.wpstgObject.i18n.something_went_wrong,e)}))},t}(),Z=function(){function t(){this.init()}var e=t.prototype;return e.init=function(){this.wpstdStagingTab=document.querySelector("#wpstg--tab--toggle--staging"),this.wpstdBackupTab=document.querySelector("#wpstg--tab--toggle--backup"),this.wpstdSidebarMenu=document.querySelector("#toplevel_page_wpstg_clone"),this.addEvents(),setTimeout((function(){E("hidden")}),5e3)},e.addEvents=function(){var t=this;null!==this.wpstdStagingTab&&this.wpstdStagingTab.addEventListener("click",(function(){T(),t.setPageUrl("wpstg_clone"),t.setSidebarMenu("wpstg_clone")})),null!==this.wpstdBackupTab&&this.wpstdBackupTab.addEventListener("click",(function(){T().then((function(){return E()})),t.setPageUrl("wpstg_backup"),t.setSidebarMenu("wpstg_backup")})),"wpstg-tools"===C()&&new Q,"wpstg-settings"===C()&&"temporary-login"===(new URLSearchParams(window.location.search).get("tab")||null)&&this.setSidebarMenu("wpstg-settings&tab=temporary-login")},e.setPageUrl=function(t){window.history.pushState(null,null,window.location.pathname+"?page="+t)},e.setSidebarMenu=function(t){var e=this.wpstdSidebarMenu.querySelector("ul").querySelectorAll("li");if(e.length>0)for(var n=0;n<e.length;n++)e[n].classList.remove("current"),null!==e[n].querySelector("a")&&e[n].querySelector("a").getAttribute("href")==="admin.php?page="+t&&e[n].classList.add("current")},t}(),K=function(){function e(e){var n=this;void 0===e&&(e=wpstg),this.wpstgObject=e,document.addEventListener("DOMContentLoaded",s(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.body=document.querySelector("body"),t.next=3,n.init();case 3:n.observeDOMChanges();case 4:case"end":return t.stop()}}),e)}))))}var n=e.prototype;return n.observeDOMChanges=function(){var t=this;this.observer=new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&e.addedNodes.length>0&&t.triggerRenderEvent()}))})),this.observerConfig={childList:!0,subtree:!0},this.observer.observe(document.documentElement,this.observerConfig)},n.triggerRenderEvent=function(){var t=this,e=this.body.classList.contains("wpstg-dark");document.querySelectorAll(".wpstg--dashicons").forEach((function(n){var s,r=(void 0===(s=n.src)&&(s=""),""===s?"":s.split("/").pop());""!==r&&!n.src.includes("dark/")&&e&&(n.src=t.wpstgObject.assetsUrl+"svg/dark/"+r),""!==r&&n.src.includes("dark/")&&!e&&(n.src=t.wpstgObject.assetsUrl+"svg/"+r)}))},n.setButtonAsActive=function(t){if("wpstg-welcome"!==C()){["dark","light","system"].forEach((function(t){document.querySelector(".wpstg-"+t+"-mode-container").classList.remove("active")})),document.querySelector(".wpstg-"+t+"-mode-container").classList.add("active");var e="dark"===t||"system"===t&&"dark"===this.defaultOsColorMode?"#E3DCFF":"#e9e9e9";document.querySelectorAll(".wpstg-color-mode-container > div").forEach((function(t){t.style.border="1px solid "+e}))}},n.updateFooterLogo=function(){var t=this.body.classList.contains("wpstg-dark")?"img/dark-logo.svg":"img/logo.svg",e=document.querySelector(".wpstg-footer-logo a");if(e){var n=e.querySelector("img");n&&(n.src=this.wpstgObject.assetsUrl+t)}this.triggerRenderEvent()},n.updateBodyClass=function(t){"dark"===t||"system"===t&&"dark"===this.defaultOsColorMode?this.body.classList.add("wpstg-dark"):this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()},n.setButtonsEventListeners=function(){var e=this;this.systemModeButton=document.querySelector("#wpstg-system-mode-button"),this.lightModeButton=document.querySelector("#wpstg-light-mode-button"),this.darkModeButton=document.querySelector("#wpstg-dark-mode-button"),null!==this.systemModeButton&&null!==this.lightModeButton&&null!==this.darkModeButton&&(this.systemModeButton.addEventListener("click",s(t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("system");case 2:e.setButtonAsActive("system");case 3:case"end":return t.stop()}}),n)})))),this.lightModeButton.addEventListener("click",s(t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("light");case 2:e.setButtonAsActive("light");case 3:case"end":return t.stop()}}),n)})))),this.darkModeButton.addEventListener("click",s(t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("dark");case 2:e.setButtonAsActive("dark");case 3:case"end":return t.stop()}}),n)})))))},n.init=function(){var e=s(t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.matchMedia("(prefers-color-scheme: dark)"),this.defaultOsColorMode=n.matches?"dark":"light",this.setButtonsEventListeners(),e.next=5,this.setDefaultOsColorMode();case 5:n.addEventListener("change",function(){var e=s(t().mark((function e(s){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.defaultOsColorMode=n.matches?"dark":"light",t.next=3,r.setDefaultOsColorMode();case 3:case"end":return t.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.setMode=function(){var e=s(t().mark((function e(n){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_dark_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,mode:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((s=t.sent).ok){t.next=7;break}return k("error",this.wpstgObject.i18n.something_went_wrong),t.abrupt("return");case 7:return t.next=9,s.json();case 9:if(!1!==(r=t.sent).success||!r.data){t.next=13;break}return k("error",r.data),t.abrupt("return");case 13:this.updateBodyClass(n),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,t.t0);case 19:case"end":return t.stop()}}),e,this,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),n.setDefaultOsColorMode=function(){var e=s(t().mark((function e(){var n,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_default_os_color_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,defaultOsColorMode:this.defaultOsColorMode}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((n=t.sent).ok){t.next=7;break}return k("error",this.wpstgObject.i18n.something_went_wrong),t.abrupt("return");case 7:return t.next=9,n.json();case 9:if((s=t.sent).data&&s.data.defaultColorMode&&this.setButtonAsActive(s.data.defaultColorMode),!s.success||"dark"!==s.data.defaultColorMode){t.next=15;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),t.abrupt("return");case 15:if(!s.success||"dark"!==this.defaultOsColorMode||"system"!==s.data.defaultColorMode){t.next=19;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),t.abrupt("return");case 19:s.success&&this.body.classList.contains("wpstg-dark")&&(this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,t.t0);case 25:case"end":return t.stop()}}),e,this,[[0,22]])})));return function(){return e.apply(this,arguments)}}(),e}();new K;var V=function(){function t(){this.messages={WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",INFO_SUB:"info_sub",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},this.stoppingTypes=[this.messages.ERROR,this.messages.CRITICAL]}var e=t.prototype;return e.resetLogs=function(){this.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},e.getLogs=function(){return this.messages.data},e.shouldStop=function(t){return this.stoppingTypes.includes(t.toLowerCase())},e.logMessages=function(t){var e=this,n=u.getSwalContainer(),s=function(t){var s,r;e.messages.data.all.find((function(e){return e.message===t.message}))||(t.type=null==t||null==(s=t.type)?void 0:s.toLowerCase(),e.messages.data.all.push(t),null==(r=e.messages.data[t.type])||r.push(t),null!==n&&e.renderLogs(t))};Array.isArray(t)?t.forEach((function(t){return t&&s(t)})):t&&s(t),document.querySelectorAll(".wpstg--logs--body").forEach((function(t){t.scrollTop=t.scrollHeight}))},e.renderLogs=function(t){var e,n=this;""===t&&(t=this.messages.data.all);var s=null==(e=u.getSwalContainer())?void 0:e.querySelector(".wpstg--logs--container");s&&(Array.isArray(t)?t.forEach((function(t){n.appendLogRow(s,t)})):this.appendLogRow(s,t))},e.appendLogRow=function(t,e){var n,s=t.querySelector(".wpstg--logs-table--body");if(s){var r=s.querySelector(".wpstg--logs-table--template-row");if(r){var o=r.cloneNode(!0);o.classList.remove("wpstg--logs-table--template-row");var i=null==e||null==(n=e.type)?void 0:n.toLowerCase(),a=t.querySelector(".wpstg--logs--selector").value;(a===i||"all"===a||a===this.messages.INFO&&i===this.messages.INFO_SUB)&&o.classList.remove("hidden"),o.classList.add("wpstg--logs--row-"+i);var c=s.querySelectorAll("tr"),l=c[c.length-1];i===this.messages.INFO_SUB&&l.classList.contains("wpstg--logs--row-info")&&l.classList.add("wpstg-no-border"),i===this.messages.INFO&&l.classList.contains("wpstg--logs--row-info_sub")&&l.classList.add("wpstg--logs--row-last");var u,d=o.querySelectorAll("td");if(i===this.messages.INFO_SUB){var p=document.createElement("div");return p.innerHTML=e.message,d[3].textContent=p.textContent||p.innerText,p.remove(),s.appendChild(o),void this.updateLogCounter(t,i)}4===d.length&&(d[0].classList.add("wpstg--logs--icon-"+i),d[1].textContent=0===(u=e.type).length?u:u.toLowerCase().split(" ").map((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})).join(" "),d[1].classList.add("wpstg--logs--log-"+i),d[2].textContent=e.date,d[3].innerHTML=e.message),s.appendChild(o),this.updateLogCounter(t,i)}}},e.updateLogCounter=function(t,e){var n=t.querySelector(".wpstg--logs--counter-"+e);if(n){var s=parseInt(n.textContent,10);n.textContent=isNaN(s)?1:s+1;var r=t.querySelector(".wpstg--logs--button-"+e);null==r||r.classList.remove("hidden")}},e.resetLogContainer=function(t){var e=t.querySelector(".wpstg--logs-table--body");e&&(e.querySelectorAll("tr").forEach((function(t){t.classList.contains("wpstg--logs-table--template-row")||t.remove()})),Object.values(this.messages).forEach((function(e){if("object"!=typeof e||null===e){var n=t.querySelector(".wpstg--logs--counter-"+e);n&&(n.textContent="0");var s=t.querySelector(".wpstg--logs--button-"+e);null==s||s.classList.add("hidden")}})))},e.toggleProcessLogs=function(t){var e=u.getSwalContainer(),n=e.querySelector(".wpstg--logs--container");if(n){this.resetLogContainer(n),this.renderLogs("");var s=e.querySelector(".wpstg--logs--container"),r=t.target;t.preventDefault();var o="block"===s.style.display;s.style.display=o?"none":"block",r.textContent=o?wpstg.i18n.show_logs:wpstg.i18n.hide_logs,e.childNodes[0].style.width=o?"600px":"97%",e.style.zIndex=9999,s.classList.contains("wpstg--process-modal--logs")&&this.adjustProcessLogsWindow(e),this.addEvents(e)}},e.addEvents=function(t){var e=this;t||(t=u.getSwalContainer()),t.querySelector(".wpstg--logs--selector").addEventListener("change",(function(n){e.filterLogs(t,n)})),t.querySelector(".wpstg--logs--button-info").addEventListener("click",(function(t){e.filterLogsByButton(t,"info")})),t.querySelector(".wpstg--logs--button-debug").addEventListener("click",(function(t){e.filterLogsByButton(t,"debug")})),t.querySelector(".wpstg--logs--button-warning").addEventListener("click",(function(t){e.filterLogsByButton(t,"warning")})),t.querySelector(".wpstg--logs--button-error").addEventListener("click",(function(t){e.filterLogsByButton(t,"error")})),t.querySelector(".wpstg--logs--button-critical").addEventListener("click",(function(t){e.filterLogsByButton(t,"critical")}))},e.filterLogsByButton=function(t,e){var n=t.target.closest(".wpstg--logs--header").querySelector(".wpstg--logs--selector");n.value=e;var s=new Event("change");n.dispatchEvent(s)},e.filterLogs=function(t,e){var n=this,s=e.target.value;t.querySelectorAll(".wpstg--logs-table--body tr").forEach((function(t){("all"===s||t.classList.contains("wpstg--logs--row-"+s)||s===n.messages.INFO&&t.classList.contains("wpstg--logs--row-"+n.messages.INFO_SUB))&&!t.classList.contains("wpstg--logs-table--template-row")?t.classList.remove("hidden"):t.classList.add("hidden")})),e.target.closest(".wpstg--logs--header").querySelectorAll("button").forEach((function(t){"all"==s||t.classList.contains("wpstg--logs--button-"+s)?t.style.setProperty("--wpstg-logs-button-before-display","inline-block"):t.style.setProperty("--wpstg-logs-button-before-display","none")}))},e.adjustProcessLogsWindow=function(t){var e=t.querySelector(".wpstg--swal2-html-container"),n=t.querySelector(".wpstg--logs--container"),s=t.querySelector(".wpstg--logs--body");if("block"===n.style.display)return e.style.setProperty("padding","0 2em","important"),n.style.setProperty("height","350px"),void s.style.setProperty("height","300px");e.style.setProperty("padding","4em 2em","important"),n.style.setProperty("height","300px"),s.style.setProperty("height","250px")},e.shouldWarn=function(){return this.messages.data.error.length>0||this.messages.data.critical.length>0},t}(),X=function(){function t(t){void 0===t&&(t=".wpstg--process-modal--elapsed-time"),this.totalSeconds=0,this.interval=null,this.outputTimeSelector=t}var e=t.prototype;return e.prettify=function(t){return new Date(1e3*t).toISOString().slice(11,19)+"s"},e.start=function(){var t=this;null===this.interval&&(this.interval=setInterval((function(){document.querySelectorAll(t.outputTimeSelector).forEach((function(e){e.innerText=t.prettify(t.totalSeconds)})),t.totalSeconds++}),1e3))},e.stop=function(){this.totalSeconds=0,this.interval&&(clearInterval(this.interval),this.interval=null)},e.getTimeElapsed=function(){return this.totalSeconds},t}(),tt={processModal:new Y,processModalLogs:new V,timer:new X,isCancelled:!1,isFinished:!1,performingCancelRequest:!1,processInfo:{title:null,interval:null,maxTotalRetries:0,maxSequentialRetries:0,totalTimeRetried:0,sequentialRetried:0},job:{action:null,name:null,type:null},status:{hasResponse:null,reTryAfter:5e3,STATUS_FAIL:"JOB_FAIL"},onSuccess:function(){},incrementRetry:function(){tt.processInfo.totalTimeRetried++,tt.processInfo.sequentialRetried++},resetJob:function(){tt.resetRetry(),tt.isCancelled=!1,tt.isFinished=!1,tt.performingCancelRequest=!1},resetRetry:function(){tt.processInfo.totalTimeRetried=0,tt.processInfo.sequentialRetried=0},canRetry:function(){return!(tt.processInfo.totalTimeRetried>=tt.processInfo.maxTotalRetries)&&!(tt.processInfo.sequentialRetried>=tt.processInfo.maxSequentialRetries)},setJob:function(t){tt.job.action=t.action||null,tt.job.name=t.name||null,tt.job.type=t.type||null},statusStop:function(){var t;clearInterval(tt.processInfo.interval),tt.processInfo.interval=null,window.removeEventListener("beforeunload",null==(t=WPStaging)?void 0:t.warnIfClosingDuringProcess)},statusStart:function(){var n;null===tt.processInfo.interval&&(tt.processInfo.interval=setInterval(s(t().mark((function n(){var s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==tt.isCancelled){t.next=3;break}return tt.statusStop(),t.abrupt("return");case 3:if(!1!==tt.status.hasResponse){t.next=5;break}return t.abrupt("return");case 5:return tt.status.hasResponse=!1,t.prev=6,t.next=9,H("wpstg--job--status",{type:tt.job.type,name:tt.job.name});case 9:if(s=t.sent,tt.status.hasResponse=!0,void 0===s&&tt.statusStop(),tt.processInfo.title!==s.currentStatusTitle){t.next=14;break}return t.abrupt("return");case 14:tt.processInfo.title=res.currentStatusTitle,(r=u.getSwalContainer()).querySelector(".wpstg--process-modal--title").innerText=res.currentStatusTitle,r.querySelector(".wpstg--process-modal--process-percent").innerText="0",t.next=24;break;case 20:t.prev=20,t.t0=t.catch(6),tt.status.hasResponse=!0,WPStagingCommom.showAjaxFatalError(e,"","Submit an error report.");case 24:case"end":return t.stop()}}),n,null,[[6,20]])}))),null!=(n=wpstg.jobStatusInterval)?n:5e3))},prepareJob:function(e,n,r){var o=this;return s(t().mark((function s(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n={}),void 0===r&&(r=null),tt.resetJob(),t.prev=3,t.next=6,H(e,n);case 6:if((i=t.sent)&&i.success){t.next=9;break}return t.abrupt("return",!1);case 9:return r&&window.dispatchEvent(new Event(r)),o.processModal.setSetupTimerInterval(!1),tt.timer.start(),t.abrupt("return",!0);case 15:return t.prev=15,t.t0=t.catch(3),console.warn(wpstgi18n.something_went_wrong,t.t0),k("warning",wpstgi18n.something_went_wrong),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),s,null,[[3,15]])})))()},runJob:function(){return s(t().mark((function e(){var n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u.resetErrors(),!tt.isCancelled){t.next=4;break}return tt.statusStop(),t.abrupt("return");case 4:return t.next=6,H(tt.job.action);case 6:if(n=t.sent){t.next=11;break}return t.next=10,tt.onJobFail();case 10:return t.abrupt("return");case 11:if(!tt.isCancelled){t.next=13;break}return t.abrupt("return");case 13:if(void 0!==n){t.next=17;break}return t.next=16,tt.onJobFail();case 16:return t.abrupt("return");case 17:if(tt.processResponse(n),tt.processInfo.interval||tt.statusStart(),!0!==n.isRunning){t.next=23;break}return tt.processInfo.sequentialRetried=0,tt.runJob(),t.abrupt("return");case 23:if(tt.processModal.stop(),tt.statusStop(),n.jobStatus!==tt.status.STATUS_FAIL){t.next=29;break}return t.next=28,tt.onJobFail(n);case 28:return t.abrupt("return");case 29:u.closeSwalModal(),"function"==typeof tt.onSuccess&&tt.onSuccess(n);case 31:case"end":return t.stop()}}),e)})))()},onJobFail:function(e){return s(t().mark((function n(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=null),t.next=3,tt.checkMemoryExhaustion(e,tt.job.name);case 3:if(!t.sent){t.next=6;break}return t.abrupt("return");case 6:if(tt.processInfo.canRetry()){t.next=14;break}return t.next=9,tt.processModal.logEventFailure(tt.job.name);case 9:return s={messages:[{type:"critical",message:"There was a PHP fatal error while processing this job. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}]},tt.processResponse(s),tt.cancel(),setTimeout(tt.logsModal,500),t.abrupt("return");case 14:return t.next=16,u.delay(wpstg.delayReq);case 16:return tt.processInfo.incrementRetry(),t.next=19,tt.runJob();case 19:case"end":return t.stop()}}),n)})))()},cancel:function(t,e){var n;void 0===t&&(t={}),void 0===e&&(e=null),tt.timer.stop(),clearInterval(tt.processInfo.interval),tt.isCancelled=!0,tt.processInfo.interval=null,window.removeEventListener("beforeunload",null==(n=WPStaging)?void 0:n.warnIfClosingDuringProcess),u.closeSwalModal(),u.getSwalModal(!0).fire({title:wpstg.i18n.cancel_modal_title,text:wpstg.i18n.cancel_modal_text,icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){tt.sendCancelRequest(Object.assign({isInit:"yes"},t),e)}})},sendCancelRequest:function(e,n){return s(t().mark((function s(){var o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!tt.performingCancelRequest){t.next=2;break}return t.abrupt("return");case 2:return tt.performingCancelRequest=!0,t.prev=3,t.next=6,H("wpstg--job--cancel",r({job:tt.job.name,jobIdBeingCancelled:u.getJobId()},e));case 6:if(o=t.sent,tt.performingCancelRequest=!1,tt.isCancelled=!1,u.showAjaxFatalError(o,"",wpstg.i18n.submit_error_report),o.hasOwnProperty("isRunning")||u.showErrorModal(wpstg.i18n.cancel_modal_error),!0!==(null==o?void 0:o.isRunning)){t.next=15;break}return e.isInit="no",tt.sendCancelRequest(e,n),t.abrupt("return");case 15:tt.performingCancelRequest=!1,u.continueErrorHandle=!1,W.stop(),u.closeSwalModal(),null!=n&&n(),t.next=30;break;case 22:t.prev=22,t.t0=t.catch(3),tt.performingCancelRequest=!1,u.continueErrorHandle=!1,W.stop(),u.closeSwalModal(),u.showErrorModal(wpstg.i18n.cancel_modal_error),null!=n&&n();case 30:case"end":return t.stop()}}),s,null,[[3,22]])})))()},checkMemoryExhaustion:function(e,n){return s(t().mark((function s(){var r,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.checkMemoryExhaustion(n);case 2:if(!1!==(r=t.sent)){t.next=5;break}return t.abrupt("return");case 5:o=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">CONTACT US</button> for help in solving this issue.',wpstg.isPro&&(o=' Read <a target="_blank" href="'+u.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),e.messages=[{type:"critical",date:r.data.time,message:r.message+"."+o}],tt.processResponse(e);case 9:case"end":return t.stop()}}),s)})))()},processResponse:function(t){if(null===t)throw u.closeSwalModal(),u.showError("Invalid Response; null"),new Error("Invalid Response; "+t);var e=u.getSwalContainer();(t.title||t.statusTitle)&&(e.querySelector(".wpstg--process-modal--title").innerText=t.title||t.statusTitle),t.percentage&&(e.querySelector(".wpstg--process-modal--percent").innerText=t.percentage),tt.addResponseMessagesToLog(t),t.jobId&&u.setJobId(t.jobId),!1===t.isRunning&&!0===t.job_done&&(tt.timer.stop(),tt.isCancelled=!0,t.status=!t.isRunning,window.dispatchEvent(new CustomEvent("wpstgJobDone",{response:t,job:tt.job})))},addResponseMessagesToLog:function(t){if(t.messages)for(var e,n=function t(e){if(Array.isArray(e))for(var n,s=i(e);!(n=s()).done;){t(n.value)}else e.type&&(tt.processModalLogs.logMessages(e),tt.processModalLogs.shouldStop(e.type)&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:e.message}})),tt.cancel({},(function(){setTimeout(tt.logsModal,500)}))))},s=i(t.messages);!(e=s()).done;){var r=e.value;r&&n(r)}},logsModal:function(){return s(t().mark((function e(){var n,s,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),s=n?n.innerHTML:null,t.next=4,u.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'+s+"</div>",width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){u.getSwalContainer()[0].style["z-index"]=9999;var t=tt.processModalLogs.getLogs();t.all&&(tt.processModalLogs.renderLogs(t.all),tt.processModalLogs.addEvents())},onOpen:function(t){var e=$(t).find(".wpstg--process-modal--logs");e.scrollTop(e.scrollHeight)}});case 4:return(r=t.sent).value&&u.closeSwalModal(),t.abrupt("return",r);case 7:case"end":return t.stop()}}),e)})))()},shouldWarn:function(){return tt.processModalLogs.shouldWarn()},successModal:function(e){return s(t().mark((function n(){var s,r,o,i,a,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.title,r=void 0===s?null:s,o=e.bodyText,i=void 0===o?null:o,a=e.onSuccessModalRender,c=void 0===a?function(){}:a,l=document.querySelector("#wpstg--success-modal").innerHTML,t.next=4,u.getSwalModal(!0).fire({icon:"success",html:l.replace("{title}",r).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==i?i:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){var t=u.getSwalContainer();tt.registerLogsToggle(t),x(".wpstg--success-modal--logs-wrapper"),c()},allowEscapeKey:!1,allowOutsideClick:!1});case 4:return(d=t.sent).value&&u.closeSwalModal(),t.abrupt("return",d);case 7:case"end":return t.stop()}}),n)})))()},registerLogsToggle:function(t){g(t,"click",".wpstg--success-modal--logs-button",(function(t,e){tt.showLogsInModal(e)}))},showLogsInModal:function(t){tt.processModalLogs.toggleProcessLogs(t)}},et=function(){function e(){this.allTablesChecked=!0,this.isDeletingTables=!1,this.isDeletingFiles=!1,this.excludedTables=[],this.cloneId=null,this.isDeleteConfirmEventListened=!1}var n=e.prototype;return n.listen=function(){var e=this;this.isDeleteConfirmEventListened||(this.isDeleteConfirmEventListened=!0,g(d("body"),"click",".wpstg--delete--staging-site",function(){var n=s(t().mark((function n(s){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.openStagingSiteDeleteConfirmationModal(s);case 2:case"end":return t.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()))},n.openStagingSiteDeleteConfirmationModal=function(){var e=s(t().mark((function e(n){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u.resetErrors(),this.cloneId=n.getAttribute("data-cloneId"),t.next=4,H("wpstg--staging-site--delete-confirmation",{cloneId:this.cloneId});case 4:if((s=t.sent)&&s.success){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this.showDeleteConfirmationModal(s.data);case 9:case"end":return t.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.showDeleteConfirmationModal=function(){var e=s(t().mark((function e(n){var r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal wpstg-delete-staging-site-modal",content:"wpstg--process--content"}).fire({html:"<div id='wpstg--modal--confirm-delete--staging-site--content'></div>",title:wpstg.i18n.staging_site.delete.confirmation.replace("%s",n.stagingSiteName),icon:"error",width:"100%",focusConfirm:!1,confirmButtonText:wpstg.i18n.delete,confirmButtonColor:"#e01e5a",showCancelButton:!0,cancelButtonText:wpstg.i18n.cancel,onRender:function(){d(".wpstg--swal2-container #wpstg--modal--confirm-delete--staging-site--content").innerHTML=n.html,r.updateDeleteConfirmationModalUI()},preConfirm:function(){return r.validateIfAnythingToDelete()}});case 2:if(e.sent.isConfirmed){e.next=5;break}return e.abrupt("return");case 5:return tt.processModal.initializeProcessModal(!1),tt.setJob({name:"staging_site_delete",action:"wpstg--staging-site--delete",type:"staging"}),e.next=9,tt.prepareJob("wpstg--staging-site--prepare-delete",{wpstgDeleteData:{cloneId:this.cloneId,excludedTables:this.excludedTables,isDeletingTables:this.isDeletingTables,isDeletingFiles:this.isDeletingFiles}},"startedDeletingStagingSite");case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:return tt.onSuccess=function(){var e=s(t().mark((function e(n){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(T().then((function(){return E()})),!tt.shouldWarn()){t.next=9;break}return t.next=4,tt.logsModal();case 4:if(t.sent.value){t.next=7;break}return t.abrupt("return");case 7:return WPStaging.loadOverview(),t.abrupt("return");case 9:return t.next=11,tt.successModal({title:wpstg.i18n.staging_site.delete.title,bodyText:""});case 11:if(t.sent.value){t.next=14;break}return t.abrupt("return");case 14:WPStaging.loadOverview();case 15:case"end":return t.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=13,e.next=16,tt.runJob();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),console.error(e.t0);case 21:case"end":return e.stop()}}),e,this,[[13,18]])})));return function(t){return e.apply(this,arguments)}}(),n.updateDeleteConfirmationModalUI=function(){var t=this;g(d("body"),"click","#wpstg-unselect-all-tables",(function(){t.toggleSelectAllTables()})),d(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container"),document.querySelector(".wpstg--swal2-confirm").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-left").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-right").style.background="#e01e5a",document.querySelector(".wpstg--swal2-icon.wpstg--swal2-error").style.borderColor="#e01e5a";var e=u.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(t){u.closeSwalModal(),d(".wpstg-loader").removeClass("wpstg-finished"),hideWpstgLoader(),E("hidden")}))},n.toggleSelectAllTables=function(t){var e=d("#wpstg-unselect-all-tables-id");!1===this.allTablesChecked?(e.textContent="Unselect All",p(".wpstg-db-table-checkboxes").forEach((function(t){t.checked=!0})),this.allTablesChecked=!0):(e.textContent="Select All",p(".wpstg-db-table-checkboxes").forEach((function(t){t.checked=!1})),this.allTablesChecked=!1)},n.validateIfAnythingToDelete=function(){var t=this;return this.isDeletingTables=!1,p(".wpstg-db-table-checkboxes").forEach((function(e){e.checked?t.isDeletingTables=!0:t.excludedTables.push(e.value)})),this.isDeletingFiles=d("#deleteDirectory").checked,!(!this.isDeletingTables&&!this.isDeletingFiles)||(k("warning","Please select at least one item to delete."),!1)},e}(),nt=function(){function e(){this.deleteModule=new et}var n=e.prototype;return n.load=function(){var e=s(t().mark((function e(){var n,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=d("#wpstg-workflow")){t.next=3;break}return t.abrupt("return");case 3:return"wpstg_clone"===C()&&S(),t.prev=4,t.next=7,H("wpstg--staging-site--listing");case 7:s=t.sent,n.innerHTML=s,this.listen(),"wpstg_backup"!==C()&&E("hidden"),t.next=18;break;case 13:t.prev=13,t.t0=t.catch(4),console.warn(t.t0),WPStagingCommon.showError(wpstg.i18n.admin_load_overview.error_no_response),"wpstg_backup"!==C()&&E("hidden");case 18:return t.prev=18,x(".wpstg-step3-cloning"),y(".wpstg-step3-pushing"),t.finish(18);case 22:case"end":return t.stop()}}),e,this,[[4,13,18,22]])})));return function(){return e.apply(this,arguments)}}(),n.listen=function(){this.deleteModule.listen()},e}(),st=function(e){var n={isCancelled:!1,isFinished:!1,getLogs:!1,onGoingRequest:null,time:1,executionTime:!1,progressBar:0,cloneExcludeFilters:null,directoryNavigator:null,tableSelector:null,notyf:null,areAllTablesChecked:!0,handleDisplayDependencies:m,handleToggleElement:b,handleCopyPaste:v,copyTextToClipboard:_,messages:[],requestType:"",modal:{instance:"",processTime:0,processInterval:"",currentJob:""},processModalType:null};n.staging=new nt,n.wpstgProcessModal=new Y,n.wpstgProcessLogs=new V;var o,i={elements:[]};i.get=function(t){return-1!==e.inArray(t,i.elements)||(i.elements[t]=jQuery(t)),i.elements[t]},i.refresh=function(t){t.elements[t]=jQuery(t)};var a=function(){i.get(".wpstg-loader").is(":visible")?i.get(".wpstg-loader").css("visibility","hidden"):i.get(".wpstg-loader").hide()},c=function(t){window.scrollTo(0,0),i.get("#wpstg-try-again").css("display","inline-block"),i.get("#wpstg-cancel-cloning").text("Reset"),i.get("#wpstg-resume-cloning").show(),i.get("#wpstg-error-wrapper").show(),i.get("#wpstg-error-details").show().html(t),i.get(".wpstg-loading-bar-container").css("visibility","hidden"),a(),e(".wpstg--modal--process--generic-problem").show().html(t),document.querySelectorAll(".wpstg-report-issue-button").forEach((function(t){t.addEventListener("click",(function(){setTimeout((function(){document.querySelectorAll(".wpstg-report-show").forEach((function(t){t.style.zIndex="9999999999"}))}),10)}))})),e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_staging_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:t}})};n.warnIfClosingDuringProcess=function(t){return t.returnValue=wpstg.i18n.admin_warn_if_closing_during_process,null};var l=function(){i.get("#wpstg-error-details").hide().html("")},p=function(){var t=e("#wpstg_clone_hostname").val();if(""===t)return!0;return!1!==/^http(s)?:\/\/.*$/.test(t)},g=function(){var t=i.get("#wpstg-workflow");t.on("click","#wpstg-cancel-cloning",(function(){if(!confirm(wpstg.i18n.admin_clone_actions.cancel_cloning_confirm))return!1;var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),n.isCancelled=!0,n.progressBar=0,e("#wpstg-processing-status").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(o),P()})).on("click","#wpstg-resume-cloning",(function(){l();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),n.isCancelled=!1,e("#wpstg-processing-status").text(wpstg.i18n.admin_clone_actions.resume_cloning_status),e("#wpstg-error-details").hide(),e(".wpstg-loader").show(),t.parent().append(o),n.startCloning()})).on("click","#wpstg-cancel-cloning-update",(function(){l();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),n.isCancelled=!0,e("#wpstg-cloning-result").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(o),U()})).on("click","#wpstg-restart-cloning",(function(){l();var t=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.prop("disabled",!0),n.isCancelled=!0,e("#wpstg-cloning-result").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),t.parent().append(o),F()})).on("click",".wpstg-execute-clone",(function(s){s.preventDefault();var r=e(this).data("clone"),o=e(this).data("url");u.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_clone_actions_update_modal.title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height wpstg-mt-10px">'+wpstg.i18n.admin_clone_actions_update_modal.body.replace("{URL}",o)+"<br><br>"+wpstg.i18n.admin_clone_actions_update_modal.suggestion+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_clone_actions_update_modal.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var t=u.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",(function(t){u.closeSwalModal()}))}}).then((function(e){e.value&&(n.cloneExcludeFilters=null,h({action:"wpstg_scanning",clone:r,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e.length<1&&c(wpstg.i18n.admin_clone_actions.wpstg_scanning_show_error);var s=C(e);!1===s||!1!==s.success?(t.html(e),W(),n.directoryNavigator=new B("#wpstg-directories-listing",wpstg,n.notyf),n.directoryNavigator.countSelectedFiles(),n.tableSelector=new M("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg,n.notyf),n.tableSelector.countSelectedTables(),n.cloneExcludeFilters=new I,n.switchStep(2)):E(s)}),"HTML"),u.closeSwalModal())}))})).on("click","#wpstg-update-cloning-site-button",(function(t){window.open(n.data.cloneHostname,"_blank")})).on("click",".wpstg-reset-clone",(function(t){t.preventDefault();var s=e(this).data("clone"),r=new q(s);r.setNetworkClone("yes"===e(this).data("network"));var o=r.showModal();n.areAllTablesChecked=!0,o.then((function(t){if(t.value){var e=r.getDirectoryNavigator(),n=r.getTableSelector(),o=r.getExcludeFilters().getExcludeFilters(),i="",a="",c="",l=!1;null!==n&&(i=n.getIncludedTables(),a=n.getExcludedTables(),c=n.getSelectedTablesWithoutPrefix()),i.length>a.length?i="":a.length>i.length&&(a="",l=""===i),T(s,{includedTables:i,excludedTables:a,allTablesExcluded:l,selectedTablesWithoutPrefix:c,excludeSizeRules:encodeURIComponent(o.sizes),excludeGlobRules:encodeURIComponent(o.globs),excludedDirectories:e.getExcludedDirectories(),extraDirectories:e.getExtraDirectoriesRootOnly()})}}))}))},h=function r(o,i,l,d,p,g){void 0===g&&(g=null),void 0===l&&(l="json"),!1!==d&&(d=!0);var h=1e4*(p=void 0===p?0:p);g=parseInt(g),isNaN(g)||(h*=g);var w,f="<br/>"+wpstg.i18n.admin_ajax.error_msg_footer,m="<br/><br/>"+wpstg.i18n.admin_ajax.pushing_error_msg,b='<br/><br/><button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">CONTACT US</button> '+wpstg.i18n.admin_ajax.contact_us_text;n.onGoingRequest=e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:l,cache:!1,data:o,error:(w=s(t().mark((function e(s,w,v){var y,x,_,k,S;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(403!==(y=void 0===s.status?"Unknown":s.status)&&405!==y&&406!==y){t.next=4;break}return u.handleFetchErrors(s),t.abrupt("return");case 4:if(console.log(s),"wpstg_cloning"!==st.requestType){t.next=22;break}return t.next=8,u.checkMemoryExhaustion(st.requestType);case 8:if(x=t.sent,_=b,wpstg.isPro&&(_='<br/><br/>Read <a target="_blank" href="'+u.memoryExhaustArticleLink+'">this article</a> for solving this issue.<br/><br/>'+wpstg.i18n.help_content_pro),!1===x){t.next=22;break}return window.removeEventListener("beforeunload",st.warnIfClosingDuringProcess),st.requestType="",a(),k=x.message+"."+_,n.wpstgProcessLogs.logMessages({message:k,type:"critical",date:(e=void 0,e=new Date,e.getFullYear()+"/"+(e.getMonth()+1).toString().padStart(2,"0")+"/"+e.getDate().toString().padStart(2,"0")+" "+e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")+":"+e.getSeconds().toString().padStart(2,"0"))}),t.next=19,n.wpstgProcessModal.openErrorModal("clone");case 19:return t.next=21,n.wpstgProcessModal.logEventFailure("clone");case 21:return t.abrupt("return");case 22:if("wpstg_cloning"===st.requestType?f+=b:"wpstg_push_processing"===o.action?f+=m+b:f=b,"wpstg_cloning"!==st.requestType||0!==p){t.next=26;break}return t.next=26,n.wpstgProcessModal.logEventFailure("clone");case 26:if("wpstg_push_processing"!==o.action||0!==p){t.next=29;break}return t.next=29,n.wpstgProcessModal.logEventFailure("push");case 29:++p<=5?(console.log("RETRYING "+p+"/5"),setTimeout((function(){r(o,i,l,d,p,g)}),h)):(st.requestType="",console.log("RETRYING LIMIT"),S=void 0===s.status?"Unknown":s.status,c("Fatal Error:  "+S+" "+f));case 31:case"end":return t.stop()}var e}),e)}))),function(t,e,n){return w.apply(this,arguments)}),success:function(t){"function"==typeof i&&i(t)},statusCode:{0:function(){p>=5&&c("Error 0 - Connection error. Please check you network connection.")},404:function(){p>=5&&c("Error 404 - Can't find ajax request URL."+b)},500:function(){p>=5&&c("Fatal Error 500 - Internal server error while processing the request! "+f)},504:function(){p>5&&c("Error 504 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+b)},502:function(){p>=5&&c("Error 502 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+b)},503:function(){p>=5&&c("Error 503 - It seem your server is rate limiting ajax requests. Please try to resume after a minute. "+b)},429:function(){p>=5&&c("Error 429 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+b)},403:function(){c("Error 403 - "+u.showFirewallError())},405:function(){c("Error 405 - "+u.showFirewallError())},406:function(){c("Error 406 - "+u.showFirewallError())},400:function(){p>=5&&c("Error 400 - <strong>It looks like you have been logged out.</strong><br/><br/> <a href='/wp-login.php' target='_blank' id=\"wpstg-login-link\">Log in again and try again!</a>")}}})},w=function(t,e){i.get(".wpstg-loader").show(),h({action:"wpstg_database_verification",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:i.get("#wpstg-db-user").val(),databasePassword:i.get("#wpstg-db-pass").val(),databaseServer:i.get("#wpstg-db-server").val(),databaseDatabase:i.get("#wpstg-db-database").val(),databaseSsl:i.get("#wpstg-db-ssl").is(":checked")},(function(n){if(!1===n)return c(wpstg.i18n.admin_verify_external_database.error_no_response+" <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void a();if(void 0===n.success)return c(wpstg.i18n.admin_verify_external_database.error_invalid_response+"<a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void a();if(n.success)return a(),void f(t,e);if("comparison"===n.error_type){a();var s='<table class="wpstg-db-comparison-table"><thead><tr><th>Property</th><th>Production DB</th><th>Staging DB</th><th>Status</th></tr></thead><tbody>';return n.checks.forEach((function(t){var e='<span class="wpstg-css-tick"></span>';t.production!==t.staging&&(e='<span class="wpstg-css-cross"></span>'),s+="<tr><td>"+t.name+"</td><td>"+t.production+"</td><td>"+t.staging+"</td><td>"+e+"</td></tr>"})),s+="</tbody></table><p>"+wpstg.i18n.admin_verify_external_database.comparison_modal_html_note+"</p>",void u.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-db-comparison-modal wpstg-centered-modal"}).fire({title:wpstg.i18n.admin_verify_external_database.comparison_modal_title,icon:"warning",html:s,width:"650px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_verify_external_database.comparison_modal_confirm_button_text,showCancelButton:!0}).then((function(n){n.value&&f(t,e)}))}u.getSwalModal(!0).fire({title:wpstg.i18n.admin_verify_external_database.error_modal_title,icon:"error",html:n.message,focusConfirm:!0,confirmButtonText:wpstg.i18n.admin_verify_external_database.error_modal_confirm_button_text,showCancelButton:!1}),a()}),"json",!1)},f=function(t,n){if("wpstg_cloning"===t.data("action")){if(wpstg.isPro&&((s=d("#wpstg-new-admin-user"))&&s.checked)&&!1===function(t){var e,n=(null==(e=d(t))?void 0:e.value)||"";return/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9]+(?:-[a-zA-Z0-9]+)*\.[a-zA-Z]{2,24}$/.test(n)?(d(t).style.borderColor="unset",!0):(k("error","Invalid email address"),d(t).style.borderColor="red",!1)}("#wpstg-new-admin-email"))return;H().then((function(t){if(!t||!wpstg.isPro)return new Promise((function(t){h({action:"wpstg_is_writable_clone_destination_dir",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneDir:e("#wpstg_clone_dir").val()},(function(e){var n;e.success?(a(),t(!0)):(c("Something went wrong! Error: "+(null==(n=e.data)?void 0:n.message)),a(),document.getElementById("wpstg-error-wrapper").scrollIntoView(),t(!1))}),"json",!1)}))})).then((function(e){e&&y(t,n)})).catch((function(t){k("error",t)}))}else y(t,n);var s},y=function(t,s){i.get(".wpstg-loading-bar-container").css("visibility","visible"),n.data={action:t.data("action"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){if("wpstg_cloning"===n.data.action||"wpstg_update"===n.data.action||"wpstg_reset"===n.data.action){if(n.data.cloneID=(new Date).getTime().toString(),"wpstg_update"===n.data.action&&(n.data.cloneID=e("#wpstg-new-clone-id").data("clone")),n.data.cloneName=u.sanitizeEventAttribute(e("#wpstg-new-clone-id").val())||n.data.cloneID,null!==n.directoryNavigator&&(n.data.excludedDirectories=encodeURIComponent(n.directoryNavigator.getExcludedDirectories()),n.data.extraDirectories=encodeURIComponent(n.directoryNavigator.getExtraDirectoriesRootOnly())),n.data.excludeGlobRules="",n.data.excludeSizeRules="",n.cloneExcludeFilters instanceof I){var t=n.cloneExcludeFilters.getExcludeFilters();n.data.excludeGlobRules=encodeURIComponent(t.globs),n.data.excludeSizeRules=encodeURIComponent(t.sizes)}n.data.includedTables="",n.data.excludedTables="",n.data.allTablesExcluded=!1,null!==n.tableSelector&&(n.data.includedTables=n.tableSelector.getIncludedTables(),n.data.excludedTables=n.tableSelector.getExcludedTables(),n.data.selectedTablesWithoutPrefix=n.tableSelector.getSelectedTablesWithoutPrefix()),n.data.includedTables.length>n.data.excludedTables.length?n.data.includedTables="":n.data.excludedTables.length>n.data.includedTables.length&&(n.data.excludedTables="",n.data.allTablesExcluded=""===n.data.includedTables),"undefined"!=typeof wpstgPro&&"function"==typeof wpstgPro.getAdvancedCloningOptions&&(n.data=wpstgPro.getAdvancedCloningOptions(n.data))}}(),x(s)},x=function(t){var e=i.get(".wpstg-loading-bar-container");h(n.data,(function(s){!1===s&&c(wpstg.i18n.admin_send_cloning_ajax.error_general),s.length<1&&(e.css("visibility","hidden"),c(wpstg.i18n.admin_send_cloning_ajax.error_no_response));var r=C(s);if(!1!==r&&!1===r.success)return e.css("visibility","hidden"),void E(r);e.css("visibility","hidden"),t.html(s),n.cloneExcludeFilters=null,"wpstg_scanning"===n.data.action?(n.areAllTablesChecked=!0,n.directoryNavigator=new B("#wpstg-directories-listing",wpstg,n.notyf),n.tableSelector=new M("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),n.switchStep(2),n.cloneExcludeFilters=new I,n.directoryNavigator.countSelectedFiles(),n.tableSelector.countSelectedTables()):"wpstg_cloning"!==n.data.action&&"wpstg_update"!==n.data.action&&"wpstg_reset"!==n.data.action||n.switchStep(3),n.startCloning()}),"HTML")},E=function(t){new A("wpstg_modal_error",wpstg).show(Object.assign({title:"Error",icon:"error",html:wpstg.i18n.something_went_wrong+(void 0!==t.message?"<br/>"+t.message:""),width:"500px",confirmButtonText:"Ok",showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},t.swalOptions),{type:t.type})},C=function(t){if(!t)return!1;try{var e=JSON.parse(t);if(e&&"object"==typeof e)return e}catch(t){}return!1},T=function(t,e){n.data={action:"wpstg_reset",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:t},n.data=r({},n.data,e);var s=i.get("#wpstg-workflow");x(s)},L=function(){n.staging.load(),n.switchStep(1)},P=function t(){if(n.timer("stop"),!0===n.isFinished)return!0;h({action:"wpstg_cancel_clone",clone:n.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(e&&void 0!==e.delete&&"finished"===e.delete)return a(),void L();!0===e?L():t()}))},U=function t(){if(!0===n.isFinished)return!0;h({action:"wpstg_cancel_update",clone:n.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e&&void 0!==e.delete&&"finished"===e.delete||!0===e?L():t()}))},F=function(){if(!0===n.isFinished)return!0;h({action:"wpstg_restart",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){t&&void 0!==t.delete&&"finished"===t.delete||!0===t?L():U()}))},N=function(t){n.wpstgProcessLogs.logMessages(t)},W=function(){i.get("#wpstg-check-space").on("click",(function(t){i.get(".wpstg-loader").show(),S();var e=encodeURIComponent(n.directoryNavigator.getExcludedDirectories()),s=encodeURIComponent(n.directoryNavigator.getExtraDirectoriesRootOnly()),r=document.getElementById("wpstg_symlink_upload").checked;h({action:"wpstg_check_disk_space",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedDirectories:e,extraDirectories:s,isUploadsSymlinked:r},(function(t){a(),j(),!1!==t?i.get("#wpstg-clone-id-error").html("<strong>"+wpstg.i18n.admin_check_disk_space.error_disk_space_html_1+t.requiredSpace+"</strong>"+(null!==t.errorMessage?"<br>"+t.errorMessage:"")+'<br><span class="wpstg--grey">'+wpstg.i18n.admin_check_disk_space.error_disk_space_html_2+"</span>").show():i.get("#wpstg-clone-id-error").text(wpstg.i18n.admin_check_disk_space.admin_check_disk_space).show()}),"json",!1)}))};n.timer=function(t){if("stop"===t){var e=n.time;return n.time=1,clearInterval(n.executionTime),n.convertSeconds(e)}n.executionTime=setInterval((function(){null!==document.getElementById("wpstg-processing-timer")&&(document.getElementById("wpstg-processing-timer").innerHTML=wpstg.i18n.admin_that_timer.elapsed_time+n.convertSeconds(n.time)),n.time++,"stop"===t&&(n.time=1,clearInterval(n.executionTime))}),1e3)},n.convertSeconds=function(t){var e=new Date(null);return e.setSeconds(t),e.toISOString().substr(11,8)},n.startCloning=function(){if(l(),W(),"wpstg_cloning"===n.data.action||"wpstg_update"===n.data.action||"wpstg_reset"===n.data.action){n.isCancelled=!1,i.get(".wpstg-loader").show(),i.get("#wpstg-cancel-cloning").text("Cancel"),i.get("#wpstg-resume-cloning").hide(),i.get("#wpstg-error-details").hide(),setTimeout((function(){window.addEventListener("beforeunload",st.warnIfClosingDuringProcess),t()}),wpstg.delayReq);var t=function t(){if(!0===n.isCancelled)return window.removeEventListener("beforeunload",st.warnIfClosingDuringProcess),!1;var r;(r=!0)&&!1!==r?i.get(".wpstg-loader").show():a();var o,l="",u="";null!==n.directoryNavigator&&(l=n.directoryNavigator.getExcludedDirectories(),u=n.directoryNavigator.getExtraDirectoriesRootOnly()),st.requestType="wpstg_cloning",st.ajax({action:"wpstg_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:(o=[],e(".wpstg-db-table input:not(:checked)").each((function(){o.push(this.name)})),o),excludedDirectories:encodeURIComponent(l),extraDirectories:encodeURIComponent(u)},(function(e){!function(t,e,n){e=e?e+"<br/><br/>":wpstg.i18n.something_went_wrong+"!<br/><br/>",n=n?n+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===t?(c(e+" Error: No response."+n),window.removeEventListener("beforeunload",st.warnIfClosingDuringProcess)):void 0!==t.error&&t.error&&(console.error(t.message),c(e+" Error: "+t.message+n),window.removeEventListener("beforeunload",st.warnIfClosingDuringProcess))}(e),void 0!==e.last_msg&&e.last_msg&&N(e.last_msg),!1===e.status?(s(e),setTimeout((function(){t()}),wpstg.delayReq)):!0===e.status&&"finished"!==e.status?(i.get("#wpstg-error-details").hide(),i.get("#wpstg-error-wrapper").hide(),s(e),t()):("finished"===e.status||void 0!==e.job_done&&e.job_done)&&(window.removeEventListener("beforeunload",st.warnIfClosingDuringProcess),st.requestType="",function(t){!0===n.getLogs&&N();s(t),void 0!==t.last_msg&&N(t.last_msg);var e=n.data.action.replace("wpstg_","");null!==wpstg.i18n[e]&&n.wpstgProcessModal.openSuccessModal(wpstg.i18n[e],!0,t.url)}(e))}),"json",!1)},s=function(t,e){null!==t&&n.wpstgProcessModal.openProcessModal(n.data,t,!0)}}};var H=function(){return new Promise((function(t){var e,n;((null==(e=d("#wpstg-use-target-dir"))?void 0:e.dataset.basePath)||"")!==((null==(n=d("#wpstg_clone_dir"))?void 0:n.value)||"")?t(!1):(d("#wpstg_clone_dir").style.borderColor="red",k("error",wpstg.i18n.admin_is_clone_destination_path_same_as_root_error),t(!0))}))};return n.switchStep=function(t){i.get(".wpstg-current-step").removeClass("wpstg-current-step"),i.get(".wpstg-step"+t).addClass("wpstg-current-step")},n.checkUserDbPermissions=function(t){return new Promise((function(n){st.ajax({action:"wpstg_check_user_permissions",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:t},(function(t){t.success?n(!0):(u.getSwalModal(!0,{container:"wpstg-swal-push-container"}).fire({title:"",icon:"warning",html:t.data.message,width:"750px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_check_user_db_permissions_confirm_button_text,showCancelButton:!0}).then((function(t){t.isConfirmed&&n(!0)})),e("#wpstg-db-permission-show-full-message").click((function(){e("#wpstg-permission-info-output").html(e("#wpstg-permission-info-data").html())})))}),"json",!1)}))},n.init=function(){var t,s,r;L(),s=i.get("#wpstg-workflow"),r=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",2<window.devicePixelRatio&&(r+="-2x"),o="<img src=''"+(r+=".gif")+"' alt='' class='ajax-spinner general-spinner' />",s.on("click",".wpstg-button-unselect",(function(t){t.preventDefault(),!1===n.areAllTablesChecked?(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),i.get(".wpstg-button-unselect").text(wpstg.i18n.unselect_all),i.get(".wpstg-db-table-checkboxes").prop("checked",!0),n.areAllTablesChecked=!0):(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),i.get(".wpstg-button-unselect").text(wpstg.i18n.select_all),i.get(".wpstg-db-table-checkboxes").prop("checked",!1),n.areAllTablesChecked=!1)})).on("keyup","#wpstg-new-clone-id",(function(){if(document.getElementById("wpstg-error-details").style.display="none","number"==typeof t&&clearInterval(t),void 0===this.value||""===this.value)return i.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),i.get("#wpstg-start-cloning").removeAttr("disabled"),void i.get("#wpstg-clone-id-error").text("").hide();var e=u.slugify(this.value);t=setTimeout((function(){h({action:"wpstg_check_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,directoryName:e},(function(t){if(!t)return i.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),i.get("#wpstg-start-cloning").prop("disabled",!0),void k("error",wpstg.i18n.admin_elements.wpstg_check_clone_error);"success"===t.status?(i.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),i.get("#wpstg-start-cloning").removeAttr("disabled"),i.get("#wpstg-clone-id-error").text("").hide()):(i.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),i.get("#wpstg-start-cloning").prop("disabled",!0),i.get("#wpstg-clone-id-error").text(t.message).show())}))}),500)})).on("click","#wpstg-start-cloning",(function(){l(),n.isCancelled=!1,n.progressBar=0})).on("input","#wpstg-new-clone-id",(function(){if(!(e("#wpstg-clone-directory").length<1)){var t=u.slugify(this.value).substring(0,16).trim(),n=e("#wpstg-use-target-dir"),s=e("#wpstg-use-target-hostname"),r=n.data("base-path"),o=s.data("base-uri");r&&t&&(r=function(t,e){var n=t.replace(/\/+$/g,"");return(n+="/"+e+"/").replace(/\/+/g,"/")}(r,t)),o&&(o=o.replace(/\/+$/g,"")+"/"+t),e(".wpstg-use-target-dir--value").text(r),e(".wpstg-use-target-hostname--value").text(o),n.attr("data-path",r),s.attr("data-uri",o),e("#wpstg_clone_dir").attr("placeholder",r),e("#wpstg_clone_hostname").attr("placeholder",o)}})).on("input","#wpstg_clone_hostname",(function(){""===e(this).val()||p()?e("#wpstg_clone_hostname_error").remove():p()||e("#wpstg_clone_hostname_error").length||e("#wpstg-clone-directory tr:last-of-type").after('<tr><td>&nbsp;</td><td><p id="wpstg_clone_hostname_error" style="color: red;">&nbsp;'+wpstg.i18n.admin_elements.wpstg_clone_hostname_error+"</p></td></tr>")})),g(),function(){var t=i.get("#wpstg-workflow");t.on("click",".wpstg-next-step-link",(function(n){n.preventDefault();var s=e(this);if(e("#wpstg_clone_hostname").length&&!p())return e("#wpstg_clone_hostname").focus(),!1;if(("wpstg_update"===s.data("action")||"wpstg_reset"===s.data("action"))&&"wpstg_update"===s.data("action")){var r=s,o=t,i=s.data("action");return u.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_step_buttons.popup_title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height wpstg-mt-10px">'+wpstg.i18n.admin_step_buttons.popup_html.replace("{URL}",s.data("url"))+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_step_buttons.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var t=u.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",(function(t){u.closeSwalModal()}))}}).then((function(t){if(t.value){var e=document.querySelector("#wpstg-ext-db");if("wpstg_cloning"===i&&e.checked)return void w(r,o);u.closeSwalModal(),f(r,o)}})),!1}if(s.attr("disabled"))return!1;"wpstg_cloning"===s.data("action")&&e("#wpstg-ext-db").is(":checked")?w(s,t):f(s,t)})).on("click",".wpstg-prev-step-link",(function(t){t.preventDefault(),a(),i.get(".wpstg-loader").removeClass("wpstg-finished"),L()}))}(),i.get("#wpstg-workflow").on("click",".wpstg-tab-header",(function(t){t.preventDefault();var n=e(this),s=i.get(n.data("id"));n.toggleClass("expand"),s.slideToggle();var r=n.find(".wpstg-tab-triangle");n.hasClass("expand")?(r.text(""),r.addClass("wpstg-rotate-90")):r.removeClass("wpstg-rotate-90")})),u.listenTooltip(),new R,new O,new D,new Y,new Z,new V,n.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]})},n.ajax=h,n.showError=c,n.getLogs=N,n.loadOverview=L,n}(jQuery);jQuery(document).ready((function(){st.init(),window.WPStaging=st})),jQuery(document).ready((function(t){function e(t,e,n){var s=document.getElementById(t);if(s){var r=null!=e&&e.includes(n)?"#e01e5a":"";"checkbox"!==s.type?s.style.borderColor=r:document.querySelector("#"+t+" ~ svg .wpstg--checkbox-border").style.stroke=r}}function n(s,r){void 0===r&&(r="false");var o=t(".wpstg--tab--header .wpstg-report-email").val(),i=t(".wpstg--tab--header .wpstg-report-hosting-provider").val(),a=t(".wpstg--tab--header .wpstg-report-description").val(),c=t(".wpstg--tab--header .wpstg-report-syslog").is(":checked"),l=t(".wpstg--tab--header .wpstg-report-terms").is(":checked");s.attr("disabled",!0),x("#wpstg-contact-us-loader"),t.ajax({url:ajaxurl,type:"POST",dataType:"json",async:!0,data:{action:"wpstg_send_report",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg_email:o,wpstg_provider:i,wpstg_message:a,wpstg_syslog:+c,wpstg_terms:+l,wpstg_force_send:r}}).done((function(r){if(s.attr("disabled",!1),y("#wpstg-contact-us-loader"),r.errors.length>0){t(".wpstg-report-issue-form .wpstg-message").remove();var o="";t.each(r.errors,(function(t,e){"already_submitted"===e.status?(o="",u.getSwalModal(!0,{container:"wpstg-issue-resubmit-confirmation"}).fire({title:"",icon:"warning",html:e.message,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Yes",cancelButtonText:"No"}).then((function(t){t.isConfirmed&&n(s,"true")}))):o+=e+"<br/>"})),e("wpstg-report-email",o,"email"),e("wpstg-report-description",o,"issue"),e("wpstg-report-terms",o,"privacy policy"),""!==o&&k("error",o)}else{var i=t("<div />").addClass("wpstg-message wpstg-success-message");i.append("<p>"+wpstg.i18n.admin_send_issue_report_success_message+"</p>"),t(".wpstg--tab--header .wpstg-report-issue-form").html(i),null!==document.getElementById("wpstg-modal-close")&&void 0!==document.getElementById("wpstg-modal-close")||t(".wpstg--tab--header .wpstg-success-message").append('<div class="wpstg-float-right"><button id="wpstg-success-button" class="wpstg-close-button"><a href="javascript:void(0)" class="wpstg-report-cancel wpstg--red">Close</a></button></div>'),setTimeout((function(){t(".wpstg--tab--header .wpstg-report-issue-form").removeClass("wpstg-report-active")}),2e3)}}))}t("body").on("click",".wpstg-report-issue-button",(function(e){e.preventDefault();var n=document.querySelector("#wpstg-contact-us-modal");null!=n&&void 0!==n&&(x("#wpstg-contact-us-modal"),new P),t(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),t("body").on("click",".wpstg-backups-report-issue-button",(function(e){e.preventDefault(),t(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),t("body").on("click","#wpstg-report-cancel",(function(e){e.preventDefault(),t(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),t("body").on("click","#wpstg-report-submit",(function(e){e.preventDefault(),n(t(this),"false")})),t("body").on("click","#wpstg-success-button",(function(e){e.preventDefault(),t(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),t(document).on("click",".wpstg-dropdown>.wpstg-dropdown-toggler",(function(e){e.preventDefault(),t(e.target).next(".wpstg-dropdown-menu").toggleClass("shown"),t(e.target).find(".wpstg-caret").toggleClass("wpstg-caret-up")})),t(document).on("click",".wpstg-caret",(function(e){e.preventDefault();var n=t(e.target).closest(".wpstg-dropdown-toggler");n&&n.trigger("click")})),document.addEventListener("click",(function(e){if(!e.target.closest(".wpstg-dropdown-toggler")){for(var n=document.getElementsByClassName("wpstg-dropdown-menu"),s=0;s<n.length;s++)n[s].classList.remove("shown");t(".wpstg-caret").removeClass("wpstg-caret-up")}})),window.addEventListener("finishedProcessWithError",(function(e){t.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:e.detail.error,job_id:u.getJobId()}})})),document.addEventListener("click",(function(t){"wpstg-login-link"===t.target.id&&(t.preventDefault(),window.open("/wp-login.php","_blank"),window.WPStaging&&window.WPStaging.wpstgProcessModal&&(window.WPStaging.wpstgProcessModal.stop(),window.WPStaging.loadOverview()))})),document.addEventListener("click",(function(t){var e=t.target.id;if(["wpstg-send-schedules-error-report","wpstg-send-schedules-slack-error-report"].includes(e)){var n=document.getElementById(e+"-input");n&&n.classList.toggle("hidden")}}))})),window.addEventListener("load",s(t().mark((function e(){var n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("true"!==localStorage.getItem("wpstgPushProcessCompleted")){t.next=5;break}return n=new Y,t.next=4,n.logEventSuccess("push");case 4:localStorage.removeItem("wpstgPushProcessCompleted");case 5:case"end":return t.stop()}}),e)}))))}();
