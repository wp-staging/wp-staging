!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function t(e,t,n,s,r,o,i){try{var a=e[o](i),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(s,r)}function n(e){return function(){var n=this,s=arguments;return new Promise((function(r,o){var i=e.apply(n,s);function a(e){t(i,r,o,a,c,"next",e)}function c(e){t(i,r,o,a,c,"throw",e)}a(void 0)}))}}function s(t,n){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=function(t,n){if(t){if("string"==typeof t)return e(t,n);var s={}.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){s&&(t=s);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},r.apply(null,arguments)}function o(){o=function(){return t};var e,t={},n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function p(e,t,n,s){var o=t&&t.prototype instanceof v?t:v,i=Object.create(o.prototype),a=new P(s||[]);return r(i,"_invoke",{value:T(e,n,a)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var g="suspendedStart",h="suspendedYield",w="executing",f="completed",m={};function v(){}function b(){}function y(){}var x={};u(x,a,(function(){return this}));var k=Object.getPrototypeOf,_=k&&k(k(I([])));_&&_!==n&&s.call(_,a)&&(x=_);var S=y.prototype=v.prototype=Object.create(x);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(r,o,i,a){var c=d(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,a)}),(function(e){n("throw",e,i,a)})):t.resolve(u).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,a)}))}a(c.arg)}var o;r(this,"_invoke",{value:function(e,s){function r(){return new t((function(t,r){n(e,s,t,r)}))}return o=o?o.then(r,r):r()}})}function T(t,n,s){var r=g;return function(o,i){if(r===w)throw Error("Generator is already running");if(r===f){if("throw"===o)throw i;return{value:e,done:!0}}for(s.method=o,s.arg=i;;){var a=s.delegate;if(a){var c=L(a,s);if(c){if(c===m)continue;return c}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(r===g)throw r=f,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);r=w;var l=d(t,n,s);if("normal"===l.type){if(r=s.done?f:h,l.arg===m)continue;return{value:l.arg,done:s.done}}"throw"===l.type&&(r=f,s.method="throw",s.arg=l.arg)}}}function L(t,n){var s=n.method,r=t.iterator[s];if(r===e)return n.delegate=null,"throw"===s&&t.iterator.return&&(n.method="return",n.arg=e,L(t,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),m;var o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(s.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=y,r(S,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:b,configurable:!0}),b.displayName=u(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(C.prototype),u(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,s,r,o){void 0===o&&(o=Promise);var i=new C(p(e,n,s,r),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(S),u(S,l,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(s,r){return a.type="throw",a.arg=t,n.next=s,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=s.call(i,"catchLoc"),l=s.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var r=s.arg;j(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,s){return this.delegate={iterator:I(t),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=e),m}},t}var i=(Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),function(e,t){return e instanceof Element?e.closest(t):null});function a(e){return document.querySelector(e)}function c(e){return document.querySelectorAll(e)}function l(e,t,n,s){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&s(e.target.closest(n),e)}),!1)}function u(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden",e.style.paddingTop="0px",e.style.paddingBottom="0px";var n=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=n+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function p(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var n=e.offsetHeight;e.style.height=n+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function d(e,t){for(var n=e.previousElementSibling;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function g(e){if(!(!e instanceof Element)&&e.id){var t="hidden";if("checkbox"!==e.getAttribute("type"));else{var n=i(e,".wpstg-container");if(null===n)return;var r=n.querySelectorAll('[data-show-if-unchecked="'+e.id+'"]'),o=e.checked;if(r.length)for(var a,c=s(r);!(a=c()).done;){var l=a.value;o?l.classList.add(t):l.classList.remove(t)}}}}function h(e){if(!(!e instanceof Element)&&e.getAttribute("data-wpstg-target")){var t=null!==document.querySelector(".wpstg--swal2-container"),n=i(e,t?".wpstg--swal2-container":".wpstg_admin");if(null!==n){var r=n.querySelectorAll(e.getAttribute("data-wpstg-target"));if(r.length)for(var o,a=s(r);!(o=a()).done;){o.value.classList.toggle("hidden")}}}}function w(e){if(!(!e instanceof Element)&&e.getAttribute("data-wpstg-target")&&e.getAttribute("data-wpstg-copy")){var t=i(e,".wpstg_admin");if(null!==t){navigator.clipboard.writeText(e.getAttribute("data-wpstg-copy"));var n=t.querySelectorAll(e.getAttribute("data-wpstg-target"));if(n.length)for(var r,o=s(n);!(r=o()).done;){r.value.value=e.getAttribute("data-wpstg-copy","")}}}}function f(e){document.querySelectorAll(e).forEach((function(e){e.style.display="none"}))}function m(e){document.querySelectorAll(e).forEach((function(e){e.style.display="block"}))}function v(e){var t,n=function(e){return"string"==typeof e?e:e&&"object"==typeof e&&e.target&&e.target.getAttribute("data-copy-content")?e.target.getAttribute("data-copy-content"):e instanceof Element&&e.getAttribute("data-wpstg-source")?document.querySelector(e.getAttribute("data-wpstg-source")).value:null}(e);n||b("error","No content to copy"),navigator.clipboard&&window.isSecureContext?(t=n,navigator.clipboard.writeText(t).then((function(){b("success","Copied to clipboard")})).catch((function(e){b("error","Unable to copy to clipboard")}))):function(e){var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();var n=document.execCommand("copy");b(n?"success":"error",n?"Copied to clipboard":"Unable to copy to clipboard"),document.body.removeChild(t)}(n)}function b(e,t){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:e,message:t})}function y(e){void 0===e&&(e="visible"),document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(t){t&&(t.style.visibility=e)}))}function x(e){var t=a(e);return!!t&&t.checked}function k(e){void 0===e&&(e="visible");var t=c(".wpstg-loading-placeholder-container");t.forEach((function(t){t&&(t.style.visibility=e)})),setTimeout((function(){t.forEach((function(e){e&&"visible"===e.style.visibility&&(e.style.visibility="hidden")})),C()}),5e3);var n=a(".wpstg--tab--contents");if("visible"===e)return y(),void(n&&(n.style.overflow="hidden"));C(),n&&(n.style.overflow="unset")}function _(){return(window.location.search.match(/[\?&]page=([^&]*)/)||[])[1]||null}function S(e){return E.apply(this,arguments)}function E(){return(E=n(o().mark((function e(t){var n,s,r,i,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=""),""===t&&(t=a(".wpstg--tab--contents")),null!==t){e.next=4;break}return e.abrupt("return");case 4:if(n=t.querySelector(".wpstg-loading-placeholder-container"),s=n.querySelector(".wpstg-dom-loading-wrapper")){e.next=8;break}return e.abrupt("return");case 8:if(s.offsetHeight===t.offsetHeight){e.next=19;break}s.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(e){return e.remove()})),null==(r=s.querySelector(".wpstg-loading-line"))||r.remove(),null==(i=s.querySelector(".wpstg-loading-last-line-bar"))||i.remove();case 13:return s.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),e.next=16,new Promise((function(e){return setTimeout(e,0)}));case 16:if(s.offsetHeight<=t.offsetHeight+300){e.next=13;break}case 17:null==(c=s.firstElementChild)||c.classList.add("wpstg-loading-first-line-bar"),null==(l=s.lastElementChild)||l.classList.add("wpstg-loading-last-line-bar");case 19:return e.next=21,new Promise((function(e){return setTimeout(e,0)}));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(e){e&&(e.style.visibility="hidden")}))}function T(e,t){var n;void 0===t&&(t=!0);var s=(null==(n=a(e))?void 0:n.value)||"",r=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9]+(?:-[a-zA-Z0-9]+)*\.[a-zA-Z]{2,24}$/.test(s);return!(t||!r)||!(!t&&!r)&&(r?(a(e).style.borderColor="unset",!0):(b("error","Invalid email address"),a(e).style.borderColor="red",!1))}function L(){return new URLSearchParams(window.location.search).get("tab")||null}function M(e){return new Date(1e3*e).toISOString().slice(11,19)+"s"}function j(e,t,n){return P.apply(this,arguments)}function P(){return(P=n(o().mark((function e(t,n,s){var r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),void 0===s&&(s="json"),e.next=4,I(t,n,s);case 4:if(r=e.sent,null===(i=r.response)){e.next=8;break}return e.abrupt("return",i);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t,n){return B.apply(this,arguments)}function B(){return(B=n(o().mark((function e(t,n,s){var i,a,c,l,u,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),void 0===s&&(s="json"),i=r({},n,{action:t,accessToken:wpstg.accessToken,nonce:wpstg.nonce}),a=null,e.prev=4,e.next=7,fetch(wpstg.ajaxUrl,{method:"POST",credentials:"same-origin",body:O(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:if(c=e.sent,a=c.status,c.ok){e.next=14;break}return e.next=12,c.json();case 12:return l=e.sent,e.abrupt("return",{response:null,error:l,code:a});case 14:if("json"!==s){e.next=21;break}return e.next=17,c.json();case 17:return u=e.sent,e.abrupt("return",{response:u,error:null,code:a});case 21:return e.next=23,c.text();case 23:return p=e.sent,e.abrupt("return",{response:p,error:null,code:a});case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(4),e.abrupt("return",{response:null,error:e.t0,code:a});case 30:case"end":return e.stop()}}),e,null,[[4,27]])})))).apply(this,arguments)}function O(e){var t=new URLSearchParams;return R(e,t),t}function R(e,t,n){for(var s in void 0===n&&(n=""),e)if(e.hasOwnProperty(s)){var r=n?n+"["+s+"]":s;"object"!=typeof e[s]||e[s]instanceof File?t.append(r,e[s]):R(e[s],t,r)}}var D=function(){function e(e,t){void 0===e&&(e="contact-us"),void 0===t&&(t=wpstg),this.wpstgObject=t,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=e,this.init()}var t=e.prototype;return t.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.askInTheForumForm=this.contactUsModal+" .wpstg-contact-us-report-issue",this.contactUsSuccessPopup=this.contactUsModal+" .wpstg-contact-us-success-form",this.contactUsLoader=this.contactUsModal+" .wpstg-contact-us-report-issue-loader",this.contactUsSupport=this.contactUsModal+" .wpstg-contact-us-support-forum",this.reportIssueButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-open-debug-log"),this.successForm=document.querySelector(this.contactUsModal+" .wpstg-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" .wpstg-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" .wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" .wpstg-contact-us-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" .wpstg-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code"),this.contactUsModalCloseBtn=document.querySelector(this.contactUsModal+" .wpstg-contact-us-close-btn"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector(this.contactUsModal+" #wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()},t.addEvents=function(){var e=this;document.addEventListener("keydown",(function(t){"Escape"===t.key&&(f(e.contactUsModal),f(e.askInTheForumForm),f(e.contactUsSuccessPopup),f(e.contactUsSupport),e.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){m(e.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){m(e.contactUsModal)})),null!==this.contactUsModalCloseBtn&&this.contactUsModalCloseBtn.addEventListener("click",(function(){f(e.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){e.isDebugWindowOpened?f(e.askInTheForumForm):m(e.askInTheForumForm),e.isDebugWindowOpened=!e.isDebugWindowOpened,e.toggleActiveClass()})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){e.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){f(e.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){f(e.contactUsModal),f(e.contactUsSupport),f(e.askInTheForumForm),e.isDebugWindowOpened=!1,e.toggleActiveClass()})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){e.contactUsDebugCodeField.select(),e.contactUsDebugCodeField.setSelectionRange(0,99999),v(e.contactUsDebugCodeField.value)}))},t.generateDebugCode=function(e){for(var t="",n=0;n<e;n++)t+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+t+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},t.sendDebugInfo=function(){var e=n(o().mark((function e(){var t,n,s,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0,t=this.generateDebugCode(8),n=!1,this.contactUsForceSendDebugLog&&(n=this.contactUsForceSendDebugLog.checked),s={debugCode:t,forceSend:n,wpstg_action:"bypass_optimizer"},e.prev=6,e.next=9,j("wpstg_send_debug_log_report",s);case 9:a=e.sent,this.contactUsReportIssueBtn.disabled=!1,!0===(null==(r=a.response)?void 0:r.sent)&&(this.contactUsDebugCodeField.value=t,m(this.contactUsSuccessPopup),window.debugCode=t,this.contactUsForceSendDebugLog&&(f(this.contactUsForceSendDebugLogContainer),this.contactUsForceSendDebugLog.checked=!1)),!1===(null==(i=a.response)?void 0:i.sent)&&"already_submitted"===a.response.status&&(this.contactUsForceSendDebugLog&&m(this.contactUsForceSendDebugLogContainer),b("error",a.response.message)),f(this.contactUsLoader),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(6),f(this.contactUsLoader),m(this.contactUsSupport),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 21:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(){return e.apply(this,arguments)}}(),t.toggleActiveClass=function(){this.isDebugWindowOpened||!this.reportIssueButton.classList.contains("active")?this.isDebugWindowOpened&&this.reportIssueButton.classList.add("active"):this.reportIssueButton.classList.remove("active")},e}(),q=function(){function e(e,t){void 0===e&&(e="#wpstg-clonepage-wrapper"),void 0===t&&(t=wpstg),this.pageWrapper=a(e),this.wpstgObject=t,this.enableButtonId="#wpstg-enable-staging-cloning",this.enableAction="wpstg_enable_staging_cloning",this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.pageWrapper&&l(this.pageWrapper,"click",this.enableButtonId,(function(){e.sendRequest(e.enableAction)}))},t.init=function(){this.addEvents()},t.sendRequest=function(e){var t=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){void 0!==e.success&&e.success?location.reload():void 0===e.message?t.notyf.error(t.wpstgObject.i18n.something_went_wrong):t.notyf.error(e.message)})).catch((function(e){console.warn(t.wpstgObject.i18n.something_went_wrong,e)}))},e}();function A(e,t,n,s){var r,o,i,a,c=!1,l=!1,u={},p=0,d=0,g={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(e){r=e.clientX,o=e.clientY}function w(e,t){if(d&&(d=clearTimeout(d)),Math.abs(i-r)+Math.abs(a-o)<g.sensitivity)return p=1,l?void 0:n(e,t);i=r,a=o,d=setTimeout((function(){w(e,t)}),g.interval)}function f(e,t){return c=!0,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1!==p&&(i=t.clientX,a=t.clientY,e.addEventListener("mousemove",h,!1),d=setTimeout((function(){w(e,t)}),g.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function v(e,t){return c=!1,d&&(d=clearTimeout(d)),e.removeEventListener("mousemove",h,!1),1===p&&(d=setTimeout((function(){!function(e,t){d&&(d=clearTimeout(d)),p=0,l||s(e,t)}(e,t)}),g.timeout)),this}function b(e){e.target.matches(t+", "+t+" *")&&v(e.target.closest(t),e)}function y(e){var s,r;e.target.matches(t+", "+t+" *")&&(s=e.target.closest(t),r=e,c||(l=!0,n(s,r)))}function x(e){var n,r;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),r=e,!c&&l&&(l=!1,s(n,r)))}function k(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",x,!1)}return u.options=function(t){var n=t.handleFocus!==g.handleFocus;return g=Object.assign({},g,t),n&&(g.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",x,!1)):k()),u},u.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",b,!1),k())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",b,!1)),u}var U=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e}return e.prototype.sendRequest=function(){var e=n(o().mark((function e(t){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:t,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return n=e.sent,e.next=6,n.json();case 6:if(void 0===(s=e.sent).status||!s.status||!s.error){e.next=9;break}return e.abrupt("return",s);case 9:console.warn(s.message),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),e}(),F=function(){function e(e){if(this.container="string"==typeof e?document.querySelector(e):e,!(this.container instanceof HTMLElement))throw console.error("Container not found."),new Error("Container not found.");this.emptyChar=" ",this.inputs=this.container.querySelectorAll("input[type=text], input[type=number], input[type=password]"),this.inputCount=this.inputs.length,this.init()}var t=e.prototype;return t.reset=function(){this.inputs.forEach((function(e){e.value="",e.dataset.otpInputRestore=""}))},t.init=function(){for(var e=this,t=function(t){var n=e.inputs[t];n.addEventListener("input",(function(){e.bindInputEvent(n,t)})),n.addEventListener("keydown",(function(s){e.bindKeyEvent(n,t,s)})),0===t&&n.addEventListener("paste",(function(t){t.preventDefault();var n=(t.clipboardData||window.clipboardData).getData("Text");n&&e.setValue(n)}))},n=0;n<this.inputCount;n++)t(n)},t.bindInputEvent=function(e,t){if(Number.isNaN(Number(e.value)))e.value=e.dataset.otpInputRestore||"";else{if(0===e.value.length)return this._saveInputValue(t);if(1===e.value.length)return this._saveInputValue(t),void(t+1<this.inputCount&&this.inputs[t+1].focus());if(t===this.inputCount-1)return this._setInputValue(t,e.value);for(var n=e.value.split(""),s=0;s<n.length&&!(s+t>=this.inputCount);s++)this._setInputValue(s+t,n[s]);var r=Math.min(this.inputCount-1,t+n.length);this.inputs[r].focus()}},t.bindKeyEvent=function(e,t,n){if("Backspace"===n.key&&""===e.value&&0!==t)return this._setInputValue(t-1,""),void this.inputs[t-1].focus();if("Delete"===n.key&&t!==this.inputCount-1){for(var s=e.selectionStart||0,r=t+s;r<this.inputCount-1;r++)this._setInputValue(r,this.inputs[r+1].value);return this._setInputValue(this.inputCount-1,""),e.selectionStart&&(e.selectionStart=s),void n.preventDefault()}"ArrowLeft"!==n.key||null!=e.selectionStart&&0!==e.selectionStart?"ArrowRight"!==n.key||null!=e.selectionStart&&e.selectionEnd!==e.value.length||t+1<this.inputCount&&(n.preventDefault(),this.inputs[t+1].focus(),this.inputs[t+1].select()):t>0&&(n.preventDefault(),this.inputs[t-1].focus(),this.inputs[t-1].select())},t.getValue=function(){var e=this,t="";return this.inputs.forEach((function(n){t+=""===n.value?e.emptyChar:n.value})),t},t.setValue=function(e){if(Number.isNaN(e))console.error("Please enter an integer value.");else for(var t=(""+e).split(""),n=0;n<this.inputs.length;n++)this._setInputValue(n,t[n]||"")},t._setInputValue=function(e,t){return Number.isNaN(Number(t))?console.error("Please enter an integer value."):this.inputs[e]?(this.inputs[e].value=String(t).substring(0,1),void this._saveInputValue(e)):console.error("Index not found.")},t._saveInputValue=function(e,t){if(!this.inputs[e])return console.error("Index not found.");this.inputs[e].dataset.otpInputRestore=t||this.inputs[e].value},e}(),N=function(){function e(){}var t=e.prototype;return t.init=function(){var e=this;this.otpScreen=document.querySelector("#wpstg--otp--overlay-screen"),this.otpContainer=this.otpScreen.querySelector(".wpstg-otp-container"),this.otpInput=new F(this.otpContainer),this.verifyButton=this.otpScreen.querySelector(".wpstg-otp-verify-btn"),this.closeButton=this.otpScreen.querySelector(".wpstg-otp-overlay-close-btn"),this.resendButton=this.otpScreen.querySelector(".wpstg-otp-resend-btn"),this.otpMessageContainer=this.otpScreen.querySelector(".wpstg-otp-message"),this.reset(),this.addEventListener(".wpstg-otp-overlay-close-btn",(function(){e.otpScreen.style.display="none",e.onCancel(),e.reset()})),this.addEventListener(".wpstg-otp-verify-btn",n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.verifyOtp();case 2:case"end":return t.stop()}}),t)})))),this.addEventListener(".wpstg-otp-resend-btn",n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.resendOtp();case 2:case"end":return t.stop()}}),t)}))))},t.addEventListener=function(e,t){this.otpScreen.querySelector(e).addEventListener("click",(function(e){t(e)}))},t.createSession=function(){return Date.now().toString(36)+Math.random().toString(36).substring(0,2)},t.reset=function(){this.sessionId=null,this.otpAction=null,this.otpMessageContainer.innerHTML="",this.onVerification=null,this.onRequest=null,this.onCancel=function(){},this.additionalData={},this.otpInput.reset()},t.verifyOtp=function(){var e=n(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this.otpInput.getValue()).length<this.otpInput.inputCount)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.processOtpVerification(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.processOtpVerification=function(){var e=n(o().mark((function e(t){var n,s,i,a,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.closeButton.disabled=!0,this.verifyButton.disabled=!0,this.resendButton.style.display="none",e.next=5,I(this.otpAction,r({},this.additionalData,{sessionId:this.sessionId,otp:t}));case 5:if(s=e.sent,i=s.response,a=s.error,c=s.code,this.closeButton.disabled=!1,this.verifyButton.disabled=!1,this.resendButton.style.display="block",403!==c||null==a||null==(n=a.data)||!n.message){e.next=15;break}return b("error",null==a||null==(l=a.data)?void 0:l.message),e.abrupt("return");case 15:this.otpScreen.style.display="none",this.onVerification(i,a,c),this.reset();case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.resendOtp=function(){var e=n(o().mark((function e(){var t,n,s,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("wpstg--send--otp",{sessionId:this.sessionId,resend:"true"});case 2:if(t=e.sent,n=t.response,s=t.error,t.code,!s){e.next=9;break}return b("error",null!=(r=null==s||null==(i=s.data)?void 0:i.message)?r:wpstg.i18n.something_went_wrong),e.abrupt("return");case 9:if(n){e.next=11;break}return e.abrupt("return");case 11:this.initResendTimer(n.data.message,n.data.reRequestAt);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.setOnOtpRequest=function(e){this.onRequest=e},t.setOnOtpVerification=function(e){this.onVerification=e},t.setOnOtpCancelled=function(e){this.onCancel=e},t.start=function(){var e=n(o().mark((function e(t,n){var s,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n&&(n={}),this.onRequest&&this.onRequest instanceof Function){e.next=3;break}return e.abrupt("return");case 3:if(this.onVerification&&this.onVerification instanceof Function){e.next=5;break}return e.abrupt("return");case 5:return this.otpAction=t,this.additionalData=n,e.next=9,this.requestOtp();case 9:if(s=e.sent,r=s.response,i=s.error,202!==(a=s.code)){e.next=17;break}return e.next=16,this.processOtpVerification("");case 16:return e.abrupt("return");case 17:null!=r&&r.success&&(this.otpScreen.style.display="flex"),this.onRequest(r,i,a);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.requestOtp=function(){var e=n(o().mark((function e(){var t,n,s,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sessionId=this.createSession(),e.next=3,I("wpstg--send--otp",{sessionId:this.sessionId});case 3:return t=e.sent,n=t.response,s=t.error,r=t.code,e.abrupt("return",{response:n,error:s,code:r});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.initResendTimer=function(e,t){var n=this;this.resendButton.style.display="none",this.otpMessageContainer.innerHTML="",this.otpMessageContainer.style.display="block",this.interval=setInterval((function(){var s=(new Date).getTime()/1e3,r=Math.ceil(t-s);r<=0?(clearInterval(n.interval),n.resendButton.style.display="block",n.otpMessageContainer.style.display="none"):n.otpMessageContainer.innerHTML=e.replace("%s",r+"s")}),1e3)},e}(),H=function(e){var t={OTP_DISABLE_ARTICLE:"https://wp-staging.com/docs/disable-verification-code",continueErrorHandle:!0,otp:new N,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],oneTimeRetry:!1,performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),t.retry.performingRequest=!0,0===t.retry.currentDelay&&(t.retry.currentDelay=1e3,t.retry.count=1),t.retry.currentDelay+=1e3*t.retry.count*e,t.retry.count++},canRetry:function(){return t.retry.count<t.retry.max},reset:function(){t.retry.currentDelay=0,t.retry.count=0,t.retry.performingRequest=!1,t.retry.oneTimeRetry=!1}},delay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(e){return n(o().mark((function t(){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new U,t.next=3,n.sendRequest(e);case 3:if(s=t.sent){t.next=6;break}return t.abrupt("return",!1);case 6:return t.abrupt("return",s);case 10:case"end":return t.stop()}}),t)})))()},listenTooltip:function(){A(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){t.target.closest(".wpstg--tooltiptext a")||(e.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},s={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(s)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"success",title:wpstg.i18n.success+"!",html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},showOtpGenerationErrorModal:function(){t.showErrorModal(wpstg.i18n.cannot_generate_otp_error.replace("%s",t.OTP_DISABLE_ARTICLE),wpstg.i18n.something_went_wrong)},showErrorModal:function(e,t){void 0===t&&(t=null),void 0!==t&&""!==t&&null!==t||(t=wpstg.i18n.error+"!"),this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"error",title:t,html:'<div class="wpstg--grey" style="text-align: left;">'+e+"</div>"})},processAndShowErrorModal:function(e,n,s){var r,o,i=wpstg.i18n.error+(null==s?"!":" "+s+"!");if(null!=e&&e.message)t.showErrorModal(e.message,i);else if(null!=e&&null!=(r=e.data)&&r.message)t.showErrorModal(e.data.message,i);else if(null!=e&&e.data)t.showErrorModal(e.data,i);else if(null!=n&&n.message)t.showErrorModal(n.message,i);else if(null!=n&&null!=(o=n.data)&&o.message)t.showErrorModal(n.data.message,i);else if(null!=n&&n.data)t.showErrorModal(n.data,i);else{var a=wpstg.i18n.something_went_wrong;t.showErrorModal(a,i)}},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},confirmModal:function(e,n,s,r){return t.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:r+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:n,width:"750px",focusConfirm:!1,confirmButtonText:s,showCancelButton:!0})},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?t.cache.get(".wpstg-loader").show():t.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(e){return null===e?e:e.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(e){return null===e?e:e.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(e,n,s){return n=n?n+"<br/><br/>":wpstg.i18n.something_went_wrong+"<br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===e?(t.showError(n+" Error: No response."+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(t.showError(n+" Error: "+e.message+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},showFirewallError:function(){return wpstg.i18n.common.firewall_error_text},handleFetchErrors:function(e){if(!e.ok){var n=!1,s="Error: "+e.status+" - "+e.statusText+". ";403===e.status||405===e.status||406===e.status?(s+=t.showFirewallError(),n=!0):s+=wpstg.i18n.common.fetch_errors_error_text,n&&t.showErrorModal(s),t.showError(s)}return e},showError:function(n){t.retry.performingRequest||(t.cache.get("#wpstg-try-again").css("display","inline-block"),t.cache.get("#wpstg-cancel-cloning").text("Reset"),t.cache.get("#wpstg-resume-cloning").show(),t.cache.get("#wpstg-error-wrapper").show(),t.cache.get("#wpstg-error-details").show().html(n),t.cache.get("#wpstg-removing-clone").removeClass("loading"),t.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(n))},resetErrors:function(){t.cache.get("#wpstg-error-details").hide().html("")},ajax:function(n,s,r,o,i,a,c){void 0===a&&(a=null),void 0===c&&(c=null),void 0===r&&(r="json"),!1!==o&&(o=!0),i=void 0===i?0:i;var l=wpstg.maxFailedRetries,u=1e4*i;a=parseInt(a),isNaN(a)||(u*=a),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:r,cache:!1,data:n,error:function(e,p,d){if(console.log(e.status+" "+e.statusText+"---"+p),"function"!=typeof c||(c(e,p,d),t.continueErrorHandle))if(++i<=l)setTimeout((function(){t.ajax(n,s,r,o,i,a)}),u);else{var g=void 0===e.status?"Unknown":e.status,h=wpstg.i18n.common.ajax_error_fatal_error+g+wpstg.i18n.common.ajax_error_error_text;403!==g&&405!==g&&406!==g||(h=wpstg.i18n.common.ajax_error_fatal_error+g+" "+t.showFirewallError()),t.showError(h)}else t.continueErrorHandle=!0},success:function(e){"function"==typeof s&&s(e)},statusCode:{404:function(){i>=l&&t.showError(wpstg.i18n.ajax_status_code_404)},500:function(){i>=l&&t.showError(wpstg.i18n.status_code_500)},504:function(){i>l&&t.showError(wpstg.i18n.common.ajax_status_code_504)},502:function(){i>=l&&t.showError(wpstg.i18n.common.ajax_status_code_502)},503:function(){i>=l&&t.showError(wpstg.i18n.common.ajax_status_code_503)},429:function(){i>=l&&t.showError(wpstg.i18n.common.ajax_status_code_429)},403:function(){showError("Error 403 - "+t.showFirewallError())},405:function(){showError("Error 405 - "+t.showFirewallError())},406:function(){showError("Error 406 - "+t.showFirewallError())}}})}};return t}(jQuery),W=function(){function e(e,t){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=H),this.directoryListingContainer=a(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(l(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),l(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,n){n.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),l(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),l(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),l(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,n){n.preventDefault(),e.toggleDirectoryNavigation(t)})),l(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: Unable to add directory navigation events.")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){this.currentParentDiv=e.parentElement;var t=d(e,"span");return this.currentCheckboxElement=t.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var n=this.currentCheckboxElement.getAttribute("data-changed"),s=this.currentCheckboxElement.getAttribute("data-path"),r=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:s,prefix:r,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===n}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("data-scanned",!0);var n=document.createElement("div");return n.classList.add("wpstg-dir"),n.classList.add("wpstg-subdir"),n.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(n),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void u(n)}b("error",t.wpstgObject.i18n.something_went_wrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.something_went_wrong,e)}))},t.getExcludedDirectories=function(){var e,t=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(e){t.isParentExcluded(e.value)||t.excludedDirectories.push(e.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(e){t.isParentExcluded(e)||t.isScanned(e)||t.excludedDirectories.push(e)})),this.excludedDirectories.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(n){e.startsWith(n+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t,n=a("#wpstg_extraDirectories");if(null===n||""===n.value)return e.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator);var s=n.value.split(/\r?\n/);return e.concat(s).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(n){n.value===e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=d(e,"span"),n=t.querySelector('input[type="checkbox"]');if("false"!==n.getAttribute("data-navigatable","false")&&"false"!==n.getAttribute("data-scanned","false")){var s=function(e,t){for(var n=e.nextElementSibling;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(t,".wpstg-subdir");"none"===s.style.display?u(s):p(s)}},t.updateDirectorySelection=function(e){var t=e.parentElement.parentElement;e.setAttribute("data-changed","true"),e.checked?(function(e,t){for(var n=[],s=e&&e.parentElement;s;s=s.parentElement)s.matches(t)&&n.push(s);return n}(t.parentElement,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg--checkbox-wrapper")&&(e.children[t].children[t].checked=!0)})),t.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,n=this.directoryListingContainer.querySelectorAll('[data-dir-type="other"]:checked'),s=0;n.forEach((function(e){var t,n;null!=(t=e.getAttribute("data-path"))&&t.includes("wp-content/plugins")||null!=(n=e.getAttribute("data-path"))&&n.includes("wp-content/themes")||s++}));var r=a("#wpstg-files-count");0===e&&0===t&&0===s?r.classList.add("danger"):r.classList.remove("danger"),r.innerHTML=this.wpstgObject.i18n.files_selected.replace("{t}",e).replace("{ts}",1===e?"":"s").replace("{p}",t).replace("{ps}",1===t?"":"s").replace("{o}",s).replace("{os}",1===s?"":"s")},e}(),G=function(){function e(e,t,n,s,r){void 0===e&&(e="#wpstg-scanning-db"),void 0===t&&(t="#wpstg-workflow"),void 0===n&&(n="#wpstg_network_clone"),void 0===s&&(s="#wpstg_select_tables_cloning"),void 0===r&&(r=wpstg),this.databaseTableSection=a(e),this.workflow=a(t),this.networkCloneSelector=n,this.networkCloneCheckbox=a(n),this.wpstgObject=r,this.isAllTablesChecked=!0,this.isMultisite="1"===this.wpstgObject.isMultisite,this.isNetworkClone=!1,this.inputSelector=s,this.input=a(this.inputSelector),this.init()}var t=e.prototype;return t.setNetworkClone=function(e){this.isNetworkClone=e},t.addEvents=function(){var e=this;null!==this.workflow?(l(this.workflow,"change",this.networkCloneSelector,(function(){e.selectDefaultTables()})),l(this.workflow,"change",this.inputSelector,(function(){e.countSelectedTables()})),l(this.workflow,"click",".wpstg-button-select",(function(t,n){n.preventDefault(),e.selectDefaultTables()})),l(this.workflow,"click",".wpstg-button-unselect",(function(t,n){n.preventDefault(),e.toggleTableSelection()})),l(this.workflow,"click",".wpstg-button-unselect-wpstg",(function(t,n){n.preventDefault(),e.unselectWPSTGTables()}))):console.log("Error: database table section is null. Cannot register events")},t.init=function(){this.addEvents()},t.getRegexPattern=function(){var e="^"+this.wpstgObject.tblprefix,t=!1;return void 0!==this.networkCloneCheckbox&&null!==this.networkCloneCheckbox&&(t=this.networkCloneCheckbox.checked),this.isNetworkClone&&(t=!0),this.isMultisite&&!t&&(e+="([^0-9])_*"),e},t.selectDefaultTables=function(){var e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table"),t=this.getRegexPattern();e.forEach((function(e){e.getAttribute("name","").match(t)?e.selected=!0:e.selected=!1})),this.countSelectedTables()},t.toggleTableSelection=function(){!1===this.isAllTablesChecked?(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.selected=!0})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.isAllTablesChecked=!0):(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.selected=!1})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.isAllTablesChecked=!1),this.countSelectedTables()},t.unselectWPSTGTables=function(){var e=this,t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table");t.forEach((function(t){var n=t.getAttribute("name","");n.match("wpstg")&&!n.match(e.wpstgObject.tblprefix+"wpstg_queue")&&(t.selected=!1)})),this.countSelectedTables()},t.getSelectedTablesWithoutPrefix=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),n=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(n)||e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getIncludedTables=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),n=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(n)&&e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getExcludedTables=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:not(:checked)"),n=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(n)&&e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getTotalDbPrefixTables=function(){var e=0,t=this.getRegexPattern();return this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option").forEach((function(n){n.getAttribute("name","").match(t)&&e++})),e},t.countSelectedTables=function(){var e,t=this.getTotalDbPrefixTables(),n=null==(e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option"))?void 0:e.length,s=this.input.querySelectorAll("option:checked").length,r=a("#wpstg-tables-count");0===s?(r.classList.add("danger"),r.innerHTML=this.wpstgObject.i18n.tables_not_selected):(r.classList.remove("danger"),r.innerHTML=this.wpstgObject.i18n.tables_selected.replace("{d}",s).replace("{t}",n)),s!==t&&r.classList.add("danger")},e}(),z=function(){function e(e,t){void 0===e&&(e="#wpstg-exclude-filters-container"),void 0===t&&(t=wpstg),this.excludeContainer=a(e),this.excludeTableBody=a(e+" tbody"),this.wpstgObject=t,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;l(this.excludeContainer,"click",".wpstg-file-size-rule",(function(){e.addFileSizeExclude()})),l(this.excludeContainer,"click",".wpstg-file-ext-rule",(function(){e.addFileExtExclude()})),l(this.excludeContainer,"click",".wpstg-file-name-rule",(function(){e.addFileNameExclude()})),l(this.excludeContainer,"click",".wpstg-dir-name-rule",(function(){e.addDirNameExclude()})),l(this.excludeContainer,"click",".wpstg-clear-all-rules",(function(){e.clearExcludes()})),l(this.excludeContainer,"click",".wpstg-remove-exclude-rule",(function(t){e.removeExclude(t.parentElement)}))},t.init=function(){null!==this.excludeContainer?this.addEvents():console.log("Error: Given table selector not found!")},t.addFileSizeExclude=function(){this.addExcludeRuleRow("#wpstg-file-size-exclude-filter-template")},t.addFileExtExclude=function(){this.addExcludeRuleRow("#wpstg-file-ext-exclude-filter-template")},t.addFileNameExclude=function(){this.addExcludeRuleRow("#wpstg-file-name-exclude-filter-template")},t.addDirNameExclude=function(){this.addExcludeRuleRow("#wpstg-dir-name-exclude-filter-template")},t.addExcludeRuleRow=function(e){var t=a(e);if(null!==t){var n=t.content.cloneNode(!0).querySelector("tr");this.excludeTableBody.appendChild(n),c(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="inherit"}))}},t.clearExcludes=function(){this.excludeTableBody.innerHTML="",c(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.removeExclude=function(e){null!==e.parentElement&&null!==e.parentElement.parentElement&&this.excludeTableBody.removeChild(e.parentElement.parentElement),""===this.excludeTableBody.innerHTML.trim()&&c(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.getExcludeFilters=function(){for(var e=this,t=[],n=[],s=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleCompare[]"]'),r=this.excludeTableBody.querySelectorAll('input[name="wpstgFileSizeExcludeRuleSize[]"]'),o=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleByte[]"]'),i=0,a=Object.entries(r);i<a.length;i++){var c=a[i],l=c[0],u=c[1];""!==u.value&&n.push(s[l].value+" "+u.value+o[l].value)}this.excludeTableBody.querySelectorAll('input[name="wpstgFileExtExcludeRule[]"]').forEach((function(n){var s=e.cleanStringForGlob(n.value);""!==s&&t.push("ext:"+s.trim())}));for(var p=this.excludeTableBody.querySelectorAll('select[name="wpstgFileNameExcludeRulePos[]"]'),d=this.excludeTableBody.querySelectorAll('input[name="wpstgFileNameExcludeRulePath[]"]'),g=0,h=Object.entries(d);g<h.length;g++){var w=h[g],f=w[0],m=w[1],v=this.cleanStringForGlob(m.value);""!==v&&t.push("file:"+p[f].value+" "+v.trim())}for(var b=this.excludeTableBody.querySelectorAll('select[name="wpstgDirNameExcludeRulePos[]"]'),y=this.excludeTableBody.querySelectorAll('input[name="wpstgDirNameExcludeRulePath[]"]'),x=0,k=Object.entries(y);x<k.length;x++){var _=k[x],S=_[0],E=_[1],C=this.cleanStringForGlob(E.value);""!==C&&t.push("dir:"+b[S].value+" "+C.trim())}return{sizes:n.filter(this.onlyUnique).join(","),globs:t.filter(this.onlyUnique).join(",")}},t.onlyUnique=function(e,t,n){return n.indexOf(e)===t},t.cleanStringForGlob=function(e){return e.replace(/[*^//!\[?]/g,"")},e}(),J=function(){function e(e,t){void 0===t&&(t=wpstg),this.confirmAction=e,this.wpstgObject=t}var t=e.prototype;return t.show=function(e,t,n){var s=this;void 0===t&&(t={}),void 0===n&&(n=null),wpstgSwal.fire(e).then((function(e){e.value&&null!==s.error&&s.triggerConfirmAction(t,n)}))},t.triggerConfirmAction=function(e,t){var n=this;void 0===e&&(e={}),void 0===t&&(t=null),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams(Object.assign({action:this.confirmAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce},e)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){null!==t&&t(e)})).catch((function(e){console.log(n.wpstgObject.i18n.something_went_wrong,e)}))},e}(),V=function(){function e(e,t,n,s,r){void 0===t&&(t="#wpstg-workflow"),void 0===n&&(n="wpstg_clone_excludes_settings"),void 0===s&&(s="wpstg_modal_error"),void 0===r&&(r=wpstg),this.cloneID=e,this.workflow=a(t),this.wpstgObject=r,this.fetchExcludeSettingsAction=n,this.modalErrorAction=s,this.resetButtonClass="wpstg-confirm-reset-clone",this.resetModalContainerClass="wpstg-reset-confirmation",this.resetTabSelector=".wpstg-reset-exclude-tab",this.directoryNavigator=null,this.excludeFilters=null,this.tableSelector=null,this.isNetworkClone=!1}var t=e.prototype;return t.addEvents=function(){var e=this,t=a("."+this.resetModalContainerClass);null!==t?l(t,"click",this.resetTabSelector,(function(t){e.toggleContent(t)})):console.log("Exit")},t.init=function(){this.addEvents()},t.setNetworkClone=function(e){this.isNetworkClone=e},t.toggleContent=function(e){var t=a("."+this.resetModalContainerClass),n=e.getAttribute("data-id"),s=e.querySelector(".wpstg-tab-triangle"),r=e.getAttribute("data-collapsed","true"),o=a(n);"true"===r?(t.classList.contains("has-collapsible-open")?t.classList.add("has-collapsible-open-2"):t.classList.add("has-collapsible-open"),u(o),s.style.transform="rotate(90deg)",e.setAttribute("data-collapsed","false")):(t.classList.contains("has-collapsible-open-2")?t.classList.remove("has-collapsible-open-2"):t.classList.remove("has-collapsible-open"),p(o),s.style.removeProperty("transform"),e.setAttribute("data-collapsed","true"))},t.showModal=function(){var e=this.loadModal();return this.init(),this.fetchCloneExcludes(),e},t.loadModal=function(){return H.getSwalModal(!1,{confirmButton:this.resetButtonClass+" wpstg-confirm-reset-clone wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",container:this.resetModalContainerClass+" wpstg-swal2-container wpstg-swal2-loading"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"400px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.reset.confirm_button,showCancelButton:!0})},t.fetchCloneExcludes=function(){var e=this;this.error=null,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.fetchExcludeSettingsAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,job:"resetting"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(t.success){var n=a(".wpstg-reset-confirmation");n.classList.remove("wpstg-swal2-loading"),n.querySelector(".wpstg--swal2-popup").style.width="540px",n.querySelector(".wpstg--swal2-content").innerHTML=t.html,e.directoryNavigator=new W("#wpstg-directories-listing",wpstg,null),e.directoryNavigator.countSelectedFiles(),e.excludeFilters=new z,e.tableSelector=new G("#wpstg-reset-excluded-tables","."+e.resetModalContainerClass),e.tableSelector.setNetworkClone(e.isNetworkClone),e.tableSelector.countSelectedTables()}else{new J(e.modalErrorAction,e.wpstgObject).show(Object.assign({title:"Error",icon:"error",html:e.wpstgObject.i18n.something_went_wrong,width:"500px",confirmButtonText:e.wpstgObject.i18n.ok,showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},t.swalOptions),{type:t.type})}})).catch((function(t){e.renderError({html:e.wpstgObject.i18n.something_went_wrong+" "+t})}))},t.getDirectoryNavigator=function(){return this.directoryNavigator},t.getExcludeFilters=function(){return this.excludeFilters},t.getTableSelector=function(){return this.tableSelector},t.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><span class="wpstg-loader"></span></div>'},e}(),Q=function(){function e(e){void 0===e&&(e="#wpstg-clonepage-wrapper"),this.baseContainer=a(e),this.checkBoxSettingTogglerSelector=".wpstg-toggle-advance-settings-section",this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.baseContainer&&l(this.baseContainer,"change",this.checkBoxSettingTogglerSelector,(function(t){e.toggleSettings(t)}))},t.init=function(){this.addEvents()},t.toggleSettings=function(e){var t=a("#"+e.getAttribute("data-id"));e.checked?u(t):p(t)},e}(),Y=function(){function e(){this.activeTabClass="wpstg--tab--active",this.mainMenu()}var t=e.prototype;return t.mainMenu=function(){var e=this;if(null!==a(".wpstg--tab--header")){var t=a("#wpstg-workflow");null!==t&&l(t,"click",".wpstg-navigate-button",(function(e){var t=e.getAttribute("data-target");""!==t&&"#wpstg--tab--backup"===t&&a('.wpstg--tab--header a[data-target="#wpstg--tab--backup"]').click()})),l(a(".wpstg--tab--header"),"click",".wpstg-button:not(.wpstg-navigation-menu-mobile .wpstg-button)",(function(t){var n=t,s=n.getAttribute("data-target");if(""!==s)if("#wpstg--tab--staging"!==s&&"#wpstg--tab--backup"!==s){H.resetErrors();var r=c(s),o=c(".wpstg--tab--header a[data-target]");c(".wpstg--tab--contents > .wpstg--tab--content").forEach((function(t){t.matches("."+e.activeTabClass+":not("+s+")")&&t.classList.remove(e.activeTabClass)})),o.forEach((function(t){t!==n&&t.classList.remove(e.activeTabClass)})),n.classList.add(e.activeTabClass),r.forEach((function(t){t.classList.add(e.activeTabClass)})),"#wpstg--tab--backup"===s&&window.dispatchEvent(new Event("backups-tab"))}else window.location.reload()})),l(a(".wpstg--tab--header"),"click",".wpstg-navigation-menu-mobile .wpstg-button",(function(t){var n=t,s=n.getAttribute("data-target-id");if(s){var r=a("#"+s);r?r.click():window.location.href=n.getAttribute("data-target-url");var o=document.getElementById("wpstg-navbar-menu");o&&o.classList.toggle("hidden"),c(".wpstg--tab--header a[data-target-id]").forEach((function(t){t!==n&&t.classList.remove(e.activeTabClass)})),n.classList.add(e.activeTabClass)}})),window.addEventListener("resize",(function(){e.adjustWrapperWidth()})),this.adjustWrapperWidth()}},t.adjustWrapperWidth=function(){var e=window.innerWidth,t=document.getElementById("wpstg-clonepage-wrapper");e>640?t.style.width="100%":e<=640&&e>=480?t.style.width=68+22*(e-480)/160+"%":e<480&&e>=320?t.style.width=47+18*(e-320)/160+"%":e<320&&(t.style.width=30+20*e/320+"%"),document.querySelector(".wpstg-navbar-toggler").style.padding=e<640?"15px":"12px 15px 12px 15px"},e}(),K=function(e){var t,n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,s){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),a=new j(s||[]);return r(i,"_invoke",{value:C(e,n,a)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",g="suspendedYield",h="executing",w="completed",f={};function m(){}function v(){}function b(){}var y={};l(y,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(P([])));k&&k!==n&&s.call(k,i)&&(y=k);var _=b.prototype=m.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(r,o,i,a){var c=p(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&s.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,a)}),(function(e){n("throw",e,i,a)})):t.resolve(u).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,a)}))}a(c.arg)}var o;r(this,"_invoke",{value:function(e,s){function r(){return new t((function(t,r){n(e,s,t,r)}))}return o=o?o.then(r,r):r()}})}function C(e,t,n){var s=d;return function(r,o){if(s===h)throw new Error("Generator is already running");if(s===w){if("throw"===r)throw o;return I()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var a=T(i,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=w,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=h;var c=p(e,t,n);if("normal"===c.type){if(s=n.done?w:g,c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=w,n.method="throw",n.arg=c.arg)}}}function T(e,n){var s=n.method,r=e.iterator[s];if(r===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),f;var o=p(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,f;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function P(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(s.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:I}}function I(){return{value:t,done:!0}}return v.prototype=b,r(_,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,c,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},S(E.prototype),l(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,s,r,o){void 0===o&&(o=Promise);var i=new E(u(t,n,s,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(_),l(_,c,"Generator"),l(_,i,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=P,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(s,r){return a.type="throw",a.arg=e,n.next=s,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=s.call(i,"catchLoc"),l=s.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var r=s.arg;M(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:P(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),f}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=K}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=K:Function("r","regeneratorRuntime = r")(K)}var Z=new(function(){function e(){this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}var t=e.prototype;return t.setCallbackOnHide=function(e){this.callbackOnHide=e},t.shows=function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()},t.addUnloadEvent=function(){window.addEventListener("beforeunload",(function(e){e.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))},t.createIframeElement=function(){var e=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return e.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement},t.handleIframeLoad=function(){var e,t;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{e=(t=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(e){return void this.handleIframeLoadError()}t&&e?t.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=e+40+"px":this.handleIframeLoadError()},t.handleIframeLoadError=function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()},t.openModal=function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")},t.focusIframe=function(){this.iframeElement.focus()},t.setIframeLoadTimeout=function(){var e=this;setTimeout((function(){e.isIframeLoaded||(e.wrapElement.classList.add("fallback"),e.formElement.remove(),e.noFrameElement.focus())}),2e3)},t.focusFallbackElement=function(){this.noFrameElement.focus()},t.hide=function(){var e,t;window.removeEventListener("beforeunload",(function(e){e.returnValue=null})),e=this.wrap,void 0===(t=200)&&(t=300),e.style.opacity=1,e.style.transitionProperty="opacity",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.opacity=0,window.setTimeout((function(){e.style.display="none",e.style.removeProperty("opacity"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0),this.callbackOnHide&&this.callbackOnHide()},e}()),X=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.count=0,this.status=!0,this.isAuthenticated=!0}var t=e.prototype;return t.start=function(){var e=this;this.status&&setTimeout((function(){e.checkUserAuthentication()}),1e3)},t.stop=function(){this.resetCount(),this.status=!1},t.resetCount=function(){this.count=0},t.checkUserAuthentication=function(){var e=n(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(!1===e.wpAuthCheck&&t.count++,t.isAuthenticated=e.wpAuthCheck,2===t.count)return t.stop(),void t.createAuthCheckElements(e.redirectUrl);t.start()})).catch((function(e){console.error("Error:",e)}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.createAuthCheckElements=function(e){var t=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var n=document.createElement("div");n.id="wpstg-auth-check-wrap",n.classList.add("hidden");var s=document.createElement("div");s.id="wpstg-auth-check-bg";var r=document.createElement("div");r.id="wpstg-auth-check";var o=document.createElement("div");o.id="wpstg-auth-check-form",o.classList.add("loading"),o.dataset.src=e+"?interim-login=1&wp_lang=en_US";var i=document.createElement("div");i.classList.add("wpstg-auth-fallback");var a=document.createElement("p");a.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var c=document.createElement("p");c.innerHTML='<a href="'+e+'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.';var l=document.createElement("button");l.type="button",l.classList.add("wpstg-auth-check-close","button-link"),l.innerHTML='<span class="screen-reader-text">Close dialog</span>',l.addEventListener("click",(function(){n.classList.add("hidden")})),r.append(l,o,i),i.append(a,c),n.append(s,r),document.body.appendChild(n),Z.setCallbackOnHide((function(){t.checkUserAuthentication()})),Z.shows()},e}(),ee=new X,te=function(){function e(e){var t=this;void 0===e&&(e=wpstg),this.wpstgObject=e,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval=null,this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl="",this.shouldSetupTimerInterval=!0,this.processStartTime=null,document.addEventListener("visibilitychange",n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(document.hidden){e.next=3;break}return e.next=3,t.maybeUpdateElapsedTimeFromLogs();case 3:case"end":return e.stop()}}),e)}))))}var t=e.prototype;return t.setSetupTimerInterval=function(e){this.shouldSetupTimerInterval=e},t.maybeSetupTimerInterval=function(){var e=this;if(this.shouldSetupTimerInterval){this.processStartTime=Date.now();var t=function(){if(!document.hidden&&(ee.isAuthenticated||"wpstg_push_processing"===e.action)){var n=Date.now();e.processTime=Math.floor((n-e.processStartTime)/1e3),e.updateElapsedTime()}null!==e.processInterval&&requestAnimationFrame(t)};requestAnimationFrame(t),this.processInterval=setInterval((function(){if(document.hidden&&(ee.isAuthenticated||"wpstg_push_processing"===e.action)){var t=Date.now();e.processTime=Math.floor((t-e.processStartTime)/1e3),e.updateElapsedTime()}}),1e3)}},t.start=function(){(this.showCancelButton=!0,this.maybeSetupTimerInterval(),"wpstg_delete_clone"===this.action)&&(f(".wpstg--process-modal--logs-button"),this.showCancelButton=!1,H.getSwalContainer().querySelector(".wpstg--process-modal--percent").textContent=100);"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||(ee.status=!0,ee.start()),f(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),f(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")},t.stop=function(){this.processTime=0,this.processStartTime=null,this.modal=null,this.percentage="",this.resetCancelChecks(),this.processInterval&&(clearInterval(this.processInterval),this.processInterval=null),H.closeSwalModal(),y(),f("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader"),"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||ee.stop()},t.resetCancelChecks=function(){var e=this;null!==document.getElementById("wpstg-new-clone")?(setTimeout((function(){e.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),C()):setTimeout((function(){e.resetCancelChecks()}),1e3)},t.cancelProcess=function(){confirm(this.wpstgObject.i18n.module_process_modal.cancel_process_confirm)&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(H.getSwalContainer().querySelector(".wpstg--process-modal--title").textContent=this.wpstgObject.i18n.module_process_modal.cancel_process_text,this.stop(),m("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())},t.setTitle=function(e){this.title=e.job,"database"===e.job||"jobCopyDatabaseTmp"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_database,this.disableCancelButton=!1):"SearchReplace"===e.job||"jobSearchReplace"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_search_replace,this.disableCancelButton=!1):"PreserveDataSecondStep"===e.job||"PreserveDataFirstStep"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_preserve_data,this.disableCancelButton=!1):"directories"===e.job||"jobFileScanning"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_scanning_files,this.disableCancelButton=!1):"files"===e.job||"data"===e.job||"jobCopy"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_files,this.disableCancelButton=!1):"Backup"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_backup_files_scanning,this.disableCancelButton=!1):"finish"===e.job||"finished"===e.status?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_process_finished,this.disableCancelButton=!1):"jobDatabaseRename"===e.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_renaming_database,this.disableCancelButton=!0):"jobData"===e.job&&(this.title=this.wpstgObject.i18n.module_process_modal.set_title_updating_database_data,this.disableCancelButton=!0)},t.setPercentage=function(e){null!==e.percentage&&(this.percentage=e.percentage)},t.initializeProcessModal=function(e){var t=this;void 0===e&&(e=null);var n=document.getElementById("wpstg--process-modal");if(n){null===e&&(e=this.showCancelButton);var s=n.innerHTML;n.remove(),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:H.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:s,cancelButtonText:this.wpstgObject.i18n.cancel,showCancelButton:e,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var e=H.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(){t.cancelProcess()}));var s=H.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0],r=s.cloneNode(!0);s.parentNode.replaceChild(r,s),r.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}})},this.start()}},t.setProcessModal=function(){var e=H.getSwalContainer(),t=e.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.querySelector(".wpstg--process-modal--title"),s=e.querySelector(".wpstg--process-modal--percent");n.textContent=this.title,s.textContent=this.percentage,t.disabled=this.disableCancelButton},t.openProcessModal=function(e,t,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0),this.isProcessCancelled||WPStaging.isCancelled||(void 0!==e&&(this.action=e.action,this.cloneId=e.cloneID),this.showCancelButton=s,this.showLogs=n,this.modal?t.job?(this.setTitle(t),this.setPercentage(t),this.setProcessModal(),"finish"===t.job&&this.stop()):"finished"===t.status&&this.stop():(H.resetErrors(),this.initializeProcessModal()))},t.updateElapsedTime=function(){null!==this.processInterval&&(H.getSwalContainer().querySelector(".wpstg--process-modal--elapsed-time").textContent=M(this.processTime))},t.getCancelCloneAction=function(){var e=this;if(""!==this.action){var t=[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(t){return t.name===e.action}));return null==t?void 0:t.cancel}},t.cancelCloneAction=function(){var e=n(o().mark((function e(){var t,n,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.action){e.next=2;break}return e.abrupt("return");case 2:try{null!==WPStaging.onGoingRequest&&(WPStaging.onGoingRequest.abort(),WPStaging.onGoingRequest=null)}catch(e){console.error(this.wpstgObject.i18n.something_went_wrong,e),WPStaging.onGoingRequest=null}return e.prev=3,e.next=6,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:null!=(t=this.getCancelCloneAction())?t:"wpstg_cancel_clone",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){(e&&void 0!==e.delete&&"finished"===e.delete||!0===e)&&(s.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==e&&s.cancelCloneAction()})).catch((function(e){console.log(s.wpstgObject.i18n.something_went_wrong,e)}));case 6:(n=e.sent).ok||(console.error(this.wpstgObject.i18n.something_went_wrong,n),this.stop()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(this.wpstgObject.i18n.something_went_wrong,e.t0),this.stop();case 14:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),t.initializeSuccessModal=function(){var e=n(o().mark((function e(t){var n,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setSuccessModalContent(t);case 2:this.successModal=e.sent,(n=document.getElementById("wpstg-workflow"))&&(n.innerHTML=""),H.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=H.getSwalContainer().querySelector(".wpstg--success-modal--logs-button"),t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(e){e.value&&(H.closeSwalModal(),f(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),"wpstg_push_processing"===s.action&&(localStorage.setItem("wpstgPushProcessCompleted","true"),location.reload()),"wpstg_delete_clone"!==s.action&&WPStaging.loadOverview(),s.action="")})),this.showProcessLogs&&m(".wpstg--success-modal--logs-wrapper"),f(".wpstg-loader");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.setSuccessModalContent=function(){var e=n(o().mark((function e(t){var n,s,r,i,a,c,l,u,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("wpstg--success-modal"),null!==t.title&&(n.innerHTML=n.innerHTML.replace("{title}",t.title)),this.showProcessLogs&&(n.innerHTML=n.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null===t.body||void 0===t.body){e.next=20;break}if(s=t.body,null===this.stagingSiteUrl){e.next=15;break}if(i=this.stagingSiteUrl,"wpstg_cloning"!==this.action||"undefined"==typeof wpstgPro||"function"!=typeof(null==(r=wpstgPro)?void 0:r.saveGeneratedLinkData)){e.next=14;break}return a=Date.now().toString(),c=this.cloneId,e.next=12,wpstgPro.saveGeneratedLinkData({cloneID:c,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:a});case 12:null!=(l=e.sent)&&l.success&&(i=this.stagingSiteUrl+"/?wpstg_login="+a);case 14:s+='<br><strong><a href="'+i+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>";case 15:"wpstg_push_processing"===this.action&&(s+='<a href="https://wp-staging.com/refresh-and-clear-cache/" target="_blank">How to delete the cache.</a>',(u=n.querySelector(".wpstg--success-modal--text"))&&u.classList.add("wpstg--red")),"wpstg_cloning"===this.action&&(p=n.querySelector(".wpstg-rate-us"))&&p.classList.add("show"),n.innerHTML=n.innerHTML.replace("{text}",s+"<br/><br/>"),e.next=21;break;case 20:n.innerHTML=n.innerHTML.replace("{text}","");case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.openSuccessModal=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),this.stagingSiteUrl=n,this.showProcessLogs=t,this.initializeSuccessModal(e)},t.logEventFailure=function(){var e=n(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=""),e.prev=1,e.next=4,j("wpstg_log_event_failure",{process:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error(wpstg.i18n.something_went_wrong,e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),t.openErrorModal=function(){var e=n(o().mark((function e(t,n){var s,r,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),this.stop(),f(".wpstg-loader"),k("hidden"),this.showProcessLogs=!0,n||(n="Memory exhaust issue is detected during the process"),e.next=9,this.setSuccessModalContent({title:"Error",body:n});case 9:this.successModal=e.sent,(s=document.getElementById("wpstg-workflow"))&&(s.innerHTML=""),H.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"error",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=H.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(e){e.value&&(H.closeSwalModal(),f(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.loadOverview(),i.action="")})),m(".wpstg--success-modal--logs-wrapper"),(r=H.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0])&&(r.click(),document.querySelectorAll(".wpstg--logs--body").forEach((function(e){e.scrollTop=e.scrollHeight})));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.logEventSuccess=function(){var e=n(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=""),e.next=3,j("wpstg_log_event_success",{process:t});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.convertTimeStringToSeconds=function(){var e=n(o().mark((function e(t){var n,s,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",0);case 2:return n=t.slice(0,-1).split(":").map(Number),s=n[0],r=n[1],i=n[2],e.abrupt("return",3600*s+60*r+i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.maybeUpdateElapsedTimeFromLogs=function(){var e=n(o().mark((function e(){var t,n,s,r,i,a,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(s=window.WPStaging.wpstgProcessLogs.getLogs())&&null!=(t=s.all)&&t.length){e.next=3;break}return e.abrupt("return");case 3:if(r=null==(n=H.getSwalContainer())?void 0:n.querySelector(".wpstg--process-modal--elapsed-time")){e.next=6;break}return e.abrupt("return");case 6:return i=new Date(s.all[0].date),a=new Date(s.all[s.all.length-1].date),c=Math.floor((a-i)/1e3),e.next=11,this.convertTimeStringToSeconds(r.textContent);case 11:if(l=e.sent,!(this.processTime===l||c<l)){e.next=14;break}return e.abrupt("return");case 14:r.textContent=M(c);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e}();new(function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.wpstgBackupNoticeCloseButton=null,this.wpstgBackupNoticeReminderButton=null,this.init()}var t=e.prototype;return t.init=function(){var e=this;document.addEventListener("DOMContentLoaded",(function(){e.wpstgBackupNoticeCloseButton=document.getElementById("wpstg-backup-plugin-notice-close"),e.wpstgBackupNoticeReminderButton=document.getElementById("wpstg-backup-plugin-notice-remind-me"),e.addEvent()}))},t.addEvent=function(){var e=this;null!==this.wpstgBackupNoticeCloseButton&&this.wpstgBackupNoticeCloseButton.addEventListener("click",(function(){e.closeBackupPluginNotice()})),null!==this.wpstgBackupNoticeReminderButton&&this.wpstgBackupNoticeReminderButton.addEventListener("click",(function(){e.closeBackupPluginNotice("wpstg_backup_plugin_notice_remind_me")}))},t.closeBackupPluginNotice=function(e){void 0===e&&(e="wpstg_backup_plugin_notice_close"),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){e.success&&(a(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){f(".wpstg-backup-plugin-notice-container")}),500))})).catch((function(e){a(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){f(".wpstg-backup-plugin-notice-container")}),500)}))},e}());var ne=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.wpstgPurgeBackupQueueButton=a("#wpstg-purge-backup-queue-btn"),this.init()}var t=e.prototype;return t.init=function(){var e=this;null!==this.wpstgPurgeBackupQueueButton&&this.wpstgPurgeBackupQueueButton.addEventListener("click",(function(){e.confirmAndProceedPurge()}))},t.confirmAndProceedPurge=function(){var e=this;H.getSwalModal(!0,{container:"wpstg-swal-push-container",confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_title,icon:"warning",html:"<p>"+this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_html.replace("%s","<code>"+this.wpstgObject.tblprefix+"wpstg_queue</code>")+"</p>",width:"550px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.system_info.confirm_button_text,showCancelButton:!0}).then((function(t){t.isConfirmed&&e.ajaxPurgeQueueTable()}))},t.ajaxPurgeQueueTable=function(){var e=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_purge_queue_table",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(t.ok)return t.json();404===t.status&&b("error",e.wpstgObject.i18n.something_went_wrong+e.wpstgObject.i18n.ajax_status_code_404),500===t.status&&b("error",e.wpstgObject.i18n.something_went_wrong+e.wpstgObject.i18n.status_code_500)})).then((function(e){e.success&&!0===e.success&&b("success",e.message),e.success&&!1===e.success&&b("error",e.message)})).catch((function(t){b("error",e.wpstgObject.i18n.something_went_wrong+" "+t),console.warn(e.wpstgObject.i18n.something_went_wrong,t)}))},e}(),se=function(){function e(){this.init()}var t=e.prototype;return t.init=function(){this.wpstdStagingTab=document.querySelector("#wpstg--tab--toggle--staging"),this.wpstdBackupTab=document.querySelector("#wpstg--tab--toggle--backup"),this.wpstdSidebarMenu=document.querySelector("#toplevel_page_wpstg_clone"),this.addEvents(),setTimeout((function(){k("hidden")}),5e3)},t.addEvents=function(){var e=this;null!==this.wpstdStagingTab&&this.wpstdStagingTab.addEventListener("click",(function(){e.setPageUrl("wpstg_clone"),e.setSidebarMenu("wpstg_clone")})),null!==this.wpstdBackupTab&&this.wpstdBackupTab.addEventListener("click",(function(){e.setPageUrl("wpstg_backup"),e.setSidebarMenu("wpstg_backup")})),"wpstg-tools"===_()&&new ne,"wpstg-settings"===_()&&"temporary-login"===L()&&this.setSidebarMenu("wpstg-settings&tab=temporary-login")},t.setPageUrl=function(e){window.history.pushState(null,null,window.location.pathname+"?page="+e)},t.setSidebarMenu=function(e){var t=this.wpstdSidebarMenu.querySelector("ul").querySelectorAll("li");if(t.length>0)for(var n=0;n<t.length;n++)t[n].classList.remove("current"),null!==t[n].querySelector("a")&&t[n].querySelector("a").getAttribute("href")==="admin.php?page="+e&&t[n].classList.add("current")},e}(),re=function(){function e(e){var t=this;void 0===e&&(e=wpstg),this.wpstgObject=e,document.addEventListener("DOMContentLoaded",n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.body=document.querySelector("body"),e.next=3,t.init();case 3:t.observeDOMChanges();case 4:case"end":return e.stop()}}),e)}))))}var t=e.prototype;return t.observeDOMChanges=function(){var e=this;this.observer=new MutationObserver((function(t){t.forEach((function(t){"childList"===t.type&&t.addedNodes.length>0&&e.triggerRenderEvent()}))})),this.observerConfig={childList:!0,subtree:!0},this.observer.observe(document.documentElement,this.observerConfig)},t.triggerRenderEvent=function(){var e=this,t=this.body.classList.contains("wpstg-dark");document.querySelectorAll(".wpstg--dashicons").forEach((function(n){var s,r=(void 0===(s=n.src)&&(s=""),""===s?"":s.split("/").pop());""!==r&&!n.src.includes("dark/")&&t&&(n.src=e.wpstgObject.assetsUrl+"svg/dark/"+r),""!==r&&n.src.includes("dark/")&&!t&&(n.src=e.wpstgObject.assetsUrl+"svg/"+r)}))},t.setButtonAsActive=function(e){if("wpstg-welcome"!==_()){["dark","light","system"].forEach((function(e){document.querySelector(".wpstg-"+e+"-mode-container").classList.remove("active")})),document.querySelector(".wpstg-"+e+"-mode-container").classList.add("active");var t="dark"===e||"system"===e&&"dark"===this.defaultOsColorMode?"#E3DCFF":"#e9e9e9";document.querySelectorAll(".wpstg-color-mode-container > div").forEach((function(e){e.style.border="1px solid "+t}))}},t.updateFooterLogo=function(){var e=this.body.classList.contains("wpstg-dark")?"img/dark-logo.svg":"img/logo.svg",t=document.querySelector(".wpstg-footer-logo a");if(t){var n=t.querySelector("img");n&&(n.src=this.wpstgObject.assetsUrl+e)}this.triggerRenderEvent()},t.updateBodyClass=function(e){"dark"===e||"system"===e&&"dark"===this.defaultOsColorMode?this.body.classList.add("wpstg-dark"):this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()},t.setButtonsEventListeners=function(){var e=this;this.systemModeButton=document.querySelector("#wpstg-system-mode-button"),this.lightModeButton=document.querySelector("#wpstg-light-mode-button"),this.darkModeButton=document.querySelector("#wpstg-dark-mode-button"),null!==this.systemModeButton&&null!==this.lightModeButton&&null!==this.darkModeButton&&(this.systemModeButton.addEventListener("click",n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("system");case 2:e.setButtonAsActive("system");case 3:case"end":return t.stop()}}),t)})))),this.lightModeButton.addEventListener("click",n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("light");case 2:e.setButtonAsActive("light");case 3:case"end":return t.stop()}}),t)})))),this.darkModeButton.addEventListener("click",n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setMode("dark");case 2:e.setButtonAsActive("dark");case 3:case"end":return t.stop()}}),t)})))))},t.init=function(){var e=n(o().mark((function e(){var t,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.matchMedia("(prefers-color-scheme: dark)"),this.defaultOsColorMode=t.matches?"dark":"light",this.setButtonsEventListeners(),e.next=5,this.setDefaultOsColorMode();case 5:t.addEventListener("change",function(){var e=n(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.defaultOsColorMode=t.matches?"dark":"light",e.next=3,s.setDefaultOsColorMode();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.setMode=function(){var e=n(o().mark((function e(t){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_dark_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,mode:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((n=e.sent).ok){e.next=7;break}return b("error",this.wpstgObject.i18n.something_went_wrong),e.abrupt("return");case 7:return e.next=9,n.json();case 9:if(!1!==(s=e.sent).success||!s.data){e.next=13;break}return b("error",s.data),e.abrupt("return");case 13:this.updateBodyClass(t),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),t.setDefaultOsColorMode=function(){var e=n(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_default_os_color_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,defaultOsColorMode:this.defaultOsColorMode}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((t=e.sent).ok){e.next=7;break}return b("error",this.wpstgObject.i18n.something_went_wrong),e.abrupt("return");case 7:return e.next=9,t.json();case 9:if((n=e.sent).data&&n.data.defaultColorMode&&this.setButtonAsActive(n.data.defaultColorMode),!n.success||"dark"!==n.data.defaultColorMode){e.next=15;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),e.abrupt("return");case 15:if(!n.success||"dark"!==this.defaultOsColorMode||"system"!==n.data.defaultColorMode){e.next=19;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),e.abrupt("return");case 19:n.success&&this.body.classList.contains("wpstg-dark")&&(this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,e.t0);case 25:case"end":return e.stop()}}),e,this,[[0,22]])})));return function(){return e.apply(this,arguments)}}(),e}();new re;var oe,ie,ae=function(){function e(){this.messages={WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",INFO_SUB:"info_sub",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},this.stoppingTypes=[this.messages.ERROR,this.messages.CRITICAL]}var t=e.prototype;return t.resetLogs=function(){this.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[],info_sub:[]}},t.getLogs=function(){return this.messages.data},t.shouldStop=function(e){return this.stoppingTypes.includes(e.toLowerCase())},t.logMessages=function(e){var t=this,n=H.getSwalContainer(),s=function(e){var s,r;t.messages.data.all.find((function(t){return t.message===e.message}))||(e.type=null==e||null==(s=e.type)?void 0:s.toLowerCase(),t.messages.data.all.push(e),null==(r=t.messages.data[e.type])||r.push(e),null!==n&&t.renderLogs(e))};Array.isArray(e)?e.forEach((function(e){return e&&s(e)})):e&&s(e),document.querySelectorAll(".wpstg--logs--body").forEach((function(e){e.scrollTop=e.scrollHeight}))},t.renderLogs=function(e){var t,n=this;""===e&&(e=this.messages.data.all);var s=null==(t=H.getSwalContainer())?void 0:t.querySelector(".wpstg--logs--container");s&&(Array.isArray(e)?e.forEach((function(e){n.appendLogRow(s,e)})):this.appendLogRow(s,e))},t.appendLogRow=function(e,t){var n,s=e.querySelector(".wpstg--logs-table--body");if(s){var r=s.querySelector(".wpstg--logs-table--template-row");if(r){var o=r.cloneNode(!0);o.classList.remove("wpstg--logs-table--template-row");var i=null==t||null==(n=t.type)?void 0:n.toLowerCase(),a=e.querySelector(".wpstg--logs--selector").value;(a===i||"all"===a||a===this.messages.INFO&&i===this.messages.INFO_SUB)&&o.classList.remove("hidden"),o.classList.add("wpstg--logs--row-"+i);var c=s.querySelectorAll("tr"),l=c[c.length-1];i===this.messages.INFO_SUB&&l.classList.contains("wpstg--logs--row-info")&&l.classList.add("wpstg-no-border"),i===this.messages.INFO&&l.classList.contains("wpstg--logs--row-info_sub")&&l.classList.add("wpstg--logs--row-last");var u,p=o.querySelectorAll("td");if(i===this.messages.INFO_SUB){var d=document.createElement("div");return d.innerHTML=t.message,p[3].textContent=d.textContent||d.innerText,d.remove(),s.appendChild(o),void this.updateLogCounter(e,i)}if(4===p.length){p[0].classList.add("wpstg--logs--icon-"+i),p[1].textContent=0===(u=t.type).length?u:u.toLowerCase().split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" "),p[1].classList.add("wpstg--logs--log-"+i),p[2].textContent=t.date;/https?:\/\/[^\s<>"']+/i.test(t.message)?p[3].innerHTML=t.message.replace(/((https?:\/\/[^\s<>"']+))/g,(function(e){return'<a href="'+e+'" target="_blank" rel="noopener noreferrer">'+e+"</a>"})):p[3].textContent=t.message}s.appendChild(o),this.updateLogCounter(e,i)}}},t.updateLogCounter=function(e,t){var n=e.querySelector(".wpstg--logs--counter-"+t);if(n){var s=parseInt(n.textContent,10);n.textContent=isNaN(s)?1:s+1;var r=e.querySelector(".wpstg--logs--button-"+t);null==r||r.classList.remove("hidden")}},t.resetLogContainer=function(e){var t=e.querySelector(".wpstg--logs-table--body");t&&(t.querySelectorAll("tr").forEach((function(e){e.classList.contains("wpstg--logs-table--template-row")||e.remove()})),Object.values(this.messages).forEach((function(t){if("object"!=typeof t||null===t){var n=e.querySelector(".wpstg--logs--counter-"+t);n&&(n.textContent="0");var s=e.querySelector(".wpstg--logs--button-"+t);null==s||s.classList.add("hidden")}})))},t.toggleProcessLogs=function(e){void 0===e&&(e=null);var t=H.getSwalContainer(),n=t.querySelector(".wpstg--logs--container");if(n){this.resetLogContainer(n),this.renderLogs("");var s="block"===n.style.display;n.style.display=s?"none":"block",e&&(e.textContent=s?wpstg.i18n.show_logs:wpstg.i18n.hide_logs),t.childNodes[0].style.width=s?"600px":"97%",t.style.zIndex=9999,n.classList.contains("wpstg--process-modal--logs")&&this.adjustProcessLogsWindow(t),this.addEvents(t)}},t.addEvents=function(e){var t=this;e||(e=H.getSwalContainer()),e.querySelector(".wpstg--logs--selector").addEventListener("change",(function(n){t.filterLogs(e,n)})),e.querySelector(".wpstg--logs--button-info").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.INFO)})),e.querySelector(".wpstg--logs--button-debug").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.DEBUG)})),e.querySelector(".wpstg--logs--button-warning").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.WARNING)})),e.querySelector(".wpstg--logs--button-error").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.ERROR)})),e.querySelector(".wpstg--logs--button-critical").addEventListener("click",(function(e){t.filterLogsByButton(e,t.messages.CRITICAL)}))},t.filterLogsByButton=function(e,t){var n=e.target.closest(".wpstg--logs--header").querySelector(".wpstg--logs--selector");n.value=t;var s=new Event("change");n.dispatchEvent(s)},t.filterLogs=function(e,t){var n=this,s=t.target.value;e.querySelectorAll(".wpstg--logs-table--body tr").forEach((function(e){("all"===s||e.classList.contains("wpstg--logs--row-"+s)||s===n.messages.INFO&&e.classList.contains("wpstg--logs--row-"+n.messages.INFO_SUB))&&!e.classList.contains("wpstg--logs-table--template-row")?e.classList.remove("hidden"):e.classList.add("hidden")})),t.target.closest(".wpstg--logs--header").querySelectorAll("button").forEach((function(e){"all"==s||e.classList.contains("wpstg--logs--button-"+s)?e.style.setProperty("--wpstg-logs-button-before-display","inline-block"):e.style.setProperty("--wpstg-logs-button-before-display","none")}))},t.adjustProcessLogsWindow=function(e){var t=e.querySelector(".wpstg--swal2-html-container"),n=e.querySelector(".wpstg--logs--container"),s=e.querySelector(".wpstg--logs--body");if("block"===n.style.display)return t.style.setProperty("padding","0 2em","important"),n.style.setProperty("height","350px"),void s.style.setProperty("height","300px");t.style.setProperty("padding","4em 2em","important"),n.style.setProperty("height","300px"),s.style.setProperty("height","250px")},t.shouldWarn=function(){return this.messages.data.error.length>0||this.messages.data.critical.length>0},e}(),ce={showLogs:!0,onClose:null,show:(oe=n(o().mark((function e(t,n){var s,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0===n&&(n="success"),r="success"===n?"wpstg-green-button":"",H.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-button wpstg-link-btn "+r}).fire({icon:n,html:t.innerHTML,confirmButtonText:null==(s=wpstg)||null==(s=s.i18n)?void 0:s.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var e=H.getSwalContainer().querySelector(".wpstg--success-modal--logs-button");if(e){var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){e.preventDefault(),WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}}).then((function(e){e.value&&(H.closeSwalModal(),ce.onClose&&"function"==typeof ce.onClose&&ce.onClose())})),ce.showLogs&&m(".wpstg--success-modal--logs-wrapper");case 4:case"end":return e.stop()}}),e)}))),function(e,t){return oe.apply(this,arguments)}),getModalContent:function(e){var t,n=document.getElementById("wpstg--success-modal");(null!==e.title&&(n.innerHTML=n.innerHTML.replace("{title}",e.title)),ce.showLogs)?n.innerHTML=n.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">'+(null==(t=wpstg)||null==(t=t.i18n)?void 0:t.show_logs)+"</span>"):n.innerHTML=n.innerHTML.replace("{btnTxtLog}","");return n.innerHTML=n.innerHTML.replace("{text}",e.body),n}},le=function(){function e(e){void 0===e&&(e=".wpstg--process-modal--elapsed-time"),this.totalSeconds=0,this.interval=null,this.outputTimeSelector=e,this.processStartTime=null}var t=e.prototype;return t.start=function(){var e=this;if(null===this.interval){this.processStartTime=Date.now();var t=function(){if(!document.hidden){var n=Date.now();e.totalSeconds=Math.floor((n-e.processStartTime)/1e3),e.updateElapsedTime()}null!==e.interval&&requestAnimationFrame(t)};requestAnimationFrame(t),this.interval=setInterval((function(){if(document.hidden){var t=Date.now();e.totalSeconds=Math.floor((t-e.processStartTime)/1e3),e.updateElapsedTime()}}),1e3)}},t.stop=function(){this.totalSeconds=0,this.interval&&(clearInterval(this.interval),this.interval=null)},t.getTimeElapsed=function(){return this.totalSeconds},t.updateElapsedTime=function(){var e=this;document.querySelectorAll(this.outputTimeSelector).forEach((function(t){t.innerText=M(e.totalSeconds)}))},e}(),ue={processModal:new te,processModalLogs:new ae,timer:new le,isCancelled:!1,isFinished:!1,performingCancelRequest:!1,processInfo:{title:null,interval:null,maxTotalRetries:0,maxSequentialRetries:0,totalTimeRetried:0,sequentialRetried:0},job:{action:null,name:null,type:null},status:{hasResponse:null,reTryAfter:5e3,STATUS_FAIL:"JOB_FAIL"},onSuccess:function(){},incrementRetry:function(){ue.processInfo.totalTimeRetried++,ue.processInfo.sequentialRetried++},resetJob:function(){ue.resetRetry(),ue.isCancelled=!1,ue.isFinished=!1,ue.performingCancelRequest=!1},resetRetry:function(){ue.processInfo.totalTimeRetried=0,ue.processInfo.sequentialRetried=0},canRetry:function(){return!(ue.processInfo.totalTimeRetried>=ue.processInfo.maxTotalRetries)&&!(ue.processInfo.sequentialRetried>=ue.processInfo.maxSequentialRetries)},setJob:function(e){ue.job.action=e.action||null,ue.job.name=e.name||null,ue.job.type=e.type||null},statusStop:function(){var e;clearInterval(ue.processInfo.interval),ue.processInfo.interval=null,window.removeEventListener("beforeunload",null==(e=WPStaging)?void 0:e.warnIfClosingDuringProcess)},statusStart:function(){var e;null===ue.processInfo.interval&&(ue.processInfo.interval=setInterval(n(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==ue.isCancelled){e.next=3;break}return ue.statusStop(),e.abrupt("return");case 3:if(!1!==ue.status.hasResponse){e.next=5;break}return e.abrupt("return");case 5:return ue.status.hasResponse=!1,e.prev=6,e.next=9,j("wpstg--job--status",{type:ue.job.type,name:ue.job.name});case 9:if(t=e.sent,ue.status.hasResponse=!0,void 0===t&&ue.statusStop(),ue.processInfo.title!==t.currentStatusTitle){e.next=14;break}return e.abrupt("return");case 14:ue.processInfo.title=res.currentStatusTitle,(n=H.getSwalContainer()).querySelector(".wpstg--process-modal--title").innerText=res.currentStatusTitle,n.querySelector(".wpstg--process-modal--process-percent").innerText="0",e.next=24;break;case 20:e.prev=20,e.t0=e.catch(6),ue.status.hasResponse=!0,H.showAjaxFatalError(e.t0,"","Submit an error report.");case 24:case"end":return e.stop()}}),e,null,[[6,20]])}))),null!=(e=wpstg.jobStatusInterval)?e:5e3))},prepareJob:function(e,t,s){var r=this;return n(o().mark((function n(){var i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===t&&(t={}),void 0===s&&(s=null),ue.resetJob(),n.prev=3,n.next=6,j(e,t);case 6:if((i=n.sent)&&i.success){n.next=9;break}return n.abrupt("return",!1);case 9:return s&&window.dispatchEvent(new Event(s)),r.processModal.setSetupTimerInterval(!1),ue.timer.start(),n.abrupt("return",!0);case 15:return n.prev=15,n.t0=n.catch(3),console.warn(wpstgi18n.something_went_wrong,n.t0),b("warning",wpstgi18n.something_went_wrong),n.abrupt("return",!1);case 20:case"end":return n.stop()}}),n,null,[[3,15]])})))()},runJob:function(){return n(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H.resetErrors(),!ue.isCancelled){e.next=4;break}return ue.statusStop(),e.abrupt("return");case 4:return e.next=6,j(ue.job.action);case 6:if(t=e.sent){e.next=11;break}return e.next=10,ue.onJobFail();case 10:return e.abrupt("return");case 11:if(!ue.isCancelled){e.next=13;break}return e.abrupt("return");case 13:if(void 0!==t){e.next=17;break}return e.next=16,ue.onJobFail();case 16:return e.abrupt("return");case 17:if(ue.processResponse(t),ue.processInfo.interval||ue.statusStart(),!0!==t.isRunning){e.next=23;break}return ue.processInfo.sequentialRetried=0,ue.runJob(),e.abrupt("return");case 23:if(ue.processModal.stop(),ue.statusStop(),t.jobStatus!==ue.status.STATUS_FAIL){e.next=29;break}return e.next=28,ue.onJobFail(t);case 28:return e.abrupt("return");case 29:H.closeSwalModal(),"function"==typeof ue.onSuccess&&ue.onSuccess(t);case 31:case"end":return e.stop()}}),e)})))()},onJobFail:function(e){return n(o().mark((function t(){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e=null),t.next=3,ue.checkMemoryExhaustion(e,ue.job.name);case 3:if(!t.sent){t.next=6;break}return t.abrupt("return");case 6:if(ue.processInfo.canRetry()){t.next=14;break}return t.next=9,ue.processModal.logEventFailure(ue.job.name);case 9:return n={messages:[{type:"critical",message:"There was a PHP fatal error while processing this job. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}]},ue.processResponse(n),ue.cancel(),setTimeout(ue.logsModal,500),t.abrupt("return");case 14:return t.next=16,H.delay(wpstg.delayReq);case 16:return ue.processInfo.incrementRetry(),t.next=19,ue.runJob();case 19:case"end":return t.stop()}}),t)})))()},cancel:function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t=null),ue.timer.stop(),clearInterval(ue.processInfo.interval),ue.isCancelled=!0,ue.processInfo.interval=null,window.removeEventListener("beforeunload",null==(n=WPStaging)?void 0:n.warnIfClosingDuringProcess),H.closeSwalModal(),H.getSwalModal(!0).fire({title:wpstg.i18n.cancel_modal_title,text:wpstg.i18n.cancel_modal_text,icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){ue.sendCancelRequest(e,t,!0)}})},sendCancelRequest:function(e,t,s,r){return n(o().mark((function n(){var i,a,c;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===s&&(s=!1),void 0===r&&(r=10),!ue.performingCancelRequest){n.next=4;break}return n.abrupt("return");case 4:return ue.performingCancelRequest=!0,n.prev=5,i=s?"wpstg--job--prepare-cancel":"wpstg--job--cancel",n.next=9,I(i,e);case 9:if(a=n.sent,c=a.response,a.error,!(423===a.code&&r>0)){n.next=17;break}return ue.performingCancelRequest=!1,setTimeout((function(){ue.sendCancelRequest(e,t,s,r-1)}),3e3),n.abrupt("return");case 17:if(!s||null==c||!c.success){n.next=21;break}return ue.performingCancelRequest=!1,ue.sendCancelRequest(e,t),n.abrupt("return");case 21:if(ue.performingCancelRequest=!1,ue.isCancelled=!1,H.showAjaxFatalError(c,"",wpstg.i18n.submit_error_report),c.hasOwnProperty("isRunning")||H.showErrorModal(wpstg.i18n.cancel_modal_error),!0!==(null==c?void 0:c.isRunning)){n.next=28;break}return ue.sendCancelRequest(e,t),n.abrupt("return");case 28:ue.performingCancelRequest=!1,H.continueErrorHandle=!1,ee.stop(),H.closeSwalModal(),null!=t&&t(),n.next=43;break;case 35:n.prev=35,n.t0=n.catch(5),ue.performingCancelRequest=!1,H.continueErrorHandle=!1,ee.stop(),H.closeSwalModal(),H.showErrorModal(wpstg.i18n.cancel_modal_error),null!=t&&t();case 43:case"end":return n.stop()}}),n,null,[[5,35]])})))()},checkMemoryExhaustion:function(e,t){return n(o().mark((function n(){var s,r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,H.checkMemoryExhaustion(t);case 2:if(!1!==(s=n.sent)){n.next=5;break}return n.abrupt("return");case 5:r=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(r=' Read <a target="_blank" href="'+H.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),e.messages=[{type:"critical",date:s.data.time,message:s.message+"."+r}],ue.processResponse(e);case 9:case"end":return n.stop()}}),n)})))()},processResponse:function(e){if(null===e)throw H.closeSwalModal(),H.showError("Invalid Response; null"),new Error("Invalid Response; "+e);var t=H.getSwalContainer();(e.title||e.statusTitle)&&(t.querySelector(".wpstg--process-modal--title").innerText=e.title||e.statusTitle),e.percentage&&(t.querySelector(".wpstg--process-modal--percent").innerText=e.percentage),ue.addResponseMessagesToLog(e),e.jobId&&H.setJobId(e.jobId),!1===e.isRunning&&!0===e.job_done&&(ue.timer.stop(),ue.isCancelled=!0,e.status=!e.isRunning,window.dispatchEvent(new CustomEvent("wpstgJobDone",{response:e,job:ue.job})))},addResponseMessagesToLog:function(e){if(e.messages)for(var t,n=function(e){if(Array.isArray(e))for(var t,r=s(e);!(t=r()).done;){var o=t.value;n(o)}else e.type&&(ue.processModalLogs.logMessages(e),ue.processModalLogs.shouldStop(e.type)&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:e.message}})),ue.cancel({},(function(){setTimeout(ue.logsModal,500)}))))},r=s(e.messages);!(t=r()).done;){var o=t.value;o&&n(o)}},logsModal:function(){return n(o().mark((function e(){var t,n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),n=t?t.innerHTML:null,e.next=4,H.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'+n+"</div>",width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){H.getSwalContainer()[0].style["z-index"]=9999;var e=ue.processModalLogs.getLogs();e.all&&(ue.processModalLogs.renderLogs(e.all),ue.processModalLogs.addEvents())},onOpen:function(e){var t=$(e).find(".wpstg--process-modal--logs");t.scrollTop(t.scrollHeight)}});case 4:return(s=e.sent).value&&H.closeSwalModal(),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))()},shouldWarn:function(){return ue.processModalLogs.shouldWarn()},successModal:function(e){return n(o().mark((function t(){var n,s,r,i,a,c,l,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.title,s=void 0===n?null:n,r=e.bodyText,i=void 0===r?null:r,a=e.onSuccessModalRender,c=void 0===a?function(){}:a,l=document.querySelector("#wpstg--success-modal").innerHTML,t.next=4,H.getSwalModal(!0).fire({icon:"success",html:l.replace("{title}",s).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==i?i:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){var e=H.getSwalContainer();ue.registerLogsToggle(e),m(".wpstg--success-modal--logs-wrapper"),c()},allowEscapeKey:!1,allowOutsideClick:!1});case 4:return(u=t.sent).value&&H.closeSwalModal(),t.abrupt("return",u);case 7:case"end":return t.stop()}}),t)})))()},registerLogsToggle:function(e){l(e,"click",".wpstg--success-modal--logs-button",(function(e,t){ue.showLogsInModal(t)}))},showLogsInModal:function(e){e.preventDefault(),ue.processModalLogs.toggleProcessLogs(e.target)}};!function(e){ie={processModal:new te,wpstgProcessLogs:new ae,isBackupSlowerThanUsual:!1,isBackupSpeedModalDisplayed:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1,isBackupCreationInBackground:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},upload:{html:null,confirmBtnTxt:null,retryCount:0,data:{file:null}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return ie.messages.data.error.length>0||ie.messages.data.critical.length>0},addMessage:function(e){if(Array.isArray(e))e.forEach((function(e){ie.messages.addMessage(e)}));else if(e.type){var t=e.type.toLowerCase()||"info";ie.messages.data[t]||(ie.messages.data[t]=[]),ie.messages.data.all.push(e),ie.messages.data[t].push(e)}},reset:function(){ie.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:new le,status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(t){return void 0===t&&(t=!0),k(),H.isLoading(!0),e("#backup-messages").text(""),t&&H.resetErrors(),fetch(ajaxurl+"?action=wpstg--backups--listing&_="+Math.random(),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(H.handleFetchErrors).then((function(e){return e.json()})).then((function(t){var n,s=a("#wpstg--tab--backup");if(s.style.minHeight=s.offsetHeight+"px",e("#wpstg--tab--backup").empty(),ie.modal.create.html=null,H.cache.get("#wpstg--tab--backup").html(t),void 0!==t.success&&!1===t.success)return H.showError("Error: "+t.data),void k("hidden");(null===ie.modal.download.html&&(ie.modal.download.html=e("#wpstg--success-modal").html()),H.showAjaxFatalError(t,"",wpstg.i18n.submit_error_report),H.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),e("#local-backup-title").show(),e("#cloud-backup-title").hide(),"wpstg_backup"===_()&&"true"===localStorage.getItem("wpstg-trigger-backup-after-authentication"))&&(null==(n=document.getElementById("wpstg-new-backup"))||n.click());return t})).catch((function(e){return H.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))},cancel:function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),ie.timer.stop(),clearInterval(ie.processInfo.interval),ie.processInfo.interval=null,ue.cancel(e,t)},process:function(t){if(!("function"==typeof t.execute||t.data&&t.onResponse))return H.closeSwalModal(),void H.showError("process.data and / or process.onResponse is not set");if(!ie.modal.process.html||!ie.modal.process.cancelBtnTxt){var n=e("#wpstg--process-modal"),s=n.html(),r=n.attr("data-cancelButtonText");ie.modal.process.html=s||null,ie.modal.process.cancelBtnTxt=r||null,n.remove()}ie.modal.process.html&&e("#wpstg--process-modal").remove(),e("body").off("click",".wpstg--process-modal--logs-button").on("click",".wpstg--process-modal--logs-button",(function(e){ie.showLogsInModal(e)})).off("click",".wpstg--success-modal--logs-button").on("click",".wpstg--success-modal--logs-button",(function(e){ie.showLogsInModal(e,"success")})),t.isShowCancelButton=!1!==t.isShowCancelButton,ie.modal.process.modal=H.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:ie.modal.process.html,cancelButtonText:ie.modal.process.cancelBtnTxt,showCancelButton:t.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var e=H.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=e.cloneNode(!0);if(e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(e){confirm(wpstg.i18n.cancel_modal_confirm_text)&&ie.cancel()})),"function"!=typeof t.execute)return t.data&&t.onResponse?void H.ajax(t.data,t.onResponse):(H.closeSwalModal(),void H.showError("process.data and / or process.onResponse is not set"));t.execute()},onAfterClose:function(){return"function"==typeof t.onAfterClose&&t.onAfterClose()}})},processResponse:function(t){if(null===t)throw H.closeSwalModal(),H.showError("Invalid Response; null"),new Error("Invalid Response; "+t);var n=e(H.getSwalContainer());(t.title||t.statusTitle)&&n.find(".wpstg--process-modal--title").text(t.title||t.statusTitle),t.percentage&&n.find(".wpstg--process-modal--percent").text(t.percentage),ie.addResponseMessagesToLog(t),t.jobId&&H.setJobId(t.jobId),!1===t.isRunning&&!0===t.job_done&&("Backup"!==t.job||null!=t&&t.isGlitchInBackup||ie.calculateBackupSpeedIndex(t.backupSize,ie.timer.getTimeElapsed()),ie.timer.stop(),ue.isCancelled=!0,t.status=!t.isRunning,window.dispatchEvent(new CustomEvent("finishedProcess",{response:t})))},logsModal:function(){var t=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),n=t?t.innerHTML:null;H.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'+n+"</div>",width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){e(H.getSwalContainer())[0].style["z-index"]=9999,ie.messages.data.all&&(ie.wpstgProcessLogs.renderLogs(ie.messages.data.all),ie.wpstgProcessLogs.addEvents())},onOpen:function(t){var n=e(t).find(".wpstg--process-modal--logs");n.scrollTop(n[0].scrollHeight)}}).then((function(e){e.value&&(H.closeSwalModal(),ie.fetchListing())}))},addResponseMessagesToLog:function(t){if(t.messages){for(var n,r=e(".wpstg--process-modal--logs"),o=[ie.messages.ERROR,ie.messages.CRITICAL],i=function(e){if(Array.isArray(e))for(var t,n=s(e);!(t=n()).done;){var r=t.value;i(r)}else e.type&&(ie.wpstgProcessLogs.logMessages(e),o.includes(e.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:e.message}})),ie.cancel({},(function(){setTimeout(ie.logsModal,500)}))))},a=s(t.messages);!(n=a()).done;){var c=n.value;c&&(ie.messages.addMessage(c),i(c))}r.is(":visible")&&r.scrollTop(r[0].scrollHeight)}},successModal:function(t){var n=t.title,s=void 0===n?null:n,r=t.bodyText,o=void 0===r?null:r,i=t.processResponse,a=void 0===i?null:i;if(!ie.isBackupSlowerThanUsual||!1!==ie.isBackupSpeedModalDisplayed){var c=e("#wpstg--success-modal");if(null===ie.modal.download.html&&(ie.modal.download.html=c.html()),c.remove(),H.getSwalModal(!0).fire({icon:"success",html:ie.modal.download.html.replace("{title}",s).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==o?o:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){wpstg.isPro||(document.querySelector(".wpstg--swal2-html-container").querySelector(".wpstg--success-modal--additional-content").innerHTML=document.querySelector("#wpstg-backup-success-content").innerHTML)},allowEscapeKey:!1,allowOutsideClick:!1}).then((function(t){t.value&&(H.closeSwalModal(),S().then((function(){k()})),ie.fetchListing().then((function(){if(s===wpstg.i18n.backup_remote_upload.backup_upload_complete&&e("#wpstg-show-cloud-backup").click(),s===wpstg.i18n.backup_success.created.title||a)if(a.backupMd5||ie.processInfo.isOnlySchedule||ie.processInfo.isBackupCreationInBackground){!ie.processInfo.isOnlySchedule&&Array.isArray(H.selectedStorages)&&(H.selectedStorages.includes("localStorage")&&H.selectedStorages.length>=2||!H.selectedStorages.includes("localStorage")&&H.selectedStorages.length>=1)&&e("#wpstg-show-cloud-backup").click();var t="",n=0,r=setInterval((function(){if(ie.processInfo.isOnlySchedule||ie.processInfo.isBackupCreationInBackground||!a.isLocalBackup)clearInterval(r);else{n++;var s=!1;if(a.isMultipartBackup?a.backupMd5.forEach((function(n){(t=e('.wpstg-backup[data-md5="'+n+'"] .wpstg--backup--download')).length&&(s=!0,console.log("remote backup found"))})):(t=e('.wpstg-backup[data-md5="'+a.backupMd5+'"] .wpstg--backup--download'),s=t.length>0),!s)return void(n>=20&&clearInterval(r));clearInterval(r)}ie.wpstgProcessLogs.logMessages(ie.messages.data.all)}),500)}else H.showError("<strong>%s</strong>:".replace("%s",wpstg.i18n.warning)+wpstg.i18n.backup_create.create_backup_fetch_listing_error_md5+JSON.stringify(a)+"<br/><br/>"+wpstg.i18n.report_this_warning)})))})),e(".wpstg--success-modal--logs-wrapper").show(),s===wpstg.i18n.backup_success.created.title){var l=H.getSwalContainer().querySelector(".wpstg-rate-us");l&&l.classList.add("show")}}},checkMemoryExhaustion:function(e,t){return n(o().mark((function n(){var s,r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,H.checkMemoryExhaustion(t);case 2:if(!1!==(s=n.sent)){n.next=5;break}return n.abrupt("return");case 5:r=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(r=wpstg.i18n.memory_exhaust_error.replace("%s",H.memoryExhaustArticleLink)),e.messages=[{type:"critical",date:s.data.time,message:s.message+". "+r}],ie.processResponse(e);case 9:case"end":return n.stop()}}),n)})))()},statusStop:function(){clearInterval(ie.processInfo.interval),ie.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(t){null===ie.processInfo.interval&&(ie.processInfo.interval=setInterval((function(){!0!==ue.isCancelled?!1!==ie.status.hasResponse&&(ie.status.hasResponse=!1,fetch(ajaxurl+"?action=wpstg--backups--status&"+t+"=restore",{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()})).then((function(t){if(ie.status.hasResponse=!0,void 0===t&&ie.statusStop(),ie.processInfo.title!==t.currentStatusTitle){ie.processInfo.title=t.currentStatusTitle;var n=e(H.getSwalContainer());n.find(".wpstg--process-modal--title").text(t.currentStatusTitle),n.find(".wpstg--process-modal--percent").text("0")}})).catch((function(e){ie.status.hasResponse=!0,H.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))):ie.statusStop()}),wpstg.backupStatusInterval))},showLogsInModal:function(e,t){e.preventDefault(),ie.wpstgProcessLogs.toggleProcessLogs(e.target)},showGeneralErrorModal:function(){var e=document.querySelector("#wpstg-general-error-modal");null!=e&&null!=e&&(m("#wpstg-general-error-modal"),new D("general-error"))},removeLogsListeners:function(){e("body").off("click",".wpstg--process-modal--logs-button").off("click",".wpstg--success-modal--logs-button")},calculateBackupSpeedIndex:function(e,t){fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_calculate_backup_speed_index",accessToken:wpstg.accessToken,nonce:wpstg.nonce,size:e,time:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){ie.isBackupSlowerThanUsual=e.isBackupSlowerThanUsual,ie.isBackupSpeedModalDisplayed=e.isBackupSpeedModalDisplayed,e.isBackupSlowerThanUsual&&!1===e.isBackupSpeedModalDisplayed&&ie.showGeneralErrorModal()})).catch((function(e){console.log(e)}))}}}(jQuery);var pe,de=ie,ge={onCancel:null,onRender:null,isCancellable:!1,isCloseable:!1,show:function(){var e=n(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("wpstg--process-modal")){e.next=3;break}return e.abrupt("return");case 3:n=t.innerHTML,H.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:n,cancelButtonText:ge.isCloseable?wpstg.i18n.close:wpstg.i18n.cancel,showCancelButton:ge.isCloseable||ge.isCancellable,showConfirmButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){de.removeLogsListeners();var e=H.getSwalContainer(),t=e.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(){H.getSwalModal().close(),ge.onCancel&&"function"==typeof ge.onCancel&&ge.onCancel()}));var s=e.getElementsByClassName("wpstg--process-modal--logs-button")[0],r=s.cloneNode(!0);s.parentNode.replaceChild(r,s),r.addEventListener("click",(function(e){e.preventDefault(),WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)})),ge.onRender&&"function"==typeof ge.onRender&&ge.onRender()}});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),updateProgress:function(e){var t=H.getSwalContainer();if(t){var n,s=t.querySelector(".wpstg--process-modal--title");if(s)s.innerHTML=null!=(n=e.title)?n:"Processing";var r,o=t.querySelector(".wpstg--process-modal--percent");if(o)o.innerHTML=null!=(r=e.percentage)?r:"0"}}},he={offset:0,retries:5,source:null,startTime:null,loader:null,timer:null,taskData:null,isCancelled:!1,resetRetries:function(){he.retries=5},showSuccessModal:function(e){ce.showLogs=!0;var t=ce.getModalContent({title:wpstg.i18n.success,body:e+"<br/><br/>"});ce.show(t)},showErrorModal:function(e){ce.showLogs=!0;var t=ce.getModalContent({title:wpstg.i18n.error,body:e+"<br/><br/>"});ce.show(t,"error")},init:function(e,t){l(document.querySelector("#wpstg--locked-process"),"click",".wpstg--locked-process--show-logs",(function(e,t){ge.isCloseable=!0,ge.show(),t.preventDefault(),H.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0].remove(),WPStaging.wpstgProcessLogs.toggleProcessLogs(),ge.updateProgress(he.taskData)})),l(document.querySelector("#wpstg--locked-process"),"click",".wpstg--locked-process--cancel-job",(function(){he.confirmCancel()})),he.token=t,he.startTime=e,he.loader=document.getElementById("wpstg--locked-process"),he.startTimer(),he.offset=0,he.resetRetries(),WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.wpstgProcessLogs.renderLogs(""),he.run()},close:function(){he.source&&he.source.close(),he.source=null},setTitle:function(e){var t=he.loader.querySelector(".wpstg--locked-process--job-title");t&&(t.innerHTML=e)},startTimer:function(){var e=he.loader.querySelector(".wpstg--locked-process--elapsed-time");e&&(he.timer=setInterval((function(){var t=Math.floor((new Date).getTime()/1e3)-he.startTime,n=t%60,s=Math.floor(t/60)+":"+(n<10?"0":"")+n+"s";e.innerHTML=s;var r=H.getSwalContainer();if(r){var o=r.querySelector(".wpstg--process-modal--elapsed-time");o&&(o.innerHTML=s)}}),1e3))},stop:function(){he.close(),he.isCancelled=!1,he.startTime=null,he.token=null,clearInterval(he.timer),he.timer=null,he.loader.remove()},enableUI:function(){he.close(),de.removeLogsListeners(),de.fetchListing();var e=document.getElementById("wpstg-new-backup");e&&e.removeAttribute("disabled")},run:function(){he.source=new EventSource(wpstg.restUrl+"/sse-logs&token="+he.token+"&offset="+he.offset),he.source.onmessage=function(e){var t=JSON.parse(e.data);t&&WPStaging.wpstgProcessLogs.logMessages(t)},he.source.addEventListener("task",(function(e){var t=JSON.parse(e.data);he.updateProgress(t)})),he.source.addEventListener("offset",(function(e){var t=parseInt(e.data,10);he.close(),he.offset=t,he.resetRetries(),ue.performingCancelRequest||setTimeout((function(){return he.run()}),200)})),he.source.addEventListener("success",(function(e){he.close();var t=JSON.parse(e.data);he.enableUI(),he.showSuccessModal(t.message)})),he.source.addEventListener("failed",(function(e){he.close();var t=JSON.parse(e.data);he.enableUI(),he.showErrorModal(t.message)})),he.source.addEventListener("cancelled",(function(e){var t=JSON.parse(e.data);he.setTitle(t.title),he.disableCancelButton(),he.isCancelled=!0,setTimeout((function(){return he.run()}),3e3)})),he.source.onerror=function(e){if(2===e.target.readyState&&he.isCancelled)setTimeout((function(){he.stop(),he.enableUI()}),3e3);else if(he.close(),void 0!==e.data){var t=JSON.parse(e.data);if(t.retry&&he.retries>0&&!he.isCancelled)return he.retries--,void setTimeout((function(){return he.run()}),1e3);he.enableUI(),he.showErrorModal(t.message)}}},updateProgress:function(e){he.taskData=e,ge.updateProgress(e);var t=he.loader.querySelector(".wpstg--locked-process--task-title"),n=he.loader.querySelector(".wpstg--locked-process--percentage");t&&(t.innerHTML=e.title),n&&(n.innerHTML=e.percentage)},confirmCancel:function(){var e,t=document.getElementById("wpstg--modal--cancel-job");H.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-button wpstg-link-btn danger"}).fire({html:'<div class="wpstg--modal--cancel-job">'+t.innerHTML+"</div>",showConfirmButton:!0,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,confirmButtonText:wpstg.i18n.confirm,cancelButtonText:wpstg.i18n.close,width:540,allowEscapeKey:!0,allowOutsideClick:!0,preConfirm:(e=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he.cancelJob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},cancelJob:(pe=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:he.stop(),ue.cancel({},(function(){he.enableUI()}));case 2:case"end":return e.stop()}}),e)}))),function(){return pe.apply(this,arguments)}),disableCancelButton:function(){var e=document.querySelector(".wpstg--locked-process--cancel-job");e&&e.setAttribute("disabled","disabled")}},we={pageContainer:null,job:null,isStagingPage:function(){return"wpstg_clone"===_()},getPageContainer:function(){if(this.pageContainer)return this.pageContainer;throw new Error("Staging page container not found")},setJob:function(e,t){void 0===t&&(t=null),this.job={type:e,cloneId:t}},init:function(){var e=this;return n(o().mark((function t(){var n,s,r,i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.pageContainer=null,n=5e3,s=250,r="#wpstg-workflow",i=Date.now();case 5:if(!(Date.now()-i<n)){t.next=15;break}if(!(a=document.querySelector(r))){t.next=11;break}return e.pageContainer=a,window.dispatchEvent(new Event("wpstg.onStagingPageLoaded")),t.abrupt("return");case 11:return t.next=13,new Promise((function(e){return setTimeout(e,s)}));case 13:t.next=5;break;case 15:throw new Error("Staging page container not found");case 17:case"end":return t.stop()}}),t)})))()},showLoader:function(){k(),this.isStagingPage()&&y(),this.isStagingPage()&&function(e,t){if(window.MutationObserver){var n=new MutationObserver((function(e){for(var n,r=s(e);!(n=r()).done;){var o=n.value;"childList"===o.type&&t(o)}}));return n.observe(e,{childList:!0,subtree:!1}),n}console.warn("MutationObserver is not supported in your browser.")}(this.getPageContainer(),(function(){S().then((function(){k("hidden")}))}))},hideLoader:function(){this.isStagingPage()&&k("hidden")},fetchListing:function(){var e=this;return n(o().mark((function t(){var n,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getPageContainer(),e.showLoader(),t.prev=2,t.next=5,j("wpstg--staging-site--listing");case 5:s=t.sent,window.dispatchEvent(new Event("wpstg.onStagingSitesListed")),n.innerHTML=s,e.runScripts(n),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn(t.t0),H.showError(wpstg.i18n.admin_load_overview.error_no_response),e.hideLoader();case 16:return t.prev=16,m(".wpstg-step3-cloning"),f(".wpstg-step3-pushing"),t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[2,11,16,20]])})))()},runScripts:function(e){e.querySelectorAll("script").forEach((function(e){var t=document.createElement("script");t.textContent=e.textContent,e.parentNode.replaceChild(t,e)}))}},fe={fixStagingSitesOption:function(){return n(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("wpstg--staging-site--fix-option");case 2:if(t=e.sent,n=t.response,!t.error){e.next=7;break}return e.abrupt("return",!1);case 7:if(!n.success){e.next=10;break}return b("success",n.data.message),e.abrupt("return",!0);case 10:return b("error",n.data.message),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})))()},reportCorruptedStagingSitesOption:function(){return n(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("wpstg--staging-site--report-option");case 2:if(t=e.sent,n=t.response,!t.error){e.next=7;break}return e.abrupt("return");case 7:if(!n.success){e.next=10;break}return b("success",n.data.message),e.abrupt("return");case 10:b("error",n.data.message);case 11:case"end":return e.stop()}}),e)})))()},listen:function(){var e=this;window.addEventListener("wpstg.onStagingPageLoaded",(function(){var t=we.getPageContainer();l(t,"click","#wpstg-fix-staging-sites-option",function(){var t=n(o().mark((function t(n,s){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.preventDefault(),t.next=3,e.fixStagingSitesOption();case 3:if(!t.sent){t.next=5;break}we.fetchListing();case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),l(t,"click","#wpstg-report-corrupted-staging-sites",function(){var t=n(o().mark((function t(n,s){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.preventDefault(),t.next=3,e.reportCorruptedStagingSitesOption();case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}))}},me=function(){function e(){this.allTablesChecked=!0,this.isDeletingTables=!1,this.isDeletingFiles=!1,this.excludedTables=[],this.cloneId=null,this.isDeleteConfirmEventListened=!1}var t=e.prototype;return t.listen=function(){var e=this;this.isDeleteConfirmEventListened||(this.isDeleteConfirmEventListened=!0,l(a("body"),"click",".wpstg--delete--staging-site",function(){var t=n(o().mark((function t(n){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.openStagingSiteDeleteConfirmationModal(n);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},t.openStagingSiteDeleteConfirmationModal=function(){var e=n(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.resetErrors(),this.cloneId=t.getAttribute("data-cloneId"),e.next=4,j("wpstg--staging-site--delete-confirmation",{cloneId:this.cloneId});case 4:if((n=e.sent)&&n.success){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.showDeleteConfirmationModal(n.data);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.showDeleteConfirmationModal=function(){var e=n(o().mark((function e(t){var s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal wpstg-delete-staging-site-modal",content:"wpstg--process--content"}).fire({html:"<div id='wpstg--modal--confirm-delete--staging-site--content'></div>",title:wpstg.i18n.staging_site.delete.confirmation.replace("%s",t.stagingSiteName),icon:"error",width:"100%",focusConfirm:!1,confirmButtonText:wpstg.i18n.delete,confirmButtonColor:"#e01e5a",showCancelButton:!0,cancelButtonText:wpstg.i18n.cancel,onRender:function(){a(".wpstg--swal2-container #wpstg--modal--confirm-delete--staging-site--content").innerHTML=t.html,s.updateDeleteConfirmationModalUI()},preConfirm:function(){return s.validateIfAnythingToDelete()}});case 2:if(e.sent.isConfirmed){e.next=5;break}return e.abrupt("return");case 5:return ue.processModal.initializeProcessModal(!1),ue.setJob({name:"staging_site_delete",action:"wpstg--staging-site--delete",type:"Staging_Delete"}),e.next=9,ue.prepareJob("wpstg--staging-site--prepare-delete",{wpstgDeleteData:{cloneId:this.cloneId,excludedTables:this.excludedTables,isDeletingTables:this.isDeletingTables,isDeletingFiles:this.isDeletingFiles}},"startedDeletingStagingSite");case 9:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:return ue.onSuccess=function(){var e=n(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S().then((function(){return k()})),!ue.shouldWarn()){e.next=9;break}return e.next=4,ue.logsModal();case 4:if(e.sent.value){e.next=7;break}return e.abrupt("return");case 7:return WPStaging.loadOverview(),e.abrupt("return");case 9:return e.next=11,ue.successModal({title:wpstg.i18n.staging_site.delete.title,bodyText:""});case 11:if(e.sent.value){e.next=14;break}return e.abrupt("return");case 14:WPStaging.loadOverview();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=13,e.next=16,ue.runJob();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),console.error(e.t0);case 21:case"end":return e.stop()}}),e,this,[[13,18]])})));return function(t){return e.apply(this,arguments)}}(),t.updateDeleteConfirmationModalUI=function(){var e=this;l(a("body"),"click","#wpstg-unselect-all-tables",(function(){e.toggleSelectAllTables()})),a(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container"),document.querySelector(".wpstg--swal2-confirm").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-left").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-right").style.background="#e01e5a",document.querySelector(".wpstg--swal2-icon.wpstg--swal2-error").style.borderColor="#e01e5a";var t=H.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",(function(e){H.closeSwalModal(),f(".wpstg-loader"),k("hidden")}))},t.toggleSelectAllTables=function(e){var t=a("#wpstg-unselect-all-tables-id");!1===this.allTablesChecked?(t.textContent="Unselect All",c(".wpstg-db-table-checkboxes").forEach((function(e){e.checked=!0})),this.allTablesChecked=!0):(t.textContent="Select All",c(".wpstg-db-table-checkboxes").forEach((function(e){e.checked=!1})),this.allTablesChecked=!1)},t.validateIfAnythingToDelete=function(){var e=this;return this.isDeletingTables=!1,c(".wpstg-db-table-checkboxes").forEach((function(t){t.checked?e.isDeletingTables=!0:e.excludedTables.push(t.value)})),this.isDeletingFiles=a("#deleteDirectory").checked,!(!this.isDeletingTables&&!this.isDeletingFiles)||(b("warning","Please select at least one item to delete."),!1)},e}(),ve={allTablesSelected:!0,directoryNavigator:null,tableSelector:null,cloneExcludeFilters:null,setup:function(){var e=this;return n(o().mark((function t(){var n,s,r,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=we.getPageContainer(),we.showLoader(),t.next=4,I("wpstg--staging-site--setup");case 4:if(s=t.sent,r=s.response,!(i=s.error)){t.next=11;break}return console.warn(i),we.hideLoader(),t.abrupt("return");case 11:if(r.success){t.next=14;break}return we.hideLoader(),t.abrupt("return");case 14:we.setJob("staging-create",null),window.dispatchEvent(new Event("wpstg.onStagingSiteSetup")),n.innerHTML=r.data,e.directoryNavigator=new W("#wpstg-directories-listing",wpstg),e.directoryNavigator.countSelectedFiles(),e.tableSelector=new G("#wpstg-setup-tables","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),e.tableSelector.countSelectedTables(),e.cloneExcludeFilters=new z;case 22:case"end":return t.stop()}}),t)})))()},listen:function(){var e=this;window.addEventListener("wpstg.onStagingSitesListed",(function(){l(we.getPageContainer(),"click","#wpstg-new-staging",function(){var t=n(o().mark((function t(n,s){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.preventDefault(),t.next=3,e.setup();case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}))}},be=function(){function e(){this.isCreateEventListened=!1}var t=e.prototype;return t.listen=function(){var e=this;this.isCreateEventListened||(this.isCreateEventListened=!0,l(a("body"),"click",".wpstg--create--staging-site",function(){var t=n(o().mark((function t(n){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.start();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))},t.start=function(){var e=n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ue.processModal.initializeProcessModal(!0),ue.setJob({name:"staging_site_create",action:"wpstg--staging-site--create",type:"Staging_Create"}),e.next=4,ue.prepareJob("wpstg--staging-site--prepare-create",{wpstgCreateData:{}},"startedCreatingStagingSite");case 4:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return ue.onSuccess=function(){var e=n(o().mark((function e(t){var n,s,r,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S().then((function(){return k()})),!ue.shouldWarn()){e.next=9;break}return e.next=4,ue.logsModal();case 4:if(e.sent.value){e.next=7;break}return e.abrupt("return");case 7:return WPStaging.loadOverview(),e.abrupt("return");case 9:if(n=wpstg.i18n.cloning.body,null===t.stagingSiteUrl){e.next=19;break}return s=t.stagingSiteUrl,r=Date.now().toString(),i=t.cloneId,e.next=16,wpstgPro.saveGeneratedLinkData({cloneID:i,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:r});case 16:null!=(a=e.sent)&&a.success&&(s=t.stagingSiteUrl+"/wp-login.php?wpstg_login="+r),n+='<br><strong><a href="'+s+'" target="_blank" id="wpstg-clone-url">'+t.stagingSiteUrl+"</a></strong><br><br>";case 19:return e.next=21,ue.successModal({title:wpstg.i18n.cloning.title,bodyText:n});case 21:if(e.sent.value){e.next=24;break}return e.abrupt("return");case 24:WPStaging.loadOverview();case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=8,e.next=11,ue.runJob();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[8,13]])})));return function(){return e.apply(this,arguments)}}(),e}(),ye={deleteModule:new me,createModule:new be,init:function(){var e=this;return n(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:fe.listen(),we.init(),e.listen();case 3:case"end":return t.stop()}}),t)})))()},listen:function(){ve.listen(),this.deleteModule.listen(),this.createModule.listen()}},xe=function(e){var t={isCancelled:!1,isFinished:!1,getLogs:!1,onGoingRequest:null,time:1,executionTime:!1,progressBar:0,cloneExcludeFilters:null,directoryNavigator:null,tableSelector:null,notyf:null,areAllTablesChecked:!0,handleDisplayDependencies:g,handleToggleElement:h,handleCopyPaste:w,copyTextToClipboard:v,messages:[],requestType:"",modal:{instance:"",processTime:0,processInterval:"",currentJob:""},processModalType:null};t.wpstgProcessModal=new te,t.wpstgProcessLogs=new ae;var s,i={elements:[]};i.get=function(t){return-1!==e.inArray(t,i.elements)||(i.elements[t]=jQuery(t)),i.elements[t]},i.refresh=function(e){e.elements[e]=jQuery(e)};var c=function(){i.get(".wpstg-loader").is(":visible")?i.get(".wpstg-loader").css("visibility","hidden"):i.get(".wpstg-loader").hide()},l=function(t){window.scrollTo(0,0),i.get("#wpstg-try-again").css("display","inline-block"),i.get("#wpstg-cancel-cloning").text("Reset"),i.get("#wpstg-resume-cloning").show(),i.get("#wpstg-error-wrapper").show(),i.get("#wpstg-error-details").show().html(t),i.get(".wpstg-loading-bar-container").css("visibility","hidden"),c(),e(".wpstg--modal--process--generic-problem").show().html(t),document.querySelectorAll(".wpstg-report-issue-button").forEach((function(e){e.addEventListener("click",(function(){setTimeout((function(){document.querySelectorAll(".wpstg-report-show").forEach((function(e){e.style.zIndex="9999999999"}))}),10)}))})),e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_staging_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:t}})};t.warnIfClosingDuringProcess=function(e){return e.returnValue=wpstg.i18n.admin_warn_if_closing_during_process,null};var u=function(){i.get("#wpstg-error-details").hide().html("")},p=function(){var t=e("#wpstg_clone_hostname").val();if(""===t)return!0;return!1!==/^http(s)?:\/\/.*$/.test(t)},d=function(){var n=i.get("#wpstg-workflow");n.on("click","#wpstg-cancel-cloning",(function(){if(!confirm(wpstg.i18n.admin_clone_actions.cancel_cloning_confirm))return!1;var n=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),n.prop("disabled",!0),t.isCancelled=!0,t.progressBar=0,e("#wpstg-processing-status").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),n.parent().append(s),I()})).on("click","#wpstg-resume-cloning",(function(){u();var n=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),t.isCancelled=!1,e("#wpstg-processing-status").text(wpstg.i18n.admin_clone_actions.resume_cloning_status),e("#wpstg-error-details").hide(),e(".wpstg-loader").show(),n.parent().append(s),t.startCloning()})).on("click","#wpstg-cancel-cloning-update",(function(){u();var n=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),n.prop("disabled",!0),t.isCancelled=!0,e("#wpstg-cloning-result").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),n.parent().append(s),B()})).on("click","#wpstg-restart-cloning",(function(){u();var n=e(this);e("#wpstg-try-again, #wpstg-home-link").hide(),n.prop("disabled",!0),t.isCancelled=!0,e("#wpstg-cloning-result").text(wpstg.i18n.please_wait),e(".wpstg-loader, #wpstg-show-log-button").hide(),n.parent().append(s),O()})).on("click",".wpstg-execute-clone",(function(s){s.preventDefault();var r=e(this).data("clone"),o=e(this).data("url");H.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_clone_actions_update_modal.title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height wpstg-text-justify">'+wpstg.i18n.admin_clone_actions_update_modal.body.replace("{URL}",o)+"<br><br>"+wpstg.i18n.admin_clone_actions_update_modal.suggestion+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_clone_actions_update_modal.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var e=H.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){H.closeSwalModal()}))}}).then((function(e){e.value&&(t.cloneExcludeFilters=null,f({action:"wpstg_scanning",clone:r,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e.length<1&&l(wpstg.i18n.admin_clone_actions.scanning_show_error);var s=M(e);!1===s||!1!==s.success?(n.html(e),D(),t.directoryNavigator=new W("#wpstg-directories-listing",wpstg),t.directoryNavigator.countSelectedFiles(),t.tableSelector=new G("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),t.tableSelector.countSelectedTables(),t.cloneExcludeFilters=new z,t.switchStep(2)):L(s)}),"HTML"),H.closeSwalModal())}))})).on("click","#wpstg-update-cloning-site-button",(function(e){window.open(t.data.cloneHostname,"_blank")})).on("click",".wpstg-reset-clone",(function(n){n.preventDefault();var s=e(this).data("clone"),r=new V(s);r.setNetworkClone("yes"===e(this).data("network"));var o=r.showModal();t.areAllTablesChecked=!0,o.then((function(e){if(e.value){var t=r.getDirectoryNavigator(),n=r.getTableSelector(),o=r.getExcludeFilters().getExcludeFilters(),i="",a="",c="",l=!1;null!==n&&(i=n.getIncludedTables(),a=n.getExcludedTables(),c=n.getSelectedTablesWithoutPrefix()),i.length>a.length?i="":a.length>i.length&&(a="",l=""===i),j(s,{includedTables:i,excludedTables:a,allTablesExcluded:l,selectedTablesWithoutPrefix:c,excludeSizeRules:encodeURIComponent(o.sizes),excludeGlobRules:encodeURIComponent(o.globs),excludedDirectories:t.getExcludedDirectories(),extraDirectories:t.getExtraDirectoriesRootOnly()})}}))}))},f=function(s,r,i,a,u,p){void 0===p&&(p=null),void 0===i&&(i="json"),!1!==a&&(a=!0);var d=1e4*(u=void 0===u?0:u);p=parseInt(p),isNaN(p)||(d*=p);var g,h="<br/>"+wpstg.i18n.admin_ajax.error_msg_footer,w="<br/><br/>"+wpstg.i18n.admin_ajax.pushing_error_msg,m='<br/><br/><button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> "+wpstg.i18n.admin_ajax.contact_us_text;t.onGoingRequest=e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:i,cache:!1,data:s,error:(g=n(o().mark((function e(n,g,v){var b,y,x,k,_;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(403!==(b=void 0===n.status?"Unknown":n.status)&&405!==b&&406!==b){e.next=4;break}return H.handleFetchErrors(n),e.abrupt("return");case 4:if(console.log(n),"wpstg_cloning"!==xe.requestType){e.next=22;break}return e.next=8,H.checkMemoryExhaustion(xe.requestType);case 8:if(y=e.sent,x=m,wpstg.isPro&&(x='<br/><br/>Read <a target="_blank" href="'+H.memoryExhaustArticleLink+'">this article</a> for solving this issue.<br/><br/>'+wpstg.i18n.admin_ajax.help_content_pro),!1===y){e.next=22;break}return window.removeEventListener("beforeunload",xe.warnIfClosingDuringProcess),xe.requestType="",c(),k=y.message+"."+x,t.wpstgProcessLogs.logMessages({message:k,type:"critical",date:(o=void 0,o=new Date,o.getFullYear()+"/"+(o.getMonth()+1).toString().padStart(2,"0")+"/"+o.getDate().toString().padStart(2,"0")+" "+o.getHours().toString().padStart(2,"0")+":"+o.getMinutes().toString().padStart(2,"0")+":"+o.getSeconds().toString().padStart(2,"0"))}),e.next=19,t.wpstgProcessModal.openErrorModal("clone");case 19:return e.next=21,t.wpstgProcessModal.logEventFailure("clone");case 21:return e.abrupt("return");case 22:if("wpstg_cloning"===xe.requestType?h+=m:"wpstg_push_processing"===s.action?h+=w+m:h=m,"wpstg_cloning"!==xe.requestType||0!==u){e.next=26;break}return e.next=26,t.wpstgProcessModal.logEventFailure("clone");case 26:if("wpstg_push_processing"!==s.action||0!==u){e.next=29;break}return e.next=29,t.wpstgProcessModal.logEventFailure("push");case 29:++u<=5?(console.log("RETRYING "+u+"/5"),setTimeout((function(){f(s,r,i,a,u,p)}),d)):(xe.requestType="",console.log("RETRYING LIMIT"),_=void 0===n.status?"Unknown":n.status,l("Fatal Error:  "+_+" "+h));case 31:case"end":return e.stop()}var o}),e)}))),function(e,t,n){return g.apply(this,arguments)}),success:function(e){"function"==typeof r&&r(e)},statusCode:{0:function(){u>=5&&l("Error 0 - Connection error. Please check you network connection.")},404:function(){u>=5&&l("Error 404 - Can't find ajax request URL."+m)},500:function(){u>=5&&l("Fatal Error 500 - Internal server error while processing the request! "+h)},504:function(){u>5&&l("Error 504 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+m)},502:function(){u>=5&&l("Error 502 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+m)},503:function(){u>=5&&l("Error 503 - It seem your server is rate limiting ajax requests. Please try to resume after a minute. "+m)},429:function(){u>=5&&l("Error 429 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+m)},403:function(){l("Error 403 - "+H.showFirewallError())},405:function(){l("Error 405 - "+H.showFirewallError())},406:function(){l("Error 406 - "+H.showFirewallError())},400:function(){u>=5&&l("Error 400 - <strong>It looks like you have been logged out.</strong><br/><br/> <a href='/wp-login.php' target='_blank' id=\"wpstg-login-link\">Log in again and try again!</a>")}}})},m=function(e,t){i.get(".wpstg-loader").show(),f({action:"wpstg_database_verification",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:i.get("#wpstg-db-user").val(),databasePassword:i.get("#wpstg-db-pass").val(),databaseServer:i.get("#wpstg-db-server").val(),databaseDatabase:i.get("#wpstg-db-database").val(),databaseSsl:i.get("#wpstg-db-ssl").is(":checked")},(function(n){var s;if(!1===n)return l(wpstg.i18n.admin_verify_external_database.error_no_response+" <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void c();if(void 0===n.success)return l(wpstg.i18n.admin_verify_external_database.error_invalid_response+"<a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void c();if(n.success)return c(),void k(e,t);if("comparison"===n.error_type){c();var r='<table class="wpstg-db-comparison-table"><thead><tr><th>Property</th><th>Production DB</th><th>Staging DB</th><th>Status</th></tr></thead><tbody>';return n.checks.forEach((function(e){var t='<span class="wpstg-css-tick"></span>';e.production!==e.staging&&(t='<span class="wpstg-css-cross"></span>'),r+="<tr><td>"+e.name+"</td><td>"+e.production+"</td><td>"+e.staging+"</td><td>"+t+"</td></tr>"})),r+="</tbody></table><p>"+wpstg.i18n.admin_verify_external_database.comparison_modal_html_note+"</p>",void H.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-db-comparison-modal wpstg-centered-modal"}).fire({title:wpstg.i18n.admin_verify_external_database.comparison_modal_title,icon:"warning",html:r,width:"650px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_verify_external_database.comparison_modal_confirm_button_text,showCancelButton:!0}).then((function(n){n.value&&k(e,t)}))}H.getSwalModal(!0).fire({title:wpstg.i18n.admin_verify_external_database.error_modal_title,icon:"error",html:null==n||null==(s=n.data)?void 0:s.message,focusConfirm:!0,confirmButtonText:wpstg.i18n.admin_verify_external_database.error_modal_confirm_button_text,showCancelButton:!1}),c()}),"json",!1)},k=function(){var t=n(o().mark((function t(n,s){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("wpstg_cloning"!==n.data("action")){t.next=14;break}if(!wpstg.isPro||!x("#wpstg-new-admin-user")||!1!==T("#wpstg-new-admin-email")){t.next=3;break}return t.abrupt("return");case 3:if(t.t0=wpstg.isPro&&x("#wpstg-ext-db")&&"undefined"!=typeof wpstgPro&&"function"==typeof(null==(r=wpstgPro)?void 0:r.verifyDbGrants),!t.t0){t.next=9;break}return t.next=7,wpstgPro.verifyDbGrants();case 7:t.t1=t.sent,t.t0=!1===t.t1;case 9:if(!t.t0){t.next=11;break}return t.abrupt("return");case 11:A().then((function(t){if(!t||!wpstg.isPro)return new Promise((function(t){f({action:"wpstg_is_writable_clone_destination_dir",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneDir:e("#wpstg_clone_dir").val()},(function(e){var n;e.success?(c(),t(!0)):(l("Something went wrong! Error: "+(null==(n=e.data)?void 0:n.message)),c(),document.getElementById("wpstg-error-wrapper").scrollIntoView(),t(!1))}),"json",!1)}))})).then((function(e){e&&S(n,s)})).catch((function(e){b("error",e)})),t.next=15;break;case 14:S(n,s);case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),S=function(n,s){i.get(".wpstg-loading-bar-container").css("visibility","visible"),t.data={action:n.data("action"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){if("wpstg_cloning"===t.data.action||"wpstg_update"===t.data.action||"wpstg_reset"===t.data.action){if(t.data.cloneID=(new Date).getTime().toString(),"wpstg_update"===t.data.action&&(t.data.cloneID=e("#wpstg-new-clone-id").data("clone")),t.data.cloneName=H.sanitizeEventAttribute(e("#wpstg-new-clone-id").val())||t.data.cloneID,null!==t.directoryNavigator&&(t.data.excludedDirectories=encodeURIComponent(t.directoryNavigator.getExcludedDirectories()),t.data.extraDirectories=encodeURIComponent(t.directoryNavigator.getExtraDirectoriesRootOnly())),t.data.excludeGlobRules="",t.data.excludeSizeRules="",t.cloneExcludeFilters instanceof z){var n=t.cloneExcludeFilters.getExcludeFilters();t.data.excludeGlobRules=encodeURIComponent(n.globs),t.data.excludeSizeRules=encodeURIComponent(n.sizes)}t.data.includedTables="",t.data.excludedTables="",t.data.allTablesExcluded=!1,null!==t.tableSelector&&(t.data.includedTables=t.tableSelector.getIncludedTables(),t.data.excludedTables=t.tableSelector.getExcludedTables(),t.data.selectedTablesWithoutPrefix=t.tableSelector.getSelectedTablesWithoutPrefix()),t.data.includedTables.length>t.data.excludedTables.length?t.data.includedTables="":t.data.excludedTables.length>t.data.includedTables.length&&(t.data.excludedTables="",t.data.allTablesExcluded=""===t.data.includedTables),"undefined"!=typeof wpstgPro&&"function"==typeof wpstgPro.getAdvancedCloningOptions&&(t.data=wpstgPro.getAdvancedCloningOptions(t.data))}}(),E(s)},E=function(e){var n=i.get(".wpstg-loading-bar-container");f(t.data,(function(s){!1===s&&l(wpstg.i18n.admin_send_cloning_ajax.error_general),s.length<1&&(n.css("visibility","hidden"),l(wpstg.i18n.admin_send_cloning_ajax.error_no_response));var r=M(s);if(!1!==r&&!1===r.success)return n.css("visibility","hidden"),void L(r);n.css("visibility","hidden"),e.html(s),t.cloneExcludeFilters=null,"wpstg_scanning"===t.data.action?(t.areAllTablesChecked=!0,t.directoryNavigator=new W("#wpstg-directories-listing",wpstg),t.tableSelector=new G("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),t.switchStep(2),t.cloneExcludeFilters=new z,t.directoryNavigator.countSelectedFiles(),t.tableSelector.countSelectedTables()):"wpstg_cloning"!==t.data.action&&"wpstg_update"!==t.data.action&&"wpstg_reset"!==t.data.action||t.switchStep(3),t.startCloning()}),"HTML")},L=function(e){new J("wpstg_modal_error",wpstg).show(Object.assign({title:"Error",icon:"error",html:wpstg.i18n.something_went_wrong+(void 0!==e.message?"<br/>"+e.message:""),width:"500px",confirmButtonText:wpstg.i18n.ok,showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},e.swalOptions),{type:e.type})},M=function(e){if(!e)return!1;try{var t=JSON.parse(e);if(t&&"object"==typeof t)return t}catch(e){}return!1},j=function(e,n){t.data={action:"wpstg_reset",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:e},t.data=r({},t.data,n);var s=i.get("#wpstg-workflow");E(s)},P=function(){"wpstg_clone"===_()&&wpstg.isCloneable&&we.fetchListing(),t.switchStep(1)},I=function(){if(t.timer("stop"),!0===t.isFinished)return!0;f({action:"wpstg_cancel_clone",clone:t.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){if(e&&void 0!==e.delete&&"finished"===e.delete)return c(),void P();!0===e?P():I()}))},B=function(){if(!0===t.isFinished)return!0;f({action:"wpstg_cancel_update",clone:t.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e&&void 0!==e.delete&&"finished"===e.delete||!0===e?P():B()}))},O=function(){if(!0===t.isFinished)return!0;f({action:"wpstg_restart",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e&&void 0!==e.delete&&"finished"===e.delete||!0===e?P():B()}))},R=function(e){t.wpstgProcessLogs.logMessages(e)},D=function(){i.get("#wpstg-check-space").on("click",(function(e){i.get(".wpstg-loader").show(),y();var n=encodeURIComponent(t.directoryNavigator.getExcludedDirectories()),s=encodeURIComponent(t.directoryNavigator.getExtraDirectoriesRootOnly()),r=document.getElementById("wpstg_symlink_upload").checked;f({action:"wpstg_check_disk_space",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedDirectories:n,extraDirectories:s,isUploadsSymlinked:r},(function(e){c(),C(),!1!==e?i.get("#wpstg-clone-id-error").html("<strong>"+wpstg.i18n.admin_check_disk_space.error_disk_space_html_1+e.requiredSpace+"</strong>"+(null!==e.errorMessage?"<br>"+e.errorMessage:"")+'<br><span class="wpstg--grey">'+wpstg.i18n.admin_check_disk_space.error_disk_space_html_2+"</span>").show():i.get("#wpstg-clone-id-error").text(wpstg.i18n.admin_check_disk_space.admin_check_disk_space).show()}),"json",!1)}))};t.timer=function(e){if("stop"===e){var n=t.time;return t.time=1,clearInterval(t.executionTime),t.convertSeconds(n)}t.executionTime=setInterval((function(){null!==document.getElementById("wpstg-processing-timer")&&(document.getElementById("wpstg-processing-timer").innerHTML=wpstg.i18n.admin_that_timer.elapsed_time+t.convertSeconds(t.time)),t.time++,"stop"===e&&(t.time=1,clearInterval(t.executionTime))}),1e3)},t.convertSeconds=function(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(11,8)},t.startCloning=function(){if(u(),D(),"wpstg_cloning"===t.data.action||"wpstg_update"===t.data.action||"wpstg_reset"===t.data.action){t.isCancelled=!1,i.get(".wpstg-loader").show(),i.get("#wpstg-cancel-cloning").text("Cancel"),i.get("#wpstg-resume-cloning").hide(),i.get("#wpstg-error-details").hide(),setTimeout((function(){window.addEventListener("beforeunload",xe.warnIfClosingDuringProcess),n()}),wpstg.delayReq);var n=function(){if(!0===t.isCancelled)return window.removeEventListener("beforeunload",xe.warnIfClosingDuringProcess),!1;var r;(r=!0)&&!1!==r?i.get(".wpstg-loader").show():c();var o,a="",u="";null!==t.directoryNavigator&&(a=t.directoryNavigator.getExcludedDirectories(),u=t.directoryNavigator.getExtraDirectoriesRootOnly()),xe.requestType="wpstg_cloning",xe.ajax({action:"wpstg_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:(o=[],e(".wpstg-db-table input:not(:checked)").each((function(){o.push(this.name)})),o),excludedDirectories:encodeURIComponent(a),extraDirectories:encodeURIComponent(u)},(function(e){!function(e,t,n){t=t?t+"<br/><br/>":wpstg.i18n.something_went_wrong+"!<br/><br/>",n=n?n+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===e?(l(t+" Error: No response."+n),window.removeEventListener("beforeunload",xe.warnIfClosingDuringProcess)):void 0!==e.error&&e.error&&(console.error(e.message),l(t+" Error: "+e.message+n),window.removeEventListener("beforeunload",xe.warnIfClosingDuringProcess))}(e),void 0!==e.last_msg&&e.last_msg&&R(e.last_msg),!1===e.status?(s(e),setTimeout((function(){n()}),wpstg.delayReq)):!0===e.status&&"finished"!==e.status?(i.get("#wpstg-error-details").hide(),i.get("#wpstg-error-wrapper").hide(),s(e),n()):("finished"===e.status||void 0!==e.job_done&&e.job_done)&&(window.removeEventListener("beforeunload",xe.warnIfClosingDuringProcess),xe.requestType="",function(e){!0===t.getLogs&&R();s(e),void 0!==e.last_msg&&R(e.last_msg);var n=t.data.action.replace("wpstg_","");null!==wpstg.i18n[n]&&t.wpstgProcessModal.openSuccessModal(wpstg.i18n[n],!0,e.url)}(e))}),"json",!1)},s=function(e,n){null!==e&&t.wpstgProcessModal.openProcessModal(t.data,e,!0)}}};var A=function(){return new Promise((function(e){var t,n;((null==(t=a("#wpstg-use-target-dir"))?void 0:t.dataset.basePath)||"")!==((null==(n=a("#wpstg_clone_dir"))?void 0:n.value)||"")?e(!1):(a("#wpstg_clone_dir").style.borderColor="red",b("error",wpstg.i18n.admin_is_clone_destination_path_same_as_root_error),e(!0))}))};return t.switchStep=function(e){i.get(".wpstg-current-step").removeClass("wpstg-current-step"),i.get(".wpstg-step"+e).addClass("wpstg-current-step")},t.checkUserDbPermissions=function(e){return new Promise((function(t){xe.ajax({action:"wpstg_check_user_permissions",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:e},(function(e){e.success?t(!0):(H.getSwalModal(!0,{container:"wpstg-swal-push-container"}).fire({title:"",icon:"warning",html:e.data.message,width:"750px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_check_user_db_permissions_confirm_button_text,showCancelButton:!0}).then((function(e){e.isConfirmed&&t(!0)})),document.getElementById("wpstg-db-permission-show-full-message").addEventListener("click",(function(){var e=document.getElementById("wpstg-permission-info-output"),t=document.getElementById("wpstg-permission-info-data"),n="none"!==window.getComputedStyle(e).display;e.style.display=n?"none":"block",t.style.display=n?"block":"none",this.textContent="none"===t.style.display?wpstg.i18n.admin_verify_external_database.show_full_message:wpstg.i18n.admin_verify_external_database.hide_full_message})))}),"json",!1)}))},t.init=function(){var n,r,o;P(),r=i.get("#wpstg-workflow"),o=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",2<window.devicePixelRatio&&(o+="-2x"),s="<img src=''"+(o+=".gif")+"' alt='' class='ajax-spinner general-spinner' />",r.on("click",".wpstg-button-unselect",(function(e){e.preventDefault(),!1===t.areAllTablesChecked?(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),i.get(".wpstg-button-unselect").text(wpstg.i18n.unselect_all),i.get(".wpstg-db-table-checkboxes").prop("checked",!0),t.areAllTablesChecked=!0):(i.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),i.get(".wpstg-button-unselect").text(wpstg.i18n.select_all),i.get(".wpstg-db-table-checkboxes").prop("checked",!1),t.areAllTablesChecked=!1)})).on("keyup","#wpstg-new-clone-id",(function(){if(document.getElementById("wpstg-error-details").style.display="none","number"==typeof n&&clearInterval(n),void 0===this.value||""===this.value)return i.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),i.get("#wpstg-start-cloning").removeAttr("disabled"),void i.get("#wpstg-clone-id-error").text("").hide();var e=H.slugify(this.value);n=setTimeout((function(){f({action:"wpstg_check_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,directoryName:e},(function(e){if(!e)return i.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),i.get("#wpstg-start-cloning").prop("disabled",!0),void b("error",wpstg.i18n.admin_elements.wpstg_check_clone_error);"success"===e.status?(i.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),i.get("#wpstg-start-cloning").removeAttr("disabled"),i.get("#wpstg-clone-id-error").text("").hide()):(i.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),i.get("#wpstg-start-cloning").prop("disabled",!0),i.get("#wpstg-clone-id-error").text(e.message).show())}))}),500)})).on("click","#wpstg-start-cloning",(function(){u(),t.isCancelled=!1,t.progressBar=0})).on("input","#wpstg-new-clone-id",(function(){if(!(e("#wpstg-clone-directory").length<1)){var t=H.slugify(this.value).substring(0,16).trim(),n=e("#wpstg-use-target-dir"),s=e("#wpstg-use-target-hostname"),r=n.data("base-path"),o=s.data("base-uri");r&&t&&(r=function(e,t){var n=e.replace(/\/+$/g,"");return(n+="/"+t+"/").replace(/\/+/g,"/")}(r,t)),o&&(o=o.replace(/\/+$/g,"")+"/"+t),e(".wpstg-use-target-dir--value").text(r),e(".wpstg-use-target-hostname--value").text(o),n.attr("data-path",r),s.attr("data-uri",o),e("#wpstg_clone_dir").attr("placeholder",r),e("#wpstg_clone_hostname").attr("placeholder",o)}})).on("input","#wpstg_clone_hostname",(function(){""===e(this).val()||p()?e("#wpstg_clone_hostname_error").remove():p()||e("#wpstg_clone_hostname_error").length||e("#wpstg-clone-directory tr:last-of-type").after('<tr><td>&nbsp;</td><td><p id="wpstg_clone_hostname_error" style="color: red;">&nbsp;'+wpstg.i18n.admin_elements.wpstg_clone_hostname_error+"</p></td></tr>")})),d(),function(){var t=i.get("#wpstg-workflow");t.on("click",".wpstg-next-step-link",(function(n){n.preventDefault();var s=e(this);if(e("#wpstg_clone_hostname").length&&!p())return e("#wpstg_clone_hostname").focus(),!1;if(("wpstg_update"===s.data("action")||"wpstg_reset"===s.data("action"))&&"wpstg_update"===s.data("action")){var r=s,o=t,i=s.data("action");return H.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_step_buttons.popup_title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height">'+wpstg.i18n.admin_step_buttons.popup_html.replace("{URL}",s.data("url"))+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_step_buttons.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var e=H.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){H.closeSwalModal()}))}}).then((function(e){if(e.value){var t=document.querySelector("#wpstg-ext-db");if("wpstg_cloning"===i&&t.checked)return void m(r,o);H.closeSwalModal(),k(r,o)}})),!1}if(s.attr("disabled"))return!1;"wpstg_cloning"===s.data("action")&&e("#wpstg-ext-db").is(":checked")?m(s,t):k(s,t)})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),c(),i.get(".wpstg-loader").removeClass("wpstg-finished"),P()}))}(),i.get("#wpstg-workflow").on("click",".wpstg-tab-header",(function(t){t.preventDefault();var n=e(this),s=i.get(n.data("id"));n.toggleClass("expand"),s.slideToggle();var r=n.find(".wpstg-tab-triangle");n.hasClass("expand")?(r.text(""),r.addClass("wpstg-rotate-90")):r.removeClass("wpstg-rotate-90")})),H.listenTooltip(),new Y,new q,new Q,new te,new se,new ae},t.ajax=f,t.showError=l,t.getLogs=R,t.loadOverview=P,t.initBackgroundLogger=he.init,t}(jQuery);jQuery(document).ready(n(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wpstg_clone"!==_()||!wpstg.isCloneable){e.next=3;break}return e.next=3,ye.init();case 3:xe.init(),window.WPStaging=xe;case 5:case"end":return e.stop()}}),e)})))),jQuery(document).ready((function(e){function t(e,t,n){var s=document.getElementById(e);if(s){var r=null!=t&&t.includes(n)?"#e01e5a":"";"checkbox"!==s.type?s.style.borderColor=r:document.querySelector("#"+e+" ~ svg .wpstg--checkbox-border").style.stroke=r}}function n(s,r){void 0===r&&(r="false");var o=e(".wpstg--tab--header .wpstg-report-email").val(),i=e(".wpstg--tab--header .wpstg-report-hosting-provider").val(),a=e(".wpstg--tab--header .wpstg-report-description").val(),c=e(".wpstg--tab--header .wpstg-report-syslog").is(":checked"),l=e(".wpstg--tab--header .wpstg-report-terms").is(":checked");s.attr("disabled",!0),m("#wpstg-contact-us-loader"),e.ajax({url:ajaxurl,type:"POST",dataType:"json",async:!0,data:{action:"wpstg_send_report",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg_email:o,wpstg_provider:i,wpstg_message:a,wpstg_syslog:+c,wpstg_terms:+l,wpstg_force_send:r}}).done((function(r){if(s.attr("disabled",!1),f("#wpstg-contact-us-loader"),r.errors.length>0){e(".wpstg-report-issue-form .wpstg-message").remove();var o="";e.each(r.errors,(function(e,t){"already_submitted"===t.status?(o="",H.getSwalModal(!0,{container:"wpstg-issue-resubmit-confirmation"}).fire({title:"",icon:"warning",html:t.message,showCancelButton:!0,focusConfirm:!1,confirmButtonText:wpstg.i18n.yes,cancelButtonText:wpstg.i18n.no}).then((function(e){e.isConfirmed&&n(s,"true")}))):o+=t+"<br/>"})),t("wpstg-report-email",o,"email"),t("wpstg-report-description",o,"issue"),t("wpstg-report-terms",o,"privacy policy"),""!==o&&b("error",o)}else{var i=e("<div />").addClass("wpstg-message wpstg-success-message");i.append("<p>"+wpstg.i18n.admin_send_issue_report_success_message+"</p>"),e(".wpstg--tab--header .wpstg-report-issue-form").html(i),null!==document.getElementById("wpstg-modal-close")&&void 0!==document.getElementById("wpstg-modal-close")||e(".wpstg--tab--header .wpstg-success-message").append('<div class="wpstg-float-right"><button id="wpstg-success-button" class="wpstg-close-button"><a href="javascript:void(0)" class="wpstg-report-cancel wpstg--red">'+wpstg.i18n.close+"</a></button></div>"),setTimeout((function(){e(".wpstg--tab--header .wpstg-report-issue-form").removeClass("wpstg-report-active")}),2e3)}}))}e("body").on("click",".wpstg-report-issue-button",(function(t){t.preventDefault();var n=document.querySelector("#wpstg-contact-us-modal");null!=n&&void 0!==n&&(m("#wpstg-contact-us-modal"),new D),e(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),e("body").on("click",".wpstg-backups-report-issue-button",(function(t){t.preventDefault(),e(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),e("body").on("click","#wpstg-report-cancel",(function(t){t.preventDefault(),e(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),e("body").on("click","#wpstg-report-submit",(function(t){t.preventDefault(),n(e(this),"false")})),e("body").on("click","#wpstg-success-button",(function(t){t.preventDefault(),e(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),e(document).on("click",".wpstg-dropdown>.wpstg-dropdown-toggler",(function(t){t.preventDefault(),e(t.target).next(".wpstg-dropdown-menu").toggleClass("shown"),e(t.target).find(".wpstg-caret").toggleClass("wpstg-caret-up")})),e(document).on("click",".wpstg-caret",(function(t){t.preventDefault();var n=e(t.target).closest(".wpstg-dropdown-toggler");n&&n.trigger("click")})),document.addEventListener("click",(function(t){if(!t.target.closest(".wpstg-dropdown-toggler")){for(var n=document.getElementsByClassName("wpstg-dropdown-menu"),s=0;s<n.length;s++)n[s].classList.remove("shown");e(".wpstg-caret").removeClass("wpstg-caret-up")}})),window.addEventListener("finishedProcessWithError",(function(t){e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:t.detail.error,job_id:H.getJobId()}})})),document.addEventListener("click",(function(e){"wpstg-login-link"===e.target.id&&(e.preventDefault(),window.open("/wp-login.php","_blank"),window.WPStaging&&window.WPStaging.wpstgProcessModal&&(window.WPStaging.wpstgProcessModal.stop(),window.WPStaging.loadOverview()))})),document.addEventListener("click",(function(e){var t=e.target.id;if(["wpstg-send-schedules-error-report","wpstg-send-schedules-slack-error-report"].includes(t)){var n=document.getElementById(t+"-input");n&&n.classList.toggle("hidden")}}))})),window.addEventListener("load",n(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("true"!==localStorage.getItem("wpstgPushProcessCompleted")){e.next=5;break}return t=new te,e.next=4,t.logEventSuccess("push");case 4:localStorage.removeItem("wpstgPushProcessCompleted");case 5:case"end":return e.stop()}}),e)})))),document.addEventListener("DOMContentLoaded",(function(){var e=_(),t=L();("wpstg-settings"===e&&"temporary-login"!==t||["wpstg-tools","wpstg-license"].includes(e))&&k("hidden")}))}();
