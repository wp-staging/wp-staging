!function(){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},e.apply(this,arguments)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function s(e,s){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,s){if(e){if("string"==typeof e)return t(e,s);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,s):void 0}}(e))||s&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n=(Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),function(e,t){return e instanceof Element?e.closest(t):null});function o(e,t,s,n){var o,i,r,a,c=!1,l=!1,d={},g=0,u=0,p={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function w(e){o=e.clientX,i=e.clientY}function h(e,t){if(u&&(u=clearTimeout(u)),Math.abs(r-o)+Math.abs(a-i)<p.sensitivity)return g=1,l?void 0:s(e,t);r=o,a=i,u=setTimeout((function(){h(e,t)}),p.interval)}function f(e,t){return c=!0,u&&(u=clearTimeout(u)),e.removeEventListener("mousemove",w,!1),1!==g&&(r=t.clientX,a=t.clientY,e.addEventListener("mousemove",w,!1),u=setTimeout((function(){h(e,t)}),p.interval)),this}function m(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function b(e,t){return c=!1,u&&(u=clearTimeout(u)),e.removeEventListener("mousemove",w,!1),1===g&&(u=setTimeout((function(){!function(e,t){u&&(u=clearTimeout(u)),g=0,l||n(e,t)}(e,t)}),p.timeout)),this}function v(e){e.target.matches(t+", "+t+" *")&&b(e.target.closest(t),e)}function y(e){var n,o;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),o=e,c||(l=!0,s(n,o)))}function S(e){var s,o;e.target.matches(t+", "+t+" *")&&(s=e.target.closest(t),o=e,!c&&l&&(l=!1,n(s,o)))}function x(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",S,!1)}return d.options=function(t){var s=t.handleFocus!==p.handleFocus;return p=Object.assign({},p,t),s&&(p.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",S,!1)):x()),d},d.remove=function(){e&&(e.removeEventListener("mouseover",m,!1),e.removeEventListener("mouseout",v,!1),x())},e&&(e.addEventListener("mouseover",m,!1),e.addEventListener("mouseout",v,!1)),d}var i=function(e){var t={continueErrorHandle:!0,retry:{currentDelay:0,count:0,max:10,retryOnErrors:[401,403,404,429,502,503,504],performingRequest:!1,incrementRetry:function(e){void 0===e&&(e=1.25),t.retry.performingRequest=!0,0===t.retry.currentDelay&&(t.retry.currentDelay=1e3,t.retry.count=1),t.retry.currentDelay+=500*t.retry.count*e,t.retry.count++},canRetry:function(){return t.retry.count<t.retry.max},reset:function(){t.retry.currentDelay=0,t.retry.count=0,t.retry.performingRequest=!1}},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},listenTooltip:function(){o(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="hidden"}))},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var s={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},n={customClass:Object.assign(s,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(n)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?t.cache.get(".wpstg-loader").show():t.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},showAjaxFatalError:function(e,s,n){return s=s?s+"<br/><br/>":"Something went wrong! <br/><br/>",n=n?n+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(t.showError(s+" Error: No response."+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(t.showError(s+" Error: "+e.message+n),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(e){return e.ok||t.showError("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},showError:function(s){t.retry.performingRequest||(t.cache.get("#wpstg-try-again").css("display","inline-block"),t.cache.get("#wpstg-cancel-cloning").text("Reset"),t.cache.get("#wpstg-resume-cloning").show(),t.cache.get("#wpstg-error-wrapper").show(),t.cache.get("#wpstg-error-details").show().html(s),t.cache.get("#wpstg-removing-clone").removeClass("loading"),t.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(s))},resetErrors:function(){t.cache.get("#wpstg-error-details").hide().html("")},ajax:function(s,n,o,i,r,a,c){void 0===a&&(a=null),void 0===c&&(c=null),void 0===o&&(o="json"),!1!==i&&(i=!0);var l=10,d=1e4*(r=void 0===r?0:r);a=parseInt(a),isNaN(a)||(d*=a),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:o,cache:!1,data:s,error:function(e,g,u){if(console.log(e.status+" "+e.statusText+"---"+g),"function"!=typeof c||(c(e,g,u),t.continueErrorHandle))if(++r<=l)setTimeout((function(){t.ajax(s,n,o,i,r,a)}),d);else{var p=void 0===e.status?"Unknown":e.status;t.showError("Fatal Error:  "+p+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}else t.continueErrorHandle=!0},success:function(e){"function"==typeof n&&n(e)},statusCode:{404:function(){r>=l&&t.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){r>=l&&t.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){r>l&&t.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){r>=l&&t.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){r>=l&&t.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){r>=l&&t.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){r>=l&&t.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})}};return t}(jQuery);function r(e){return document.querySelector(e)}function a(e){return document.querySelectorAll(e)}function c(e,t,s,n){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(s+", "+s+" *")&&n(e.target.closest(s),e)}),!1)}function l(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var s=e.offsetHeight;e.style.height="0px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height=s+"px",window.setTimeout((function(){e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function d(e,t){void 0===t&&(t=400),e.style.display="block",e.style.overflow="hidden";var s=e.offsetHeight;e.style.height=s+"px",e.style.transitionProperty="height",e.style.transitionDuration=t+"ms",setTimeout((function(){e.style.height="0px",window.setTimeout((function(){e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)}),0)}function g(e,t){for(var s=e.previousElementSibling;s;){if(s.matches(t))return s;s=s.previousElementSibling}}function u(e){if(!(!e instanceof Element)&&e.id){var t="hidden";if("checkbox"!==e.getAttribute("type"));else{var o=n(e,".wpstg-container");if(null===o)return;var i=o.querySelectorAll('[data-show-if-checked="'+e.id+'"]'),r=o.querySelectorAll('[data-show-if-unchecked="'+e.id+'"]'),a=e.checked;if(i.length)for(var c,l=s(i);!(c=l()).done;){var d=c.value;a?d.classList.remove(t):d.classList.add(t)}if(r.length)for(var g,u=s(r);!(g=u()).done;){var p=g.value;a?p.classList.add(t):p.classList.remove(t)}}}}function p(e){if(!(!e instanceof Element)&&e.getAttribute("data-wpstg-target")){var t=n(e,".wpstg_admin");if(null!==t){var o=t.querySelectorAll(e.getAttribute("data-wpstg-target"));if(o.length)for(var i,r=s(o);!(i=r()).done;){i.value.classList.toggle("hidden")}}}}function w(e){if(!(!e instanceof Element)&&e.getAttribute("data-wpstg-target")&&e.getAttribute("data-wpstg-copy")){var t=n(e,".wpstg_admin");if(null!==t){navigator.clipboard.writeText(e.getAttribute("data-wpstg-copy"));var o=t.querySelectorAll(e.getAttribute("data-wpstg-target"));if(o.length)for(var i,r=s(o);!(i=r()).done;){i.value.value=e.getAttribute("data-wpstg-copy","")}}}}function h(e){if(!(!e instanceof Element)&&e.getAttribute("data-wpstg-source")){var t=n(e,".wpstg_admin");if(null!==t){var s=t.querySelector(e.getAttribute("data-wpstg-source"));s&&navigator.clipboard.writeText(s.value)}}}function f(e){document.querySelectorAll(e).forEach((function(e){e.style.display="none"}))}function m(e){document.querySelectorAll(e).forEach((function(e){e.style.display="block"}))}var b=function(){function e(){this.init()}var t=e.prototype;return t.init=function(){this.wpstdStagingTab=document.querySelector("#wpstg--tab--toggle--staging"),this.wpstdBackupTab=document.querySelector("#wpstg--tab--toggle--backup"),this.wpstdSidebarMenu=document.querySelector("#toplevel_page_wpstg_clone"),this.addEvents()},t.addEvents=function(){var e=this;null!==this.wpstdStagingTab&&this.wpstdStagingTab.addEventListener("click",(function(){e.setPageUrl("wpstg_clone"),e.setSidebarMenu("wpstg_clone")})),null!==this.wpstdBackupTab&&this.wpstdBackupTab.addEventListener("click",(function(){e.setPageUrl("wpstg_backup"),e.setSidebarMenu("wpstg_backup")}))},t.setPageUrl=function(e){window.history.pushState(null,null,window.location.pathname+"?page="+e)},t.setSidebarMenu=function(e){var t=this.wpstdSidebarMenu.querySelector("ul").querySelectorAll("li");if(t.length>0)for(var s=0;s<t.length;s++)t[s].classList.remove("current"),null!==t[s].querySelector("a")&&t[s].querySelector("a").getAttribute("href")==="admin.php?page="+e&&t[s].classList.add("current")},e}(),v=function(){function e(e,t){void 0===e&&(e="contact-us"),void 0===t&&(t=wpstg),this.wpstgObject=t,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=e,this.init()}var t=e.prototype;return t.init=function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.askInTheForumForm=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-form",this.contactUsSuccessPopup=this.contactUsModal+" #wpstg-"+this.modalType+"-success-form",this.contactUsLoader=this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-loader",this.contactUsSupport=this.contactUsModal+" #wpstg-"+this.modalType+"-support-forum",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.reportIssueButton=document.querySelector("#wpstg-contact-us-report-issue"),this.successForm=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" #wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" #wpstg-"+this.modalType+"-debug-code"),this.isDebugWindowOpened=!1,this.addEvents(),this.notyf=new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]})},t.addEvents=function(){var e=this;document.addEventListener("keydown",(function(t){"Escape"===t.key&&(f(e.contactUsModal),f(e.askInTheForumForm),f(e.contactUsSuccessPopup),f(e.contactUsSupport),e.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){m(e.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){m(e.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){e.isDebugWindowOpened?f(e.askInTheForumForm):m(e.askInTheForumForm),e.isDebugWindowOpened=!e.isDebugWindowOpened})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){e.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){f(e.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){f(e.contactUsModal),f(e.contactUsSupport),f(e.askInTheForumForm),e.isDebugWindowOpened=!1})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){e.copyDebugCode(),e.notyf.success("Debug code copied to clipboard")}))},t.copyDebugCode=function(){this.contactUsDebugCodeField.select(),this.contactUsDebugCodeField.setSelectionRange(0,99999),navigator.clipboard.writeText(this.contactUsDebugCodeField.value)},t.generateDebugCode=function(e){for(var t="",s=0;s<e;s++)t+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+t+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()},t.sendDebugInfo=function(){var e=this;m(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0;var t=this.generateDebugCode(8);fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_send_debug_log_report",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,debugCode:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){if(e.contactUsReportIssueBtn.disabled=!1,t.ok)return t.json()})).then((function(s){s.response&&!0===s.response.sent?(e.contactUsDebugCodeField.value=t,m(e.contactUsSuccessPopup),window.debugCode=t):(e.contactUsDebugCodeField.value=void 0===window.debugCode?t:window.debugCode,m(e.contactUsSuccessPopup)),f(e.contactUsLoader)})).catch((function(t){f(e.contactUsLoader),m(e.contactUsSupport),console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},e}(),y=function(){function e(e,t){void 0===e&&(e="#wpstg-clonepage-wrapper"),void 0===t&&(t=wpstg),this.pageWrapper=r(e),this.wpstgObject=t,this.enableButtonId="#wpstg-enable-staging-cloning",this.enableAction="wpstg_enable_staging_cloning",this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.pageWrapper&&(c(this.pageWrapper,"click",this.enableButtonId,(function(){e.sendRequest(e.enableAction)})),new b)},t.init=function(){this.addEvents()},t.sendRequest=function(e){var t=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){void 0!==e.success&&e.success?location.reload():void 0===e.message?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):t.notyf.error(e.message)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},e}(),S=function(){function e(e,t,s){void 0===e&&(e="#wpstg-directories-listing"),void 0===t&&(t=i),void 0===s&&(s=null),this.directoryListingContainer=r(e),this.wpstgObject=t,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.notyf=s,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.directoryListingContainer?(c(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(e,t){t.preventDefault()})),c(this.directoryListingContainer,"click",this.dirExpandSelector,(function(t,s){s.preventDefault(),e.toggleDirExpand(t)&&e.sendRequest(e.fetchChildrenAction,t)})),c(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){e.unselectAll()})),c(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){e.selectDefault()})),c(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(t,s){s.preventDefault(),e.toggleDirectoryNavigation(t)})),c(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(t){e.updateDirectorySelection(t)}))):console.log("Error: Unable to add directory navigation events.")},t.init=function(){this.addEvents(),this.parseExcludes()},t.toggleDirExpand=function(e){return this.currentParentDiv=e.parentElement,this.currentCheckboxElement=g(e,"input"),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("wpstg-data-navigateable","false")&&"false"===this.currentCheckboxElement.getAttribute("wpstg-data-scanned","false")},t.sendRequest=function(e){var t=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var s=this.currentCheckboxElement.getAttribute("wpstg-data-changed"),n=this.currentCheckboxElement.getAttribute("wpstg-data-path"),o=this.currentCheckboxElement.getAttribute("wpstg-data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:e,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:n,prefix:o,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===s}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){if(void 0!==e.success&&e.success){t.currentCheckboxElement.setAttribute("wpstg-data-scanned",!0);var s=document.createElement("div");return s.classList.add("wpstg-dir"),s.classList.add("wpstg-subdir"),s.innerHTML=JSON.parse(e.directoryListing),t.currentParentDiv.appendChild(s),null!==t.currentLoader&&(t.currentLoader.style.display="none"),void l(s)}null!==t.notyf?t.notyf.error(t.wpstgObject.i18n.somethingWentWrong):alert("Error: "+t.wpstgObject.i18n.somethingWentWrong)})).catch((function(e){console.warn(t.wpstgObject.i18n.somethingWentWrong,e)}))},t.getExcludedDirectories=function(){var e,t=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir input:not(:checked)").forEach((function(e){t.isParentExcluded(e.value)||t.excludedDirectories.push(e.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(e){t.isParentExcluded(e)||t.isScanned(e)||t.excludedDirectories.push(e)})),this.excludedDirectories.join(null==(e=this.wpstgObject.settings)?void 0:e.directorySeparator)},t.isParentExcluded=function(e){var t=!1;return this.excludedDirectories.forEach((function(s){e.startsWith(s+"/")&&(t=!0)})),t},t.getExtraDirectoriesRootOnly=function(){this.getExcludedDirectories();var e=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir>input.wpstg-wp-non-core-dir:checked").forEach((function(t){e.push(t.value)}));var t,s=r("#wpstg_extraDirectories");if(null===s||""===s.value)return e.join(null==(t=this.wpstgObject.settings)?void 0:t.directorySeparator);var n=s.value.split(/\r?\n/);return e.concat(n).join(this.wpstgObject.settings.directorySeparator)},t.unselectAll=function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir input").forEach((function(e){e.checked=!1})),this.countSelectedFiles()},t.selectDefault=function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir input.wpstg-wp-core-dir").forEach((function(e){e.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg-wp-non-core-dir").forEach((function(e){e.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(e){e.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()},t.parseExcludes=function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("wpstg-data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var e=this.existingExcludes.split(",");this.existingExcludes=e.map((function(e){return"/"===e.substr(0,1)?e.slice(1):e}))}else this.existingExcludes=[];else this.existingExcludes=[]},t.isScanned=function(e){var t=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir>input").forEach((function(s){s.value===e&&(t=!0)})),t},t.toggleDirectoryNavigation=function(e){var t=g(e,"input");if("false"!==t.getAttribute("wpstg-data-navigateable","false")&&"false"!==t.getAttribute("wpstg-data-scanned","false")){var s=function(e,t){for(var s=e.nextElementSibling;s;){if(s.matches(t))return s;s=s.nextElementSibling}}(e,".wpstg-subdir");"none"===s.style.display?l(s):d(s)}},t.updateDirectorySelection=function(e){var t=e.parentElement;e.setAttribute("wpstg-data-changed","true"),e.checked?(function(e,t){for(var s=[],n=e&&e.parentElement;n;n=n.parentElement)n.matches(t)&&s.push(n);return s}(t,".wpstg-dir").forEach((function(e){for(var t=0;t<e.children.length;t++)e.children[t].matches(".wpstg-check-dir")&&(e.children[t].checked=!0)})),t.querySelectorAll(".wpstg-expand-dirs").forEach((function(e){"wp-admin"!==e.textContent&&"wp-includes"!==e.textContent&&e.classList.remove("disabled")})),t.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(e){e.checked=!0}))):(t.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(e){e.classList.add("disabled")})),t.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(e){e.checked=!1}))),this.countSelectedFiles()},t.countSelectedFiles=function(){var e=this.directoryListingContainer.querySelectorAll('[wpstg-data-dir-type="theme"]:checked').length,t=this.directoryListingContainer.querySelectorAll('[wpstg-data-dir-type="plugin"]:checked').length,s=r("#wpstg-files-count");0===e&&0===t?(s.classList.add("danger"),s.innerHTML=this.wpstgObject.i18n.noFileSelected):(s.classList.remove("danger"),s.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",e).replace("{p}",t))},e}(),x=function(){function e(e,t,s,n,o){void 0===e&&(e="#wpstg-scanning-db"),void 0===t&&(t="#wpstg-workflow"),void 0===s&&(s="#wpstg_network_clone"),void 0===n&&(n="#wpstg_select_tables_cloning"),void 0===o&&(o=wpstg),this.databaseTableSection=r(e),this.workflow=r(t),this.networkCloneSelector=s,this.networkCloneCheckbox=r(s),this.wpstgObject=o,this.isAllTablesChecked=!0,this.isMultisite="1"===this.wpstgObject.isMultisite,this.isNetworkClone=!1,this.inputSelector=n,this.input=r(this.inputSelector),this.init()}var t=e.prototype;return t.setNetworkClone=function(e){this.isNetworkClone=e},t.addEvents=function(){var e=this;null!==this.workflow?(c(this.workflow,"change",this.networkCloneSelector,(function(){e.selectDefaultTables()})),c(this.workflow,"change",this.inputSelector,(function(){e.countSelectedTables()})),c(this.workflow,"click",".wpstg-button-select",(function(t,s){s.preventDefault(),e.selectDefaultTables()})),c(this.workflow,"click",".wpstg-button-unselect",(function(t,s){s.preventDefault(),e.toggleTableSelection()})),c(this.workflow,"click",".wpstg-button-unselect-wpstg",(function(t,s){s.preventDefault(),e.unselectWPSTGTables()}))):console.log("Error: database table section is null. Cannot register events")},t.init=function(){this.addEvents()},t.getRegexPattern=function(){var e="^"+this.wpstgObject.tblprefix,t=!1;return void 0!==this.networkCloneCheckbox&&null!==this.networkCloneCheckbox&&(t=this.networkCloneCheckbox.checked),this.isNetworkClone&&(t=!0),this.isMultisite&&!t&&(e+="([^0-9])_*"),e},t.selectDefaultTables=function(){var e=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table"),t=this.getRegexPattern();e.forEach((function(e){e.getAttribute("name","").match(t)?e.selected=!0:e.selected=!1})),this.countSelectedTables()},t.toggleTableSelection=function(){!1===this.isAllTablesChecked?(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.selected=!0})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.isAllTablesChecked=!0):(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(e){e.selected=!1})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.isAllTablesChecked=!1),this.countSelectedTables()},t.unselectWPSTGTables=function(){var e=this,t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table");t.forEach((function(t){var s=t.getAttribute("name","");s.match("wpstg")&&!s.match(e.wpstgObject.tblprefix+"wpstg_queue")&&(t.selected=!1)})),this.countSelectedTables()},t.getSelectedTablesWithoutPrefix=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),s=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(s)||e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getIncludedTables=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),s=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(s)&&e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getExcludedTables=function(){var e=[],t=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:not(:checked)"),s=this.getRegexPattern();return t.forEach((function(t){t.getAttribute("name","").match(s)&&e.push(t.value)})),e.join(this.wpstgObject.settings.directorySeparator)},t.countSelectedTables=function(){var e=this.input.querySelectorAll("option:checked").length,t=r("#wpstg-tables-count");0===e?(t.classList.add("danger"),t.innerHTML=this.wpstgObject.i18n.noTableSelected):(t.classList.remove("danger"),t.innerHTML=this.wpstgObject.i18n.tablesSelected.replace("{d}",e))},e}(),k=function(){function e(e,t){void 0===e&&(e="#wpstg-exclude-filters-container"),void 0===t&&(t=wpstg),this.excludeContainer=r(e),this.excludeTableBody=r(e+" tbody"),this.wpstgObject=t,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;c(this.excludeContainer,"click",".wpstg-file-size-rule",(function(){e.addFileSizeExclude()})),c(this.excludeContainer,"click",".wpstg-file-ext-rule",(function(){e.addFileExtExclude()})),c(this.excludeContainer,"click",".wpstg-file-name-rule",(function(){e.addFileNameExclude()})),c(this.excludeContainer,"click",".wpstg-dir-name-rule",(function(){e.addDirNameExclude()})),c(this.excludeContainer,"click",".wpstg-clear-all-rules",(function(){e.clearExcludes()})),c(this.excludeContainer,"click",".wpstg-remove-exclude-rule",(function(t){e.removeExclude(t)}))},t.init=function(){null!==this.excludeContainer?this.addEvents():console.log("Error: Given table selector not found!")},t.addFileSizeExclude=function(){this.addExcludeRuleRow("#wpstg-file-size-exclude-filter-template")},t.addFileExtExclude=function(){this.addExcludeRuleRow("#wpstg-file-ext-exclude-filter-template")},t.addFileNameExclude=function(){this.addExcludeRuleRow("#wpstg-file-name-exclude-filter-template")},t.addDirNameExclude=function(){this.addExcludeRuleRow("#wpstg-dir-name-exclude-filter-template")},t.addExcludeRuleRow=function(e){var t=r(e);if(null!==t){var s=t.content.cloneNode(!0).querySelector("tr");this.excludeTableBody.appendChild(s),a(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="inherit"}))}},t.clearExcludes=function(){this.excludeTableBody.innerHTML="",a(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.removeExclude=function(e){null!==e.parentElement&&null!==e.parentElement.parentElement&&this.excludeTableBody.removeChild(e.parentElement.parentElement),""===this.excludeTableBody.innerHTML.trim()&&a(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))},t.getExcludeFilters=function(){for(var e=this,t=[],s=[],n=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleCompare[]"]'),o=this.excludeTableBody.querySelectorAll('input[name="wpstgFileSizeExcludeRuleSize[]"]'),i=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleByte[]"]'),r=0,a=Object.entries(o);r<a.length;r++){var c=a[r],l=c[0],d=c[1];""!==d.value&&s.push(n[l].value+" "+d.value+i[l].value)}this.excludeTableBody.querySelectorAll('input[name="wpstgFileExtExcludeRule[]"]').forEach((function(s){var n=e.cleanStringForGlob(s.value);""!==n&&t.push("ext:"+n.trim())}));for(var g=this.excludeTableBody.querySelectorAll('select[name="wpstgFileNameExcludeRulePos[]"]'),u=this.excludeTableBody.querySelectorAll('input[name="wpstgFileNameExcludeRulePath[]"]'),p=0,w=Object.entries(u);p<w.length;p++){var h=w[p],f=h[0],m=h[1],b=this.cleanStringForGlob(m.value);""!==b&&t.push("file:"+g[f].value+" "+b.trim())}for(var v=this.excludeTableBody.querySelectorAll('select[name="wpstgDirNameExcludeRulePos[]"]'),y=this.excludeTableBody.querySelectorAll('input[name="wpstgDirNameExcludeRulePath[]"]'),S=0,x=Object.entries(y);S<x.length;S++){var k=x[S],C=k[0],T=k[1],E=this.cleanStringForGlob(T.value);""!==E&&t.push("dir:"+v[C].value+" "+E.trim())}return{sizes:s.filter(this.onlyUnique).join(","),globs:t.filter(this.onlyUnique).join(",")}},t.onlyUnique=function(e,t,s){return s.indexOf(e)===t},t.cleanStringForGlob=function(e){return e.replace(/[*^//!\[?]/g,"")},e}(),C=function(){function e(e,t){void 0===t&&(t=wpstg),this.confirmAction=e,this.wpstgObject=t}var t=e.prototype;return t.show=function(e,t,s){var n=this;void 0===t&&(t={}),void 0===s&&(s=null),wpstgSwal.fire(e).then((function(e){e.value&&null!==n.error&&n.triggerConfirmAction(t,s)}))},t.triggerConfirmAction=function(e,t){var s=this;void 0===e&&(e={}),void 0===t&&(t=null),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams(Object.assign({action:this.confirmAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce},e)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){null!==t&&t(e)})).catch((function(e){console.log(s.wpstgObject.i18n.somethingWentWrong,e)}))},e}(),T=function(){function e(e,t,s,n,o){void 0===t&&(t="#wpstg-workflow"),void 0===s&&(s="wpstg_clone_excludes_settings"),void 0===n&&(n="wpstg_modal_error"),void 0===o&&(o=wpstg),this.cloneID=e,this.workflow=r(t),this.wpstgObject=o,this.fetchExcludeSettingsAction=s,this.modalErrorAction=n,this.resetButtonClass="wpstg-confirm-reset-clone",this.resetModalContainerClass="wpstg-reset-confirmation",this.resetTabSelector=".wpstg-reset-exclude-tab",this.directoryNavigator=null,this.excludeFilters=null,this.tableSelector=null,this.isNetworkClone=!1}var t=e.prototype;return t.addEvents=function(){var e=this,t=r("."+this.resetModalContainerClass);null!==t?c(t,"click",this.resetTabSelector,(function(t){e.toggleContent(t)})):console.log("Exit")},t.init=function(){this.addEvents()},t.setNetworkClone=function(e){this.isNetworkClone=e},t.toggleContent=function(e){var t=r("."+this.resetModalContainerClass),s=e.getAttribute("data-id"),n=e.querySelector(".wpstg-tab-triangle"),o=e.getAttribute("data-collapsed","true"),i=r(s);"true"===o?(t.classList.contains("has-collapsible-open")?t.classList.add("has-collapsible-open-2"):t.classList.add("has-collapsible-open"),l(i),n.style.transform="rotate(90deg)",e.setAttribute("data-collapsed","false")):(t.classList.contains("has-collapsible-open-2")?t.classList.remove("has-collapsible-open-2"):t.classList.remove("has-collapsible-open"),d(i),n.style.removeProperty("transform"),e.setAttribute("data-collapsed","true"))},t.showModal=function(){var e=this.loadModal();return this.init(),this.fetchCloneExcludes(),e},t.loadModal=function(){return i.getSwalModal(!1,{confirmButton:this.resetButtonClass+" wpstg-confirm-reset-clone wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",container:this.resetModalContainerClass+" wpstg-swal2-container wpstg-swal2-loading"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"400px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.resetClone,showCancelButton:!0})},t.fetchCloneExcludes=function(){var e=this;this.error=null,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.fetchExcludeSettingsAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,job:"resetting"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(t.success){var s=r(".wpstg-reset-confirmation");s.classList.remove("wpstg-swal2-loading"),s.querySelector(".wpstg--swal2-popup").style.width="540px",s.querySelector(".wpstg--swal2-content").innerHTML=t.html,e.directoryNavigator=new S("#wpstg-directories-listing",wpstg,null),e.directoryNavigator.countSelectedFiles(),e.excludeFilters=new k,e.tableSelector=new x("#wpstg-reset-excluded-tables","."+e.resetModalContainerClass),e.tableSelector.setNetworkClone(e.isNetworkClone),e.tableSelector.countSelectedTables()}else{new C(e.modalErrorAction,e.wpstgObject).show(Object.assign({title:"Error",icon:"error",html:e.wpstgObject.i18n.somethingWentWrong,width:"500px",confirmButtonText:"Ok",showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},t.swalOptions),{type:t.type})}})).catch((function(t){e.renderError({html:e.wpstgObject.i18n.somethingWentWrong+" "+t})}))},t.getDirectoryNavigator=function(){return this.directoryNavigator},t.getExcludeFilters=function(){return this.excludeFilters},t.getTableSelector=function(){return this.tableSelector},t.getAjaxLoader=function(){return'<div class="wpstg-swal2-ajax-loader"><img src="'+this.wpstgObject.wpstgIcon+'" /></div>'},e}(),E=function(){function e(e){void 0===e&&(e="#wpstg-clonepage-wrapper"),this.baseContainer=r(e),this.checkBoxSettingTogglerSelector=".wpstg-toggle-advance-settings-section",this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.baseContainer&&c(this.baseContainer,"change",this.checkBoxSettingTogglerSelector,(function(t){e.toggleSettings(t)}))},t.init=function(){this.addEvents()},t.toggleSettings=function(e){var t=r("#"+e.getAttribute("data-id"));e.checked?l(t):d(t)},e}(),_=function(){function e(){this.activeTabClass="wpstg--tab--active",this.mainMenu()}return e.prototype.mainMenu=function(){var e=this;null!==r(".wpstg--tab--header")&&c(r(".wpstg--tab--header"),"click",".wpstg-button",(function(t){var s=t,n=s.getAttribute("data-target");if(""!==n){var o=a(n),i=a(".wpstg--tab--header a[data-target]");a(".wpstg--tab--contents > .wpstg--tab--content").forEach((function(t){t.matches("."+e.activeTabClass+":not("+n+")")&&t.classList.remove(e.activeTabClass)})),i.forEach((function(t){t!==s&&t.classList.remove(e.activeTabClass)})),s.classList.add(e.activeTabClass),o.forEach((function(t){t.classList.add(e.activeTabClass)})),"#wpstg--tab--backup"===n&&window.dispatchEvent(new Event("backups-tab"))}}))},e}(),P=function(){function e(e){void 0===e&&(e=wpstg),this.wpstgObject=e,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval="",this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl=""}var t=e.prototype;return t.start=function(){var e=this;(this.showCancelButton=!0,this.processInterval=setInterval((function(){e.processTime++,e.updateElapsedTime()}),1e3),"wpstg_delete_clone"===this.action)&&(f(".wpstg--modal--process--logs--tail"),this.showCancelButton=!1,i.getSwalContainer().querySelector(".wpstg--modal--process--percent").textContent=100);f(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),f(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")},t.stop=function(){var e=this;this.processTime=0,this.modal=null,this.percentage="",setTimeout((function(){e.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),clearInterval(this.processInterval),i.closeSwalModal(),f("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader")},t.cancelProcess=function(){confirm("Are you sure you want to cancel cloning process?")&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(i.getSwalContainer().querySelector(".wpstg--modal--process--title").textContent="Canceling Please wait....",this.stop(),m("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())},t.setTitle=function(e){this.title=e.job,"database"===e.job||"jobCopyDatabaseTmp"===e.job?(this.title="Copying Database",this.disableCancelButton=!1):"SearchReplace"===e.job?(this.title="Processing Data",this.disableCancelButton=!1):"directories"===e.job||"jobFileScanning"===e.job?(this.title="Scanning Files",this.disableCancelButton=!1):"files"===e.job||"data"===e.job||"jobCopy"===e.job||"jobSearchReplace"===e.job?(this.title="Copying Files",this.disableCancelButton=!1):"Backup"===e.job?(this.title="Backup Files Scanning",this.disableCancelButton=!1):"finish"===e.job||"finished"===e.status?(this.title="Process Finished",this.disableCancelButton=!1):"jobDatabaseRename"===e.job?(this.title="Renaming Database",this.disableCancelButton=!0):"jobData"===e.job&&(this.title="Updating Database Data",this.disableCancelButton=!0)},t.setPercentage=function(e){null!==e.percentage&&(this.percentage=e.percentage)},t.initializeProcessModal=function(){var e=this,t=document.querySelector("#wpstg--modal--backup--process"),s=t.innerHTML;t.parentNode.removeChild(t),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:i.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:s,cancelButtonText:"Cancel",showCancelButton:this.showCancelButton,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var t=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],s=t.cloneNode(!0);t.parentNode.replaceChild(s,t),s.addEventListener("click",(function(){e.cancelProcess()}))}})},this.start()},t.setProcessModal=function(){var e=i.getSwalContainer(),t=e.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],s=e.querySelector(".wpstg--modal--process--title"),n=e.querySelector(".wpstg--modal--process--percent");s.textContent=this.title,n.textContent=this.percentage,t.disabled=this.disableCancelButton},t.openProcessModal=function(e,t,s,n){void 0===s&&(s=!1),void 0===n&&(n=!0),this.isProcessCancelled||WPStaging.isCancelled||(void 0!==e&&(this.action=e.action,this.cloneId=e.cloneID),this.showCancelButton=n,this.showLogs=s,this.modal?t.job?(this.setTitle(t),this.setPercentage(t),this.setProcessModal(),"finish"===t.job&&this.stop()):"finished"===t.status&&this.stop():this.initializeProcessModal())},t.formatTimeDuration=function(){return new Date(1e3*this.processTime).toISOString().slice(11,19)+"s"},t.updateElapsedTime=function(){null!==this.processInterval&&(i.getSwalContainer().querySelector(".wpstg--modal--process--elapsed-time").textContent=this.formatTimeDuration())},t.getCancelCloneAction=function(){var e=this;if(""!==this.action)return[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(t){return t.name===e.action})).cancel},t.cancelCloneAction=function(){var e=this;this.action&&fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.getCancelCloneAction(),accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){(t&&void 0!==t.delete&&"finished"===t.delete||!0===t)&&(e.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==t&&e.cancelCloneAction()})).catch((function(t){console.log(e.wpstgObject.i18n.somethingWentWrong,t)}))},t.initializeSuccessModal=function(e){var t=this;this.successModal=this.setSuccessModalContent(e),i.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1}).then((function(e){e.value&&(t.action="",i.closeSwalModal(),f(".wpstg-loader"),WPStaging.messages=[],"wpstg_delete_clone"!==t.action&&location.reload())})),this.showProcessLogs&&m(".wpstg--modal--download--logs--wrapper"),f(".wpstg-loader"),"wpstg_delete_clone"!==this.action&&WPStaging.loadOverview()},t.setSuccessModalContent=function(e){var t=document.getElementById("wpstg--modal--backup--download");if(null!==e.title&&(t.innerHTML=t.innerHTML.replace("{title}",e.title)),this.showProcessLogs&&(t.innerHTML=t.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null!==e.body&&void 0!==e.body){var s=e.body;null!==this.stagingSiteUrl&&(s+='<br><strong><a href="'+this.stagingSiteUrl+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>"),t.innerHTML=t.innerHTML.replace("{text}",s)}else t.innerHTML=t.innerHTML.replace("{text}","");return t},t.openSuccessModal=function(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=null),this.stagingSiteUrl=s,this.showProcessLogs=t,this.initializeSuccessModal(e)},e}(),j=function(t){var s={isCancelled:!1,isFinished:!1,getLogs:!1,time:1,executionTime:!1,progressBar:0,cloneExcludeFilters:null,directoryNavigator:null,tableSelector:null,notyf:null,areAllTablesChecked:!0,handleDisplayDependencies:u,handleToggleElement:p,handleCopyPaste:w,handleCopyToClipboard:h,messages:[],modal:{instance:"",processTime:0,processInterval:"",currentJob:""}};s.wpstgProcessModal=new P;var n,o={elements:[]};o.get=function(e){return-1!==t.inArray(e,o.elements)||(o.elements[e]=jQuery(e)),o.elements[e]},o.refresh=function(e){e.elements[e]=jQuery(e)};var r=function(e){o.get("#wpstg-try-again").css("display","inline-block"),o.get("#wpstg-cancel-cloning").text("Reset"),o.get("#wpstg-resume-cloning").show(),o.get("#wpstg-error-wrapper").show(),o.get("#wpstg-error-details").show().html(e),o.get(".wpstg-loading-bar-container").css("visibility","hidden"),o.get(".wpstg-loader").hide(),t(".wpstg--modal--process--generic-problem").show().html(e),t.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_staging_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:e}})};s.warnIfClosingDuringProcess=function(e){return e.returnValue="You MUST leave this window open while cloning/pushing. Please wait...",null};var a=function(e,t,s){return t=t?t+"<br/><br/>":"Something went wrong! <br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(r(t+" Error: No response."+s),void window.removeEventListener("beforeunload",j.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(console.error(e.message),r(t+" Error: "+e.message+s),void window.removeEventListener("beforeunload",j.warnIfClosingDuringProcess)):void 0},c=function(){o.get("#wpstg-error-details").hide().html("")},l=function(){var e=t("#wpstg_clone_hostname").val();if(""===e)return!0;return!1!==/^http(s)?:\/\/.*$/.test(e)},d=function(){var e=o.get("#wpstg-workflow");e.on("click","#wpstg-cancel-cloning",(function(){if(!confirm("Are you sure you want to cancel cloning process?"))return!1;var e=t(this);t("#wpstg-try-again, #wpstg-home-link").hide(),e.prop("disabled",!0),s.isCancelled=!0,s.progressBar=0,t("#wpstg-processing-status").text("Please wait...this can take up a while."),t(".wpstg-loader, #wpstg-show-log-button").hide(),e.parent().append(n),M()})).on("click","#wpstg-resume-cloning",(function(){c();var e=t(this);t("#wpstg-try-again, #wpstg-home-link").hide(),s.isCancelled=!1,t("#wpstg-processing-status").text("Try to resume cloning process..."),t("#wpstg-error-details").hide(),t(".wpstg-loader").show(),e.parent().append(n),s.startCloning()})).on("click","#wpstg-cancel-cloning-update",(function(){c();var e=t(this);t("#wpstg-try-again, #wpstg-home-link").hide(),e.prop("disabled",!0),s.isCancelled=!0,t("#wpstg-cloning-result").text("Please wait...this can take up a while."),t(".wpstg-loader, #wpstg-show-log-button").hide(),e.parent().append(n),U()})).on("click","#wpstg-restart-cloning",(function(){c();var e=t(this);t("#wpstg-try-again, #wpstg-home-link").hide(),e.prop("disabled",!0),s.isCancelled=!0,t("#wpstg-cloning-result").text("Please wait...this can take up a while."),t(".wpstg-loader, #wpstg-show-log-button").hide(),e.parent().append(n),O()})).on("click",".wpstg-remove-clone[data-clone]",(function(n){c(),n.preventDefault(),e.removeClass("active"),o.get(".wpstg-loader").show();var r=t(this).data("clone"),a=t(this).data("name");g({action:"wpstg_confirm_delete_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:t(this).data("clone")},(function(e){i.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal wpstg-delete-staging-site-modal",content:"wpstg--process--content"}).fire({title:'Delete staging site "'+a+'"',icon:"error",html:e,width:"100%",focusConfirm:!1,confirmButtonText:"Delete",confirmButtonColor:"#e01e5a",showCancelButton:!0,onRender:function(){var e=document.getElementById("wpstg-unselect-all-tables"),t=document.getElementById("wpstg-unselect-all-tables-id");null!==e&&e.addEventListener("click",(function(e){!1===s.areAllTablesChecked?(o.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),o.get("#wpstgUnselectAllTablesId").text("Unselect All"),t.textContent="Unselect All",o.get(".wpstg-db-table-checkboxes").prop("checked",!0),s.areAllTablesChecked=!0):(o.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),o.get("#wpstgUnselectAllTablesId").text("Select All"),t.textContent="Select All",o.get(".wpstg-db-table-checkboxes").prop("checked",!1),s.areAllTablesChecked=!1)})),document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container"),document.querySelector(".wpstg--swal2-confirm").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-left").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-right").style.background="#e01e5a",document.querySelector(".wpstg--swal2-icon.wpstg--swal2-error").style.borderColor="#e01e5a";var n=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],r=n.cloneNode(!0);n.parentNode.replaceChild(r,n),r.addEventListener("click",(function(e){i.closeSwalModal(),s.modal.instance=null,o.get(".wpstg-loader").removeClass("wpstg-finished"),o.get(".wpstg-loader").hide()}))}}).then((function(e){if(e.value){var n=document.querySelector("#deleteDirectory:checked"),o="",i=[];null!==n&&(o=n.getAttribute("data-deletepath")),t(".wpstg-db-table input:not(:checked)").each((function(){i.push(this.name)})),s.modal.instance=null;s.wpstgProcessModal.openProcessModal({action:"wpstg_delete_clone",cloneID:r},{job:"delete"},!1,!1),I(r,o,i)}}))}),"HTML")})).on("click","#wpstg-remove-clone",(function(e){c(),e.preventDefault(),o.get(".wpstg-loader").show(),I(t(this).data("clone"))})).on("click","#wpstg-cancel-removing",(function(e){e.preventDefault(),t(".wpstg-clone").removeClass("active"),o.get("#wpstg-removing-clone").html("")})).on("click",".wpstg-execute-clone",(function(n){n.preventDefault();var o=t(this).data("clone");s.cloneExcludeFilters=null,g({action:"wpstg_scanning",clone:o,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){t.length<1&&r("Something went wrong! Error: No response.  Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.");var n=L(t);!1===n||!1!==n.success?(e.html(t),R(),s.directoryNavigator=new S("#wpstg-directories-listing",wpstg,s.notyf),s.directoryNavigator.countSelectedFiles(),s.tableSelector=new x("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg,s.notyf),s.tableSelector.countSelectedTables(),s.cloneExcludeFilters=new k,s.switchStep(2)):D(n)}),"HTML")})).on("click","#wpstg-update-cloning-site-button",(function(e){window.open(s.data.cloneHostname,"_blank")})).on("click",".wpstg-reset-clone",(function(e){e.preventDefault();var n=t(this).data("clone"),o=new T(n);o.setNetworkClone("yes"===t(this).data("network"));var i=o.showModal();s.areAllTablesChecked=!0,i.then((function(e){if(e.value){var t=o.getDirectoryNavigator(),s=o.getTableSelector(),i=o.getExcludeFilters().getExcludeFilters(),r="",a="",c="",l=!1;null!==s&&(r=s.getIncludedTables(),a=s.getExcludedTables(),c=s.getSelectedTablesWithoutPrefix()),r.length>a.length?r="":a.length>r.length&&(a="",l=""===r),A(n,{includedTables:r,excludedTables:a,allTablesExcluded:l,selectedTablesWithoutPrefix:c,excludeSizeRules:encodeURIComponent(i.sizes),excludeGlobRules:encodeURIComponent(i.globs),excludedDirectories:t.getExcludedDirectories(),extraDirectories:t.getExtraDirectoriesRootOnly()})}}))}))},g=function e(s,n,o,i,a,c){void 0===c&&(c=null),void 0===o&&(o="json"),!1!==i&&(i=!0);var l=1e4*(a=void 0===a?0:a);c=parseInt(c),isNaN(c)||(l*=c);var d="Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP STAGING Small Server Settings</a> or submit an error report and contact us. <br/><br/><strong>Tip:</strong> If you get this error while pushing, you can also use the <strong>BACKUP & MIGRATION</strong> feature to move your staging site to live. <a href='https://wp-staging.com/docs/how-to-migrate-your-wordpress-site-to-a-new-host/' target='_blank'>Read more.</a>";t.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:o,cache:!1,data:s,error:function(t,g,u){if(++a<=5)console.log("RETRYING "+a+"/5"),setTimeout((function(){e(s,n,o,i,a,c)}),l);else{console.log("RETRYING LIMIT");var p=void 0===t.status?"Unknown":t.status;r("Fatal Error:  "+p+" "+d)}},success:function(e){"function"==typeof n&&n(e)},statusCode:{404:function(){a>=5&&r("Error 404 - Can't find ajax request URL! "+d)},500:function(){a>=5&&r("Fatal Error 500 - Internal server error while processing the request! "+d)},504:function(){a>5&&r("Error 504 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+d)},502:function(){a>=5&&r("Error 502 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+d)},503:function(){a>=5&&r("Error 503 - It seem your server is rate limiting ajax requests. Please try to resume after a minute. "+d)},429:function(){a>=5&&r("Error 429 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+d)},403:function(){a>=5&&r("Refresh page or login again! The process should be finished successfully. \n ")}}})},f=function(e,t){o.get(".wpstg-loader").show(),g({action:"wpstg_database_verification",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:o.get("#wpstg_db_username").val(),databasePassword:o.get("#wpstg_db_password").val(),databaseServer:o.get("#wpstg_db_server").val(),databaseDatabase:o.get("#wpstg_db_database").val(),databaseSsl:o.get("#wpstg_db_ssl").is(":checked")},(function(s){if(!1===s)return r("Something went wrong! Error: No response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void o.get(".wpstg-loader").hide();if(void 0===s.success)return r("Something went wrong! Error: Invalid response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void o.get(".wpstg-loader").hide();if(s.success)return o.get(".wpstg-loader").hide(),void m(e,t);if("comparison"===s.error_type){o.get(".wpstg-loader").hide();var n='<table class="wpstg-db-comparison-table"><thead><tr><th>Property</th><th>Production DB</th><th>Staging DB</th><th>Status</th></tr></thead><tbody>';return s.checks.forEach((function(e){var t='<span class="wpstg-css-tick"></span>';e.production!==e.staging&&(t='<span class="wpstg-css-cross"></span>'),n+="<tr><td>"+e.name+"</td><td>"+e.production+"</td><td>"+e.staging+"</td><td>"+t+"</td></tr>"})),n+="</tbody></table><p>Note: Some MySQL/MariaDB properties do not match. You may proceed but the staging site may not work as expected.</p>",void i.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-db-comparison-modal wpstg-centered-modal"}).fire({title:"Different Database Properties",icon:"warning",html:n,width:"650px",focusConfirm:!1,confirmButtonText:"Proceed",showCancelButton:!0}).then((function(s){s.value&&m(e,t)}))}i.getSwalModal(!0).fire({title:"Different Database Properties",icon:"error",html:s.message,focusConfirm:!0,confirmButtonText:"Ok",showCancelButton:!1}),o.get(".wpstg-loader").hide()}),"json",!1)},m=function(e,s){"wpstg_cloning"===e.data("action")?new Promise((function(e){g({action:"wpstg_is_writable_clone_destination_dir",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneDir:t("#wpstg_clone_dir").val()},(function(t){var s;t.success?(o.get(".wpstg-loader").hide(),e(!0)):(r("Something went wrong! Error: "+(null==(s=t.data)?void 0:s.message)),o.get(".wpstg-loader").hide(),document.getElementById("wpstg-error-wrapper").scrollIntoView(),e(!1))}),"json",!1)})).then((function(t){t&&b(e,s)})):b(e,s)},b=function(e,n){o.get(".wpstg-loading-bar-container").css("visibility","visible"),s.data={action:e.data("action"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){if("wpstg_cloning"===s.data.action||"wpstg_update"===s.data.action||"wpstg_reset"===s.data.action){if(s.data.cloneID=(new Date).getTime().toString(),"wpstg_update"===s.data.action&&(s.data.cloneID=t("#wpstg-new-clone-id").data("clone")),s.data.cloneName=t("#wpstg-new-clone-id").val()||s.data.cloneID,null!==s.directoryNavigator&&(s.data.excludedDirectories=encodeURIComponent(s.directoryNavigator.getExcludedDirectories()),s.data.extraDirectories=encodeURIComponent(s.directoryNavigator.getExtraDirectoriesRootOnly())),s.data.excludeGlobRules="",s.data.excludeSizeRules="",s.cloneExcludeFilters instanceof k){var e=s.cloneExcludeFilters.getExcludeFilters();s.data.excludeGlobRules=encodeURIComponent(e.globs),s.data.excludeSizeRules=encodeURIComponent(e.sizes)}s.data.includedTables="",s.data.excludedTables="",s.data.allTablesExcluded=!1,null!==s.tableSelector&&(s.data.includedTables=s.tableSelector.getIncludedTables(),s.data.excludedTables=s.tableSelector.getExcludedTables(),s.data.selectedTablesWithoutPrefix=s.tableSelector.getSelectedTablesWithoutPrefix()),s.data.includedTables.length>s.data.excludedTables.length?s.data.includedTables="":s.data.excludedTables.length>s.data.includedTables.length&&(s.data.excludedTables="",s.data.allTablesExcluded=""===s.data.includedTables),s.data.databaseServer=t("#wpstg_db_server").val(),s.data.databaseUser=t("#wpstg_db_username").val(),s.data.databasePassword=t("#wpstg_db_password").val(),s.data.databaseDatabase=t("#wpstg_db_database").val(),s.data.databasePrefix=t("#wpstg_db_prefix").val(),s.data.databaseSsl=t("#wpstg_db_ssl").is(":checked");var n=t("#wpstg_clone_dir").val();s.data.cloneDir=encodeURIComponent(t.trim(n)),s.data.cloneHostname=t("#wpstg_clone_hostname").val(),s.data.cronDisabled=t("#wpstg_disable_cron").is(":checked"),s.data.emailsAllowed=t("#wpstg_allow_emails").is(":checked"),s.data.networkClone=t("#wpstg_network_clone").is(":checked"),s.data.uploadsSymlinked=t("#wpstg_symlink_upload").is(":checked"),s.data.cleanPluginsThemes=t("#wpstg-clean-plugins-themes").is(":checked"),s.data.cleanUploadsDir=t("#wpstg-clean-uploads").is(":checked")}}(),v(n)},v=function(e){var t=o.get(".wpstg-loading-bar-container");g(s.data,(function(n){!1===n&&r("Something went wrong!<br/><br/> Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),n.length<1&&(t.css("visibility","hidden"),r("Something went wrong! No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "));var o=L(n);if(!1!==o&&!1===o.success)return t.css("visibility","hidden"),void D(o);t.css("visibility","hidden"),e.html(n),s.cloneExcludeFilters=null,"wpstg_scanning"===s.data.action?(s.areAllTablesChecked=!0,s.directoryNavigator=new S("#wpstg-directories-listing",wpstg,s.notyf),s.tableSelector=new x("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),s.switchStep(2),s.cloneExcludeFilters=new k,s.directoryNavigator.countSelectedFiles(),s.tableSelector.countSelectedTables()):"wpstg_cloning"!==s.data.action&&"wpstg_update"!==s.data.action&&"wpstg_reset"!==s.data.action||s.switchStep(3),s.startCloning()}),"HTML")},D=function(e){new C("wpstg_modal_error",wpstg).show(Object.assign({title:"Error",icon:"error",html:wpstg.i18n.somethingWentWrong+(void 0!==e.message?"<br/>"+e.message:""),width:"500px",confirmButtonText:"Ok",showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},e.swalOptions),{type:e.type})},L=function(e){if(!e)return!1;try{var t=JSON.parse(e);if(t&&"object"==typeof t)return t}catch(e){}return!1},A=function(t,n){s.data={action:"wpstg_reset",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:t},s.data=e({},s.data,n);var i=o.get("#wpstg-workflow");v(i)},B=function(){var e=o.get("#wpstg-workflow"),t=o.get(".wpstg-loading-bar-container");t.css("visibility","visible"),g({action:"wpstg_overview",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(s){s.length<1&&r("Something went wrong! No response. Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report."),o.get(".wpstg-current-step"),t.css("visibility","hidden"),e.html(s)}),"HTML"),s.switchStep(1),o.get(".wpstg-step3-cloning").show(),o.get(".wpstg-step3-pushing").hide()},I=function e(n,r,c){g({action:"wpstg_delete_clone",clone:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:c,deleteDir:r},(function(l){if(!l||(a(l),void 0===l.delete||"finished"!==l.delete&&"unfinished"!==l.delete))!0===l||e(n,r,c);else if("finished"===l.delete&&void 0===l.error&&t('.wpstg-clone[data-clone-id="'+n+'"]').remove(),t("#wpstg-existing-clones .wpstg-clone").length<1&&(o.get("#wpstg-existing-clones").find("h3").text(""),o.get("#wpstg-no-staging-site-results").show()),o.get(".wpstg-loader").hide(),null!==wpstg.i18n.wpstg_delete_clone&&"finished"===l.delete){s.wpstgProcessModal.openProcessModal({action:"wpstg_delete_clone",cloneID:n},{status:"finished"},!1,!1),i.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width"}).fire({icon:"success",html:'<div style="display:block"><h2 style="color: #565656;">'+wpstg.i18n.wpstg_delete_clone.title+"</h2></div>",confirmButtonText:"Close",showCancelButton:!1,showConfirmButton:!0}).then((function(e){e.value&&i.closeSwalModal()}))}}))},M=function e(){if(s.timer("stop"),!0===s.isFinished)return!0;g({action:"wpstg_cancel_clone",clone:s.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){if(t&&void 0!==t.delete&&"finished"===t.delete)return o.get(".wpstg-loader").hide(),void B();!0===t?B():e()}))},U=function e(){if(!0===s.isFinished)return!0;g({action:"wpstg_cancel_update",clone:s.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(t){t&&void 0!==t.delete&&"finished"===t.delete||!0===t?B():e()}))},O=function(){if(!0===s.isFinished)return!0;g({action:"wpstg_restart",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(e){e&&void 0!==e.delete&&"finished"===e.delete||!0===e?B():U()}))},q=function(e){if(Array.isArray(e))e.forEach((function(e){if(null!==e&&!s.messages.find((function(t){return t.message===e.message}))){s.messages.push(e);var n=t(".wpstg--modal--process--logs"),o="wpstg--modal--process--msg--"+(e.type.toLowerCase()||"info");n.append('<p class="'+o+'">['+(e.type||"info")+"] - ["+e.date+"] - "+e.message+"</p>")}}));else if(!s.messages.find((function(t){return t.message===e.message}))){s.messages.push(e);var n=t(".wpstg--modal--process--logs"),o="wpstg--modal--process--msg--"+(e.type.toLowerCase()||"info");n.append('<p class="'+o+'">['+(e.type||"info")+"] - ["+e.date+"] - "+e.message+"</p>")}document.querySelectorAll(".wpstg--modal--process--logs").forEach((function(e){e.scrollTop=e.scrollHeight}))},R=function(){o.get("#wpstg-check-space").on("click",(function(e){o.get(".wpstg-loader").show();var t=encodeURIComponent(s.directoryNavigator.getExcludedDirectories()),n=encodeURIComponent(s.directoryNavigator.getExtraDirectoriesRootOnly());g({action:"wpstg_check_disk_space",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedDirectories:t,extraDirectories:n},(function(e){if(!1===e)return o.get("#wpstg-clone-id-error").text("Can not detect required disk space").show(),void o.get(".wpstg-loader").hide();o.get("#wpstg-clone-id-error").html("<strong>Estimated necessary disk space: "+e.requiredSpace+"</strong>"+(null!==e.errorMessage?"<br>"+e.errorMessage:"")+'<br> <span style="color:#444;">Before you proceed ensure your account has enough free disk space to hold the entire instance of the production site. You can check the available space from your hosting account (e.g. cPanel).</span>').show(),o.get(".wpstg-loader").hide()}),"json",!1)}))};return s.timer=function(e){if("stop"===e){var t=s.time;return s.time=1,clearInterval(s.executionTime),s.convertSeconds(t)}s.executionTime=setInterval((function(){null!==document.getElementById("wpstg-processing-timer")&&(document.getElementById("wpstg-processing-timer").innerHTML="Elapsed Time: "+s.convertSeconds(s.time)),s.time++,"stop"===e&&(s.time=1,clearInterval(s.executionTime))}),1e3)},s.convertSeconds=function(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(11,8)},s.startCloning=function(){if(c(),R(),"wpstg_cloning"===s.data.action||"wpstg_update"===s.data.action||"wpstg_reset"===s.data.action){s.isCancelled=!1,o.get(".wpstg-loader").show(),o.get("#wpstg-cancel-cloning").text("Cancel"),o.get("#wpstg-resume-cloning").hide(),o.get("#wpstg-error-details").hide(),setTimeout((function(){window.addEventListener("beforeunload",j.warnIfClosingDuringProcess),e()}),wpstg.delayReq);var e=function e(){if(!0===s.isCancelled)return window.removeEventListener("beforeunload",j.warnIfClosingDuringProcess),!1;var i;(i=!0)&&!1!==i?o.get(".wpstg-loader").show():o.get(".wpstg-loader").hide();var r,c="",l="";null!==s.directoryNavigator&&(c=s.directoryNavigator.getExcludedDirectories(),l=s.directoryNavigator.getExtraDirectoriesRootOnly()),j.ajax({action:"wpstg_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:(r=[],t(".wpstg-db-table input:not(:checked)").each((function(){r.push(this.name)})),r),excludedDirectories:encodeURIComponent(c),extraDirectories:encodeURIComponent(l)},(function(t){a(t),void 0!==t.last_msg&&t.last_msg&&q(t.last_msg),!1===t.status?(n(t),setTimeout((function(){e()}),wpstg.delayReq)):!0===t.status&&"finished"!==t.status?(o.get("#wpstg-error-details").hide(),o.get("#wpstg-error-wrapper").hide(),n(t),e()):("finished"===t.status||void 0!==t.job_done&&t.job_done)&&(window.removeEventListener("beforeunload",j.warnIfClosingDuringProcess),function(e){!0===s.getLogs&&q();n(e),void 0!==e.last_msg&&q(e.last_msg);null!==wpstg.i18n[s.data.action]&&s.wpstgProcessModal.openSuccessModal(wpstg.i18n[s.data.action],!0,e.url)}(t))}),"json",!1)},n=function(e,t){null!==e&&s.wpstgProcessModal.openProcessModal(s.data,e,!0)}}},s.switchStep=function(e){o.get(".wpstg-current-step").removeClass("wpstg-current-step"),o.get(".wpstg-step"+e).addClass("wpstg-current-step")},s.checkUserDbPermissions=function(e){return new Promise((function(s){j.ajax({action:"wpstg_check_user_permissions",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:e},(function(e){e.success?s(!0):(i.getSwalModal(!0,{container:"wpstg-swal-push-container"}).fire({title:"",icon:"warning",html:e.data.message,width:"750px",focusConfirm:!1,confirmButtonText:"Proceed",showCancelButton:!0}).then((function(e){e.isConfirmed&&s(!0)})),t("#wpstg-db-permission-show-full-message").click((function(){t("#wpstg-permission-info-output").html(t("#wpstg-permission-info-data").html())})))}),"json",!1)}))},s.init=function(){var e,r,a;B(),r=o.get("#wpstg-workflow"),a=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",2<window.devicePixelRatio&&(a+="-2x"),n="<img src=''"+(a+=".gif")+"' alt='' class='ajax-spinner general-spinner' />",r.on("click",".wpstg-button-unselect",(function(e){e.preventDefault(),!1===s.areAllTablesChecked?(o.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),o.get(".wpstg-button-unselect").text("Unselect All"),o.get(".wpstg-db-table-checkboxes").prop("checked",!0),s.areAllTablesChecked=!0):(o.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),o.get(".wpstg-button-unselect").text("Select All"),o.get(".wpstg-db-table-checkboxes").prop("checked",!1),s.areAllTablesChecked=!1)})).on("keyup","#wpstg-new-clone-id",(function(){if(document.getElementById("wpstg-error-details").style.display="none","number"==typeof e&&clearInterval(e),void 0===this.value||""===this.value)return o.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),o.get("#wpstg-start-cloning").removeAttr("disabled"),void o.get("#wpstg-clone-id-error").text("").hide();var t=i.slugify(this.value);e=setTimeout((function(){g({action:"wpstg_check_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,directoryName:t},(function(e){"success"===e.status?(o.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),o.get("#wpstg-start-cloning").removeAttr("disabled"),o.get("#wpstg-clone-id-error").text("").hide()):(o.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),o.get("#wpstg-start-cloning").prop("disabled",!0),o.get("#wpstg-clone-id-error").text(e.message).show())}))}),500)})).on("click","#wpstg-start-cloning",(function(){c(),s.isCancelled=!1,s.getLogs=!1,s.progressBar=0})).on("input","#wpstg-new-clone-id",(function(){if(!(t("#wpstg-clone-directory").length<1)){var e=i.slugify(this.value).substring(0,16),s=t("#wpstg-use-target-dir"),n=t("#wpstg-use-target-hostname"),o=s.data("base-path"),r=n.data("base-uri");o&&(o=o.replace(/\/+$/g,"")+"/"+e+"/"),r&&(r=r.replace(/\/+$/g,"")+"/"+e),t(".wpstg-use-target-dir--value").text(o),t(".wpstg-use-target-hostname--value").text(r),s.attr("data-path",o),n.attr("data-uri",r),t("#wpstg_clone_dir").attr("placeholder",o),t("#wpstg_clone_hostname").attr("placeholder",r)}})).on("input","#wpstg_clone_hostname",(function(){""===t(this).val()||l()?t("#wpstg_clone_hostname_error").remove():l()||t("#wpstg_clone_hostname_error").length||t("#wpstg-clone-directory tr:last-of-type").after('<tr><td>&nbsp;</td><td><p id="wpstg_clone_hostname_error" style="color: red;">&nbsp;Invalid host name. Please provide it in a format like http://example.com</p></td></tr>')})),d(),function(){var e=o.get("#wpstg-workflow");e.on("click",".wpstg-next-step-link",(function(s){s.preventDefault();var n=t(this);if(t("#wpstg_clone_hostname").length&&!l())return t("#wpstg_clone_hostname").focus(),!1;if(("wpstg_update"===n.data("action")||"wpstg_reset"===n.data("action"))&&"wpstg_update"===n.data("action")){var o=n,r=e,a=n.data("action");return i.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:"Do you want to update the staging site?",icon:"warning",html:'<div class="wpstg-confirm-text-line-height wpstg-mt-10px">This will overwrite the staging site with all the selected data from the live site.<br>Use this only if you want to clone the live site again.<br><br> Unselect all tables and folders that you do not want to overwrite.<br>Do not cancel the update process! This could destroy the staging site.<br>If you are unsure, create a backup of the staging site before proceeding.<br>There is no automatic merging of database data!</div>',width:"610px",focusConfirm:!1,confirmButtonText:"Update",showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var e=i.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",(function(e){i.closeSwalModal()}))}}).then((function(e){if(e.value){var t=document.querySelector("#wpstg-ext-db");if("wpstg_cloning"===a&&t.checked)return void f(o,r);i.closeSwalModal(),m(o,r)}})),!1}if(n.attr("disabled"))return!1;"wpstg_cloning"===n.data("action")&&t("#wpstg-ext-db").is(":checked")?f(n,e):m(n,e)})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),o.get(".wpstg-loader").hide(),o.get(".wpstg-loader").removeClass("wpstg-finished"),B()}))}(),o.get("#wpstg-workflow").on("click",".wpstg-tab-header",(function(e){e.preventDefault();var s=t(this),n=o.get(s.data("id"));s.toggleClass("expand"),n.slideToggle();var i=s.find(".wpstg-tab-triangle");s.hasClass("expand")?(i.removeClass("wpstg-no-icon"),i.text(""),i.addClass("wpstg-rotate-90")):i.removeClass("wpstg-rotate-90")})),i.listenTooltip(),new _,new y,new E,new P,s.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]})},s.ajax=g,s.showError=r,s.getLogs=q,s.loadOverview=B,s}(jQuery);jQuery(document).ready((function(){j.init(),window.WPStaging=j})),jQuery(document).ready((function(e){function t(s,n){void 0===n&&(n="false");var o=s.next(),r=e(".wpstg--tab--header .wpstg-report-email").val(),a=e(".wpstg--tab--header .wpstg-report-hosting-provider").val(),c=e(".wpstg--tab--header .wpstg-report-description").val(),l=e(".wpstg--tab--header .wpstg-report-syslog").is(":checked"),d=e(".wpstg--tab--header .wpstg-report-terms").is(":checked");s.attr("disabled",!0),o.css("visibility","visible"),e.ajax({url:ajaxurl,type:"POST",dataType:"json",async:!0,data:{action:"wpstg_send_report",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg_email:r,wpstg_provider:a,wpstg_message:c,wpstg_syslog:+l,wpstg_terms:+d,wpstg_force_send:n}}).done((function(n){if(s.attr("disabled",!1),o.css("visibility","hidden"),n.errors.length>0){e(".wpstg-report-issue-form .wpstg-message").remove();var r=e("<div />").addClass("wpstg-message wpstg-error-message");e.each(n.errors,(function(e,n){"already_submitted"===n.status?(r="",i.getSwalModal(!0,{container:"wpstg-issue-resubmit-confirmation"}).fire({title:"",icon:"warning",html:n.message,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Yes",cancelButtonText:"No"}).then((function(e){e.isConfirmed&&t(s,"true")}))):r.append("<p>"+n+"</p>")})),e(".wpstg-report-issue-form").prepend(r)}else{var a=e("<div />").addClass("wpstg-message wpstg-success-message");a.append("<p>Thanks for submitting your request! You should receive an auto reply mail with your ticket ID immediately for confirmation!<br><br>If you do not get that mail please contact us directly at <strong>support@wp-staging.com</strong></p>"),e(".wpstg--tab--header .wpstg-report-issue-form").html(a),null!==document.getElementById("wpstg-modal-close")&&void 0!==document.getElementById("wpstg-modal-close")||e(".wpstg--tab--header .wpstg-success-message").append('<div class="wpstg-mt-10px wpstg-float-right"><a id="wpstg-success-button" href="#" class="wpstg--red"><span class="wpstg-ml-8px">Close</span></a></div>'),setTimeout((function(){e(".wpstg--tab--header .wpstg-report-issue-form").removeClass("wpstg-report-active")}),2e3)}}))}e("body").on("click",".wpstg-report-issue-button",(function(t){var s=document.querySelector("#wpstg-contact-us-modal");null!=s&&void 0!==s&&(m("#wpstg-contact-us-modal"),new v),e(".wpstg-report-issue-form").toggleClass("wpstg-report-show"),t.preventDefault()})),e("body").on("click",".wpstg-backups-report-issue-button",(function(t){e(".wpstg-report-issue-form").toggleClass("wpstg-report-show"),t.preventDefault()})),e("body").on("click","#wpstg-report-cancel",(function(t){e(".wpstg-report-issue-form").removeClass("wpstg-report-show"),t.preventDefault()})),e("body").on("click","#wpstg-report-submit",(function(s){t(e(this),"false"),s.preventDefault()})),e("body").on("click",".wpstg--modal--process--logs--tail",(function(t){!function(){if(0!==window.WPStaging.messages.length){var e=i.getSwalContainer().querySelector(".wpstg--modal--process--logs");e.innerHTML="",window.WPStaging.messages.forEach((function(t){var s="wpstg--modal--process--msg--"+t.type.toLowerCase(),n=document.createElement("p");n.className=s,n.textContent="["+t.type+"] - ["+t.date+"] - "+t.message,e.appendChild(n)}))}}();var s=e(this);t.preventDefault();var n=i.getSwalContainer(),o=e(n).find(".wpstg--modal--process--logs");o.toggle(),o.is(":visible")?(s.text(wpstg.i18n.hideLogs),n.childNodes[0].style.width="97%",n.style["z-index"]=9999):(s.text(wpstg.i18n.showLogs),n.childNodes[0].style.width="600px")})),e("body").on("click","#wpstg-success-button",(function(t){t.preventDefault(),e(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),e(document).on("click",".wpstg-dropdown>.wpstg-dropdown-toggler",(function(t){t.preventDefault(),e(t.target).next(".wpstg-dropdown-menu").toggleClass("shown"),e(t.target).find(".wpstg-caret").toggleClass("wpstg-caret-up")})),e(document).on("click",".wpstg-caret",(function(t){t.preventDefault();var s=e(t.target).closest(".wpstg-dropdown-toggler");s&&s.trigger("click")})),document.addEventListener("click",(function(t){if(!t.target.closest(".wpstg-dropdown-toggler")){for(var s=document.getElementsByClassName("wpstg-dropdown-menu"),n=0;n<s.length;n++)s[n].classList.remove("shown");e(".wpstg-caret").removeClass("wpstg-caret-up")}})),window.addEventListener("finishedProcessWithError",(function(t){e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:t.detail.error,job_id:i.getJobId()}})}))}))}();
//# sourceMappingURL=wpstg-admin.min.js.map
