!function(){"use strict";function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0,F=function(){};return{s:F,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return a=r.done,r},e:function(r){u=!0,o=r},f:function(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(typeof e+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _slicedToArray(r,e){return function(r){if(Array.isArray(r))return r}(r)||function(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toPropertyKey(t){var i=function(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}var closest=(Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(s){var el=this;do{if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode}while(null!==el&&1===el.nodeType);return null}),function(element,selector){return element instanceof Element?element.closest(selector):null});function qs(selector){return document.querySelector(selector)}function all(selector){return document.querySelectorAll(selector)}function addEvent(parent,evt,selector,handler){!parent instanceof Element||parent.addEventListener(evt,(function(event){event.target.matches(selector+", "+selector+" *")&&handler(event.target.closest(selector),event)}),!1)}function slideDown(element){var duration=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;element.style.display="block",element.style.overflow="hidden",element.style.paddingTop="0px",element.style.paddingBottom="0px";var height=element.offsetHeight;element.style.height="0px",element.style.transitionProperty="height",element.style.transitionDuration=duration+"ms",setTimeout((function(){element.style.height=height+"px",window.setTimeout((function(){element.style.removeProperty("height"),element.style.removeProperty("overflow"),element.style.removeProperty("transition-duration"),element.style.removeProperty("transition-property")}),duration)}),0)}function slideUp(element){var duration=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;element.style.display="block",element.style.overflow="hidden";var height=element.offsetHeight;element.style.height=height+"px",element.style.transitionProperty="height",element.style.transitionDuration=duration+"ms",setTimeout((function(){element.style.height="0px",window.setTimeout((function(){element.style.display="none",element.style.removeProperty("height"),element.style.removeProperty("overflow"),element.style.removeProperty("transition-duration"),element.style.removeProperty("transition-property")}),duration)}),0)}function getPreviousSibling(element,selector){for(var sibling=element.previousElementSibling;sibling;){if(sibling.matches(selector))return sibling;sibling=sibling.previousElementSibling}}function handleDisplayDependencies(element){if(!(!element instanceof Element)&&element.id){if("checkbox"!==element.getAttribute("type"));else{var container=closest(element,".wpstg-container");if(null===container)return;var showIfUnchecked=container.querySelectorAll('[data-show-if-unchecked="'.concat(element.id,'"]')),checked=element.checked;if(showIfUnchecked.length){var _step,_iterator=_createForOfIteratorHelper(showIfUnchecked);try{for(_iterator.s();!(_step=_iterator.n()).done;){var el=_step.value;checked?el.classList.add("hidden"):el.classList.remove("hidden")}}catch(err){_iterator.e(err)}finally{_iterator.f()}}}}}function handleToggleElement(element){if(!(!element instanceof Element)&&element.getAttribute("data-wpstg-target")){var isSwalOpen=null!==document.querySelector(".wpstg--swal2-container"),container=closest(element,isSwalOpen?".wpstg--swal2-container":".wpstg_admin");if(null!==container){var elements=container.querySelectorAll(element.getAttribute("data-wpstg-target"));if(elements.length){var _step3,_iterator3=_createForOfIteratorHelper(elements);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){_step3.value.classList.toggle("hidden")}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}}}function handleCopyPaste(element){if(!(!element instanceof Element)&&element.getAttribute("data-wpstg-target")&&element.getAttribute("data-wpstg-copy")){var container=closest(element,".wpstg_admin");if(null!==container){navigator.clipboard.writeText(element.getAttribute("data-wpstg-copy"));var elements=container.querySelectorAll(element.getAttribute("data-wpstg-target"));if(elements.length){var _step4,_iterator4=_createForOfIteratorHelper(elements);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){_step4.value.value=element.getAttribute("data-wpstg-copy","")}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}}}}function hide(selector){document.querySelectorAll(selector).forEach((function(element){element.style.display="none"}))}function show(selector){document.querySelectorAll(selector).forEach((function(element){element.style.display="block"}))}function copyTextToClipboard(event){var content,dataCopyContent=function(event){return"string"==typeof event?event:event&&"object"===_typeof(event)&&event.target&&event.target.getAttribute("data-copy-content")?event.target.getAttribute("data-copy-content"):event instanceof Element&&event.getAttribute("data-wpstg-source")?document.querySelector(event.getAttribute("data-wpstg-source")).value:null}(event);dataCopyContent||notify("error","No content to copy"),navigator.clipboard&&window.isSecureContext?(content=dataCopyContent,navigator.clipboard.writeText(content).then((function(){notify("success","Copied to clipboard")})).catch((function(err){notify("error","Unable to copy to clipboard")}))):function(content){var textArea=document.createElement("textarea");textArea.value=content,textArea.style.top="0",textArea.style.left="0",textArea.style.position="fixed",document.body.appendChild(textArea),textArea.focus(),textArea.select();var isSuccessful=document.execCommand("copy");notify(isSuccessful?"success":"error",isSuccessful?"Copied to clipboard":"Unable to copy to clipboard"),document.body.removeChild(textArea)}(dataCopyContent)}function notify(type,message){new Notyf({duration:6e3,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!0}]}).open({type:type,message:message})}function showLoadingBar(){var visibility=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"visible";document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(element){element&&(element.style.visibility=visibility)}))}function isElementChecked(selector){var element=qs(selector);return!!element&&element.checked}function loadingPlaceholder(){var visibility=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"visible",loader=all(".wpstg-loading-placeholder-container");loader.forEach((function(element){element&&(element.style.visibility=visibility)})),setTimeout((function(){loader.forEach((function(element){element&&"visible"===element.style.visibility&&(element.style.visibility="hidden")})),hideLoadingBar()}),5e3);var container=qs(".wpstg--tab--contents");if("visible"===visibility)return showLoadingBar(),void(container&&(container.style.overflow="hidden"));hideLoadingBar(),container&&(container.style.overflow="unset")}function getActivePage(){return(window.location.search.match(/[\?&]page=([^&]*)/)||[])[1]||null}function setLoadingPlaceholder(){return _setLoadingPlaceholder.apply(this,arguments)}function _setLoadingPlaceholder(){return _setLoadingPlaceholder=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var container,loadingPlaceholderContainer,loadingWrapper,_loadingWrapper$query,_loadingWrapper$query2,_loadingWrapper$first,_loadingWrapper$lastE,_args=arguments;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(""===(container=_args.length>0&&void 0!==_args[0]?_args[0]:"")&&(container=qs(".wpstg--tab--contents")),null!==container){_context.next=4;break}return _context.abrupt("return");case 4:if(loadingPlaceholderContainer=container.querySelector(".wpstg-loading-placeholder-container"),loadingWrapper=loadingPlaceholderContainer.querySelector(".wpstg-dom-loading-wrapper")){_context.next=8;break}return _context.abrupt("return");case 8:if(loadingWrapper.offsetHeight===container.offsetHeight){_context.next=19;break}loadingWrapper.querySelectorAll(".wpstg-loading-lines-bar").forEach((function(line){return line.remove()})),null===(_loadingWrapper$query=loadingWrapper.querySelector(".wpstg-loading-line"))||void 0===_loadingWrapper$query||_loadingWrapper$query.remove(),null===(_loadingWrapper$query2=loadingWrapper.querySelector(".wpstg-loading-last-line-bar"))||void 0===_loadingWrapper$query2||_loadingWrapper$query2.remove();case 13:return loadingWrapper.insertAdjacentHTML("beforeend",'<div class="wpstg-loading-lines-bar"></div>'),_context.next=16,new Promise((function(resolve){return setTimeout(resolve,0)}));case 16:if(loadingWrapper.offsetHeight<=container.offsetHeight+300){_context.next=13;break}case 17:null===(_loadingWrapper$first=loadingWrapper.firstElementChild)||void 0===_loadingWrapper$first||_loadingWrapper$first.classList.add("wpstg-loading-first-line-bar"),null===(_loadingWrapper$lastE=loadingWrapper.lastElementChild)||void 0===_loadingWrapper$lastE||_loadingWrapper$lastE.classList.add("wpstg-loading-last-line-bar");case 19:return _context.next=21,new Promise((function(resolve){return setTimeout(resolve,0)}));case 21:case"end":return _context.stop()}}),_callee)}))),_setLoadingPlaceholder.apply(this,arguments)}function hideLoadingBar(){document.querySelectorAll(".wpstg-loading-bar-container").forEach((function(element){element&&(element.style.visibility="hidden")}))}function isValidEmail(selector){var _qs,isNotify=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],emailAddress=(null===(_qs=qs(selector))||void 0===_qs?void 0:_qs.value)||"",isValidEmail=/^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9]+(?:-[a-zA-Z0-9]+)*\.[a-zA-Z]{2,24}$/.test(emailAddress);return!(isNotify||!isValidEmail)||!(!isNotify&&!isValidEmail)&&(isValidEmail?(qs(selector).style.borderColor="unset",!0):(notify("error","Invalid email address"),qs(selector).style.borderColor="red",!1))}function getActiveTab(){return new URLSearchParams(window.location.search).get("tab")||null}function prettify(seconds){return new Date(1e3*seconds).toISOString().slice(11,19)+"s"}function wpstgRequest(_x){return _wpstgRequest.apply(this,arguments)}function _wpstgRequest(){return _wpstgRequest=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(action){var data,returnType,_yield$wpstgRequestWi,response,_args=arguments;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return data=_args.length>1&&void 0!==_args[1]?_args[1]:{},returnType=_args.length>2&&void 0!==_args[2]?_args[2]:"json",_context.next=4,wpstgRequestWithError(action,data,returnType);case 4:if(_yield$wpstgRequestWi=_context.sent,null===(response=_yield$wpstgRequestWi.response)){_context.next=8;break}return _context.abrupt("return",response);case 8:return _context.abrupt("return",null);case 9:case"end":return _context.stop()}}),_callee)}))),_wpstgRequest.apply(this,arguments)}function wpstgRequestWithError(_x2){return _wpstgRequestWithError.apply(this,arguments)}function _wpstgRequestWithError(){return _wpstgRequestWithError=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(action){var returnType,requestData,statusCode,request,error,response,_response,_args2=arguments;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return returnType=_args2.length>2&&void 0!==_args2[2]?_args2[2]:"json",requestData=_objectSpread2(_objectSpread2({},_args2.length>1&&void 0!==_args2[1]?_args2[1]:{}),{},{action:action,accessToken:wpstg.accessToken,nonce:wpstg.nonce}),statusCode=null,_context2.prev=4,_context2.next=7,fetch(wpstg.ajaxUrl,{method:"POST",credentials:"same-origin",body:processRequestData(requestData),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 7:if(request=_context2.sent,statusCode=request.status,request.ok){_context2.next=21;break}if("json"!==returnType){_context2.next=16;break}return _context2.next=13,request.json();case 13:_context2.t0=_context2.sent,_context2.next=19;break;case 16:return _context2.next=18,request.text();case 18:_context2.t0=_context2.sent;case 19:return error=_context2.t0,_context2.abrupt("return",{response:null,error:error,code:statusCode});case 21:if("json"!==returnType){_context2.next=28;break}return _context2.next=24,request.json();case 24:return response=_context2.sent,_context2.abrupt("return",{response:response,error:null,code:statusCode});case 28:return _context2.next=30,request.text();case 30:return _response=_context2.sent,_context2.abrupt("return",{response:_response,error:null,code:statusCode});case 32:_context2.next=37;break;case 34:return _context2.prev=34,_context2.t1=_context2.catch(4),_context2.abrupt("return",{response:null,error:_context2.t1,code:statusCode});case 37:case"end":return _context2.stop()}}),_callee2,null,[[4,34]])}))),_wpstgRequestWithError.apply(this,arguments)}function processRequestData(data){var params=new URLSearchParams;return appendParams(data,params),params}function appendParams(data,params){var parentKey=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";for(var key in data)if(data.hasOwnProperty(key)){var fullKey=parentKey?"".concat(parentKey,"[").concat(key,"]"):key;"object"!==_typeof(data[key])||data[key]instanceof File?params.append(fullKey,data[key]):appendParams(data[key],params,fullKey)}}var WpstgContactUs=function(){return _createClass((function WpstgContactUs(){var modalType=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"contact-us",wpstgObject=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wpstg;_classCallCheck(this,WpstgContactUs),this.wpstgObject=wpstgObject,this.characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",this.currentDate=new Date,this.modalType=modalType,this.init()}),[{key:"init",value:function(){this.contactUsModal="#wpstg-"+this.modalType+"-modal",this.contactUsButton=document.querySelector("#wpstg-"+this.modalType+"-button"),this.contactUsButtonBackupTab=document.querySelector("#wpstg--tab--backup  #wpstg-"+this.modalType+"-button"),this.askInTheForumForm=this.contactUsModal+" .wpstg-contact-us-report-issue",this.contactUsSuccessPopup=this.contactUsModal+" .wpstg-contact-us-success-form",this.contactUsLoader=this.contactUsModal+" .wpstg-contact-us-report-issue-loader",this.contactUsSupport=this.contactUsModal+" .wpstg-contact-us-support-forum",this.reportIssueButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-open-debug-log"),this.successForm=document.querySelector(this.contactUsModal+" .wpstg-success-form"),this.contactUsReportIssueBtn=document.querySelector(this.contactUsModal+" .wpstg-report-issue-btn"),this.contactUsCloseButton=document.querySelector(this.contactUsModal+" .wpstg-modal-close"),this.contactUsSuccessPopupClose=document.querySelector(this.contactUsModal+" .wpstg-contact-us-success-modal-close"),this.debugCodeCopyButton=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code-copy"),this.contactUsResponse=document.querySelector(this.contactUsModal+" .wpstg-debug-response"),this.contactUsDebugCodeField=document.querySelector(this.contactUsModal+" .wpstg-contact-us-debug-code"),this.contactUsModalCloseBtn=document.querySelector(this.contactUsModal+" .wpstg-contact-us-close-btn"),this.contactUsForceSendDebugLogContainer=".wpstg-contact-us-force-send-email-container",this.contactUsForceSendDebugLog=document.querySelector(this.contactUsModal+" #wpstg-force-send-debug-log"),this.isDebugWindowOpened=!1,this.addEvents()}},{key:"addEvents",value:function(){var _this=this;document.addEventListener("keydown",(function(event){"Escape"===event.key&&(hide(_this.contactUsModal),hide(_this.askInTheForumForm),hide(_this.contactUsSuccessPopup),hide(_this.contactUsSupport),_this.isDebugWindowOpened=!1)})),null!==this.contactUsButton&&this.contactUsButton.addEventListener("click",(function(){show(_this.contactUsModal)})),null!==this.contactUsButtonBackupTab&&this.contactUsButtonBackupTab.addEventListener("click",(function(){show(_this.contactUsModal)})),null!==this.contactUsModalCloseBtn&&this.contactUsModalCloseBtn.addEventListener("click",(function(){hide(_this.contactUsModal)})),null!==this.reportIssueButton&&this.reportIssueButton.addEventListener("click",(function(){_this.isDebugWindowOpened?hide(_this.askInTheForumForm):show(_this.askInTheForumForm),_this.isDebugWindowOpened=!_this.isDebugWindowOpened,_this.toggleActiveClass()})),null!==this.contactUsReportIssueBtn&&this.contactUsReportIssueBtn.addEventListener("click",(function(){_this.sendDebugInfo()})),null!==this.contactUsSuccessPopupClose&&this.contactUsSuccessPopupClose.addEventListener("click",(function(){hide(_this.contactUsSuccessPopup)})),null!==this.contactUsCloseButton&&this.contactUsCloseButton.addEventListener("click",(function(){hide(_this.contactUsModal),hide(_this.contactUsSupport),hide(_this.askInTheForumForm),_this.isDebugWindowOpened=!1,_this.toggleActiveClass()})),null!==this.debugCodeCopyButton&&this.debugCodeCopyButton.addEventListener("click",(function(){_this.contactUsDebugCodeField.select(),_this.contactUsDebugCodeField.setSelectionRange(0,99999),copyTextToClipboard(_this.contactUsDebugCodeField.value)}))}},{key:"generateDebugCode",value:function(length){for(var result="",i=0;i<length;i++)result+=this.characters.charAt(Math.floor(Math.random()*this.characters.length));return"wpstg-"+result+"-"+this.currentDate.getHours()+this.currentDate.getMinutes()+this.currentDate.getSeconds()}},{key:"sendDebugInfo",value:(_sendDebugInfo=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var debugCode,forceSendDebugLog,params,_data$response,_data$response2,data;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return show(this.contactUsLoader),this.contactUsReportIssueBtn.disabled=!0,debugCode=this.generateDebugCode(8),forceSendDebugLog=!1,this.contactUsForceSendDebugLog&&(forceSendDebugLog=this.contactUsForceSendDebugLog.checked),params={debugCode:debugCode,forceSend:forceSendDebugLog,wpstg_action:"bypass_optimizer"},_context.prev=6,_context.next=9,wpstgRequest("wpstg_send_debug_log_report",params);case 9:data=_context.sent,this.contactUsReportIssueBtn.disabled=!1,!0===(null===(_data$response=data.response)||void 0===_data$response?void 0:_data$response.sent)&&(this.contactUsDebugCodeField.value=debugCode,show(this.contactUsSuccessPopup),window.debugCode=debugCode,this.contactUsForceSendDebugLog&&(hide(this.contactUsForceSendDebugLogContainer),this.contactUsForceSendDebugLog.checked=!1)),!1===(null===(_data$response2=data.response)||void 0===_data$response2?void 0:_data$response2.sent)&&"already_submitted"===data.response.status&&(this.contactUsForceSendDebugLog&&show(this.contactUsForceSendDebugLogContainer),notify("error",data.response.message)),hide(this.contactUsLoader),_context.next=21;break;case 16:_context.prev=16,_context.t0=_context.catch(6),hide(this.contactUsLoader),show(this.contactUsSupport),console.warn(this.wpstgObject.i18n.something_went_wrong,_context.t0);case 21:case"end":return _context.stop()}}),_callee,this,[[6,16]])}))),function(){return _sendDebugInfo.apply(this,arguments)})},{key:"toggleActiveClass",value:function(){this.isDebugWindowOpened||!this.reportIssueButton.classList.contains("active")?this.isDebugWindowOpened&&this.reportIssueButton.classList.add("active"):this.reportIssueButton.classList.remove("active")}}]);var _sendDebugInfo}(),WpstgCloneStaging=function(){return _createClass((function WpstgCloneStaging(){var pageWrapperId=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#wpstg-clonepage-wrapper",wpstgObject=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wpstg;_classCallCheck(this,WpstgCloneStaging),this.pageWrapper=qs(pageWrapperId),this.wpstgObject=wpstgObject,this.enableButtonId="#wpstg-enable-staging-cloning",this.enableAction="wpstg_enable_staging_cloning",this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}),[{key:"addEvents",value:function(){var _this=this;null!==this.pageWrapper&&addEvent(this.pageWrapper,"click",this.enableButtonId,(function(){_this.sendRequest(_this.enableAction)}))}},{key:"init",value:function(){this.addEvents()}},{key:"sendRequest",value:function(action){var _this2=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:action,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return response.ok?response.json():Promise.reject(response)})).then((function(data){void 0!==data.success&&data.success?location.reload():void 0===data.message?_this2.notyf.error(_this2.wpstgObject.i18n.something_went_wrong):_this2.notyf.error(data.message)})).catch((function(error){console.warn(_this2.wpstgObject.i18n.something_went_wrong,error)}))}}])}();function wpstgHoverIntent(parent,selector,onOver,onOut){var x,y,pX,pY,mouseOver=!1,focused=!1,h={},state=0,timer=0,options={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function tracker(e){x=e.clientX,y=e.clientY}function compare(el,e){if(timer&&(timer=clearTimeout(timer)),Math.abs(pX-x)+Math.abs(pY-y)<options.sensitivity)return state=1,focused?void 0:onOver(el,e);pX=x,pY=y,timer=setTimeout((function(){compare(el,e)}),options.interval)}function dispatchOver(el,e){return mouseOver=!0,timer&&(timer=clearTimeout(timer)),el.removeEventListener("mousemove",tracker,!1),1!==state&&(pX=e.clientX,pY=e.clientY,el.addEventListener("mousemove",tracker,!1),timer=setTimeout((function(){compare(el,e)}),options.interval)),this}function onMouseOver(event){event.target.matches(selector+", "+selector+" *")&&dispatchOver(event.target.closest(selector),event)}function dispatchOut(el,e){return mouseOver=!1,timer&&(timer=clearTimeout(timer)),el.removeEventListener("mousemove",tracker,!1),1===state&&(timer=setTimeout((function(){!function(el,e){timer&&(timer=clearTimeout(timer)),state=0,focused||onOut(el,e)}(el,e)}),options.timeout)),this}function onMouseOut(event){event.target.matches(selector+", "+selector+" *")&&dispatchOut(event.target.closest(selector),event)}function onFocus(event){var el,e;event.target.matches(selector+", "+selector+" *")&&(el=event.target.closest(selector),e=event,mouseOver||(focused=!0,onOver(el,e)))}function onBlur(event){var el,e;event.target.matches(selector+", "+selector+" *")&&(el=event.target.closest(selector),e=event,!mouseOver&&focused&&(focused=!1,onOut(el,e)))}function removeFocus(){parent.removeEventListener("focus",onFocus,!1),parent.removeEventListener("blur",onBlur,!1)}return h.options=function(opt){var focusOptionChanged=opt.handleFocus!==options.handleFocus;return options=Object.assign({},options,opt),focusOptionChanged&&(options.handleFocus?(parent.addEventListener("focus",onFocus,!1),parent.addEventListener("blur",onBlur,!1)):removeFocus()),h},h.remove=function(){parent&&(parent.removeEventListener("mouseover",onMouseOver,!1),parent.removeEventListener("mouseout",onMouseOut,!1),removeFocus())},parent&&(parent.addEventListener("mouseover",onMouseOver,!1),parent.addEventListener("mouseout",onMouseOut,!1)),h}var WpstgDetectMemoryExhaust=function(){return _createClass((function WpstgDetectMemoryExhaust(){var wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,WpstgDetectMemoryExhaust),this.wpstgObject=wpstgObject}),[{key:"sendRequest",value:(_sendRequest=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(requestType){var response,data;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--detect-memory-exhaust",requestType:requestType,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:return response=_context.sent,_context.next=6,response.json();case 6:if(void 0===(data=_context.sent).status||!data.status||!data.error){_context.next=9;break}return _context.abrupt("return",data);case 9:data.message&&console.warn(data.message),_context.next=15;break;case 12:_context.prev=12,_context.t0=_context.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,_context.t0);case 15:return _context.abrupt("return",!1);case 16:case"end":return _context.stop()}}),_callee,this,[[0,12]])}))),function(_x){return _sendRequest.apply(this,arguments)})}]);var _sendRequest}(),OtpInput=function(){return _createClass((function OtpInput(containerSelectorOrElement){if(_classCallCheck(this,OtpInput),this.container="string"==typeof containerSelectorOrElement?document.querySelector(containerSelectorOrElement):containerSelectorOrElement,!(this.container instanceof HTMLElement))throw console.error("Container not found."),new Error("Container not found.");this.emptyChar=" ",this.inputs=this.container.querySelectorAll("input[type=text], input[type=number], input[type=password]"),this.inputCount=this.inputs.length,this.init()}),[{key:"reset",value:function(){this.inputs.forEach((function(input){input.value="",input.dataset.otpInputRestore=""}))}},{key:"init",value:function(){for(var _this=this,_loop=function(i){var input=_this.inputs[i];input.addEventListener("input",(function(){_this.bindInputEvent(input,i)})),input.addEventListener("keydown",(function(e){_this.bindKeyEvent(input,i,e)})),0===i&&input.addEventListener("paste",(function(e){e.preventDefault();var pastedData=(e.clipboardData||window.clipboardData).getData("Text");pastedData&&_this.setValue(pastedData)}))},i=0;i<this.inputCount;i++)_loop(i)}},{key:"bindInputEvent",value:function(input,index){if(Number.isNaN(Number(input.value)))input.value=input.dataset.otpInputRestore||"";else{if(0===input.value.length)return this._saveInputValue(index);if(1===input.value.length)return this._saveInputValue(index),void(index+1<this.inputCount&&this.inputs[index+1].focus());if(index===this.inputCount-1)return this._setInputValue(index,input.value);for(var chars=input.value.split(""),position=0;position<chars.length&&!(position+index>=this.inputCount);position++)this._setInputValue(position+index,chars[position]);var focus_index=Math.min(this.inputCount-1,index+chars.length);this.inputs[focus_index].focus()}}},{key:"bindKeyEvent",value:function(input,index,e){if("Backspace"===e.key&&""===input.value&&0!==index)return this._setInputValue(index-1,""),void this.inputs[index-1].focus();if("Delete"===e.key&&index!==this.inputCount-1){for(var selectionStart=input.selectionStart||0,position=index+selectionStart;position<this.inputCount-1;position++)this._setInputValue(position,this.inputs[position+1].value);return this._setInputValue(this.inputCount-1,""),input.selectionStart&&(input.selectionStart=selectionStart),void e.preventDefault()}"ArrowLeft"!==e.key||null!=input.selectionStart&&0!==input.selectionStart?"ArrowRight"!==e.key||null!=input.selectionStart&&input.selectionEnd!==input.value.length||index+1<this.inputCount&&(e.preventDefault(),this.inputs[index+1].focus(),this.inputs[index+1].select()):index>0&&(e.preventDefault(),this.inputs[index-1].focus(),this.inputs[index-1].select())}},{key:"getValue",value:function(){var _this2=this,value="";return this.inputs.forEach((function(input){value+=""===input.value?_this2.emptyChar:input.value})),value}},{key:"setValue",value:function(value){if(Number.isNaN(value))console.error("Please enter an integer value.");else for(var chars="".concat(value).split(""),i=0;i<this.inputs.length;i++)this._setInputValue(i,chars[i]||"")}},{key:"_setInputValue",value:function(index,value){return Number.isNaN(Number(value))?console.error("Please enter an integer value."):this.inputs[index]?(this.inputs[index].value=String(value).substring(0,1),void this._saveInputValue(index)):console.error("Index not found.")}},{key:"_saveInputValue",value:function(index,value){if(!this.inputs[index])return console.error("Index not found.");this.inputs[index].dataset.otpInputRestore=value||this.inputs[index].value}}])}(),OtpService=function(){return _createClass((function OtpService(){_classCallCheck(this,OtpService)}),[{key:"init",value:function(){var _this=this;this.otpScreen=document.querySelector("#wpstg--otp--overlay-screen"),this.otpContainer=this.otpScreen.querySelector(".wpstg-otp-container"),this.otpInput=new OtpInput(this.otpContainer),this.verifyButton=this.otpScreen.querySelector(".wpstg-otp-verify-btn"),this.closeButton=this.otpScreen.querySelector(".wpstg-otp-overlay-close-btn"),this.resendButton=this.otpScreen.querySelector(".wpstg-otp-resend-btn"),this.otpMessageContainer=this.otpScreen.querySelector(".wpstg-otp-message"),this.reset(),this.addEventListener(".wpstg-otp-overlay-close-btn",(function(){_this.otpScreen.style.display="none",_this.onCancel(),_this.reset()})),this.addEventListener(".wpstg-otp-verify-btn",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.verifyOtp();case 2:case"end":return _context.stop()}}),_callee)})))),this.addEventListener(".wpstg-otp-resend-btn",_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this.resendOtp();case 2:case"end":return _context2.stop()}}),_callee2)}))))}},{key:"addEventListener",value:function(selector,listener){this.otpScreen.querySelector(selector).addEventListener("click",(function(event){listener(event)}))}},{key:"createSession",value:function(){return Date.now().toString(36)+Math.random().toString(36).substring(0,2)}},{key:"reset",value:function(){this.sessionId=null,this.otpAction=null,this.otpMessageContainer.innerHTML="",this.onVerification=null,this.onRequest=null,this.onCancel=function(){},this.additionalData={},this.otpInput.reset()}},{key:"verifyOtp",value:(_verifyOtp=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var otp;return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!((otp=this.otpInput.getValue()).length<this.otpInput.inputCount)){_context3.next=3;break}return _context3.abrupt("return");case 3:return _context3.next=5,this.processOtpVerification(otp);case 5:case"end":return _context3.stop()}}),_callee3,this)}))),function(){return _verifyOtp.apply(this,arguments)})},{key:"processOtpVerification",value:(_processOtpVerification=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(otp){var _error$data,_yield$wpstgRequestWi,response,error,code,_error$data2;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return this.closeButton.disabled=!0,this.verifyButton.disabled=!0,this.resendButton.style.display="none",_context4.next=5,wpstgRequestWithError(this.otpAction,_objectSpread2(_objectSpread2({},this.additionalData),{},{sessionId:this.sessionId,otp:otp}));case 5:if(_yield$wpstgRequestWi=_context4.sent,response=_yield$wpstgRequestWi.response,error=_yield$wpstgRequestWi.error,code=_yield$wpstgRequestWi.code,this.closeButton.disabled=!1,this.verifyButton.disabled=!1,this.resendButton.style.display="block",403!==code||null==error||null===(_error$data=error.data)||void 0===_error$data||!_error$data.message){_context4.next=15;break}return notify("error",null==error||null===(_error$data2=error.data)||void 0===_error$data2?void 0:_error$data2.message),_context4.abrupt("return");case 15:this.otpScreen.style.display="none",this.onVerification(response,error,code),this.reset();case 18:case"end":return _context4.stop()}}),_callee4,this)}))),function(_x){return _processOtpVerification.apply(this,arguments)})},{key:"resendOtp",value:(_resendOtp=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var _yield$wpstgRequestWi2,response,error,_error$data$message,_error$data3;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,wpstgRequestWithError("wpstg--send--otp",{sessionId:this.sessionId,resend:"true"});case 2:if(_yield$wpstgRequestWi2=_context5.sent,response=_yield$wpstgRequestWi2.response,error=_yield$wpstgRequestWi2.error,_yield$wpstgRequestWi2.code,!error){_context5.next=9;break}return notify("error",null!==(_error$data$message=null==error||null===(_error$data3=error.data)||void 0===_error$data3?void 0:_error$data3.message)&&void 0!==_error$data$message?_error$data$message:wpstg.i18n.something_went_wrong),_context5.abrupt("return");case 9:if(response){_context5.next=11;break}return _context5.abrupt("return");case 11:this.initResendTimer(response.data.message,response.data.reRequestAt);case 12:case"end":return _context5.stop()}}),_callee5,this)}))),function(){return _resendOtp.apply(this,arguments)})},{key:"setOnOtpRequest",value:function(onRequest){this.onRequest=onRequest}},{key:"setOnOtpVerification",value:function(onVerification){this.onVerification=onVerification}},{key:"setOnOtpCancelled",value:function(onCancel){this.onCancel=onCancel}},{key:"start",value:(_start=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(action){var additionalData,_yield$this$requestOt,response,error,code,_args6=arguments;return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(additionalData=_args6.length>1&&void 0!==_args6[1]?_args6[1]:{},this.onRequest&&this.onRequest instanceof Function){_context6.next=3;break}return _context6.abrupt("return");case 3:if(this.onVerification&&this.onVerification instanceof Function){_context6.next=5;break}return _context6.abrupt("return");case 5:return this.otpAction=action,this.additionalData=additionalData,_context6.next=9,this.requestOtp();case 9:if(_yield$this$requestOt=_context6.sent,response=_yield$this$requestOt.response,error=_yield$this$requestOt.error,202!==(code=_yield$this$requestOt.code)){_context6.next=17;break}return _context6.next=16,this.processOtpVerification("");case 16:return _context6.abrupt("return");case 17:null!=response&&response.success&&(this.otpScreen.style.display="flex"),this.onRequest(response,error,code);case 19:case"end":return _context6.stop()}}),_callee6,this)}))),function(_x2){return _start.apply(this,arguments)})},{key:"requestOtp",value:(_requestOtp=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var _yield$wpstgRequestWi3,response,error,code;return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return this.sessionId=this.createSession(),_context7.next=3,wpstgRequestWithError("wpstg--send--otp",{sessionId:this.sessionId});case 3:return _yield$wpstgRequestWi3=_context7.sent,response=_yield$wpstgRequestWi3.response,error=_yield$wpstgRequestWi3.error,code=_yield$wpstgRequestWi3.code,_context7.abrupt("return",{response:response,error:error,code:code});case 8:case"end":return _context7.stop()}}),_callee7,this)}))),function(){return _requestOtp.apply(this,arguments)})},{key:"initResendTimer",value:function(message,requestAt){var _this2=this;this.resendButton.style.display="none",this.otpMessageContainer.innerHTML="",this.otpMessageContainer.style.display="block",this.interval=setInterval((function(){var currentSeconds=(new Date).getTime()/1e3,timeLeft=Math.ceil(requestAt-currentSeconds);timeLeft<=0?(clearInterval(_this2.interval),_this2.resendButton.style.display="block",_this2.otpMessageContainer.style.display="none"):_this2.otpMessageContainer.innerHTML=message.replace("%s","".concat(timeLeft,"s"))}),1e3)}}]);var _requestOtp,_start,_resendOtp,_processOtpVerification,_verifyOtp}(),WPStagingCommon=function($){var WPStagingCommon={OTP_DISABLE_ARTICLE:"https://wp-staging.com/docs/disable-verification-code",continueErrorHandle:!0,otp:new OtpService,retry:{currentDelay:0,count:0,max:wpstg.maxFailedRetries,retryOnErrors:[401,403,404,429,502,503,504],oneTimeRetry:!1,performingRequest:!1,incrementRetry:function(){var incrementRatio=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.25;WPStagingCommon.retry.performingRequest=!0,0===WPStagingCommon.retry.currentDelay&&(WPStagingCommon.retry.currentDelay=1e3,WPStagingCommon.retry.count=1),WPStagingCommon.retry.currentDelay+=1e3*WPStagingCommon.retry.count*incrementRatio,WPStagingCommon.retry.count++},canRetry:function(){return WPStagingCommon.retry.count<WPStagingCommon.retry.max},reset:function(){WPStagingCommon.retry.currentDelay=0,WPStagingCommon.retry.count=0,WPStagingCommon.retry.performingRequest=!1,WPStagingCommon.retry.oneTimeRetry=!1}},delay:function(ms){return new Promise((function(resolve){return setTimeout(resolve,ms)}))},memoryExhaustArticleLink:"https://wp-staging.com/docs/php-fatal-error-allowed-memory-size-of-134217728-bytes-exhausted/",cache:{elements:[],get:function(selector){return-1!==$.inArray(selector,this.elements)||(this.elements[selector]=$(selector)),this.elements[selector]},refresh:function(selector){selector.elements[selector]=$(selector)}},setJobId:function(jobId){localStorage.setItem("jobIdBeingProcessed",jobId)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},checkMemoryExhaustion:function(requestType){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var detectMemoryExhaust,response;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return detectMemoryExhaust=new WpstgDetectMemoryExhaust,_context.next=3,detectMemoryExhaust.sendRequest(requestType);case 3:if(response=_context.sent){_context.next=6;break}return _context.abrupt("return",!1);case 6:return _context.abrupt("return",response);case 10:case"end":return _context.stop()}}),_callee)})))()},listenTooltip:function(){wpstgHoverIntent(document,".wpstg--tooltip",(function(target,event){target.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(target,event){event.target.closest(".wpstg--tooltiptext a")||(target.querySelector(".wpstg--tooltiptext").style.visibility="hidden")}))},getSwalModal:function(){var customClasses=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},defaultCustomClasses={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"wpstg-swal-popup wpstg-centered-modal":"wpstg-swal-popup"},options={customClass:Object.assign(defaultCustomClasses,customClasses),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(options)},showSuccessModal:function(htmlContent){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"success",title:wpstg.i18n.success+"!",html:'<div class="wpstg--grey" style="text-align: left; line-height: 1.5;">'+htmlContent+"</div>"})},showWarningModal:function(htmlContent){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; line-height: 1.5;">'+htmlContent+"</div>"})},showOtpGenerationErrorModal:function(){WPStagingCommon.showErrorModal(wpstg.i18n.cannot_generate_otp_error.replace("%s",WPStagingCommon.OTP_DISABLE_ARTICLE),wpstg.i18n.something_went_wrong)},showErrorModal:function(htmlContent){var title=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;void 0!==title&&""!==title&&null!==title||(title=wpstg.i18n.error+"!"),this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:wpstg.i18n.ok,icon:"error",title:title,html:'<div class="wpstg--grey" style="text-align: left; line-height: 1.5;">'+htmlContent+"</div>"})},processAndShowErrorModal:function(response,error,code){var _response$data,_error$data,title=wpstg.i18n.error+(null==code?"!":" "+code+"!");if(null!=response&&response.message)WPStagingCommon.showErrorModal(response.message,title);else if(null!=response&&null!==(_response$data=response.data)&&void 0!==_response$data&&_response$data.message)WPStagingCommon.showErrorModal(response.data.message,title);else if(null!=response&&response.data)WPStagingCommon.showErrorModal(response.data,title);else if(null!=error&&error.message)WPStagingCommon.showErrorModal(error.message,title);else if(null!=error&&null!==(_error$data=error.data)&&void 0!==_error$data&&_error$data.message)WPStagingCommon.showErrorModal(error.data.message,title);else if(null!=error&&error.data)WPStagingCommon.showErrorModal(error.data,title);else{var message=wpstg.i18n.something_went_wrong;WPStagingCommon.showErrorModal(message,title)}},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},confirmModal:function(title,html,confirmText,confirmButtonClass){return WPStagingCommon.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:confirmButtonClass+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:title,icon:"warning",html:html,width:"750px",focusConfirm:!1,confirmButtonText:confirmText,showCancelButton:!0})},getDataFromWordPressResponse:function(response){if("object"!==_typeof(response))throw new Error("Unexpected response (ERR 1341)");if(!response.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!response.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===response.success)throw response.data instanceof Array&&response.data.length>0?new Error(response.data.shift()):new Error("Response was not successful");return response.data},isLoading:function(_isLoading){_isLoading&&!1!==_isLoading?WPStagingCommon.cache.get(".wpstg-loader").show():WPStagingCommon.cache.get(".wpstg-loader").hide()},slugify:function(url){return url.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},sanitizeEventAttribute:function(string){return null===string?string:string.toString().replace(/("|')\s+on([a-z]+)\s?=\s?([a-z0-9\)\(\"\';]+)/i,"")},htmlEntityQuotesDecode:function(string){return null===string?string:string.toString().replace(/\\"/g,"&quot;").replace(/\\'/g,"&#039")},showAjaxFatalError:function(response,prependMessage,appendMessage){return prependMessage=prependMessage?prependMessage+"<br/><br/>":wpstg.i18n.something_went_wrong+"<br/><br/>",appendMessage=appendMessage?appendMessage+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===response?(WPStagingCommon.showError(prependMessage+" Error: No response."+appendMessage),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==response.error&&response.error?(WPStagingCommon.showError(prependMessage+" Error: "+response.message+appendMessage),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},showFirewallError:function(){return wpstg.i18n.common.firewall_error_text},handleFetchErrors:function(response){if(!response.ok){var showModal=!1,errorText="Error: "+response.status+" - "+response.statusText+". ";403===response.status||405===response.status||406===response.status?(errorText+=WPStagingCommon.showFirewallError(),showModal=!0):errorText+=wpstg.i18n.common.fetch_errors_error_text,showModal&&WPStagingCommon.showErrorModal(errorText),WPStagingCommon.showError(errorText)}return response},showError:function(message){WPStagingCommon.retry.performingRequest||(WPStagingCommon.cache.get("#wpstg-try-again").css("display","inline-block"),WPStagingCommon.cache.get("#wpstg-cancel-cloning").text("Reset"),WPStagingCommon.cache.get("#wpstg-resume-cloning").show(),WPStagingCommon.cache.get("#wpstg-error-wrapper").show(),WPStagingCommon.cache.get("#wpstg-error-details").show().html(message),WPStagingCommon.cache.get("#wpstg-removing-clone").removeClass("loading"),WPStagingCommon.cache.get(".wpstg-loader").hide(),$(".wpstg--modal--process--generic-problem").show().html(message))},resetErrors:function(){WPStagingCommon.cache.get("#wpstg-error-details").hide().html("")},ajax:function(data,callback,dataType,showErrors,tryCount){var incrementRatio=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,errorCallback=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;void 0===dataType&&(dataType="json"),!1!==showErrors&&(showErrors=!0),tryCount=void 0===tryCount?0:tryCount;var retryLimit=wpstg.maxFailedRetries,retryTimeout=1e4*tryCount;incrementRatio=parseInt(incrementRatio),isNaN(incrementRatio)||(retryTimeout*=incrementRatio),$.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:dataType,cache:!1,data:data,error:function(xhr,textStatus,errorThrown){if(console.log(xhr.status+" "+xhr.statusText+"---"+textStatus),"function"!=typeof errorCallback||(errorCallback(xhr,textStatus,errorThrown),WPStagingCommon.continueErrorHandle))if(++tryCount<=retryLimit)setTimeout((function(){WPStagingCommon.ajax(data,callback,dataType,showErrors,tryCount,incrementRatio)}),retryTimeout);else{var errorCode=void 0===xhr.status?"Unknown":xhr.status,errorText=wpstg.i18n.common.ajax_error_fatal_error+errorCode+wpstg.i18n.common.ajax_error_error_text;403!==errorCode&&405!==errorCode&&406!==errorCode||(errorText=wpstg.i18n.common.ajax_error_fatal_error+errorCode+" "+WPStagingCommon.showFirewallError()),WPStagingCommon.showError(errorText)}else WPStagingCommon.continueErrorHandle=!0},success:function(data){"function"==typeof callback&&callback(data)},statusCode:{404:function(){tryCount>=retryLimit&&WPStagingCommon.showError(wpstg.i18n.ajax_status_code_404)},500:function(){tryCount>=retryLimit&&WPStagingCommon.showError(wpstg.i18n.status_code_500)},504:function(){tryCount>retryLimit&&WPStagingCommon.showError(wpstg.i18n.common.ajax_status_code_504)},502:function(){tryCount>=retryLimit&&WPStagingCommon.showError(wpstg.i18n.common.ajax_status_code_502)},503:function(){tryCount>=retryLimit&&WPStagingCommon.showError(wpstg.i18n.common.ajax_status_code_503)},429:function(){tryCount>=retryLimit&&WPStagingCommon.showError(wpstg.i18n.common.ajax_status_code_429)},403:function(){showError("Error 403 - "+WPStagingCommon.showFirewallError())},405:function(){showError("Error 405 - "+WPStagingCommon.showFirewallError())},406:function(){showError("Error 406 - "+WPStagingCommon.showFirewallError())}}})}};return WPStagingCommon}(jQuery),WpstgDirectoryNavigation=function(){return _createClass((function WpstgDirectoryNavigation(){var directoryListingSelector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#wpstg-directories-listing",wpstgObject=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WPStagingCommon;_classCallCheck(this,WpstgDirectoryNavigation),this.directoryListingContainer=qs(directoryListingSelector),this.wpstgObject=wpstgObject,this.dirCheckboxSelector=".wpstg-check-dir",this.dirExpandSelector=".wpstg-expand-dirs",this.unselectAllDirsSelector=".wpstg-unselect-dirs",this.selectDefaultDirsSelector=".wpstg-select-dirs-default",this.fetchChildrenAction="wpstg_fetch_dir_children",this.currentCheckboxElement=null,this.currentParentDiv=null,this.currentLoader=null,this.existingExcludes=[],this.excludedDirectories=[],this.isDefaultSelected=!1,this.init()}),[{key:"addEvents",value:function(){var _this=this;null!==this.directoryListingContainer?(addEvent(this.directoryListingContainer,"change",this.dirCheckboxSelector,(function(element,event){event.preventDefault()})),addEvent(this.directoryListingContainer,"click",this.dirExpandSelector,(function(element,event){event.preventDefault(),_this.toggleDirExpand(element)&&_this.sendRequest(_this.fetchChildrenAction,element)})),addEvent(this.directoryListingContainer,"click",this.unselectAllDirsSelector,(function(){_this.unselectAll()})),addEvent(this.directoryListingContainer,"click",this.selectDefaultDirsSelector,(function(){_this.selectDefault()})),addEvent(this.directoryListingContainer,"click",".wpstg-expand-dirs",(function(target,event){event.preventDefault(),_this.toggleDirectoryNavigation(target)})),addEvent(this.directoryListingContainer,"change","input.wpstg-check-dir",(function(target){_this.updateDirectorySelection(target)}))):console.log("Error: Unable to add directory navigation events.")}},{key:"init",value:function(){this.addEvents(),this.parseExcludes()}},{key:"toggleDirExpand",value:function(element){this.currentParentDiv=element.parentElement;var checkboxWrapper=getPreviousSibling(element,"span");return this.currentCheckboxElement=checkboxWrapper.querySelector('input[type="checkbox"]'),this.currentLoader=this.currentParentDiv.querySelector(".wpstg-is-dir-loading"),"false"!==this.currentCheckboxElement.getAttribute("data-navigatable","false")&&"false"===this.currentCheckboxElement.getAttribute("data-scanned","false")}},{key:"sendRequest",value:function(action){var _this2=this;null!==this.currentLoader&&(this.currentLoader.style.display="inline-block");var changed=this.currentCheckboxElement.getAttribute("data-changed"),path=this.currentCheckboxElement.getAttribute("data-path"),prefix=this.currentCheckboxElement.getAttribute("data-prefix");fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:action,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,dirPath:path,prefix:prefix,isChecked:this.currentCheckboxElement.checked,forceDefault:"true"===changed}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return response.ok?response.json():Promise.reject(response)})).then((function(data){if(void 0!==data.success&&data.success){_this2.currentCheckboxElement.setAttribute("data-scanned",!0);var dirContainer=document.createElement("div");return dirContainer.classList.add("wpstg-dir"),dirContainer.classList.add("wpstg-subdir"),dirContainer.innerHTML=JSON.parse(data.directoryListing),_this2.currentParentDiv.appendChild(dirContainer),null!==_this2.currentLoader&&(_this2.currentLoader.style.display="none"),void slideDown(dirContainer)}notify("error",_this2.wpstgObject.i18n.something_went_wrong)})).catch((function(error){console.warn(_this2.wpstgObject.i18n.something_went_wrong,error)}))}},{key:"getExcludedDirectories",value:function(){var _this$wpstgObject$set,_this3=this;return this.excludedDirectories=[],this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input:not(:checked)").forEach((function(element){_this3.isParentExcluded(element.value)||_this3.excludedDirectories.push(element.value)})),this.existingExcludes||(this.existingExcludes=[]),this.existingExcludes.forEach((function(exclude){_this3.isParentExcluded(exclude)||_this3.isScanned(exclude)||_this3.excludedDirectories.push(exclude)})),this.excludedDirectories.join(null===(_this$wpstgObject$set=this.wpstgObject.settings)||void 0===_this$wpstgObject$set?void 0:_this$wpstgObject$set.directorySeparator)}},{key:"isParentExcluded",value:function(path){var isParentAlreadyExcluded=!1;return this.excludedDirectories.forEach((function(dir){path.startsWith(dir+"/")&&(isParentAlreadyExcluded=!0)})),isParentAlreadyExcluded}},{key:"getExtraDirectoriesRootOnly",value:function(){this.getExcludedDirectories();var extraDirectories=[];this.directoryListingContainer.querySelectorAll(":not(.wpstg-subdir)>.wpstg-dir .wpstg--checkbox-wrapper>input.wpstg-wp-non-core-dir:checked").forEach((function(element){extraDirectories.push(element.value)}));var _this$wpstgObject$set2,extraDirectoriesTextArea=qs("#wpstg_extraDirectories");if(null===extraDirectoriesTextArea||""===extraDirectoriesTextArea.value)return extraDirectories.join(null===(_this$wpstgObject$set2=this.wpstgObject.settings)||void 0===_this$wpstgObject$set2?void 0:_this$wpstgObject$set2.directorySeparator);var extraCustomDirectories=extraDirectoriesTextArea.value.split(/\r?\n/);return extraDirectories.concat(extraCustomDirectories).join(this.wpstgObject.settings.directorySeparator)}},{key:"unselectAll",value:function(){this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input").forEach((function(element){element.checked=!1})),this.countSelectedFiles()}},{key:"selectDefault",value:function(){this.unselectAll(),this.directoryListingContainer.querySelectorAll(".wpstg-dir .wpstg--checkbox-wrapper input.wpstg-wp-core-dir").forEach((function(element){element.checked=!0})),this.directoryListingContainer.querySelectorAll(".wpstg-dir > .wpstg--checkbox-wrapper .wpstg-wp-non-core-dir").forEach((function(element){element.parentElement.querySelectorAll("input.wpstg-wp-core-dir").forEach((function(element){element.checked=!1}))})),this.isDefaultSelected=!0,this.countSelectedFiles()}},{key:"parseExcludes",value:function(){if(this.existingExcludes=this.directoryListingContainer.getAttribute("data-existing-excludes",[]),void 0!==this.existingExcludes&&this.existingExcludes)if(0!==this.existingExcludes.length){var existingExcludes=this.existingExcludes.split(",");this.existingExcludes=existingExcludes.map((function(exclude){return"/"===exclude.substr(0,1)?exclude.slice(1):exclude}))}else this.existingExcludes=[];else this.existingExcludes=[]}},{key:"isScanned",value:function(exclude){var scanned=!1;return this.directoryListingContainer.querySelectorAll(".wpstg-dir> .wpstg--checkbox-wrapper>input").forEach((function(element){element.value===exclude&&(scanned=!0)})),scanned}},{key:"toggleDirectoryNavigation",value:function(element){var checkboxWrapper=getPreviousSibling(element,"span"),cbElement=checkboxWrapper.querySelector('input[type="checkbox"]');if("false"!==cbElement.getAttribute("data-navigatable","false")&&"false"!==cbElement.getAttribute("data-scanned","false")){var subDirectories=function(element,selector){for(var sibling=element.nextElementSibling;sibling;){if(sibling.matches(selector))return sibling;sibling=sibling.nextElementSibling}}(checkboxWrapper,".wpstg-subdir");"none"===subDirectories.style.display?slideDown(subDirectories):slideUp(subDirectories)}}},{key:"updateDirectorySelection",value:function(element){var parent=element.parentElement.parentElement;element.setAttribute("data-changed","true"),element.checked?(function(element,selector){for(var result=[],parent=element&&element.parentElement;parent;parent=parent.parentElement)parent.matches(selector)&&result.push(parent);return result}(parent.parentElement,".wpstg-dir").forEach((function(parElem){for(var i=0;i<parElem.children.length;i++)parElem.children[i].matches(".wpstg--checkbox-wrapper")&&(parElem.children[i].children[i].checked=!0)})),parent.parentElement.querySelectorAll(".wpstg-expand-dirs").forEach((function(x){"wp-admin"!==x.textContent&&"wp-includes"!==x.textContent&&x.classList.remove("disabled")})),parent.querySelectorAll(".wpstg-subdir .wpstg-check-dir").forEach((function(x){x.checked=!0}))):(parent.querySelectorAll(".wpstg-expand-dirs, .wpstg-check-subdirs").forEach((function(x){x.classList.add("disabled")})),parent.querySelectorAll(".wpstg-dir .wpstg-check-dir").forEach((function(x){x.checked=!1}))),this.countSelectedFiles()}},{key:"countSelectedFiles",value:function(){var themesCount=this.directoryListingContainer.querySelectorAll('[data-dir-type="theme"]:checked').length,pluginsCount=this.directoryListingContainer.querySelectorAll('[data-dir-type="plugin"]:checked').length,otherFolders=this.directoryListingContainer.querySelectorAll('[data-dir-type="other"]:checked'),othersCount=0;otherFolders.forEach((function(otherFolders){var _otherFolders$getAttr,_otherFolders$getAttr2;null!==(_otherFolders$getAttr=otherFolders.getAttribute("data-path"))&&void 0!==_otherFolders$getAttr&&_otherFolders$getAttr.includes("wp-content/plugins")||null!==(_otherFolders$getAttr2=otherFolders.getAttribute("data-path"))&&void 0!==_otherFolders$getAttr2&&_otherFolders$getAttr2.includes("wp-content/themes")||othersCount++}));var filesCountElement=qs("#wpstg-files-count");0===themesCount&&0===pluginsCount&&0===othersCount?filesCountElement.classList.add("danger"):filesCountElement.classList.remove("danger"),filesCountElement.innerHTML=this.wpstgObject.i18n.files_selected.replace("{t}",themesCount).replace("{ts}",1===themesCount?"":"s").replace("{p}",pluginsCount).replace("{ps}",1===pluginsCount?"":"s").replace("{o}",othersCount).replace("{os}",1===othersCount?"":"s")}}])}(),WpstgTableSelection=function(){return _createClass((function WpstgTableSelection(){var databaseTableSectionSelector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#wpstg-scanning-db",workflowSelector=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#wpstg-workflow",networkCloneSelector=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#wpstg_network_clone",inputSelector=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#wpstg_select_tables_cloning",wpstgObject=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wpstg;_classCallCheck(this,WpstgTableSelection),this.databaseTableSection=qs(databaseTableSectionSelector),this.workflow=qs(workflowSelector),this.networkCloneSelector=networkCloneSelector,this.networkCloneCheckbox=qs(networkCloneSelector),this.wpstgObject=wpstgObject,this.isAllTablesChecked=!0,this.isMultisite="1"===this.wpstgObject.isMultisite,this.isNetworkClone=!1,this.inputSelector=inputSelector,this.input=qs(this.inputSelector),this.init()}),[{key:"setNetworkClone",value:function(isNetworkClone){this.isNetworkClone=isNetworkClone}},{key:"addEvents",value:function(){var _this=this;null!==this.workflow?(addEvent(this.workflow,"change",this.networkCloneSelector,(function(){_this.selectDefaultTables()})),addEvent(this.workflow,"change",this.inputSelector,(function(){_this.countSelectedTables()})),addEvent(this.workflow,"click",".wpstg-button-select",(function(target,event){event.preventDefault(),_this.selectDefaultTables()})),addEvent(this.workflow,"click",".wpstg-button-unselect",(function(target,event){event.preventDefault(),_this.toggleTableSelection()})),addEvent(this.workflow,"click",".wpstg-button-unselect-wpstg",(function(target,event){event.preventDefault(),_this.unselectWPSTGTables()}))):console.log("Error: database table section is null. Cannot register events")}},{key:"init",value:function(){this.addEvents()}},{key:"getRegexPattern",value:function(){var pattern="^"+this.wpstgObject.tblprefix,isNetwork=!1;return void 0!==this.networkCloneCheckbox&&null!==this.networkCloneCheckbox&&(isNetwork=this.networkCloneCheckbox.checked),this.isNetworkClone&&(isNetwork=!0),this.isMultisite&&!isNetwork&&(pattern+="([^0-9])_*"),pattern}},{key:"selectDefaultTables",value:function(){var options=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table"),regexPattern=this.getRegexPattern();options.forEach((function(option){option.getAttribute("name","").match(regexPattern)?option.selected=!0:option.selected=!1})),this.countSelectedTables()}},{key:"toggleTableSelection",value:function(){!1===this.isAllTablesChecked?(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(option){option.selected=!0})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.isAllTablesChecked=!0):(this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table").forEach((function(option){option.selected=!1})),this.databaseTableSection.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.isAllTablesChecked=!1),this.countSelectedTables()}},{key:"unselectWPSTGTables",value:function(){var _this2=this,options=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning .wpstg-db-table");options.forEach((function(option){var name=option.getAttribute("name","");name.match("wpstg")&&!name.match(_this2.wpstgObject.tblprefix+"wpstg_queue")&&(option.selected=!1)})),this.countSelectedTables()}},{key:"getSelectedTablesWithoutPrefix",value:function(){var selectedTablesWithoutPrefix=[],options=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),regexPattern=this.getRegexPattern();return options.forEach((function(option){option.getAttribute("name","").match(regexPattern)||selectedTablesWithoutPrefix.push(option.value)})),selectedTablesWithoutPrefix.join(this.wpstgObject.settings.directorySeparator)}},{key:"getIncludedTables",value:function(){var includedTables=[],options=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:checked"),regexPattern=this.getRegexPattern();return options.forEach((function(option){option.getAttribute("name","").match(regexPattern)&&includedTables.push(option.value)})),includedTables.join(this.wpstgObject.settings.directorySeparator)}},{key:"getExcludedTables",value:function(){var excludedTables=[],options=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option:not(:checked)"),regexPattern=this.getRegexPattern();return options.forEach((function(option){option.getAttribute("name","").match(regexPattern)&&excludedTables.push(option.value)})),excludedTables.join(this.wpstgObject.settings.directorySeparator)}},{key:"getTotalDbPrefixTables",value:function(){var totalTables=0,regexPattern=this.getRegexPattern();return this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option").forEach((function(option){option.getAttribute("name","").match(regexPattern)&&totalTables++})),totalTables}},{key:"countSelectedTables",value:function(){var _this$databaseTableSe,totalDbPrefixTables=this.getTotalDbPrefixTables(),totalTables=null===(_this$databaseTableSe=this.databaseTableSection.querySelectorAll("#wpstg_select_tables_cloning option"))||void 0===_this$databaseTableSe?void 0:_this$databaseTableSe.length,tablesCount=this.input.querySelectorAll("option:checked").length,tablesCountElement=qs("#wpstg-tables-count");0===tablesCount?(tablesCountElement.classList.add("danger"),tablesCountElement.innerHTML=this.wpstgObject.i18n.tables_not_selected):(tablesCountElement.classList.remove("danger"),tablesCountElement.innerHTML=this.wpstgObject.i18n.tables_selected.replace("{d}",tablesCount).replace("{t}",totalTables)),tablesCount!==totalDbPrefixTables&&tablesCountElement.classList.add("danger")}}])}(),WpstgExcludeFilters=function(){return _createClass((function WpstgExcludeFilters(){var excludeFilterContainerSelector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#wpstg-exclude-filters-container",wpstgObject=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wpstg;_classCallCheck(this,WpstgExcludeFilters),this.excludeContainer=qs(excludeFilterContainerSelector),this.excludeTableBody=qs("".concat(excludeFilterContainerSelector," tbody")),this.wpstgObject=wpstgObject,this.init()}),[{key:"addEvents",value:function(){var _this=this;addEvent(this.excludeContainer,"click",".wpstg-file-size-rule",(function(){_this.addFileSizeExclude()})),addEvent(this.excludeContainer,"click",".wpstg-file-ext-rule",(function(){_this.addFileExtExclude()})),addEvent(this.excludeContainer,"click",".wpstg-file-name-rule",(function(){_this.addFileNameExclude()})),addEvent(this.excludeContainer,"click",".wpstg-dir-name-rule",(function(){_this.addDirNameExclude()})),addEvent(this.excludeContainer,"click",".wpstg-clear-all-rules",(function(){_this.clearExcludes()})),addEvent(this.excludeContainer,"click",".wpstg-remove-exclude-rule",(function(target){_this.removeExclude(target.parentElement)}))}},{key:"init",value:function(){null!==this.excludeContainer?this.addEvents():console.log("Error: Given table selector not found!")}},{key:"addFileSizeExclude",value:function(){this.addExcludeRuleRow("#wpstg-file-size-exclude-filter-template")}},{key:"addFileExtExclude",value:function(){this.addExcludeRuleRow("#wpstg-file-ext-exclude-filter-template")}},{key:"addFileNameExclude",value:function(){this.addExcludeRuleRow("#wpstg-file-name-exclude-filter-template")}},{key:"addDirNameExclude",value:function(){this.addExcludeRuleRow("#wpstg-dir-name-exclude-filter-template")}},{key:"addExcludeRuleRow",value:function(templateName){var excludeRowTemplate=qs(templateName);if(null!==excludeRowTemplate){var excludeRow=excludeRowTemplate.content.cloneNode(!0).querySelector("tr");this.excludeTableBody.appendChild(excludeRow),all(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="inherit"}))}}},{key:"clearExcludes",value:function(){this.excludeTableBody.innerHTML="",all(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))}},{key:"removeExclude",value:function(target){null!==target.parentElement&&null!==target.parentElement.parentElement&&this.excludeTableBody.removeChild(target.parentElement.parentElement),""===this.excludeTableBody.innerHTML.trim()&&all(".wpstg-has-exclude-rules").forEach((function(e){e.style.display="none"}))}},{key:"getExcludeFilters",value:function(){for(var _this2=this,globExcludes=[],sizeExcludes=[],sizeCompares=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleCompare[]"]'),sizeSizes=this.excludeTableBody.querySelectorAll('input[name="wpstgFileSizeExcludeRuleSize[]"]'),sizeByte=this.excludeTableBody.querySelectorAll('select[name="wpstgFileSizeExcludeRuleByte[]"]'),_i=0,_Object$entries=Object.entries(sizeSizes);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],sizeInput=_Object$entries$_i[1];""!==sizeInput.value&&sizeExcludes.push(sizeCompares[key].value+" "+sizeInput.value+sizeByte[key].value)}this.excludeTableBody.querySelectorAll('input[name="wpstgFileExtExcludeRule[]"]').forEach((function(x){var ext=_this2.cleanStringForGlob(x.value);""!==ext&&globExcludes.push("ext:"+ext.trim())}));for(var fileNamesPos=this.excludeTableBody.querySelectorAll('select[name="wpstgFileNameExcludeRulePos[]"]'),fileNames=this.excludeTableBody.querySelectorAll('input[name="wpstgFileNameExcludeRulePath[]"]'),_i2=0,_Object$entries2=Object.entries(fileNames);_i2<_Object$entries2.length;_i2++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i2],2),_key=_Object$entries2$_i[0],fileInput=_Object$entries2$_i[1],fileName=this.cleanStringForGlob(fileInput.value);""!==fileName&&globExcludes.push("file:"+fileNamesPos[_key].value+" "+fileName.trim())}for(var dirNamesPos=this.excludeTableBody.querySelectorAll('select[name="wpstgDirNameExcludeRulePos[]"]'),dirNames=this.excludeTableBody.querySelectorAll('input[name="wpstgDirNameExcludeRulePath[]"]'),_i3=0,_Object$entries3=Object.entries(dirNames);_i3<_Object$entries3.length;_i3++){var _Object$entries3$_i=_slicedToArray(_Object$entries3[_i3],2),_key2=_Object$entries3$_i[0],dirInput=_Object$entries3$_i[1],dirName=this.cleanStringForGlob(dirInput.value);""!==dirName&&globExcludes.push("dir:"+dirNamesPos[_key2].value+" "+dirName.trim())}return{sizes:sizeExcludes.filter(this.onlyUnique).join(","),globs:globExcludes.filter(this.onlyUnique).join(",")}}},{key:"onlyUnique",value:function(value,index,self){return self.indexOf(value)===index}},{key:"cleanStringForGlob",value:function(value){return value.replace(/[*^//!\[?]/g,"")}}])}(),WpstgModal=function(){return _createClass((function WpstgModal(confirmAction){var wpstgObject=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wpstg;_classCallCheck(this,WpstgModal),this.confirmAction=confirmAction,this.wpstgObject=wpstgObject}),[{key:"show",value:function(swalOptions){var _this=this,additionalParams=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},callback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;wpstgSwal.fire(swalOptions).then((function(result){result.value&&null!==_this.error&&_this.triggerConfirmAction(additionalParams,callback)}))}},{key:"triggerConfirmAction",value:function(){var _this2=this,additionalParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams(Object.assign({action:this.confirmAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce},additionalParams)),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return response.ok?response.json():Promise.reject(response)})).then((function(response){null!==callback&&callback(response)})).catch((function(error){console.log(_this2.wpstgObject.i18n.something_went_wrong,error)}))}}])}(),WpstgResetModal=function(){return _createClass((function WpstgResetModal(cloneID){var workflowSelector=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#wpstg-workflow",fetchExcludeSettingsAction=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"wpstg_clone_excludes_settings",modalErrorAction=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"wpstg_modal_error",wpstgObject=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wpstg;_classCallCheck(this,WpstgResetModal),this.cloneID=cloneID,this.workflow=qs(workflowSelector),this.wpstgObject=wpstgObject,this.fetchExcludeSettingsAction=fetchExcludeSettingsAction,this.modalErrorAction=modalErrorAction,this.resetButtonClass="wpstg-confirm-reset-clone",this.resetModalContainerClass="wpstg-reset-confirmation",this.resetTabSelector=".wpstg-reset-exclude-tab",this.directoryNavigator=null,this.excludeFilters=null,this.tableSelector=null,this.isNetworkClone=!1}),[{key:"addEvents",value:function(){var _this=this,resetModalContainer=qs("."+this.resetModalContainerClass);null!==resetModalContainer?addEvent(resetModalContainer,"click",this.resetTabSelector,(function(target){_this.toggleContent(target)})):console.log("Exit")}},{key:"init",value:function(){this.addEvents()}},{key:"setNetworkClone",value:function(isNetworkClone){this.isNetworkClone=isNetworkClone}},{key:"toggleContent",value:function(target){var resetModalContainer=qs("."+this.resetModalContainerClass),contentId=target.getAttribute("data-id"),tabTriangle=target.querySelector(".wpstg-tab-triangle"),isCollapsed=target.getAttribute("data-collapsed","true"),content=qs(contentId);"true"===isCollapsed?(resetModalContainer.classList.contains("has-collapsible-open")?resetModalContainer.classList.add("has-collapsible-open-2"):resetModalContainer.classList.add("has-collapsible-open"),slideDown(content),tabTriangle.style.transform="rotate(90deg)",target.setAttribute("data-collapsed","false")):(resetModalContainer.classList.contains("has-collapsible-open-2")?resetModalContainer.classList.remove("has-collapsible-open-2"):resetModalContainer.classList.remove("has-collapsible-open"),slideUp(content),tabTriangle.style.removeProperty("transform"),target.setAttribute("data-collapsed","true"))}},{key:"showModal",value:function(){var swalPromise=this.loadModal();return this.init(),this.fetchCloneExcludes(),swalPromise}},{key:"loadModal",value:function(){return WPStagingCommon.getSwalModal(!1,{confirmButton:this.resetButtonClass+" wpstg-confirm-reset-clone wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",container:this.resetModalContainerClass+" wpstg-swal2-container wpstg-swal2-loading"}).fire({title:"",icon:"warning",html:this.getAjaxLoader(),width:"400px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.reset.confirm_button,showCancelButton:!0})}},{key:"fetchCloneExcludes",value:function(){var _this2=this;this.error=null,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.fetchExcludeSettingsAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,job:"resetting"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return response.ok?response.json():Promise.reject(response)})).then((function(data){if(data.success){var modal=qs(".wpstg-reset-confirmation");modal.classList.remove("wpstg-swal2-loading"),modal.querySelector(".wpstg--swal2-popup").style.width="540px",modal.querySelector(".wpstg--swal2-content").innerHTML=data.html,_this2.directoryNavigator=new WpstgDirectoryNavigation("#wpstg-directories-listing",wpstg,null),_this2.directoryNavigator.countSelectedFiles(),_this2.excludeFilters=new WpstgExcludeFilters,_this2.tableSelector=new WpstgTableSelection("#wpstg-reset-excluded-tables","."+_this2.resetModalContainerClass),_this2.tableSelector.setNetworkClone(_this2.isNetworkClone),_this2.tableSelector.countSelectedTables()}else{new WpstgModal(_this2.modalErrorAction,_this2.wpstgObject).show(Object.assign({title:"Error",icon:"error",html:_this2.wpstgObject.i18n.something_went_wrong,width:"500px",confirmButtonText:_this2.wpstgObject.i18n.ok,showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},data.swalOptions),{type:data.type})}})).catch((function(error){_this2.renderError({html:_this2.wpstgObject.i18n.something_went_wrong+" "+error})}))}},{key:"getDirectoryNavigator",value:function(){return this.directoryNavigator}},{key:"getExcludeFilters",value:function(){return this.excludeFilters}},{key:"getTableSelector",value:function(){return this.tableSelector}},{key:"getAjaxLoader",value:function(){return'<div class="wpstg-swal2-ajax-loader"><span class="wpstg-loader"></span></div>'}}])}(),WpstgCloningAdvanceSettings=function(){return _createClass((function WpstgCloningAdvanceSettings(){var baseContainerSelector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#wpstg-clonepage-wrapper";_classCallCheck(this,WpstgCloningAdvanceSettings),this.baseContainer=qs(baseContainerSelector),this.checkBoxSettingTogglerSelector=".wpstg-toggle-advance-settings-section",this.init()}),[{key:"addEvents",value:function(){var _this=this;null!==this.baseContainer&&addEvent(this.baseContainer,"change",this.checkBoxSettingTogglerSelector,(function(element){_this.toggleSettings(element)}))}},{key:"init",value:function(){this.addEvents()}},{key:"toggleSettings",value:function(element){var target=qs("#"+element.getAttribute("data-id"));element.checked?slideDown(target):slideUp(target)}}])}(),WpstgMainMenu=function(){return _createClass((function WpstgMainMenu(){_classCallCheck(this,WpstgMainMenu),this.activeTabClass="wpstg--tab--active",this.mainMenu()}),[{key:"mainMenu",value:function(){var _this=this;if(null!==qs(".wpstg--tab--header")){var workflowContainer=qs("#wpstg-workflow");null!==workflowContainer&&addEvent(workflowContainer,"click",".wpstg-navigate-button",(function(element){var target=element.getAttribute("data-target");""!==target&&"#wpstg--tab--backup"===target&&qs('.wpstg--tab--header a[data-target="#wpstg--tab--backup"]').click()})),addEvent(qs(".wpstg--tab--header"),"click",".wpstg-button:not(.wpstg-navigation-menu-mobile .wpstg-button)",(function(element){var $this=element,target=$this.getAttribute("data-target");if(""!==target)if("#wpstg--tab--staging"!==target&&"#wpstg--tab--backup"!==target){WPStagingCommon.resetErrors();var targetElements=all(target),menuItems=all(".wpstg--tab--header a[data-target]");all(".wpstg--tab--contents > .wpstg--tab--content").forEach((function(content){content.matches("."+_this.activeTabClass+":not("+target+")")&&content.classList.remove(_this.activeTabClass)})),menuItems.forEach((function(menuItem){menuItem!==$this&&menuItem.classList.remove(_this.activeTabClass)})),$this.classList.add(_this.activeTabClass),targetElements.forEach((function(targetElement){targetElement.classList.add(_this.activeTabClass)})),"#wpstg--tab--backup"===target&&window.dispatchEvent(new Event("backups-tab"))}else window.location.reload()})),addEvent(qs(".wpstg--tab--header"),"click",".wpstg-navigation-menu-mobile .wpstg-button",(function(element){var $this=element,target=$this.getAttribute("data-target-id");if(target){var targetElement=qs("#"+target);targetElement?targetElement.click():window.location.href=$this.getAttribute("data-target-url");var menu=document.getElementById("wpstg-navbar-menu");menu&&menu.classList.toggle("hidden"),all(".wpstg--tab--header a[data-target-id]").forEach((function(menuItem){menuItem!==$this&&menuItem.classList.remove(_this.activeTabClass)})),$this.classList.add(_this.activeTabClass)}})),window.addEventListener("resize",(function(){_this.adjustWrapperWidth()})),this.adjustWrapperWidth()}}},{key:"adjustWrapperWidth",value:function(){var screenWidth=window.innerWidth,wrapper=document.getElementById("wpstg-clonepage-wrapper");screenWidth>640?wrapper.style.width="100%":screenWidth<=640&&screenWidth>=480?wrapper.style.width="".concat(68+22*(screenWidth-480)/160,"%"):screenWidth<480&&screenWidth>=320?wrapper.style.width="".concat(47+18*(screenWidth-320)/160,"%"):screenWidth<320&&(wrapper.style.width="".concat(30+20*screenWidth/320,"%")),document.querySelector(".wpstg-navbar-toggler").style.padding=screenWidth<640?"15px":"12px 15px 12px 15px"}}])}(),runtime=function(exports){var Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?GenStateCompleted:GenStateSuspendedYield,record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state=GenStateCompleted,context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(undefined===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}("object"==typeof module?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){"object"==typeof globalThis?globalThis.regeneratorRuntime=runtime:Function("r","regeneratorRuntime = r")(runtime)}var WpstgReAuth=function(){return _createClass((function WpstgReAuth(){_classCallCheck(this,WpstgReAuth),this.wrap="",this.tempHidden="",this.tempHiddenTimeout="",this.callbackOnHide=null}),[{key:"setCallbackOnHide",value:function(callback){this.callbackOnHide=callback}},{key:"shows",value:function(){this.wrap=document.getElementById("wpstg-auth-check-wrap"),this.parentElement=document.getElementById("wpstg-auth-check"),this.formElement=document.getElementById("wpstg-auth-check-form"),this.wrapElement=document.getElementById("wpstg-auth-check-wrap"),this.noFrameElement=this.wrapElement.querySelector(".wpstg-auth-fallback-expired"),this.iframeElement="",this.isIframeLoaded=!1,this.formElement&&(this.addUnloadEvent(),this.iframeElement=this.createIframeElement(),this.formElement.appendChild(this.iframeElement)),this.openModal(),this.iframeElement?(this.focusIframe(),this.setIframeLoadTimeout()):this.focusFallbackElement()}},{key:"addUnloadEvent",value:function(){window.addEventListener("beforeunload",(function(event){event.returnValue="Your session has expired. You can log in again from this page or go to the login page."}))}},{key:"createIframeElement",value:function(){var _this=this;return this.iframeElement=document.createElement("iframe"),this.iframeElement.id="wpstg-auth-check-frame",this.iframeElement.style.border="0px",this.iframeElement.title=this.noFrameElement.textContent,this.iframeElement.onload=function(){return _this.handleIframeLoad()},this.iframeElement.src=this.formElement.dataset.src,this.iframeElement}},{key:"handleIframeLoad",value:function(){var height,body;this.isIframeLoaded=!0,this.formElement.classList.remove("loading");try{height=(body=this.iframeElement.contentDocument.querySelector("body")).offsetHeight}catch(er){return void this.handleIframeLoadError()}body&&height?body.classList.contains("interim-login-success")?this.hide():this.parentElement.style.maxHeight=height+40+"px":this.handleIframeLoadError()}},{key:"handleIframeLoadError",value:function(){this.wrapElement.classList.add("fallback"),this.parentElement.style.maxHeight="",this.formElement.remove(),this.noFrameElement.focus()}},{key:"openModal",value:function(){document.body.classList.add("modal-open"),this.wrapElement.classList.remove("hidden")}},{key:"focusIframe",value:function(){this.iframeElement.focus()}},{key:"setIframeLoadTimeout",value:function(){var _this2=this;setTimeout((function(){_this2.isIframeLoaded||(_this2.wrapElement.classList.add("fallback"),_this2.formElement.remove(),_this2.noFrameElement.focus())}),2e3)}},{key:"focusFallbackElement",value:function(){this.noFrameElement.focus()}},{key:"hide",value:function(){var _this3=this;window.removeEventListener("beforeunload",(function(event){event.returnValue=null})),function(element){var duration=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;element.style.opacity=1,element.style.transitionProperty="opacity",element.style.transitionDuration=duration+"ms",setTimeout((function(){element.style.opacity=0,window.setTimeout((function(){element.style.display="none",element.style.removeProperty("opacity"),element.style.removeProperty("transition-duration"),element.style.removeProperty("transition-property")}),duration)}),0)}(this.wrap,200,(function(){_this3.wrap.classList.add("hidden"),_this3.wrap.style.display="",document.getElementById("wpstg-auth-check-frame").remove(),document.body.classList.remove("modal-open")})),this.callbackOnHide&&this.callbackOnHide()}}])}(),wpstgReAuth=new WpstgReAuth,WpstgAuthCheck=function(){return _createClass((function WpstgAuthCheck(){var wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,WpstgAuthCheck),this.wpstgObject=wpstgObject,this.count=0,this.status=!0,this.isAuthenticated=!0}),[{key:"start",value:function(){var _this=this;this.status&&setTimeout((function(){_this.checkUserAuthentication()}),1e3)}},{key:"stop",value:function(){this.resetCount(),this.status=!1}},{key:"resetCount",value:function(){this.count=0}},{key:"checkUserAuthentication",value:(_checkUserAuthentication=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var _this2=this;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_check_user_is_authenticated",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return response.ok?response.json():Promise.reject(response)})).then((function(data){if(!1===data.wpAuthCheck&&_this2.count++,_this2.isAuthenticated=data.wpAuthCheck,2===_this2.count)return _this2.stop(),void _this2.createAuthCheckElements(data.redirectUrl);_this2.start()})).catch((function(error){console.error("Error:",error)}));case 1:case"end":return _context.stop()}}),_callee,this)}))),function(){return _checkUserAuthentication.apply(this,arguments)})},{key:"createAuthCheckElements",value:function(redirectUrl){var _this3=this;null!==document.getElementById("wpstg-auth-check-wrap")&&document.getElementById("wpstg-auth-check-wrap").remove();var wpAuthCheckWrap=document.createElement("div");wpAuthCheckWrap.id="wpstg-auth-check-wrap",wpAuthCheckWrap.classList.add("hidden");var wpAuthCheckBg=document.createElement("div");wpAuthCheckBg.id="wpstg-auth-check-bg";var wpAuthCheckDialog=document.createElement("div");wpAuthCheckDialog.id="wpstg-auth-check";var wpAuthCheckForm=document.createElement("div");wpAuthCheckForm.id="wpstg-auth-check-form",wpAuthCheckForm.classList.add("loading"),wpAuthCheckForm.dataset.src=redirectUrl+"?interim-login=1&wp_lang=en_US";var wpAuthCheckFallback=document.createElement("div");wpAuthCheckFallback.classList.add("wpstg-auth-fallback");var wpAuthCheckExpired=document.createElement("p");wpAuthCheckExpired.innerHTML='<b class="wpstg-auth-fallback-expired" tabindex="0">Session expired</b>';var wpAuthCheckLoginLink=document.createElement("p");wpAuthCheckLoginLink.innerHTML='<a href="'.concat(redirectUrl,'" target="_blank">Please log in again.</a> The login page will open in a new tab. After logging in you can close it and return to this page.');var wpAuthCheckCloseButton=document.createElement("button");wpAuthCheckCloseButton.type="button",wpAuthCheckCloseButton.classList.add("wpstg-auth-check-close","button-link"),wpAuthCheckCloseButton.innerHTML='<span class="screen-reader-text">Close dialog</span>',wpAuthCheckCloseButton.addEventListener("click",(function(){wpAuthCheckWrap.classList.add("hidden")})),wpAuthCheckDialog.append(wpAuthCheckCloseButton,wpAuthCheckForm,wpAuthCheckFallback),wpAuthCheckFallback.append(wpAuthCheckExpired,wpAuthCheckLoginLink),wpAuthCheckWrap.append(wpAuthCheckBg,wpAuthCheckDialog),document.body.appendChild(wpAuthCheckWrap),wpstgReAuth.setCallbackOnHide((function(){_this3.checkUserAuthentication()})),wpstgReAuth.shows()}}]);var _checkUserAuthentication}(),wpstgAuthCheck=new WpstgAuthCheck,WpstgProcessModal=function(){return _createClass((function WpstgProcessModal(){var _this=this,wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,WpstgProcessModal),this.wpstgObject=wpstgObject,this.action="",this.isProcessCancelled=!1,this.isProcessFinished=!1,this.processTime=0,this.processInterval=null,this.modal=null,this.disableCancelButton=!1,this.title="",this.showCancelButton=!1,this.percentage=0,this.cloneId="",this.successModal="",this.showProcessLogs=!0,this.stagingSiteUrl="",this.shouldSetupTimerInterval=!0,this.processStartTime=null,document.addEventListener("visibilitychange",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(document.hidden){_context.next=3;break}return _context.next=3,_this.maybeUpdateElapsedTimeFromLogs();case 3:case"end":return _context.stop()}}),_callee)}))))}),[{key:"setSetupTimerInterval",value:function(shouldSetupTimerInterval){this.shouldSetupTimerInterval=shouldSetupTimerInterval}},{key:"maybeSetupTimerInterval",value:function(){var _this2=this;if(this.shouldSetupTimerInterval){this.processStartTime=Date.now();var _updateTimer=function(){if(!document.hidden&&(wpstgAuthCheck.isAuthenticated||"wpstg_push_processing"===_this2.action)){var currentTime=Date.now();_this2.processTime=Math.floor((currentTime-_this2.processStartTime)/1e3),_this2.updateElapsedTime()}null!==_this2.processInterval&&requestAnimationFrame(_updateTimer)};requestAnimationFrame(_updateTimer),this.processInterval=setInterval((function(){if(document.hidden&&(wpstgAuthCheck.isAuthenticated||"wpstg_push_processing"===_this2.action)){var currentTime=Date.now();_this2.processTime=Math.floor((currentTime-_this2.processStartTime)/1e3),_this2.updateElapsedTime()}}),1e3)}}},{key:"start",value:function(){(this.showCancelButton=!0,this.maybeSetupTimerInterval(),"wpstg_delete_clone"===this.action)&&(hide(".wpstg--process-modal--logs-button"),this.showCancelButton=!1,WPStagingCommon.getSwalContainer().querySelector(".wpstg--process-modal--percent").textContent=100);"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||(wpstgAuthCheck.status=!0,wpstgAuthCheck.start()),hide(".wpstg-prev-step-link, #wpstg-start-updating, .wpstg-loader, #wpstg-cancel-cloning, .wpstg-log-details, .wpstg-progress-bar, #wpstg-processing-header"),hide(".wpstg-processing-timer, #wpstg-cancel-pushing, .wpstg-progress-bar-wrapper, #wpstg-cancel-cloning-update, #wpstg-removing-clone")}},{key:"stop",value:function(){this.processTime=0,this.processStartTime=null,this.modal=null,this.percentage="",this.resetCancelChecks(),this.processInterval&&(clearInterval(this.processInterval),this.processInterval=null),WPStagingCommon.closeSwalModal(),showLoadingBar(),hide("#wpstg-try-again, #wpstg-home-link, #wpstg-show-log-button, .wpstg-loader"),"wpstg_cloning"!==this.action&&"wpstg_push_processing"!==this.action||wpstgAuthCheck.stop()}},{key:"resetCancelChecks",value:function(){var _this3=this;null!==document.getElementById("wpstg-new-clone")?(setTimeout((function(){_this3.isProcessCancelled=!1,WPStaging.isCancelled=!1}),2e3),hideLoadingBar()):setTimeout((function(){_this3.resetCancelChecks()}),1e3)}},{key:"cancelProcess",value:function(){confirm(this.wpstgObject.i18n.module_process_modal.cancel_process_confirm)&&(WPStaging.isCancelled=!0,this.isProcessCancelled=!0,"wpstg_push_processing"===this.action?(WPStagingCommon.getSwalContainer().querySelector(".wpstg--process-modal--title").textContent=this.wpstgObject.i18n.module_process_modal.cancel_process_text,this.stop(),show("#wpstg-workflow"),WPStaging.messages=[]):this.cancelCloneAction())}},{key:"setTitle",value:function(response){this.title=response.job,"database"===response.job||"jobCopyDatabaseTmp"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_database,this.disableCancelButton=!1):"SearchReplace"===response.job||"jobSearchReplace"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_search_replace,this.disableCancelButton=!1):"PreserveDataSecondStep"===response.job||"PreserveDataFirstStep"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_preserve_data,this.disableCancelButton=!1):"directories"===response.job||"jobFileScanning"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_scanning_files,this.disableCancelButton=!1):"files"===response.job||"data"===response.job||"jobCopy"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_copying_files,this.disableCancelButton=!1):"Backup"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_backup_files_scanning,this.disableCancelButton=!1):"finish"===response.job||"finished"===response.status?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_process_finished,this.disableCancelButton=!1):"jobDatabaseRename"===response.job?(this.title=this.wpstgObject.i18n.module_process_modal.set_title_renaming_database,this.disableCancelButton=!0):"jobData"===response.job&&(this.title=this.wpstgObject.i18n.module_process_modal.set_title_updating_database_data,this.disableCancelButton=!0)}},{key:"setPercentage",value:function(params){null!==params.percentage&&(this.percentage=params.percentage)}},{key:"initializeProcessModal",value:function(){var _this4=this,showCancelButton=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,modal=document.getElementById("wpstg--process-modal");if(modal){null===showCancelButton&&(showCancelButton=this.showCancelButton);var html=modal.innerHTML;modal.remove(),this.modal={html:null,cancelBtnTxt:null,processTime:0,instance:WPStagingCommon.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:html,cancelButtonText:this.wpstgObject.i18n.cancel,showCancelButton:showCancelButton,showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){var cancelButton=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=cancelButton.cloneNode(!0);cancelButton.parentNode.replaceChild(btnCancel,cancelButton),btnCancel.addEventListener("click",(function(){_this4.cancelProcess()}));var showLogsButton=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0],showLogs=showLogsButton.cloneNode(!0);showLogsButton.parentNode.replaceChild(showLogs,showLogsButton),showLogs.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}})},this.start()}}},{key:"setProcessModal",value:function(){var container=WPStagingCommon.getSwalContainer(),cancelButton=container.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],processTitleElement=container.querySelector(".wpstg--process-modal--title"),processPercentageElement=container.querySelector(".wpstg--process-modal--percent");processTitleElement.textContent=this.title,processPercentageElement.textContent=this.percentage,cancelButton.disabled=this.disableCancelButton}},{key:"openProcessModal",value:function(data,params){var showLogs=arguments.length>2&&void 0!==arguments[2]&&arguments[2],showCancelButton=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.isProcessCancelled||WPStaging.isCancelled||(void 0!==data&&(this.action=data.action,this.cloneId=data.cloneID),this.showCancelButton=showCancelButton,this.showLogs=showLogs,this.modal?params.job?(this.setTitle(params),this.setPercentage(params),this.setProcessModal(),"finish"===params.job&&this.stop()):"finished"===params.status&&this.stop():(WPStagingCommon.resetErrors(),this.initializeProcessModal()))}},{key:"updateElapsedTime",value:function(){null!==this.processInterval&&(WPStagingCommon.getSwalContainer().querySelector(".wpstg--process-modal--elapsed-time").textContent=prettify(this.processTime))}},{key:"getCancelCloneAction",value:function(){var _this5=this;if(""!==this.action){var result=[{name:"wpstg_cloning",cancel:"wpstg_cancel_clone"},{name:"wpstg_reset",cancel:"wpstg_cancel_update"},{name:"wpstg_update",cancel:"wpstg_cancel_update"},{name:"wpstg_push_processing",cancel:"wpstg_cancel_push_processing"}].find((function(action){return action.name===_this5.action}));return null==result?void 0:result.cancel}}},{key:"cancelCloneAction",value:(_cancelCloneAction=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var _this$getCancelCloneA,_this6=this;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(this.action){_context2.next=2;break}return _context2.abrupt("return");case 2:try{null!==WPStaging.onGoingRequest&&(WPStaging.onGoingRequest.abort(),WPStaging.onGoingRequest=null)}catch(error){console.error(this.wpstgObject.i18n.something_went_wrong,error),WPStaging.onGoingRequest=null}try{fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:null!==(_this$getCancelCloneA=this.getCancelCloneAction())&&void 0!==_this$getCancelCloneA?_this$getCancelCloneA:"wpstg_cancel_clone",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){return null!=response&&response.ok?response.json():Promise.reject(response)})).then((function(response){(response&&void 0!==response.delete&&"finished"===response.delete||!0===response)&&(_this6.stop(),WPStaging.loadOverview(),WPStaging.messages=[]),!0!==response&&_this6.cancelCloneAction()})).catch((function(error){console.log(_this6.wpstgObject.i18n.something_went_wrong,error)}))}catch(error){console.error(this.wpstgObject.i18n.something_went_wrong,error),this.stop()}case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function(){return _cancelCloneAction.apply(this,arguments)})},{key:"initializeSuccessModal",value:(_initializeSuccessModal=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(params){var $workFlow,_this7=this;return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.setSuccessModalContent(params);case 2:this.successModal=_context3.sent,($workFlow=document.getElementById("wpstg-workflow"))&&($workFlow.innerHTML=""),WPStagingCommon.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"success",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var showLogsButton=WPStagingCommon.getSwalContainer().querySelector(".wpstg--success-modal--logs-button"),showLogs=showLogsButton.cloneNode(!0);showLogsButton.parentNode.replaceChild(showLogs,showLogsButton),showLogs.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(result){result.value&&(WPStagingCommon.closeSwalModal(),hide(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),"wpstg_push_processing"===_this7.action&&(localStorage.setItem("wpstgPushProcessCompleted","true"),location.reload()),"wpstg_delete_clone"!==_this7.action&&WPStaging.loadOverview(),_this7.action="")})),this.showProcessLogs&&show(".wpstg--success-modal--logs-wrapper"),hide(".wpstg-loader");case 8:case"end":return _context3.stop()}}),_callee3,this)}))),function(_x){return _initializeSuccessModal.apply(this,arguments)})},{key:"setSuccessModalContent",value:(_setSuccessModalContent=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(params){var modal,messageBody,_wpstgPro,stagingUrl,uniqueId,cloneID,response,successModalTextElement,wpstgRateUsElement;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(modal=document.getElementById("wpstg--success-modal"),null!==params.title&&(modal.innerHTML=modal.innerHTML.replace("{title}",params.title)),this.showProcessLogs&&(modal.innerHTML=modal.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">Show Logs</span>')),null===params.body||void 0===params.body){_context4.next=20;break}if(messageBody=params.body,null===this.stagingSiteUrl){_context4.next=15;break}if(stagingUrl=this.stagingSiteUrl,"wpstg_cloning"!==this.action||"undefined"==typeof wpstgPro||"function"!=typeof(null===(_wpstgPro=wpstgPro)||void 0===_wpstgPro?void 0:_wpstgPro.saveGeneratedLinkData)){_context4.next=14;break}return uniqueId=Date.now().toString(),cloneID=this.cloneId,_context4.next=12,wpstgPro.saveGeneratedLinkData({cloneID:cloneID,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:uniqueId});case 12:null!=(response=_context4.sent)&&response.success&&(stagingUrl=this.stagingSiteUrl+"/?wpstg_login="+uniqueId);case 14:messageBody+='<br><strong><a href="'+stagingUrl+'" target="_blank" id="wpstg-clone-url">'+this.stagingSiteUrl+"</a></strong>";case 15:"wpstg_push_processing"===this.action&&(messageBody+='<a href="https://wp-staging.com/refresh-and-clear-cache/" target="_blank">How to delete the cache.</a>',(successModalTextElement=modal.querySelector(".wpstg--success-modal--text"))&&successModalTextElement.classList.add("wpstg--red")),"wpstg_cloning"===this.action&&(wpstgRateUsElement=modal.querySelector(".wpstg-rate-us"))&&wpstgRateUsElement.classList.add("show"),modal.innerHTML=modal.innerHTML.replace("{text}",messageBody+"<br/><br/>"),_context4.next=21;break;case 20:modal.innerHTML=modal.innerHTML.replace("{text}","");case 21:return _context4.abrupt("return",modal);case 22:case"end":return _context4.stop()}}),_callee4,this)}))),function(_x2){return _setSuccessModalContent.apply(this,arguments)})},{key:"openSuccessModal",value:function(params){var showLogs=arguments.length>1&&void 0!==arguments[1]&&arguments[1],siteUrl=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.stagingSiteUrl=siteUrl,this.showProcessLogs=showLogs,this.initializeSuccessModal(params)}},{key:"logEventFailure",value:(_logEventFailure=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var event,_args5=arguments;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return event=_args5.length>0&&void 0!==_args5[0]?_args5[0]:"",_context5.prev=1,_context5.next=4,wpstgRequest("wpstg_log_event_failure",{process:event});case 4:_context5.next=9;break;case 6:_context5.prev=6,_context5.t0=_context5.catch(1),console.error(wpstg.i18n.something_went_wrong,_context5.t0);case 9:case"end":return _context5.stop()}}),_callee5,null,[[1,6]])}))),function(){return _logEventFailure.apply(this,arguments)})},{key:"openErrorModal",value:(_openErrorModal=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){var error,$workFlow,showLogsButton,_this8=this,_args6=arguments;return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return error=_args6.length>1&&void 0!==_args6[1]?_args6[1]:"",this.stop(),hide(".wpstg-loader"),loadingPlaceholder("hidden"),this.showProcessLogs=!0,error||(error="Memory exhaust issue is detected during the process"),_context6.next=9,this.setSuccessModalContent({title:"Error",body:error});case 9:this.successModal=_context6.sent,($workFlow=document.getElementById("wpstg-workflow"))&&($workFlow.innerHTML=""),WPStagingCommon.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn"}).fire({icon:"error",html:this.successModal.innerHTML,confirmButtonText:this.wpstgObject.i18n.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var showLogsButton=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0],showLogs=showLogsButton.cloneNode(!0);showLogsButton.parentNode.replaceChild(showLogs,showLogsButton),showLogs.addEventListener("click",(function(e){e.preventDefault(),window.WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}).then((function(result){result.value&&(WPStagingCommon.closeSwalModal(),hide(".wpstg-loader"),WPStaging.messages=[],window.WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.loadOverview(),_this8.action="")})),show(".wpstg--success-modal--logs-wrapper"),(showLogsButton=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--success-modal--logs-button")[0])&&(showLogsButton.click(),document.querySelectorAll(".wpstg--logs--body").forEach((function(element){element.scrollTop=element.scrollHeight})));case 16:case"end":return _context6.stop()}}),_callee6,this)}))),function(){return _openErrorModal.apply(this,arguments)})},{key:"logEventSuccess",value:(_logEventSuccess=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var event,_args7=arguments;return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return event=_args7.length>0&&void 0!==_args7[0]?_args7[0]:"",_context7.next=3,wpstgRequest("wpstg_log_event_success",{process:event});case 3:case"end":return _context7.stop()}}),_callee7)}))),function(){return _logEventSuccess.apply(this,arguments)})},{key:"convertTimeStringToSeconds",value:(_convertTimeStringToSeconds=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(timeString){var _timeString$slice$spl,_timeString$slice$spl2,hours,minutes,seconds;return _regeneratorRuntime().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(timeString){_context8.next=2;break}return _context8.abrupt("return",0);case 2:return _timeString$slice$spl=timeString.slice(0,-1).split(":").map(Number),_timeString$slice$spl2=_slicedToArray(_timeString$slice$spl,3),hours=_timeString$slice$spl2[0],minutes=_timeString$slice$spl2[1],seconds=_timeString$slice$spl2[2],_context8.abrupt("return",3600*hours+60*minutes+seconds);case 4:case"end":return _context8.stop()}}),_callee8)}))),function(_x3){return _convertTimeStringToSeconds.apply(this,arguments)})},{key:"maybeUpdateElapsedTimeFromLogs",value:(_maybeUpdateElapsedTimeFromLogs=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(){var _logs$all,_WPStagingCommon$getS,logs,elapsedTimeElement,firstLogDatetime,lastLogDatetime,totalElapsedTimeFromLogs,elapsedTimeInSeconds;return _regeneratorRuntime().wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(null!=(logs=window.WPStaging.wpstgProcessLogs.getLogs())&&null!==(_logs$all=logs.all)&&void 0!==_logs$all&&_logs$all.length){_context9.next=3;break}return _context9.abrupt("return");case 3:if(elapsedTimeElement=null===(_WPStagingCommon$getS=WPStagingCommon.getSwalContainer())||void 0===_WPStagingCommon$getS?void 0:_WPStagingCommon$getS.querySelector(".wpstg--process-modal--elapsed-time")){_context9.next=6;break}return _context9.abrupt("return");case 6:return firstLogDatetime=new Date(logs.all[0].date),lastLogDatetime=new Date(logs.all[logs.all.length-1].date),totalElapsedTimeFromLogs=Math.floor((lastLogDatetime-firstLogDatetime)/1e3),_context9.next=11,this.convertTimeStringToSeconds(elapsedTimeElement.textContent);case 11:if(elapsedTimeInSeconds=_context9.sent,!(this.processTime===elapsedTimeInSeconds||totalElapsedTimeFromLogs<elapsedTimeInSeconds)){_context9.next=14;break}return _context9.abrupt("return");case 14:elapsedTimeElement.textContent=prettify(totalElapsedTimeFromLogs);case 15:case"end":return _context9.stop()}}),_callee9,this)}))),function(){return _maybeUpdateElapsedTimeFromLogs.apply(this,arguments)})}]);var _maybeUpdateElapsedTimeFromLogs,_convertTimeStringToSeconds,_logEventSuccess,_openErrorModal,_logEventFailure,_setSuccessModalContent,_initializeSuccessModal,_cancelCloneAction}(),BackupPluginsNotice=function(){return _createClass((function BackupPluginsNotice(){var wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,BackupPluginsNotice),this.wpstgObject=wpstgObject,this.wpstgBackupNoticeCloseButton=null,this.wpstgBackupNoticeReminderButton=null,this.init()}),[{key:"init",value:function(){var _this=this;document.addEventListener("DOMContentLoaded",(function(){_this.wpstgBackupNoticeCloseButton=document.getElementById("wpstg-backup-plugin-notice-close"),_this.wpstgBackupNoticeReminderButton=document.getElementById("wpstg-backup-plugin-notice-remind-me"),_this.addEvent()}))}},{key:"addEvent",value:function(){var _this2=this;null!==this.wpstgBackupNoticeCloseButton&&this.wpstgBackupNoticeCloseButton.addEventListener("click",(function(){_this2.closeBackupPluginNotice()})),null!==this.wpstgBackupNoticeReminderButton&&this.wpstgBackupNoticeReminderButton.addEventListener("click",(function(){_this2.closeBackupPluginNotice("wpstg_backup_plugin_notice_remind_me")}))}},{key:"closeBackupPluginNotice",value:function(){var action=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wpstg_backup_plugin_notice_close";fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:action,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){if(response.ok)return response.json()})).then((function(data){data.success&&(qs(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){hide(".wpstg-backup-plugin-notice-container")}),500))})).catch((function(error){qs(".wpstg-backup-plugin-notice-container").style.opacity=0,setTimeout((function(){hide(".wpstg-backup-plugin-notice-container")}),500)}))}}])}();new BackupPluginsNotice;var WpstgSystemInfo=function(){return _createClass((function WpstgSystemInfo(){var wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,WpstgSystemInfo),this.wpstgObject=wpstgObject,this.wpstgPurgeBackupQueueButton=qs("#wpstg-purge-backup-queue-btn"),this.init()}),[{key:"init",value:function(){var _this=this;null!==this.wpstgPurgeBackupQueueButton&&this.wpstgPurgeBackupQueueButton.addEventListener("click",(function(){_this.confirmAndProceedPurge()}))}},{key:"confirmAndProceedPurge",value:function(){var _this2=this;WPStagingCommon.getSwalModal(!0,{container:"wpstg-swal-push-container",confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_title,icon:"warning",html:"<p>"+this.wpstgObject.i18n.system_info.confirm_and_proceed_purge_html.replace("%s","<code>"+this.wpstgObject.tblprefix+"wpstg_queue</code>")+"</p>",width:"550px",focusConfirm:!1,confirmButtonText:this.wpstgObject.i18n.system_info.confirm_button_text,showCancelButton:!0}).then((function(result){result.isConfirmed&&_this2.ajaxPurgeQueueTable()}))}},{key:"ajaxPurgeQueueTable",value:function(){var _this3=this;fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_purge_queue_table",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){if(response.ok)return response.json();404===response.status&&notify("error",_this3.wpstgObject.i18n.something_went_wrong+_this3.wpstgObject.i18n.ajax_status_code_404),500===response.status&&notify("error",_this3.wpstgObject.i18n.something_went_wrong+_this3.wpstgObject.i18n.status_code_500)})).then((function(response){response.success&&!0===response.success&&notify("success",response.message),response.success&&!1===response.success&&notify("error",response.message)})).catch((function(error){notify("error",_this3.wpstgObject.i18n.something_went_wrong+" "+error),console.warn(_this3.wpstgObject.i18n.something_went_wrong,error)}))}}])}(),WpstgSidebarMenu=function(){return _createClass((function WpstgSidebarMenu(){_classCallCheck(this,WpstgSidebarMenu),this.init()}),[{key:"init",value:function(){this.wpstdStagingTab=document.querySelector("#wpstg--tab--toggle--staging"),this.wpstdBackupTab=document.querySelector("#wpstg--tab--toggle--backup"),this.wpstdSidebarMenu=document.querySelector("#toplevel_page_wpstg_clone"),this.addEvents(),setTimeout((function(){loadingPlaceholder("hidden")}),5e3)}},{key:"addEvents",value:function(){var _this=this;null!==this.wpstdStagingTab&&this.wpstdStagingTab.addEventListener("click",(function(){_this.setPageUrl("wpstg_clone"),_this.setSidebarMenu("wpstg_clone")})),null!==this.wpstdBackupTab&&this.wpstdBackupTab.addEventListener("click",(function(){_this.setPageUrl("wpstg_backup"),_this.setSidebarMenu("wpstg_backup")})),"wpstg-tools"===getActivePage()&&new WpstgSystemInfo,"wpstg-settings"===getActivePage()&&"temporary-login"===getActiveTab()&&this.setSidebarMenu("wpstg-settings&tab=temporary-login")}},{key:"setPageUrl",value:function(page){window.history.pushState(null,null,window.location.pathname+"?page="+page)}},{key:"setSidebarMenu",value:function(page){var wpstgSidebarMenuElements=this.wpstdSidebarMenu.querySelector("ul").querySelectorAll("li");if(wpstgSidebarMenuElements.length>0)for(var i=0;i<wpstgSidebarMenuElements.length;i++)wpstgSidebarMenuElements[i].classList.remove("current"),null!==wpstgSidebarMenuElements[i].querySelector("a")&&wpstgSidebarMenuElements[i].querySelector("a").getAttribute("href")==="admin.php?page="+page&&wpstgSidebarMenuElements[i].classList.add("current")}}])}(),DarkMode=function(){return _createClass((function DarkMode(){var _this=this,wpstgObject=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wpstg;_classCallCheck(this,DarkMode),this.wpstgObject=wpstgObject,document.addEventListener("DOMContentLoaded",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _this.body=document.querySelector("body"),_context.next=3,_this.init();case 3:_this.observeDOMChanges();case 4:case"end":return _context.stop()}}),_callee)}))))}),[{key:"observeDOMChanges",value:function(){var _this2=this;this.observer=new MutationObserver((function(mutations){mutations.forEach((function(mutation){"childList"===mutation.type&&mutation.addedNodes.length>0&&_this2.triggerRenderEvent()}))})),this.observerConfig={childList:!0,subtree:!0},this.observer.observe(document.documentElement,this.observerConfig)}},{key:"triggerRenderEvent",value:function(){var _this3=this,isDarkMode=this.body.classList.contains("wpstg-dark");document.querySelectorAll(".wpstg--dashicons").forEach((function(dashicon){var wpstgIcon=function(){var filePath=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===filePath?"":filePath.split("/").pop()}(dashicon.src);""!==wpstgIcon&&!dashicon.src.includes("dark/")&&isDarkMode&&(dashicon.src=_this3.wpstgObject.assetsUrl+"svg/dark/"+wpstgIcon),""!==wpstgIcon&&dashicon.src.includes("dark/")&&!isDarkMode&&(dashicon.src=_this3.wpstgObject.assetsUrl+"svg/"+wpstgIcon)}))}},{key:"setButtonAsActive",value:function(mode){if("wpstg-welcome"!==getActivePage()){["dark","light","system"].forEach((function(item){document.querySelector(".wpstg-".concat(item,"-mode-container")).classList.remove("active")})),document.querySelector(".wpstg-".concat(mode,"-mode-container")).classList.add("active");var borderColor="dark"===mode||"system"===mode&&"dark"===this.defaultOsColorMode?"#E3DCFF":"#e9e9e9";document.querySelectorAll(".wpstg-color-mode-container > div").forEach((function(div){div.style.border="1px solid ".concat(borderColor)}))}}},{key:"updateFooterLogo",value:function(){var logoUrl=this.body.classList.contains("wpstg-dark")?"img/dark-logo.svg":"img/logo.svg",footerLogoAnchor=document.querySelector(".wpstg-footer-logo a");if(footerLogoAnchor){var footerLogoImg=footerLogoAnchor.querySelector("img");footerLogoImg&&(footerLogoImg.src=this.wpstgObject.assetsUrl+logoUrl)}this.triggerRenderEvent()}},{key:"updateBodyClass",value:function(mode){"dark"===mode||"system"===mode&&"dark"===this.defaultOsColorMode?this.body.classList.add("wpstg-dark"):this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()}},{key:"setButtonsEventListeners",value:function(){var _this4=this;this.systemModeButton=document.querySelector("#wpstg-system-mode-button"),this.lightModeButton=document.querySelector("#wpstg-light-mode-button"),this.darkModeButton=document.querySelector("#wpstg-dark-mode-button"),null!==this.systemModeButton&&null!==this.lightModeButton&&null!==this.darkModeButton&&(this.systemModeButton.addEventListener("click",_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this4.setMode("system");case 2:_this4.setButtonAsActive("system");case 3:case"end":return _context2.stop()}}),_callee2)})))),this.lightModeButton.addEventListener("click",_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,_this4.setMode("light");case 2:_this4.setButtonAsActive("light");case 3:case"end":return _context3.stop()}}),_callee3)})))),this.darkModeButton.addEventListener("click",_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this4.setMode("dark");case 2:_this4.setButtonAsActive("dark");case 3:case"end":return _context4.stop()}}),_callee4)})))))}},{key:"init",value:(_init=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){var mediaQuery,_this5=this;return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.defaultOsColorMode=mediaQuery.matches?"dark":"light",this.setButtonsEventListeners(),_context6.next=5,this.setDefaultOsColorMode();case 5:mediaQuery.addEventListener("change",function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(event){return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _this5.defaultOsColorMode=mediaQuery.matches?"dark":"light",_context5.next=3,_this5.setDefaultOsColorMode();case 3:case"end":return _context5.stop()}}),_callee5)})));return function(_x){return _ref5.apply(this,arguments)}}());case 6:case"end":return _context6.stop()}}),_callee6,this)}))),function(){return _init.apply(this,arguments)})},{key:"setMode",value:(_setMode=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(mode){var response,responseData;return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.prev=0,_context7.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_dark_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,mode:mode}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((response=_context7.sent).ok){_context7.next=7;break}return notify("error",this.wpstgObject.i18n.something_went_wrong),_context7.abrupt("return");case 7:return _context7.next=9,response.json();case 9:if(!1!==(responseData=_context7.sent).success||!responseData.data){_context7.next=13;break}return notify("error",responseData.data),_context7.abrupt("return");case 13:this.updateBodyClass(mode),_context7.next=19;break;case 16:_context7.prev=16,_context7.t0=_context7.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,_context7.t0);case 19:case"end":return _context7.stop()}}),_callee7,this,[[0,16]])}))),function(_x2){return _setMode.apply(this,arguments)})},{key:"setDefaultOsColorMode",value:(_setDefaultOsColorMode=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(){var response,responseData;return _regeneratorRuntime().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.prev=0,_context8.next=3,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_set_default_os_color_mode",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,defaultOsColorMode:this.defaultOsColorMode}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((response=_context8.sent).ok){_context8.next=7;break}return notify("error",this.wpstgObject.i18n.something_went_wrong),_context8.abrupt("return");case 7:return _context8.next=9,response.json();case 9:if((responseData=_context8.sent).data&&responseData.data.defaultColorMode&&this.setButtonAsActive(responseData.data.defaultColorMode),!responseData.success||"dark"!==responseData.data.defaultColorMode){_context8.next=15;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),_context8.abrupt("return");case 15:if(!responseData.success||"dark"!==this.defaultOsColorMode||"system"!==responseData.data.defaultColorMode){_context8.next=19;break}return this.body.classList.add("wpstg-dark"),this.updateFooterLogo(),_context8.abrupt("return");case 19:responseData.success&&this.body.classList.contains("wpstg-dark")&&(this.body.classList.remove("wpstg-dark"),this.updateFooterLogo()),_context8.next=25;break;case 22:_context8.prev=22,_context8.t0=_context8.catch(0),console.warn(this.wpstgObject.i18n.something_went_wrong,_context8.t0);case 25:case"end":return _context8.stop()}}),_callee8,this,[[0,22]])}))),function(){return _setDefaultOsColorMode.apply(this,arguments)})}]);var _setDefaultOsColorMode,_setMode,_init}();new DarkMode;var _show,WPStagingBackup,WpstgProcessLogs=function(){return _createClass((function WpstgProcessLogs(){_classCallCheck(this,WpstgProcessLogs),this.messages={WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",NOTICE:"notice",INFO_SUB:"info_sub",data:{all:[],info:[],error:[],critical:[],warning:[],notice:[],debug:[],info_sub:[]}},this.stoppingTypes=[this.messages.ERROR,this.messages.CRITICAL]}),[{key:"resetLogs",value:function(){this.messages.data={all:[],info:[],error:[],critical:[],warning:[],notice:[],debug:[],info_sub:[]}}},{key:"getLogs",value:function(){return this.messages.data}},{key:"shouldStop",value:function(type){return this.stoppingTypes.includes(type.toLowerCase())}},{key:"logMessages",value:function(log){var _this=this,container=WPStagingCommon.getSwalContainer(),addLogMessage=function(logMessage){var _logMessage$type,_this$messages$data$l;_this.messages.data.all.find((function(_ref){return _ref.message===logMessage.message}))||(logMessage.type=null==logMessage||null===(_logMessage$type=logMessage.type)||void 0===_logMessage$type?void 0:_logMessage$type.toLowerCase(),_this.messages.data.all.push(logMessage),null===(_this$messages$data$l=_this.messages.data[logMessage.type])||void 0===_this$messages$data$l||_this$messages$data$l.push(logMessage),null!==container&&_this.renderLogs(logMessage))};Array.isArray(log)?log.forEach((function(logMessage){return logMessage&&addLogMessage(logMessage)})):log&&addLogMessage(log),document.querySelectorAll(".wpstg--logs--body").forEach((function(element){element.scrollTop=element.scrollHeight}))}},{key:"renderLogs",value:function(logs){var _WPStagingCommon$getS,_this2=this;""===logs&&(logs=this.messages.data.all);var logContainer=null===(_WPStagingCommon$getS=WPStagingCommon.getSwalContainer())||void 0===_WPStagingCommon$getS?void 0:_WPStagingCommon$getS.querySelector(".wpstg--logs--container");logContainer&&(Array.isArray(logs)?logs.forEach((function(log){_this2.appendLogRow(logContainer,log)})):this.appendLogRow(logContainer,logs))}},{key:"appendLogRow",value:function(logContainer,log){var _log$type,logsBody=logContainer.querySelector(".wpstg--logs-table--body");if(logsBody){var templateRow=logsBody.querySelector(".wpstg--logs-table--template-row");if(templateRow){var newLogRow=templateRow.cloneNode(!0);newLogRow.classList.remove("wpstg--logs-table--template-row");var logType=null==log||null===(_log$type=log.type)||void 0===_log$type?void 0:_log$type.toLowerCase(),checkbox=logContainer.querySelector('.wpstg--logs--checkbox[data-type="'.concat(logType,'"]')),selectFilter=logContainer.querySelector(".wpstg--logs--selector").value;(checkbox&&checkbox.checked||selectFilter===logType||"all"===selectFilter||selectFilter===this.messages.INFO&&logType===this.messages.INFO_SUB)&&newLogRow.classList.remove("hidden"),newLogRow.classList.add("wpstg--logs--row-".concat(logType));var rows=logsBody.querySelectorAll("tr"),lastRow=rows[rows.length-1];logType===this.messages.INFO_SUB&&lastRow.classList.contains("wpstg--logs--row-info")&&lastRow.classList.add("wpstg-no-border"),logType===this.messages.INFO&&lastRow.classList.contains("wpstg--logs--row-info_sub")&&lastRow.classList.add("wpstg--logs--row-last");var string,cells=newLogRow.querySelectorAll("td");if(logType===this.messages.INFO_SUB){var tempElement=document.createElement("div");return tempElement.innerHTML=log.message,cells[3].textContent=tempElement.textContent||tempElement.innerText,tempElement.remove(),void logsBody.appendChild(newLogRow)}if(4===cells.length){cells[0].classList.add("wpstg--logs--icon-".concat(logType)),cells[1].textContent=0===(string=log.type).length?string:string.toLowerCase().split(" ").map((function(word){return word.charAt(0).toUpperCase()+word.slice(1)})).join(" "),cells[1].classList.add("wpstg--logs--log-".concat(logType)),cells[2].textContent=log.date;/https?:\/\/[^\s<>"']+/i.test(log.message)?cells[3].innerHTML=log.message.replace(/((https?:\/\/[^\s<>"']+))/g,(function(url){return'<a href="'.concat(url,'" target="_blank" rel="noopener noreferrer">').concat(url,"</a>")})):cells[3].textContent=log.message}logsBody.appendChild(newLogRow),this.updateLogCounter(logContainer,logType)}}}},{key:"updateLogCounter",value:function(logsContainer,type){var counter=logsContainer.querySelector(".wpstg--logs--counter-".concat(type));if(counter){var logsCount=parseInt(counter.textContent,10);counter.textContent=isNaN(logsCount)?1:logsCount+1;var logCheckboxContainer=logsContainer.querySelector(".wpstg--logs--checkbox-".concat(type));logCheckboxContainer&&logCheckboxContainer.classList.remove("wpstg-log-checkbox-hidden")}}},{key:"resetLogContainer",value:function(logsContainer){var logsBody=logsContainer.querySelector(".wpstg--logs-table--body");logsBody&&(logsBody.querySelectorAll("tr").forEach((function(row){row.classList.contains("wpstg--logs-table--template-row")||row.remove()})),Object.values(this.messages).forEach((function(type){if("object"!==_typeof(type)||null===type){var counter=logsContainer.querySelector(".wpstg--logs--counter-".concat(type));counter&&(counter.textContent="0");var logCheckboxContainer=logsContainer.querySelector(".wpstg--logs--checkbox-".concat(type));null==logCheckboxContainer||logCheckboxContainer.classList.add("wpstg-log-checkbox-hidden")}})),this.updateCheckboxOpacities(logsContainer))}},{key:"toggleProcessLogs",value:function(){var logBtn=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,container=WPStagingCommon.getSwalContainer(),logsContainer=container.querySelector(".wpstg--logs--container");if(logsContainer){this.resetLogContainer(logsContainer),this.renderLogs("");var isLogsVisible="block"===logsContainer.style.display;logsContainer.style.display=isLogsVisible?"none":"block",logBtn&&(logBtn.textContent=isLogsVisible?wpstg.i18n.show_logs:wpstg.i18n.hide_logs),container.childNodes[0].style.width=isLogsVisible?"600px":"97%",container.style.zIndex=9999,logsContainer.classList.contains("wpstg--process-modal--logs")&&this.adjustProcessLogsWindow(container),this.addEvents(container)}}},{key:"addEvents",value:function(logsContainer){var _this3=this;logsContainer||(logsContainer=WPStagingCommon.getSwalContainer());var selector=logsContainer.querySelector(".wpstg--logs--selector");selector&&!selector.dataset.eventsAdded&&(selector.addEventListener("change",(function(event){_this3.filterLogs(logsContainer,event)})),selector.dataset.eventsAdded="true");var counterContainer=logsContainer.querySelector(".wpstg--logs--counter");counterContainer&&!counterContainer.dataset.eventsAdded&&(counterContainer.addEventListener("change",(function(event){if(event.target.classList.contains("wpstg--logs--checkbox")){var button=event.target.closest(".wpstg--logs--checkbox-button");button&&(event.target.checked?button.classList.remove("wpstg--unchecked"):button.classList.add("wpstg--unchecked")),_this3.filterLogsByCheckbox(logsContainer)}})),counterContainer.dataset.eventsAdded="true"),this.updateCheckboxOpacities(logsContainer)}},{key:"filterLogs",value:function(logsContainer,event){var _this4=this,logType=event.target.value,logs=logsContainer.querySelectorAll(".wpstg--logs-table--body tr");logsContainer.querySelectorAll(".wpstg--logs--counter label:not(.wpstg-log-checkbox-hidden)").forEach((function(container){var checkbox=container.querySelector(".wpstg--logs--checkbox");checkbox&&(checkbox.checked="all"===logType||checkbox.getAttribute("data-type")===logType)})),this.updateCheckboxOpacities(logsContainer),logs.forEach((function(row){("all"===logType||row.classList.contains("wpstg--logs--row-".concat(logType))||logType===_this4.messages.INFO&&row.classList.contains("wpstg--logs--row-".concat(_this4.messages.INFO_SUB)))&&!row.classList.contains("wpstg--logs-table--template-row")?row.classList.remove("hidden"):row.classList.add("hidden")}))}},{key:"filterLogsByCheckbox",value:function(logsContainer){var _this5=this,checkedTypes=[];logsContainer.querySelectorAll(".wpstg--logs--counter label:not(.wpstg-log-checkbox-hidden)").forEach((function(container){var checkbox=container.querySelector(".wpstg--logs--checkbox:checked");checkbox&&checkedTypes.push(checkbox.getAttribute("data-type"))})),logsContainer.querySelectorAll(".wpstg--logs-table--body tr").forEach((function(row){if(!row.classList.contains("wpstg--logs-table--template-row")){for(var shouldShow=!1,_i=0,_checkedTypes=checkedTypes;_i<_checkedTypes.length;_i++){var type=_checkedTypes[_i];if(row.classList.contains("wpstg--logs--row-".concat(type))||type===_this5.messages.INFO&&row.classList.contains("wpstg--logs--row-".concat(_this5.messages.INFO_SUB))){shouldShow=!0;break}}shouldShow?row.classList.remove("hidden"):row.classList.add("hidden")}})),logsContainer.querySelector(".wpstg--logs--selector").value="all"}},{key:"adjustProcessLogsWindow",value:function(logsContainer){var processContainer=logsContainer.querySelector(".wpstg--swal2-html-container"),processLogsContainer=logsContainer.querySelector(".wpstg--logs--container"),processLogsInnerContainer=logsContainer.querySelector(".wpstg--logs--body");if("block"===processLogsContainer.style.display)return processContainer.style.setProperty("padding","0 2em","important"),processLogsContainer.style.setProperty("height","350px"),void processLogsInnerContainer.style.setProperty("height","300px");processContainer.style.setProperty("padding","4em 2em","important"),processLogsContainer.style.setProperty("height","300px"),processLogsInnerContainer.style.setProperty("height","250px")}},{key:"updateCheckboxOpacities",value:function(logsContainer){logsContainer.querySelectorAll(".wpstg--logs--checkbox").forEach((function(checkbox){var button=checkbox.closest(".wpstg--logs--checkbox-button");button&&(checkbox.checked?button.classList.remove("wpstg--unchecked"):button.classList.add("wpstg--unchecked"))}))}},{key:"shouldWarn",value:function(){return this.messages.data.error.length>0||this.messages.data.critical.length>0}}])}(),FinishModal={showLogs:!0,onClose:null,show:(_show=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(content){var _wpstg,icon,btnType,_args=arguments;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:btnType="success"===(icon=_args.length>1&&void 0!==_args[1]?_args[1]:"success")?"wpstg-green-button":"",WPStagingCommon.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-button wpstg-link-btn "+btnType}).fire({icon:icon,html:content.innerHTML,confirmButtonText:null===(_wpstg=wpstg)||void 0===_wpstg||null===(_wpstg=_wpstg.i18n)||void 0===_wpstg?void 0:_wpstg.close,showCancelButton:!1,showConfirmButton:!0,allowOutsideClick:!1,onRender:function(){var showLogsButton=WPStagingCommon.getSwalContainer().querySelector(".wpstg--success-modal--logs-button");if(showLogsButton){var showLogs=showLogsButton.cloneNode(!0);showLogsButton.parentNode.replaceChild(showLogs,showLogsButton),showLogs.addEventListener("click",(function(e){e.preventDefault(),WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)}))}}}).then((function(result){result.value&&(WPStagingCommon.closeSwalModal(),FinishModal.onClose&&"function"==typeof FinishModal.onClose&&FinishModal.onClose())})),FinishModal.showLogs&&show(".wpstg--success-modal--logs-wrapper");case 4:case"end":return _context.stop()}}),_callee)}))),function(_x){return _show.apply(this,arguments)}),getModalContent:function(params){var _wpstg2,modal=document.getElementById("wpstg--success-modal");(null!==params.title&&(modal.innerHTML=modal.innerHTML.replace("{title}",params.title)),FinishModal.showLogs)?modal.innerHTML=modal.innerHTML.replace("{btnTxtLog}",'<span style="text-decoration: underline">'+(null===(_wpstg2=wpstg)||void 0===_wpstg2||null===(_wpstg2=_wpstg2.i18n)||void 0===_wpstg2?void 0:_wpstg2.show_logs)+"</span>"):modal.innerHTML=modal.innerHTML.replace("{btnTxtLog}","");return modal.innerHTML=modal.innerHTML.replace("{text}",params.body),modal}},WpStagingModalTimer=function(){return _createClass((function WpStagingModalTimer(){var outputTimeSelector=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".wpstg--process-modal--elapsed-time";_classCallCheck(this,WpStagingModalTimer),this.totalSeconds=0,this.interval=null,this.outputTimeSelector=outputTimeSelector,this.processStartTime=null}),[{key:"start",value:function(){var _this=this;if(null===this.interval){this.processStartTime=Date.now();var _updateTimer=function(){if(!document.hidden){var currentTime=Date.now();_this.totalSeconds=Math.floor((currentTime-_this.processStartTime)/1e3),_this.updateElapsedTime()}null!==_this.interval&&requestAnimationFrame(_updateTimer)};requestAnimationFrame(_updateTimer),this.interval=setInterval((function(){if(document.hidden){var currentTime=Date.now();_this.totalSeconds=Math.floor((currentTime-_this.processStartTime)/1e3),_this.updateElapsedTime()}}),1e3)}}},{key:"stop",value:function(){this.totalSeconds=0,this.interval&&(clearInterval(this.interval),this.interval=null)}},{key:"getTimeElapsed",value:function(){return this.totalSeconds}},{key:"updateElapsedTime",value:function(){var _this2=this;document.querySelectorAll(this.outputTimeSelector).forEach((function(element){element.innerText=prettify(_this2.totalSeconds)}))}}])}(),WPStagingJob={processModal:new WpstgProcessModal,processModalLogs:new WpstgProcessLogs,timer:new WpStagingModalTimer,isCancelled:!1,isFinished:!1,performingCancelRequest:!1,processInfo:{title:null,interval:null,maxTotalRetries:0,maxSequentialRetries:0,totalTimeRetried:0,sequentialRetried:0},job:{action:null,name:null,type:null},status:{hasResponse:null,reTryAfter:5e3,STATUS_FAIL:"JOB_FAIL"},onSuccess:function(){},incrementRetry:function(){WPStagingJob.processInfo.totalTimeRetried++,WPStagingJob.processInfo.sequentialRetried++},resetJob:function(){WPStagingJob.resetRetry(),WPStagingJob.isCancelled=!1,WPStagingJob.isFinished=!1,WPStagingJob.performingCancelRequest=!1},resetRetry:function(){WPStagingJob.processInfo.totalTimeRetried=0,WPStagingJob.processInfo.sequentialRetried=0},canRetry:function(){return!(WPStagingJob.processInfo.totalTimeRetried>=WPStagingJob.processInfo.maxTotalRetries)&&!(WPStagingJob.processInfo.sequentialRetried>=WPStagingJob.processInfo.maxSequentialRetries)},setJob:function(job){WPStagingJob.job.action=job.action||null,WPStagingJob.job.name=job.name||null,WPStagingJob.job.type=job.type||null},statusStop:function(){var _WPStaging;clearInterval(WPStagingJob.processInfo.interval),WPStagingJob.processInfo.interval=null,window.removeEventListener("beforeunload",null===(_WPStaging=WPStaging)||void 0===_WPStaging?void 0:_WPStaging.warnIfClosingDuringProcess)},showCancelInitiatedModal:function(){var title=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";WPStagingCommon.getSwalModal(!0).fire({title:title||wpstg.i18n.cancel_modal_title,text:wpstg.i18n.cancel_modal_wait_text,icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650})},statusStart:function(){var _wpstg$jobStatusInter;null===WPStagingJob.processInfo.interval&&(WPStagingJob.processInfo.interval=setInterval(_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var response,swalContainer;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!0!==WPStagingJob.isCancelled){_context.next=3;break}return WPStagingJob.statusStop(),_context.abrupt("return");case 3:if(!1!==WPStagingJob.status.hasResponse){_context.next=5;break}return _context.abrupt("return");case 5:return WPStagingJob.status.hasResponse=!1,_context.prev=6,_context.next=9,wpstgRequest("wpstg--job--status",{type:WPStagingJob.job.type,name:WPStagingJob.job.name});case 9:if(response=_context.sent,WPStagingJob.status.hasResponse=!0,void 0===response&&WPStagingJob.statusStop(),"JOB_CANCEL"!==(null==response?void 0:response.status)){_context.next=17;break}return WPStagingJob.isCancelled=!0,WPStagingJob.statusStop(),WPStagingJob.waitForCancel(),_context.abrupt("return");case 17:if(WPStagingJob.processInfo.title!==response.currentStatusTitle){_context.next=19;break}return _context.abrupt("return");case 19:WPStagingJob.processInfo.title=res.currentStatusTitle,(swalContainer=WPStagingCommon.getSwalContainer()).querySelector(".wpstg--process-modal--title").innerText=res.currentStatusTitle,swalContainer.querySelector(".wpstg--process-modal--process-percent").innerText="0",_context.next=29;break;case 25:_context.prev=25,_context.t0=_context.catch(6),WPStagingJob.status.hasResponse=!0,WPStagingCommon.showAjaxFatalError(_context.t0,"","Submit an error report.");case 29:case"end":return _context.stop()}}),_callee,null,[[6,25]])}))),null!==(_wpstg$jobStatusInter=wpstg.jobStatusInterval)&&void 0!==_wpstg$jobStatusInter?_wpstg$jobStatusInter:5e3))},prepareJob:function(action){var _arguments=arguments,_this=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var data,eventName,response;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return data=_arguments.length>1&&void 0!==_arguments[1]?_arguments[1]:{},eventName=_arguments.length>2&&void 0!==_arguments[2]?_arguments[2]:null,WPStagingJob.resetJob(),_context2.prev=3,_context2.next=6,wpstgRequest(action,data);case 6:if((response=_context2.sent)&&response.success){_context2.next=9;break}return _context2.abrupt("return",!1);case 9:return eventName&&window.dispatchEvent(new Event(eventName)),_this.processModal.setSetupTimerInterval(!1),WPStagingJob.timer.start(),_context2.abrupt("return",!0);case 15:return _context2.prev=15,_context2.t0=_context2.catch(3),console.warn(wpstgi18n.something_went_wrong,_context2.t0),notify("warning",wpstgi18n.something_went_wrong),_context2.abrupt("return",!1);case 20:case"end":return _context2.stop()}}),_callee2,null,[[3,15]])})))()},runJob:function(){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var response;return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(WPStagingCommon.resetErrors(),!WPStagingJob.isCancelled){_context3.next=4;break}return WPStagingJob.statusStop(),_context3.abrupt("return");case 4:return _context3.next=6,wpstgRequest(WPStagingJob.job.action);case 6:if(response=_context3.sent){_context3.next=11;break}return _context3.next=10,WPStagingJob.onJobFail();case 10:return _context3.abrupt("return");case 11:if(!WPStagingJob.isCancelled){_context3.next=13;break}return _context3.abrupt("return");case 13:if(void 0!==response){_context3.next=17;break}return _context3.next=16,WPStagingJob.onJobFail();case 16:return _context3.abrupt("return");case 17:if("JOB_CANCEL"!==response.jobStatus){_context3.next=23;break}return WPStagingJob.isCancelled=!0,WPStagingJob.statusStop(),wpstgAuthCheck.stop(),WPStagingJob.showCancelInitiatedModal(),_context3.abrupt("return");case 23:if(WPStagingJob.processResponse(response),WPStagingJob.processInfo.interval||WPStagingJob.statusStart(),!0!==response.isRunning){_context3.next=29;break}return WPStagingJob.processInfo.sequentialRetried=0,WPStagingJob.runJob(),_context3.abrupt("return");case 29:if(WPStagingJob.processModal.stop(),WPStagingJob.statusStop(),response.jobStatus!==WPStagingJob.status.STATUS_FAIL){_context3.next=35;break}return _context3.next=34,WPStagingJob.onJobFail(response);case 34:return _context3.abrupt("return");case 35:WPStagingCommon.closeSwalModal(),"function"==typeof WPStagingJob.onSuccess&&WPStagingJob.onSuccess(response);case 37:case"end":return _context3.stop()}}),_callee3)})))()},onJobFail:function(){var _arguments2=arguments;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var response,_response;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return response=_arguments2.length>0&&void 0!==_arguments2[0]?_arguments2[0]:null,_context4.next=3,WPStagingJob.checkMemoryExhaustion(response,WPStagingJob.job.name);case 3:if(!_context4.sent){_context4.next=6;break}return _context4.abrupt("return");case 6:if(WPStagingJob.processInfo.canRetry()){_context4.next=14;break}return _context4.next=9,WPStagingJob.processModal.logEventFailure(WPStagingJob.job.name);case 9:return _response={messages:[{type:"critical",message:"There was a PHP fatal error while processing this job. You might need to check your PHP error log to find out the reason. Please contact WP STAGING support if you need help."}]},WPStagingJob.processResponse(_response),WPStagingJob.cancel(),setTimeout(WPStagingJob.logsModal,500),_context4.abrupt("return");case 14:return _context4.next=16,WPStagingCommon.delay(wpstg.delayReq);case 16:return WPStagingJob.processInfo.incrementRetry(),_context4.next=19,WPStagingJob.runJob();case 19:case"end":return _context4.stop()}}),_callee4)})))()},cancel:function(){var _WPStaging2,extraParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;WPStagingJob.timer.stop(),clearInterval(WPStagingJob.processInfo.interval),WPStagingJob.isCancelled=!0,WPStagingJob.processInfo.interval=null,window.removeEventListener("beforeunload",null===(_WPStaging2=WPStaging)||void 0===_WPStaging2?void 0:_WPStaging2.warnIfClosingDuringProcess),WPStagingCommon.closeSwalModal(),WPStagingCommon.getSwalModal(!0).fire({title:wpstg.i18n.cancel_modal_title,text:wpstg.i18n.cancel_modal_text,icon:"info",showConfirmButton:!1,showCloseButton:!1,showLoaderOnConfirm:!1,showCancelButton:!1,allowEscapeKey:!1,allowOutsideClick:!1,width:650,onRender:function(){WPStagingJob.sendCancelRequest(extraParams,callback,!0)}})},sendCancelRequest:function(extraParams,callback){var _arguments3=arguments;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var isPrepare,retries,action,_yield$wpstgRequestWi,response;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(isPrepare=_arguments3.length>2&&void 0!==_arguments3[2]&&_arguments3[2],retries=_arguments3.length>3&&void 0!==_arguments3[3]?_arguments3[3]:10,!WPStagingJob.performingCancelRequest){_context5.next=4;break}return _context5.abrupt("return");case 4:return WPStagingJob.performingCancelRequest=!0,_context5.prev=5,action=isPrepare?"wpstg--job--prepare-cancel":"wpstg--job--cancel",_context5.next=9,wpstgRequestWithError(action,extraParams);case 9:if(_yield$wpstgRequestWi=_context5.sent,response=_yield$wpstgRequestWi.response,_yield$wpstgRequestWi.error,!(423===_yield$wpstgRequestWi.code&&retries>0)){_context5.next=17;break}return WPStagingJob.performingCancelRequest=!1,setTimeout((function(){WPStagingJob.sendCancelRequest(extraParams,callback,isPrepare,retries-1)}),3e3),_context5.abrupt("return");case 17:if(!isPrepare||null==response||!response.success){_context5.next=21;break}return WPStagingJob.performingCancelRequest=!1,WPStagingJob.sendCancelRequest(extraParams,callback),_context5.abrupt("return");case 21:if(WPStagingJob.performingCancelRequest=!1,WPStagingJob.isCancelled=!1,WPStagingCommon.showAjaxFatalError(response,"",wpstg.i18n.submit_error_report),response.hasOwnProperty("isRunning")||WPStagingCommon.showErrorModal(wpstg.i18n.cancel_modal_error),!0!==(null==response?void 0:response.isRunning)){_context5.next=28;break}return WPStagingJob.sendCancelRequest(extraParams,callback),_context5.abrupt("return");case 28:WPStagingJob.performingCancelRequest=!1,WPStagingCommon.continueErrorHandle=!1,wpstgAuthCheck.stop(),WPStagingCommon.closeSwalModal(),null!=callback&&callback(),_context5.next=43;break;case 35:_context5.prev=35,_context5.t0=_context5.catch(5),WPStagingJob.performingCancelRequest=!1,WPStagingCommon.continueErrorHandle=!1,wpstgAuthCheck.stop(),WPStagingCommon.closeSwalModal(),WPStagingCommon.showErrorModal(wpstg.i18n.cancel_modal_error),null!=callback&&callback();case 43:case"end":return _context5.stop()}}),_callee5,null,[[5,35]])})))()},checkMemoryExhaustion:function(response,requestType){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){var result,helpContent;return _regeneratorRuntime().wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,WPStagingCommon.checkMemoryExhaustion(requestType);case 2:if(!1!==(result=_context6.sent)){_context6.next=5;break}return _context6.abrupt("return");case 5:helpContent=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(helpContent=' Read <a target="_blank" href="'+WPStagingCommon.memoryExhaustArticleLink+'">this article</a> for solving this issue. Please contact WP Staging support if you need further assistance.'),response.messages=[{type:"critical",date:result.data.time,message:result.message+"."+helpContent}],WPStagingJob.processResponse(response);case 9:case"end":return _context6.stop()}}),_callee6)})))()},processResponse:function(response){if(null===response)throw WPStagingCommon.closeSwalModal(),WPStagingCommon.showError("Invalid Response; null"),new Error("Invalid Response; ".concat(response));var container=WPStagingCommon.getSwalContainer();(response.title||response.statusTitle)&&(container.querySelector(".wpstg--process-modal--title").innerText=response.title||response.statusTitle),response.percentage&&(container.querySelector(".wpstg--process-modal--percent").innerText=response.percentage),WPStagingJob.addResponseMessagesToLog(response),response.jobId&&WPStagingCommon.setJobId(response.jobId),!1===response.isRunning&&!0===response.job_done&&(WPStagingJob.timer.stop(),WPStagingJob.isCancelled=!0,response.status=!response.isRunning,window.dispatchEvent(new CustomEvent("wpstgJobDone",{response:response,job:WPStagingJob.job})))},addResponseMessagesToLog:function(response){if(response.messages){var _step2,_appendMessage=function(message){if(Array.isArray(message)){var _step,_iterator=_createForOfIteratorHelper(message);try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;_appendMessage(item)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else message.type&&(WPStagingJob.processModalLogs.logMessages(message),WPStagingJob.processModalLogs.shouldStop(message.type)&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:message.message}})),WPStagingJob.cancel({},(function(){setTimeout(WPStagingJob.logsModal,500)}))))},_iterator2=_createForOfIteratorHelper(response.messages);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var message=_step2.value;message&&_appendMessage(message)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},logsModal:function(){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var logsContainer,html,result;return _regeneratorRuntime().wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return logsContainer=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),html=logsContainer?logsContainer.innerHTML:null,_context7.next=4,WPStagingCommon.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'.concat(html,"</div>"),width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){WPStagingCommon.getSwalContainer()[0].style["z-index"]=9999;var logs=WPStagingJob.processModalLogs.getLogs();logs.all&&(WPStagingJob.processModalLogs.renderLogs(logs.all),WPStagingJob.processModalLogs.addEvents())},onOpen:function(container){var logsContainer=$(container).find(".wpstg--process-modal--logs");logsContainer.scrollTop(logsContainer.scrollHeight)}});case 4:return(result=_context7.sent).value&&WPStagingCommon.closeSwalModal(),_context7.abrupt("return",result);case 7:case"end":return _context7.stop()}}),_callee7)})))()},shouldWarn:function(){return WPStagingJob.processModalLogs.shouldWarn()},waitForCancel:function(){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee8(){return _regeneratorRuntime().wrap((function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return WPStagingJob.showCancelInitiatedModal(),_context8.next=3,wpstgRequest("wpstg--job--heartbeat");case 3:_context8.sent.running?setTimeout((function(){WPStagingJob.waitForCancel()}),5e3):WPStagingCommon.closeSwalModal();case 5:case"end":return _context8.stop()}}),_callee8)})))()},successModal:function(_ref2){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee9(){var _ref2$title,title,_ref2$bodyText,bodyText,_ref2$onSuccessModalR,onSuccessModalRender,html,result;return _regeneratorRuntime().wrap((function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _ref2$title=_ref2.title,title=void 0===_ref2$title?null:_ref2$title,_ref2$bodyText=_ref2.bodyText,bodyText=void 0===_ref2$bodyText?null:_ref2$bodyText,_ref2$onSuccessModalR=_ref2.onSuccessModalRender,onSuccessModalRender=void 0===_ref2$onSuccessModalR?function(){}:_ref2$onSuccessModalR,html=document.querySelector("#wpstg--success-modal").innerHTML,_context9.next=4,WPStagingCommon.getSwalModal(!0).fire({icon:"success",html:html.replace("{title}",title).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==bodyText?bodyText:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){var container=WPStagingCommon.getSwalContainer();WPStagingJob.registerLogsToggle(container),show(".wpstg--success-modal--logs-wrapper"),onSuccessModalRender()},allowEscapeKey:!1,allowOutsideClick:!1});case 4:return(result=_context9.sent).value&&WPStagingCommon.closeSwalModal(),_context9.abrupt("return",result);case 7:case"end":return _context9.stop()}}),_callee9)})))()},registerLogsToggle:function(container){addEvent(container,"click",".wpstg--success-modal--logs-button",(function(el,e){WPStagingJob.showLogsInModal(e)}))},showLogsInModal:function(e){e.preventDefault(),WPStagingJob.processModalLogs.toggleProcessLogs(e.target)}};!function($){WPStagingBackup={processModal:new WpstgProcessModal,wpstgProcessLogs:new WpstgProcessLogs,isBackupSlowerThanUsual:!1,isBackupSpeedModalDisplayed:!1,isFinished:!1,processInfo:{title:null,interval:null,isOnlySchedule:!1,isBackupCreationInBackground:!1},modal:{create:{html:null,confirmBtnTxt:null,hasBackupSchedule:null},process:{html:null,cancelBtnTxt:null,modal:null},download:{html:null,data:{indexFile:null,files:[]}},upload:{html:null,confirmBtnTxt:null,retryCount:0,data:{file:null}},restore:{html:null,btnTxtNext:null,btnTxtConfirm:null,btnTxtCancel:null,searchReplaceForm:null,containerIntroduction:null,data:{file:null,fileObject:null,search:[],replace:[],backupMetadata:{}},baseDirectory:null}},messages:{WARNING:"warning",ERROR:"error",INFO:"info",DEBUG:"debug",CRITICAL:"critical",data:{all:[],info:[],error:[],critical:[],warning:[],debug:[]},shouldWarn:function(){return WPStagingBackup.messages.data.error.length>0||WPStagingBackup.messages.data.critical.length>0},addMessage:function(message){if(Array.isArray(message))message.forEach((function(item){WPStagingBackup.messages.addMessage(item)}));else if(message.type){var type=message.type.toLowerCase()||"info";WPStagingBackup.messages.data[type]||(WPStagingBackup.messages.data[type]=[]),WPStagingBackup.messages.data.all.push(message),WPStagingBackup.messages.data[type].push(message)}},reset:function(){WPStagingBackup.messages.data={all:[],info:[],error:[],critical:[],warning:[],debug:[]}}},timer:new WpStagingModalTimer,status:{hasResponse:null,reTryAfter:5e3},fetchListing:function(){var isResetErrors=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return loadingPlaceholder(),WPStagingCommon.isLoading(!0),$("#backup-messages").text(""),isResetErrors&&WPStagingCommon.resetErrors(),fetch("".concat(ajaxurl,"?action=wpstg--backups--listing&_=").concat(Math.random()),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--backups--listing",accessToken:wpstg.accessToken,nonce:wpstg.nonce}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(WPStagingCommon.handleFetchErrors).then((function(res){return res.json()})).then((function(res){var _document$getElementB,backupTab=qs("#wpstg--tab--backup");if(backupTab.style.minHeight=backupTab.offsetHeight+"px",$("#wpstg--tab--backup").empty(),WPStagingBackup.modal.create.html=null,WPStagingCommon.cache.get("#wpstg--tab--backup").html(res),void 0!==res.success&&!1===res.success)return WPStagingCommon.showError("Error: "+res.data),void loadingPlaceholder("hidden");(null===WPStagingBackup.modal.download.html&&(WPStagingBackup.modal.download.html=$("#wpstg--success-modal").html()),WPStagingCommon.showAjaxFatalError(res,"",wpstg.i18n.submit_error_report),WPStagingCommon.isLoading(!1),window.dispatchEvent(new Event("backupListingFinished")),$("#local-backup-title").show(),$("#cloud-backup-title").hide(),"wpstg_backup"===getActivePage()&&"true"===localStorage.getItem("wpstg-trigger-backup-after-authentication"))&&(null===(_document$getElementB=document.getElementById("wpstg-new-backup"))||void 0===_document$getElementB||_document$getElementB.click());return res})).catch((function(e){return WPStagingCommon.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))},cancel:function(){var extraParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;WPStagingBackup.timer.stop(),clearInterval(WPStagingBackup.processInfo.interval),WPStagingBackup.processInfo.interval=null,WPStagingJob.cancel(extraParams,callback)},process:function(_process){if(!("function"==typeof _process.execute||_process.data&&_process.onResponse))return WPStagingCommon.closeSwalModal(),void WPStagingCommon.showError("process.data and / or process.onResponse is not set");if(!WPStagingBackup.modal.process.html||!WPStagingBackup.modal.process.cancelBtnTxt){var $modal=$("#wpstg--process-modal"),html=$modal.html(),btnTxt=$modal.attr("data-cancelButtonText");WPStagingBackup.modal.process.html=html||null,WPStagingBackup.modal.process.cancelBtnTxt=btnTxt||null,$modal.remove()}WPStagingBackup.modal.process.html&&$("#wpstg--process-modal").remove(),$("body").off("click",".wpstg--process-modal--logs-button").on("click",".wpstg--process-modal--logs-button",(function(e){WPStagingBackup.showLogsInModal(e)})).off("click",".wpstg--success-modal--logs-button").on("click",".wpstg--success-modal--logs-button",(function(e){WPStagingBackup.showLogsInModal(e,"success")})),_process.isShowCancelButton=!1!==_process.isShowCancelButton,WPStagingBackup.modal.process.modal=WPStagingCommon.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:WPStagingBackup.modal.process.html,cancelButtonText:WPStagingBackup.modal.process.cancelBtnTxt,showCancelButton:_process.isShowCancelButton,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,width:600,onRender:function(){var _btnCancel=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=_btnCancel.cloneNode(!0);if(_btnCancel.parentNode.replaceChild(btnCancel,_btnCancel),btnCancel.addEventListener("click",(function(e){confirm(wpstg.i18n.cancel_modal_confirm_text)&&WPStagingBackup.cancel()})),"function"!=typeof _process.execute)return _process.data&&_process.onResponse?void WPStagingCommon.ajax(_process.data,_process.onResponse):(WPStagingCommon.closeSwalModal(),void WPStagingCommon.showError("process.data and / or process.onResponse is not set"));_process.execute()},onAfterClose:function(){return"function"==typeof _process.onAfterClose&&_process.onAfterClose()}})},processResponse:function(response){if(null===response)throw WPStagingCommon.closeSwalModal(),WPStagingCommon.showError("Invalid Response; null"),new Error("Invalid Response; ".concat(response));var $container=$(WPStagingCommon.getSwalContainer());(response.title||response.statusTitle)&&$container.find(".wpstg--process-modal--title").text(response.title||response.statusTitle),response.percentage&&$container.find(".wpstg--process-modal--percent").text(response.percentage),WPStagingBackup.addResponseMessagesToLog(response),response.jobId&&WPStagingCommon.setJobId(response.jobId),!1===response.isRunning&&!0===response.job_done&&("Backup"!==response.job||null!=response&&response.isGlitchInBackup||WPStagingBackup.calculateBackupSpeedIndex(response.backupSize,WPStagingBackup.timer.getTimeElapsed()),WPStagingBackup.timer.stop(),WPStagingJob.isCancelled=!0,response.status=!response.isRunning,window.dispatchEvent(new CustomEvent("finishedProcess",{response:response})))},logsModal:function(){var logsContainer=document.querySelector("#wpstg--success-modal .wpstg--success-modal--logs"),html=logsContainer?logsContainer.innerHTML:null;WPStagingCommon.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal"}).fire({html:'<div class="wpstg--process-modal--logs wpstg--logs--container" style="display:block">'.concat(html,"</div>"),width:"97%",allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){$(WPStagingCommon.getSwalContainer())[0].style["z-index"]=9999,WPStagingBackup.messages.data.all&&(WPStagingBackup.wpstgProcessLogs.renderLogs(WPStagingBackup.messages.data.all),WPStagingBackup.wpstgProcessLogs.addEvents())},onOpen:function(container){var $logsContainer=$(container).find(".wpstg--process-modal--logs");$logsContainer.scrollTop($logsContainer[0].scrollHeight)}}).then((function(result){result.value&&(WPStagingCommon.closeSwalModal(),WPStagingBackup.fetchListing())}))},addResponseMessagesToLog:function(response){if(response.messages){var _step2,$logsContainer=$(".wpstg--process-modal--logs"),stoppingTypes=[WPStagingBackup.messages.ERROR,WPStagingBackup.messages.CRITICAL],_appendMessage=function(message){if(Array.isArray(message)){var _step,_iterator=_createForOfIteratorHelper(message);try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;_appendMessage(item)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else message.type&&(WPStagingBackup.wpstgProcessLogs.logMessages(message),stoppingTypes.includes(message.type.toLowerCase())&&(window.dispatchEvent(new CustomEvent("finishedProcessWithError",{detail:{error:message.message}})),WPStagingBackup.cancel({},(function(){setTimeout(WPStagingBackup.logsModal,500)}))))},_iterator2=_createForOfIteratorHelper(response.messages);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var message=_step2.value;message&&(WPStagingBackup.messages.addMessage(message),_appendMessage(message))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}$logsContainer.is(":visible")&&$logsContainer.scrollTop($logsContainer[0].scrollHeight)}},successModal:function(_ref){var _ref$title=_ref.title,title=void 0===_ref$title?null:_ref$title,_ref$bodyText=_ref.bodyText,bodyText=void 0===_ref$bodyText?null:_ref$bodyText,_ref$processResponse=_ref.processResponse,processResponse=void 0===_ref$processResponse?null:_ref$processResponse;if(!WPStagingBackup.isBackupSlowerThanUsual||!1!==WPStagingBackup.isBackupSpeedModalDisplayed){var $el=$("#wpstg--success-modal");if(null===WPStagingBackup.modal.download.html&&(WPStagingBackup.modal.download.html=$el.html()),$el.remove(),WPStagingCommon.getSwalModal(!0).fire({icon:"success",html:WPStagingBackup.modal.download.html.replace("{title}",title).replace("{btnTxtLog}",wpstg.i18n.show_logs).replace("{text}",null!==bodyText?bodyText:wpstg.i18n.backup_success.created.body),confirmButtonText:wpstg.i18n.close,showCancelButton:!1,showConfirmButton:!0,onRender:function(){wpstg.isPro||(document.querySelector(".wpstg--swal2-html-container").querySelector(".wpstg--success-modal--additional-content").innerHTML=document.querySelector("#wpstg-backup-success-content").innerHTML)},allowEscapeKey:!1,allowOutsideClick:!1}).then((function(result){result.value&&(WPStagingCommon.closeSwalModal(),setLoadingPlaceholder().then((function(){loadingPlaceholder()})),WPStagingBackup.fetchListing().then((function(){if(title===wpstg.i18n.backup_remote_upload.backup_upload_complete&&$("#wpstg-show-cloud-backup").click(),title===wpstg.i18n.backup_success.created.title||processResponse)if(processResponse.backupMd5||WPStagingBackup.processInfo.isOnlySchedule||WPStagingBackup.processInfo.isBackupCreationInBackground){!WPStagingBackup.processInfo.isOnlySchedule&&Array.isArray(WPStagingCommon.selectedStorages)&&(WPStagingCommon.selectedStorages.includes("localStorage")&&WPStagingCommon.selectedStorages.length>=2||!WPStagingCommon.selectedStorages.includes("localStorage")&&WPStagingCommon.selectedStorages.length>=1)&&$("#wpstg-show-cloud-backup").click();var $el="",timesWaited=0,intervalWaitForBackupInDom=setInterval((function(){if(WPStagingBackup.processInfo.isOnlySchedule||WPStagingBackup.processInfo.isBackupCreationInBackground||!processResponse.isLocalBackup)clearInterval(intervalWaitForBackupInDom);else{timesWaited++;var backupFound=!1;if(processResponse.isMultipartBackup?processResponse.backupMd5.forEach((function(md5){($el=$('.wpstg-backup[data-md5="'.concat(md5,'"] .wpstg--backup--download'))).length&&(backupFound=!0,console.log("remote backup found"))})):($el=$('.wpstg-backup[data-md5="'.concat(processResponse.backupMd5,'"] .wpstg--backup--download')),backupFound=$el.length>0),!backupFound)return void(timesWaited>=20&&clearInterval(intervalWaitForBackupInDom));clearInterval(intervalWaitForBackupInDom)}WPStagingBackup.wpstgProcessLogs.logMessages(WPStagingBackup.messages.data.all)}),500)}else WPStagingCommon.showError("<strong>%s</strong>:".replace("%s",wpstg.i18n.warning)+wpstg.i18n.backup_create.create_backup_fetch_listing_error_md5+JSON.stringify(processResponse)+"<br/><br/>"+wpstg.i18n.report_this_warning)})))})),$(".wpstg--success-modal--logs-wrapper").show(),title===wpstg.i18n.backup_success.created.title){var wpstgRateUsElement=WPStagingCommon.getSwalContainer().querySelector(".wpstg-rate-us");wpstgRateUsElement&&wpstgRateUsElement.classList.add("show")}}},checkMemoryExhaustion:function(response,requestType){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var result,helpContent;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,WPStagingCommon.checkMemoryExhaustion(requestType);case 2:if(!1!==(result=_context.sent)){_context.next=5;break}return _context.abrupt("return");case 5:helpContent=' <button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> for help in solving this issue.",wpstg.isPro&&(helpContent=wpstg.i18n.memory_exhaust_error.replace("%s",WPStagingCommon.memoryExhaustArticleLink)),response.messages=[{type:"critical",date:result.data.time,message:result.message+". "+helpContent}],WPStagingBackup.processResponse(response);case 9:case"end":return _context.stop()}}),_callee)})))()},statusStop:function(){clearInterval(WPStagingBackup.processInfo.interval),WPStagingBackup.processInfo.interval=null,window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)},statusStart:function(jobType){null===WPStagingBackup.processInfo.interval&&(WPStagingBackup.processInfo.interval=setInterval((function(){!0!==WPStagingJob.isCancelled?!1!==WPStagingBackup.status.hasResponse&&(WPStagingBackup.status.hasResponse=!1,fetch("".concat(ajaxurl,"?action=wpstg--job--status"),{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg--job--status",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:jobType,name:jobType}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(res){return res.json()})).then((function(res){if(WPStagingBackup.status.hasResponse=!0,void 0===res&&WPStagingBackup.statusStop(),"JOB_CANCEL"===(null==res?void 0:res.status))return WPStagingJob.isCancelled=!0,WPStagingBackup.statusStop(),wpstgAuthCheck.stop(),void WPStagingJob.waitForCancel();if(WPStagingBackup.processInfo.title!==res.currentStatusTitle){WPStagingBackup.processInfo.title=res.currentStatusTitle;var $container=$(WPStagingCommon.getSwalContainer());$container.find(".wpstg--process-modal--title").text(res.currentStatusTitle),$container.find(".wpstg--process-modal--percent").text("0")}})).catch((function(e){WPStagingBackup.status.hasResponse=!0,WPStagingCommon.showAjaxFatalError(e,"",wpstg.i18n.submit_error_report)}))):WPStagingBackup.statusStop()}),wpstg.backupStatusInterval))},showLogsInModal:function(e){e.preventDefault(),WPStagingBackup.wpstgProcessLogs.toggleProcessLogs(e.target)},showGeneralErrorModal:function(){var reportModal=document.querySelector("#wpstg-general-error-modal");null!=reportModal&&null!=reportModal&&(show("#wpstg-general-error-modal"),new WpstgContactUs("general-error"))},removeLogsListeners:function(){$("body").off("click",".wpstg--process-modal--logs-button").off("click",".wpstg--success-modal--logs-button")},calculateBackupSpeedIndex:function(size,totalTime){fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_calculate_backup_speed_index",accessToken:wpstg.accessToken,nonce:wpstg.nonce,size:size,time:totalTime}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(response){if(response.ok)return response.json()})).then((function(data){WPStagingBackup.isBackupSlowerThanUsual=data.isBackupSlowerThanUsual,WPStagingBackup.isBackupSpeedModalDisplayed=data.isBackupSpeedModalDisplayed,data.isBackupSlowerThanUsual&&!1===data.isBackupSpeedModalDisplayed&&WPStagingBackup.showGeneralErrorModal()})).catch((function(error){console.log(error)}))}}}(jQuery);var _cancelJob,WPStagingBackup$1=WPStagingBackup,ProcessModal={onCancel:null,onRender:null,isCancellable:!1,isCloseable:!1,show:function(){var _show=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var modal,html;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(modal=document.getElementById("wpstg--process-modal")){_context.next=3;break}return _context.abrupt("return");case 3:html=modal.innerHTML,WPStagingCommon.getSwalModal(!0,{content:"wpstg--process--content"}).fire({html:html,cancelButtonText:ProcessModal.isCloseable?wpstg.i18n.close:wpstg.i18n.cancel,showCancelButton:ProcessModal.isCloseable||ProcessModal.isCancellable,showConfirmButton:!1,showLoaderOnConfirm:!1,allowEscapeKey:!1,allowOutsideClick:!1,onRender:function(){WPStagingBackup$1.removeLogsListeners();var container=WPStagingCommon.getSwalContainer(),cancelButton=container.getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=cancelButton.cloneNode(!0);cancelButton.parentNode.replaceChild(btnCancel,cancelButton),btnCancel.addEventListener("click",(function(){WPStagingCommon.getSwalModal().close(),ProcessModal.onCancel&&"function"==typeof ProcessModal.onCancel&&ProcessModal.onCancel()}));var showLogsButton=container.getElementsByClassName("wpstg--process-modal--logs-button")[0],showLogs=showLogsButton.cloneNode(!0);showLogsButton.parentNode.replaceChild(showLogs,showLogsButton),showLogs.addEventListener("click",(function(e){e.preventDefault(),WPStaging.wpstgProcessLogs.toggleProcessLogs(e.target)})),ProcessModal.onRender&&"function"==typeof ProcessModal.onRender&&ProcessModal.onRender()}});case 5:case"end":return _context.stop()}}),_callee)})));return function(){return _show.apply(this,arguments)}}(),updateProgress:function(progress){var container=WPStagingCommon.getSwalContainer();if(container){var _progress$title,titleEl=container.querySelector(".wpstg--process-modal--title");if(titleEl)titleEl.innerHTML=null!==(_progress$title=progress.title)&&void 0!==_progress$title?_progress$title:"Processing";var _progress$percentage,percentEl=container.querySelector(".wpstg--process-modal--percent");if(percentEl)percentEl.innerHTML=null!==(_progress$percentage=progress.percentage)&&void 0!==_progress$percentage?_progress$percentage:"0"}}},BackgroundLogger={offset:0,retries:5,source:null,startTime:null,loader:null,timer:null,taskData:null,isCancelled:!1,jobType:null,resetRetries:function(){BackgroundLogger.retries=5},showSuccessModal:function(message){var callbackOnClose=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;FinishModal.showLogs=!0;var content=FinishModal.getModalContent({title:wpstg.i18n.success,body:message+"<br/><br/>"});FinishModal.onClose=callbackOnClose,FinishModal.show(content)},showErrorModal:function(message){var showLogs=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];FinishModal.showLogs=showLogs;var content=FinishModal.getModalContent({title:wpstg.i18n.error,body:message+"<br/><br/>"});FinishModal.show(content,"error")},init:function(startTime,jobType,token){addEvent(document.querySelector("#wpstg--locked-process"),"click",".wpstg--locked-process--show-logs",(function(el,e){e.preventDefault(),BackgroundLogger.show()})),addEvent(document.querySelector("#wpstg--locked-process"),"click",".wpstg--locked-process--cancel-job",(function(){BackgroundLogger.confirmCancel()})),BackgroundLogger.jobType=jobType,BackgroundLogger.token=token,BackgroundLogger.startTime=startTime,BackgroundLogger.loader=document.getElementById("wpstg--locked-process"),BackgroundLogger.startTimer(),BackgroundLogger.offset=0,BackgroundLogger.resetRetries(),WPStaging.wpstgProcessLogs.resetLogs(),WPStaging.wpstgProcessLogs.renderLogs(""),BackgroundLogger.run()},show:function(){ProcessModal.isCloseable=!0,ProcessModal.show(),WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--process-modal--logs-button")[0].remove(),WPStaging.wpstgProcessLogs.toggleProcessLogs(),BackgroundLogger.taskData&&ProcessModal.updateProgress(BackgroundLogger.taskData)},close:function(){BackgroundLogger.source&&BackgroundLogger.source.close(),BackgroundLogger.source=null},setTitle:function(title){var titleEl=BackgroundLogger.loader.querySelector(".wpstg--locked-process--job-title");titleEl&&(titleEl.innerHTML=title)},startTimer:function(){var timerEl=BackgroundLogger.loader.querySelector(".wpstg--locked-process--elapsed-time");timerEl&&(BackgroundLogger.timer=setInterval((function(){var elapsed=Math.floor((new Date).getTime()/1e3)-BackgroundLogger.startTime,minutes=Math.floor(elapsed/60),seconds=elapsed%60,elapsedTime="".concat(minutes,":").concat(seconds<10?"0":"").concat(seconds,"s");timerEl.innerHTML=elapsedTime;var container=WPStagingCommon.getSwalContainer();if(container){var elapsedTimeContainer=container.querySelector(".wpstg--process-modal--elapsed-time");elapsedTimeContainer&&(elapsedTimeContainer.innerHTML=elapsedTime)}}),1e3))},stop:function(){BackgroundLogger.close(),BackgroundLogger.isCancelled=!1,BackgroundLogger.startTime=null,BackgroundLogger.token=null,clearInterval(BackgroundLogger.timer),BackgroundLogger.timer=null,BackgroundLogger.loader.remove()},enableUI:function(){var refresh=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];BackgroundLogger.close();var btnBackupCreate=document.getElementById("wpstg-new-backup");btnBackupCreate&&(WPStagingBackup$1.removeLogsListeners(),btnBackupCreate.removeAttribute("disabled"),refresh&&WPStagingBackup$1.fetchListing()),document.getElementById("wpstg-step-1")&&refresh&&WPStaging.loadOverview()},run:function(){BackgroundLogger.source=new EventSource(wpstg.restUrl+"/sse-logs&token=".concat(BackgroundLogger.token,"&offset=").concat(BackgroundLogger.offset)),BackgroundLogger.source.onmessage=function(event){var log=JSON.parse(event.data);log&&WPStaging.wpstgProcessLogs.logMessages(log)},BackgroundLogger.source.addEventListener("task",(function(event){var data=JSON.parse(event.data);BackgroundLogger.updateProgress(data)})),BackgroundLogger.source.addEventListener("offset",(function(event){var offset=parseInt(event.data,10);BackgroundLogger.close(),BackgroundLogger.offset=offset,BackgroundLogger.resetRetries(),WPStagingJob.performingCancelRequest||setTimeout((function(){return BackgroundLogger.run()}),200)})),BackgroundLogger.source.addEventListener("success",(function(e){BackgroundLogger.close();var data=JSON.parse(e.data);"remote-sync"!==data.type?(BackgroundLogger.enableUI(),BackgroundLogger.showSuccessModal(data.message)):window.dispatchEvent(new CustomEvent("wpstg.onRemoteSyncSuccess",{detail:data}))})),BackgroundLogger.source.addEventListener("failed",(function(e){if(BackgroundLogger.close(),void 0===e.data)return BackgroundLogger.enableUI(!1),void BackgroundLogger.showErrorModal("");var data=JSON.parse(e.data);if(void 0===data)return BackgroundLogger.enableUI(!1),void BackgroundLogger.showErrorModal("");BackgroundLogger.enableUI(),BackgroundLogger.showErrorModal(data.message)})),BackgroundLogger.source.addEventListener("cancelled",(function(e){if(BackgroundLogger.isCancelled)setTimeout((function(){return BackgroundLogger.run()}),3e3);else{var data=JSON.parse(e.data);BackgroundLogger.setTitle(data.title),BackgroundLogger.hideFooter(),BackgroundLogger.isCancelled=!0,WPStagingJob.showCancelInitiatedModal(data.title),setTimeout((function(){return BackgroundLogger.run()}),3e3)}})),BackgroundLogger.source.onerror=function(e){var _data$message;if(2===e.target.readyState&&BackgroundLogger.isCancelled)setTimeout((function(){BackgroundLogger.stop(),BackgroundLogger.enableUI(),BackgroundLogger.hideModal(),BackgroundLogger.isCancelled=!1}),3e3);else if(BackgroundLogger.close(),void 0!==e.data){var data=JSON.parse(e.data);if(void 0===data)return BackgroundLogger.enableUI(!1),void BackgroundLogger.showErrorModal("");if(data.retry&&BackgroundLogger.retries>0&&!BackgroundLogger.isCancelled)return BackgroundLogger.retries--,void setTimeout((function(){return BackgroundLogger.run()}),1e3);BackgroundLogger.enableUI(!1),BackgroundLogger.showErrorModal(null!==(_data$message=data.message)&&void 0!==_data$message?_data$message:"")}}},updateProgress:function(data){BackgroundLogger.taskData=data,ProcessModal.updateProgress(data);var taskTitleEl=BackgroundLogger.loader.querySelector(".wpstg--locked-process--task-title"),percentageEl=BackgroundLogger.loader.querySelector(".wpstg--locked-process--percentage");taskTitleEl&&(taskTitleEl.innerHTML=data.title),percentageEl&&(percentageEl.innerHTML=data.percentage)},confirmCancel:function(){var _preConfirm,cancelModal=document.getElementById("wpstg--modal--cancel-job");WPStagingCommon.getSwalModal(!1,{confirmButton:"wpstg--btn--confirm wpstg-button wpstg-link-btn danger",cancelButton:"wpstg--btn--confirm wpstg-button wpstg-link-btn"}).fire({html:'<div class="wpstg--modal--cancel-job">'+cancelModal.innerHTML+"</div>",showConfirmButton:!0,showCloseButton:!0,showLoaderOnConfirm:!1,showCancelButton:!0,confirmButtonText:wpstg.i18n.confirm,cancelButtonText:wpstg.i18n.close,width:540,allowEscapeKey:!0,allowOutsideClick:!0,preConfirm:(_preConfirm=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,BackgroundLogger.cancelJob();case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}),_callee)}))),function(){return _preConfirm.apply(this,arguments)})})},cancelJob:(_cancelJob=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:BackgroundLogger.stop(),WPStagingJob.cancel({},(function(){BackgroundLogger.enableUI()}));case 2:case"end":return _context2.stop()}}),_callee2)}))),function(){return _cancelJob.apply(this,arguments)}),hideFooter:function(){var footer=document.querySelector(".wpstg--locked-process--footer");footer&&(footer.style.display="none")},hideModal:function(){WPStagingCommon.getSwalContainer()&&WPStagingCommon.closeSwalModal()}},WPStagingSites={pageContainer:null,job:null,isStagingPage:function(){return"wpstg_clone"===getActivePage()},getPageContainer:function(){if(this.pageContainer)return this.pageContainer;throw new Error("Staging page container not found")},setJob:function(type){var cloneId=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.job={type:type,cloneId:cloneId}},init:function(){var _this=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var timeout,interval,selector,start,element;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:_this.pageContainer=null,timeout=5e3,interval=250,selector="#wpstg-workflow",start=Date.now();case 5:if(!(Date.now()-start<timeout)){_context.next=15;break}if(!(element=document.querySelector(selector))){_context.next=11;break}return _this.pageContainer=element,window.dispatchEvent(new Event("wpstg.onStagingPageLoaded")),_context.abrupt("return");case 11:return _context.next=13,new Promise((function(resolve){return setTimeout(resolve,interval)}));case 13:_context.next=5;break;case 15:throw new Error("Staging page container not found");case 17:case"end":return _context.stop()}}),_callee)})))()},showLoader:function(){loadingPlaceholder(),this.isStagingPage()&&showLoadingBar(),this.isStagingPage()&&function(targetNode,callback){if(window.MutationObserver){var observer=new MutationObserver((function(mutationsList){var _step5,_iterator5=_createForOfIteratorHelper(mutationsList);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var mutation=_step5.value;"childList"===mutation.type&&callback(mutation)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}));return observer.observe(targetNode,{childList:!0,subtree:!1}),observer}console.warn("MutationObserver is not supported in your browser.")}(this.getPageContainer(),(function(){setLoadingPlaceholder().then((function(){loadingPlaceholder("hidden")}))}))},hideLoader:function(){this.isStagingPage()&&loadingPlaceholder("hidden")},fetchListing:function(){var _this2=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var stagingPageContainer,response;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return stagingPageContainer=_this2.getPageContainer(),_this2.showLoader(),_context2.prev=2,_context2.next=5,wpstgRequest("wpstg--staging-site--listing");case 5:response=_context2.sent,window.dispatchEvent(new Event("wpstg.onStagingSitesListed")),stagingPageContainer.innerHTML=response,_this2.runScripts(stagingPageContainer),_context2.next=16;break;case 11:_context2.prev=11,_context2.t0=_context2.catch(2),console.warn(_context2.t0),WPStagingCommon.showError(wpstg.i18n.admin_load_overview.error_no_response),_this2.hideLoader();case 16:return _context2.prev=16,show(".wpstg-step3-cloning"),hide(".wpstg-step3-pushing"),_context2.finish(16);case 20:case"end":return _context2.stop()}}),_callee2,null,[[2,11,16,20]])})))()},runScripts:function(container){container.querySelectorAll("script").forEach((function(oldScript){var newScript=document.createElement("script");newScript.textContent=oldScript.textContent,oldScript.parentNode.replaceChild(newScript,oldScript)}))}},CorruptStagingOption={fixStagingSitesOption:function(){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var _yield$wpstgRequestWi,response;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,wpstgRequestWithError("wpstg--staging-site--fix-option");case 2:if(_yield$wpstgRequestWi=_context.sent,response=_yield$wpstgRequestWi.response,!_yield$wpstgRequestWi.error){_context.next=7;break}return _context.abrupt("return",!1);case 7:if(!response.success){_context.next=10;break}return notify("success",response.data.message),_context.abrupt("return",!0);case 10:return notify("error",response.data.message),_context.abrupt("return",!1);case 12:case"end":return _context.stop()}}),_callee)})))()},reportCorruptedStagingSitesOption:function(){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var _yield$wpstgRequestWi2,response;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,wpstgRequestWithError("wpstg--staging-site--report-option");case 2:if(_yield$wpstgRequestWi2=_context2.sent,response=_yield$wpstgRequestWi2.response,!_yield$wpstgRequestWi2.error){_context2.next=7;break}return _context2.abrupt("return");case 7:if(!response.success){_context2.next=10;break}return notify("success",response.data.message),_context2.abrupt("return");case 10:notify("error",response.data.message);case 11:case"end":return _context2.stop()}}),_callee2)})))()},listen:function(){var _this=this;window.addEventListener("wpstg.onStagingPageLoaded",(function(){var stagingPageContainer=WPStagingSites.getPageContainer();addEvent(stagingPageContainer,"click","#wpstg-fix-staging-sites-option",function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(elem,event){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return event.preventDefault(),_context3.next=3,_this.fixStagingSitesOption();case 3:if(!_context3.sent){_context3.next=5;break}WPStagingSites.fetchListing();case 5:case"end":return _context3.stop()}}),_callee3)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),addEvent(stagingPageContainer,"click","#wpstg-report-corrupted-staging-sites",function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(elem,event){return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return event.preventDefault(),_context4.next=3,_this.reportCorruptedStagingSitesOption();case 3:case"end":return _context4.stop()}}),_callee4)})));return function(_x3,_x4){return _ref2.apply(this,arguments)}}())}))}},CreateStagingSite=function(){return _createClass((function CreateStagingSite(){_classCallCheck(this,CreateStagingSite),this.isCreateEventListened=!1}),[{key:"listen",value:function(){var _this=this;this.isCreateEventListened||(this.isCreateEventListened=!0,addEvent(qs("body"),"click",".wpstg--create--staging-site",function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(button){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.start();case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()))}},{key:"start",value:(_start=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return WPStagingJob.processModal.initializeProcessModal(!0),WPStagingJob.setJob({name:"staging_site_create",action:"wpstg--staging-site--create",type:"Staging_Create"}),_context3.next=4,WPStagingJob.prepareJob("wpstg--staging-site--prepare-create",{wpstgCreateData:{}},"startedCreatingStagingSite");case 4:if(_context3.sent){_context3.next=7;break}return _context3.abrupt("return");case 7:return WPStagingJob.onSuccess=function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(response){var messageBody,stagingUrl,uniqueId,cloneID,loginLinkResponse;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(setLoadingPlaceholder().then((function(){return loadingPlaceholder()})),!WPStagingJob.shouldWarn()){_context2.next=9;break}return _context2.next=4,WPStagingJob.logsModal();case 4:if(_context2.sent.value){_context2.next=7;break}return _context2.abrupt("return");case 7:return WPStaging.loadOverview(),_context2.abrupt("return");case 9:if(messageBody=wpstg.i18n.cloning.body,null===response.stagingSiteUrl){_context2.next=19;break}return stagingUrl=response.stagingSiteUrl,uniqueId=Date.now().toString(),cloneID=response.cloneId,_context2.next=16,wpstgPro.saveGeneratedLinkData({cloneID:cloneID,role:"administrator",days:"",hours:"",minutes:"15",uniqueId:uniqueId});case 16:null!=(loginLinkResponse=_context2.sent)&&loginLinkResponse.success&&(stagingUrl=response.stagingSiteUrl+"/wp-login.php?wpstg_login="+uniqueId),messageBody+='<br><strong><a href="'+stagingUrl+'" target="_blank" id="wpstg-clone-url">'+response.stagingSiteUrl+"</a></strong><br><br>";case 19:return _context2.next=21,WPStagingJob.successModal({title:wpstg.i18n.cloning.title,bodyText:messageBody});case 21:if(_context2.sent.value){_context2.next=24;break}return _context2.abrupt("return");case 24:WPStaging.loadOverview();case 25:case"end":return _context2.stop()}}),_callee2)})));return function(_x2){return _ref2.apply(this,arguments)}}(),_context3.prev=8,_context3.next=11,WPStagingJob.runJob();case 11:_context3.next=16;break;case 13:_context3.prev=13,_context3.t0=_context3.catch(8),console.error(_context3.t0);case 16:case"end":return _context3.stop()}}),_callee3,null,[[8,13]])}))),function(){return _start.apply(this,arguments)})}]);var _start}(),DeleteStagingSite=function(){return _createClass((function DeleteStagingSite(){_classCallCheck(this,DeleteStagingSite),this.allTablesChecked=!0,this.isDeletingTables=!1,this.isDeletingFiles=!1,this.excludedTables=[],this.cloneId=null,this.isDeleteConfirmEventListened=!1}),[{key:"listen",value:function(){var _this=this;this.isDeleteConfirmEventListened||(this.isDeleteConfirmEventListened=!0,addEvent(qs("body"),"click",".wpstg--delete--staging-site",function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(button){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.openStagingSiteDeleteConfirmationModal(button);case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()))}},{key:"openStagingSiteDeleteConfirmationModal",value:(_openStagingSiteDeleteConfirmationModal=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(button){var response;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return WPStagingCommon.resetErrors(),this.cloneId=button.getAttribute("data-cloneId"),_context2.next=4,wpstgRequest("wpstg--staging-site--delete-confirmation",{cloneId:this.cloneId});case 4:if((response=_context2.sent)&&response.success){_context2.next=7;break}return _context2.abrupt("return");case 7:return _context2.next=9,this.showDeleteConfirmationModal(response.data);case 9:case"end":return _context2.stop()}}),_callee2,this)}))),function(_x2){return _openStagingSiteDeleteConfirmationModal.apply(this,arguments)})},{key:"showDeleteConfirmationModal",value:(_showDeleteConfirmationModal=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(data){var _this2=this;return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,WPStagingCommon.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-centered-modal wpstg-delete-staging-site-modal",content:"wpstg--process--content"}).fire({html:"<div id='wpstg--modal--confirm-delete--staging-site--content'></div>",title:wpstg.i18n.staging_site.delete.confirmation.replace("%s",data.stagingSiteName),icon:"error",width:"100%",focusConfirm:!1,confirmButtonText:wpstg.i18n.delete,confirmButtonColor:"#e01e5a",showCancelButton:!0,cancelButtonText:wpstg.i18n.cancel,onRender:function(){qs(".wpstg--swal2-container #wpstg--modal--confirm-delete--staging-site--content").innerHTML=data.html,_this2.updateDeleteConfirmationModalUI()},preConfirm:function(){return _this2.validateIfAnythingToDelete()}});case 2:if(_context4.sent.isConfirmed){_context4.next=5;break}return _context4.abrupt("return");case 5:return WPStagingJob.processModal.initializeProcessModal(!1),WPStagingJob.setJob({name:"staging_site_delete",action:"wpstg--staging-site--delete",type:"Staging_Delete"}),_context4.next=9,WPStagingJob.prepareJob("wpstg--staging-site--prepare-delete",{wpstgDeleteData:{cloneId:this.cloneId,excludedTables:this.excludedTables,isDeletingTables:this.isDeletingTables,isDeletingFiles:this.isDeletingFiles}},"startedDeletingStagingSite");case 9:if(_context4.sent){_context4.next=12;break}return _context4.abrupt("return");case 12:return WPStagingJob.onSuccess=function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(response){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(setLoadingPlaceholder().then((function(){return loadingPlaceholder()})),!WPStagingJob.shouldWarn()){_context3.next=9;break}return _context3.next=4,WPStagingJob.logsModal();case 4:if(_context3.sent.value){_context3.next=7;break}return _context3.abrupt("return");case 7:return WPStaging.loadOverview(),_context3.abrupt("return");case 9:return _context3.next=11,WPStagingJob.successModal({title:wpstg.i18n.staging_site.delete.title,bodyText:""});case 11:if(_context3.sent.value){_context3.next=14;break}return _context3.abrupt("return");case 14:WPStaging.loadOverview();case 15:case"end":return _context3.stop()}}),_callee3)})));return function(_x4){return _ref2.apply(this,arguments)}}(),_context4.prev=13,_context4.next=16,WPStagingJob.runJob();case 16:_context4.next=21;break;case 18:_context4.prev=18,_context4.t0=_context4.catch(13),console.error(_context4.t0);case 21:case"end":return _context4.stop()}}),_callee4,this,[[13,18]])}))),function(_x3){return _showDeleteConfirmationModal.apply(this,arguments)})},{key:"updateDeleteConfirmationModalUI",value:function(){var _this3=this;addEvent(qs("body"),"click","#wpstg-unselect-all-tables",(function(){_this3.toggleSelectAllTables()})),qs(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container"),document.querySelector(".wpstg--swal2-confirm").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-left").style.background="#e01e5a",document.querySelector(".wpstg--swal2-x-mark-line-right").style.background="#e01e5a",document.querySelector(".wpstg--swal2-icon.wpstg--swal2-error").style.borderColor="#e01e5a";var _btnCancel=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=_btnCancel.cloneNode(!0);_btnCancel.parentNode.replaceChild(btnCancel,_btnCancel),btnCancel.addEventListener("click",(function(e){WPStagingCommon.closeSwalModal(),hide(".wpstg-loader"),loadingPlaceholder("hidden")}))}},{key:"toggleSelectAllTables",value:function(e){var wpstgUnselectAllTablesId=qs("#wpstg-unselect-all-tables-id");!1===this.allTablesChecked?(wpstgUnselectAllTablesId.textContent="Unselect All",all(".wpstg-db-table-checkboxes").forEach((function(checkbox){checkbox.checked=!0})),this.allTablesChecked=!0):(wpstgUnselectAllTablesId.textContent="Select All",all(".wpstg-db-table-checkboxes").forEach((function(checkbox){checkbox.checked=!1})),this.allTablesChecked=!1)}},{key:"validateIfAnythingToDelete",value:function(){var _this4=this;return this.isDeletingTables=!1,all(".wpstg-db-table-checkboxes").forEach((function(checkbox){checkbox.checked?_this4.isDeletingTables=!0:_this4.excludedTables.push(checkbox.value)})),this.isDeletingFiles=qs("#deleteDirectory").checked,!(!this.isDeletingTables&&!this.isDeletingFiles)||(notify("warning","Please select at least one item to delete."),!1)}}]);var _showDeleteConfirmationModal,_openStagingSiteDeleteConfirmationModal}(),StagingSetup={allTablesSelected:!0,directoryNavigator:null,tableSelector:null,cloneExcludeFilters:null,setup:function(){var _this=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var stagingPageContainer,_yield$wpstgRequestWi,response,error;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return stagingPageContainer=WPStagingSites.getPageContainer(),WPStagingSites.showLoader(),_context.next=4,wpstgRequestWithError("wpstg--staging-site--setup");case 4:if(_yield$wpstgRequestWi=_context.sent,response=_yield$wpstgRequestWi.response,!(error=_yield$wpstgRequestWi.error)){_context.next=11;break}return console.warn(error),WPStagingSites.hideLoader(),_context.abrupt("return");case 11:if(response.success){_context.next=14;break}return WPStagingSites.hideLoader(),_context.abrupt("return");case 14:WPStagingSites.setJob("staging-create",null),window.dispatchEvent(new Event("wpstg.onStagingSiteSetup")),stagingPageContainer.innerHTML=response.data,_this.directoryNavigator=new WpstgDirectoryNavigation("#wpstg-directories-listing",wpstg),_this.directoryNavigator.countSelectedFiles(),_this.tableSelector=new WpstgTableSelection("#wpstg-setup-tables","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),_this.tableSelector.countSelectedTables(),_this.cloneExcludeFilters=new WpstgExcludeFilters;case 22:case"end":return _context.stop()}}),_callee)})))()},listen:function(){var _this2=this;window.addEventListener("wpstg.onStagingSitesListed",(function(){addEvent(WPStagingSites.getPageContainer(),"click","#wpstg-new-staging",function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(elem,event){return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return event.preventDefault(),_context2.next=3,_this2.setup();case 3:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref.apply(this,arguments)}}())}))}},Staging={deleteModule:new DeleteStagingSite,createModule:new CreateStagingSite,init:function(){var _this=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:CorruptStagingOption.listen(),WPStagingSites.init(),_this.listen();case 3:case"end":return _context.stop()}}),_callee)})))()},listen:function(){StagingSetup.listen(),this.deleteModule.listen(),this.createModule.listen()}},WPStaging$1=function($){var that={isCancelled:!1,isFinished:!1,getLogs:!1,onGoingRequest:null,time:1,executionTime:!1,progressBar:0,cloneExcludeFilters:null,directoryNavigator:null,tableSelector:null,notyf:null,areAllTablesChecked:!0,handleDisplayDependencies:handleDisplayDependencies,handleToggleElement:handleToggleElement,handleCopyPaste:handleCopyPaste,copyTextToClipboard:copyTextToClipboard,messages:[],requestType:"",modal:{instance:"",processTime:0,processInterval:"",currentJob:""},processModalType:null};that.wpstgProcessModal=new WpstgProcessModal,that.wpstgProcessLogs=new WpstgProcessLogs;var ajaxSpinner,cache={elements:[]};cache.get=function(selector){return-1!==$.inArray(selector,cache.elements)||(cache.elements[selector]=jQuery(selector)),cache.elements[selector]},cache.refresh=function(selector){selector.elements[selector]=jQuery(selector)};var hideWpstgLoader=function(){cache.get(".wpstg-loader").is(":visible")?cache.get(".wpstg-loader").css("visibility","hidden"):cache.get(".wpstg-loader").hide()},showError=function(message){window.scrollTo(0,0),cache.get("#wpstg-try-again").css("display","inline-block"),cache.get("#wpstg-cancel-cloning").text("Reset"),cache.get("#wpstg-resume-cloning").show(),cache.get("#wpstg-error-wrapper").show(),cache.get("#wpstg-error-details").show().html(message),cache.get(".wpstg-loading-bar-container").css("visibility","hidden"),hideWpstgLoader(),$(".wpstg--modal--process--generic-problem").show().html(message),document.querySelectorAll(".wpstg-report-issue-button").forEach((function(button){button.addEventListener("click",(function(){setTimeout((function(){document.querySelectorAll(".wpstg-report-show").forEach((function(elem){elem.style.zIndex="9999999999"}))}),10)}))})),$.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_staging_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:message}})};that.warnIfClosingDuringProcess=function(event){return event.returnValue=wpstg.i18n.admin_warn_if_closing_during_process,null};var resetErrors=function(){cache.get("#wpstg-error-details").hide().html("")},validateTargetHost=function(){var the_domain=$("#wpstg_clone_hostname").val();if(""===the_domain)return!0;return!1!==/^http(s)?:\/\/.*$/.test(the_domain)},cloneActions=function(){var $workFlow=cache.get("#wpstg-workflow");$workFlow.on("click","#wpstg-cancel-cloning",(function(){if(!confirm(wpstg.i18n.admin_clone_actions.cancel_cloning_confirm))return!1;var $this=$(this);$("#wpstg-try-again, #wpstg-home-link").hide(),$this.prop("disabled",!0),that.isCancelled=!0,that.progressBar=0,$("#wpstg-processing-status").text(wpstg.i18n.please_wait),$(".wpstg-loader, #wpstg-show-log-button").hide(),$this.parent().append(ajaxSpinner),_cancelCloning()})).on("click","#wpstg-resume-cloning",(function(){resetErrors();var $this=$(this);$("#wpstg-try-again, #wpstg-home-link").hide(),that.isCancelled=!1,$("#wpstg-processing-status").text(wpstg.i18n.admin_clone_actions.resume_cloning_status),$("#wpstg-error-details").hide(),$(".wpstg-loader").show(),$this.parent().append(ajaxSpinner),that.startCloning()})).on("click","#wpstg-cancel-cloning-update",(function(){resetErrors();var $this=$(this);$("#wpstg-try-again, #wpstg-home-link").hide(),$this.prop("disabled",!0),that.isCancelled=!0,$("#wpstg-cloning-result").text(wpstg.i18n.please_wait),$(".wpstg-loader, #wpstg-show-log-button").hide(),$this.parent().append(ajaxSpinner),_cancelCloningUpdate()})).on("click","#wpstg-restart-cloning",(function(){resetErrors();var $this=$(this);$("#wpstg-try-again, #wpstg-home-link").hide(),$this.prop("disabled",!0),that.isCancelled=!0,$("#wpstg-cloning-result").text(wpstg.i18n.please_wait),$(".wpstg-loader, #wpstg-show-log-button").hide(),$this.parent().append(ajaxSpinner),restart()})).on("click",".wpstg-execute-clone",(function(e){e.preventDefault();var clone=$(this).data("clone"),url=$(this).data("url");WPStagingCommon.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_clone_actions_update_modal.title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height wpstg-text-justify">'+wpstg.i18n.admin_clone_actions_update_modal.body.replace("{URL}",url)+"<br><br>"+wpstg.i18n.admin_clone_actions_update_modal.suggestion+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_clone_actions_update_modal.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var _btnCancel=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=_btnCancel.cloneNode(!0);_btnCancel.parentNode.replaceChild(btnCancel,_btnCancel),btnCancel.addEventListener("click",(function(e){WPStagingCommon.closeSwalModal()}))}}).then((function(result){result.value&&(that.cloneExcludeFilters=null,_ajax({action:"wpstg_scanning",clone:clone,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(response){response.length<1&&showError(wpstg.i18n.admin_clone_actions.scanning_show_error);var jsonResponse=tryParseJson(response);!1===jsonResponse||!1!==jsonResponse.success?($workFlow.html(response),checkDiskSpace(),that.directoryNavigator=new WpstgDirectoryNavigation("#wpstg-directories-listing",wpstg),that.directoryNavigator.countSelectedFiles(),that.tableSelector=new WpstgTableSelection("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),that.tableSelector.countSelectedTables(),that.cloneExcludeFilters=new WpstgExcludeFilters,that.switchStep(2)):showErrorModal(jsonResponse)}),"HTML"),WPStagingCommon.closeSwalModal())}))})).on("click","#wpstg-update-cloning-site-button",(function(e){window.open(that.data.cloneHostname,"_blank")})).on("click",".wpstg-reset-clone",(function(e){e.preventDefault();var clone=$(this).data("clone"),resetModal=new WpstgResetModal(clone);resetModal.setNetworkClone("yes"===$(this).data("network"));var promise=resetModal.showModal();that.areAllTablesChecked=!0,promise.then((function(result){if(result.value){var dirNavigator=resetModal.getDirectoryNavigator(),tableSelector=resetModal.getTableSelector(),exclFilters=resetModal.getExcludeFilters().getExcludeFilters(),includedTables="",excludedTables="",selectedTablesWithoutPrefix="",allTablesExcluded=!1;null!==tableSelector&&(includedTables=tableSelector.getIncludedTables(),excludedTables=tableSelector.getExcludedTables(),selectedTablesWithoutPrefix=tableSelector.getSelectedTablesWithoutPrefix()),includedTables.length>excludedTables.length?includedTables="":excludedTables.length>includedTables.length&&(excludedTables="",allTablesExcluded=""===includedTables),resetClone(clone,{includedTables:includedTables,excludedTables:excludedTables,allTablesExcluded:allTablesExcluded,selectedTablesWithoutPrefix:selectedTablesWithoutPrefix,excludeSizeRules:encodeURIComponent(exclFilters.sizes),excludeGlobRules:encodeURIComponent(exclFilters.globs),excludedDirectories:dirNavigator.getExcludedDirectories(),extraDirectories:dirNavigator.getExtraDirectoriesRootOnly()})}}))}))},_ajax=function(data,callback,dataType,showErrors,tryCount){var incrementRatio=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;void 0===dataType&&(dataType="json"),!1!==showErrors&&(showErrors=!0);var retryTimeout=1e4*(tryCount=void 0===tryCount?0:tryCount);incrementRatio=parseInt(incrementRatio),isNaN(incrementRatio)||(retryTimeout*=incrementRatio);var _error,errorMsgFooter="<br/>"+wpstg.i18n.admin_ajax.error_msg_footer,pushingErrorMsg="<br/><br/>"+wpstg.i18n.admin_ajax.pushing_error_msg,contactUsContent='<br/><br/><button class="wpstg-btn wpstg-primary-btn wpstg-report-issue-button" type="button">'+wpstg.i18n.contact_us+"</button> "+wpstg.i18n.admin_ajax.contact_us_text;that.onGoingRequest=$.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:dataType,cache:!1,data:data,error:(_error=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(xhr,textStatus,errorThrown){var errorCode,result,helpContent,_error2,_errorCode;return _regeneratorRuntime().wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(403!==(errorCode=void 0===xhr.status?"Unknown":xhr.status)&&405!==errorCode&&406!==errorCode){_context.next=4;break}return WPStagingCommon.handleFetchErrors(xhr),_context.abrupt("return");case 4:if("wpstg_cloning"!==WPStaging$1.requestType){_context.next=21;break}return _context.next=7,WPStagingCommon.checkMemoryExhaustion(WPStaging$1.requestType);case 7:if(result=_context.sent,helpContent=contactUsContent,wpstg.isPro&&(helpContent='<br/><br/>Read <a target="_blank" href="'+WPStagingCommon.memoryExhaustArticleLink+'">this article</a> for solving this issue.<br/><br/>'+wpstg.i18n.admin_ajax.help_content_pro),!1===result){_context.next=21;break}return window.removeEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess),WPStaging$1.requestType="",hideWpstgLoader(),_error2=result.message+"."+helpContent,that.wpstgProcessLogs.logMessages({message:_error2,type:"critical",date:(now=void 0,year=void 0,month=void 0,day=void 0,hours=void 0,minutes=void 0,seconds=void 0,now=new Date,year=now.getFullYear(),month=(now.getMonth()+1).toString().padStart(2,"0"),day=now.getDate().toString().padStart(2,"0"),hours=now.getHours().toString().padStart(2,"0"),minutes=now.getMinutes().toString().padStart(2,"0"),seconds=now.getSeconds().toString().padStart(2,"0"),"".concat(year,"/").concat(month,"/").concat(day," ").concat(hours,":").concat(minutes,":").concat(seconds))}),_context.next=18,that.wpstgProcessModal.openErrorModal("clone");case 18:return _context.next=20,that.wpstgProcessModal.logEventFailure("clone");case 20:return _context.abrupt("return");case 21:if("wpstg_cloning"===WPStaging$1.requestType?errorMsgFooter+=contactUsContent:"wpstg_push_processing"===data.action?errorMsgFooter+=pushingErrorMsg+contactUsContent:errorMsgFooter=contactUsContent,"wpstg_cloning"!==WPStaging$1.requestType||0!==tryCount){_context.next=25;break}return _context.next=25,that.wpstgProcessModal.logEventFailure("clone");case 25:if("wpstg_push_processing"!==data.action||0!==tryCount){_context.next=28;break}return _context.next=28,that.wpstgProcessModal.logEventFailure("push");case 28:++tryCount<=5?(console.log("RETRYING "+tryCount+"/5"),setTimeout((function(){_ajax(data,callback,dataType,showErrors,tryCount,incrementRatio)}),retryTimeout)):(WPStaging$1.requestType="",console.log("RETRYING LIMIT"),_errorCode=void 0===xhr.status?"Unknown":xhr.status,showError("Fatal Error:  "+_errorCode+" "+errorMsgFooter));case 30:case"end":return _context.stop()}var now,year,month,day,hours,minutes,seconds}),_callee)}))),function(_x,_x2,_x3){return _error.apply(this,arguments)}),success:function(data){"function"==typeof callback&&callback(data)},statusCode:{0:function(){tryCount>=5&&showError("Error 0 - Connection error. Please check you network connection.")},404:function(){tryCount>=5&&showError("Error 404 - Can't find ajax request URL."+contactUsContent)},500:function(){tryCount>=5&&showError("Fatal Error 500 - Internal server error while processing the request! "+errorMsgFooter)},504:function(){tryCount>5&&showError("Error 504 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+contactUsContent)},502:function(){tryCount>=5&&showError("Error 502 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+contactUsContent)},503:function(){tryCount>=5&&showError("Error 503 - It seem your server is rate limiting ajax requests. Please try to resume after a minute. "+contactUsContent)},429:function(){tryCount>=5&&showError("Error 429 - It seems your server is rate limiting ajax requests. Please try to resume after a minute. "+contactUsContent)},403:function(){showError("Error 403 - "+WPStagingCommon.showFirewallError())},405:function(){showError("Error 405 - "+WPStagingCommon.showFirewallError())},406:function(){showError("Error 406 - "+WPStagingCommon.showFirewallError())},400:function(){tryCount>=5&&showError("Error 400 - <strong>It looks like you have been logged out.</strong><br/><br/> <a href='/wp-login.php' target='_blank' id=\"wpstg-login-link\">Log in again and try again!</a>")}}})},verifyExternalDatabase=function($this,workflow){cache.get(".wpstg-loader").show(),_ajax({action:"wpstg_database_verification",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:cache.get("#wpstg-db-user").val(),databasePassword:cache.get("#wpstg-db-pass").val(),databaseServer:cache.get("#wpstg-db-server").val(),databaseDatabase:cache.get("#wpstg-db-database").val(),databaseSsl:cache.get("#wpstg-db-ssl").is(":checked")},(function(response){var _response$data2;if(!1===response)return showError(wpstg.i18n.admin_verify_external_database.error_no_response+" <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void hideWpstgLoader();if(void 0===response.success)return showError(wpstg.i18n.admin_verify_external_database.error_invalid_response+"<a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void hideWpstgLoader();if(response.success)return hideWpstgLoader(),void proceedCloning($this,workflow);if("comparison"===response.error_type){hideWpstgLoader();var render='<table class="wpstg-db-comparison-table"><thead><tr><th>Property</th><th>Production DB</th><th>Staging DB</th><th>Status</th></tr></thead><tbody>';return response.checks.forEach((function(x){var icon='<span class="wpstg-css-tick"></span>';x.production!==x.staging&&(icon='<span class="wpstg-css-cross"></span>'),render+="<tr><td>"+x.name+"</td><td>"+x.production+"</td><td>"+x.staging+"</td><td>"+icon+"</td></tr>"})),render+="</tbody></table><p>"+wpstg.i18n.admin_verify_external_database.comparison_modal_html_note+"</p>",void WPStagingCommon.getSwalModal(!0,{popup:"wpstg-swal-popup wpstg-db-comparison-modal wpstg-centered-modal"}).fire({title:wpstg.i18n.admin_verify_external_database.comparison_modal_title,icon:"warning",html:render,width:"650px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_verify_external_database.comparison_modal_confirm_button_text,showCancelButton:!0}).then((function(result){result.value&&proceedCloning($this,workflow)}))}WPStagingCommon.getSwalModal(!0).fire({title:wpstg.i18n.admin_verify_external_database.error_modal_title,icon:"error",html:null==response||null===(_response$data2=response.data)||void 0===_response$data2?void 0:_response$data2.message,focusConfirm:!0,confirmButtonText:wpstg.i18n.admin_verify_external_database.error_modal_confirm_button_text,showCancelButton:!1}),hideWpstgLoader()}),"json",!1)},proceedCloning=function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2($this,workflow){var _wpstgPro;return _regeneratorRuntime().wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if("wpstg_cloning"!==$this.data("action")){_context2.next=14;break}if(!wpstg.isPro||!isElementChecked("#wpstg-new-admin-user")||!1!==isValidEmail("#wpstg-new-admin-email")){_context2.next=3;break}return _context2.abrupt("return");case 3:if(_context2.t0=wpstg.isPro&&isElementChecked("#wpstg-ext-db")&&"undefined"!=typeof wpstgPro&&"function"==typeof(null===(_wpstgPro=wpstgPro)||void 0===_wpstgPro?void 0:_wpstgPro.verifyDbGrants),!_context2.t0){_context2.next=9;break}return _context2.next=7,wpstgPro.verifyDbGrants();case 7:_context2.t1=_context2.sent,_context2.t0=!1===_context2.t1;case 9:if(!_context2.t0){_context2.next=11;break}return _context2.abrupt("return");case 11:isCloneDestinationPathSameAsRoot().then((function(result){if(!result||!wpstg.isPro)return new Promise((function(resolve){_ajax({action:"wpstg_is_writable_clone_destination_dir",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneDir:$("#wpstg_clone_dir").val()},(function(response){var _response$data;response.success?(hideWpstgLoader(),resolve(!0)):(showError("Something went wrong! Error: "+(null===(_response$data=response.data)||void 0===_response$data?void 0:_response$data.message)),hideWpstgLoader(),document.getElementById("wpstg-error-wrapper").scrollIntoView(),resolve(!1))}),"json",!1)}))})).then((function(result){result&&runCloningSteps($this,workflow)})).catch((function(error){notify("error",error)})),_context2.next=15;break;case 14:runCloningSteps($this,workflow);case 15:case"end":return _context2.stop()}}),_callee2)})));return function(_x4,_x5){return _ref.apply(this,arguments)}}(),runCloningSteps=function($this,workflow){cache.get(".wpstg-loading-bar-container").css("visibility","visible"),that.data={action:$this.data("action"),accessToken:wpstg.accessToken,nonce:wpstg.nonce},function(){if("wpstg_cloning"===that.data.action||"wpstg_update"===that.data.action||"wpstg_reset"===that.data.action){if(that.data.cloneID=(new Date).getTime().toString(),"wpstg_update"===that.data.action&&(that.data.cloneID=$("#wpstg-new-clone-id").data("clone")),that.data.cloneName=WPStagingCommon.sanitizeEventAttribute($("#wpstg-new-clone-id").val())||that.data.cloneID,null!==that.directoryNavigator&&(that.data.excludedDirectories=encodeURIComponent(that.directoryNavigator.getExcludedDirectories()),that.data.extraDirectories=encodeURIComponent(that.directoryNavigator.getExtraDirectoriesRootOnly())),that.data.excludeGlobRules="",that.data.excludeSizeRules="",that.cloneExcludeFilters instanceof WpstgExcludeFilters){var rules=that.cloneExcludeFilters.getExcludeFilters();that.data.excludeGlobRules=encodeURIComponent(rules.globs),that.data.excludeSizeRules=encodeURIComponent(rules.sizes)}that.data.includedTables="",that.data.excludedTables="",that.data.allTablesExcluded=!1,null!==that.tableSelector&&(that.data.includedTables=that.tableSelector.getIncludedTables(),that.data.excludedTables=that.tableSelector.getExcludedTables(),that.data.selectedTablesWithoutPrefix=that.tableSelector.getSelectedTablesWithoutPrefix()),that.data.includedTables.length>that.data.excludedTables.length?that.data.includedTables="":that.data.excludedTables.length>that.data.includedTables.length&&(that.data.excludedTables="",that.data.allTablesExcluded=""===that.data.includedTables),"undefined"!=typeof wpstgPro&&"function"==typeof wpstgPro.getAdvancedCloningOptions&&(that.data=wpstgPro.getAdvancedCloningOptions(that.data))}}(),sendCloningAjax(workflow)},sendCloningAjax=function(workflow){var animatedLoader=cache.get(".wpstg-loading-bar-container");_ajax(that.data,(function(response){!1===response&&showError(wpstg.i18n.admin_send_cloning_ajax.error_general),response.length<1&&(animatedLoader.css("visibility","hidden"),showError(wpstg.i18n.admin_send_cloning_ajax.error_no_response));var jsonResponse=tryParseJson(response);if(!1!==jsonResponse&&!1===jsonResponse.success)return animatedLoader.css("visibility","hidden"),void showErrorModal(jsonResponse);animatedLoader.css("visibility","hidden"),workflow.html(response),that.cloneExcludeFilters=null,"wpstg_scanning"===that.data.action?(that.areAllTablesChecked=!0,that.directoryNavigator=new WpstgDirectoryNavigation("#wpstg-directories-listing",wpstg),that.tableSelector=new WpstgTableSelection("#wpstg-scanning-db","#wpstg-workflow","#wpstg_network_clone","#wpstg_select_tables_cloning",wpstg),that.switchStep(2),that.cloneExcludeFilters=new WpstgExcludeFilters,that.directoryNavigator.countSelectedFiles(),that.tableSelector.countSelectedTables()):"wpstg_cloning"!==that.data.action&&"wpstg_update"!==that.data.action&&"wpstg_reset"!==that.data.action||that.switchStep(3),that.startCloning()}),"HTML")},showErrorModal=function(response){new WpstgModal("wpstg_modal_error",wpstg).show(Object.assign({title:"Error",icon:"error",html:wpstg.i18n.something_went_wrong+(void 0!==response.message?"<br/>"+response.message:""),width:"500px",confirmButtonText:wpstg.i18n.ok,showCancelButton:!1,customClass:{confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn",actions:"wpstg--modal--actions",popup:"wpstg-swal-popup wpstg-centered-modal"},buttonsStyling:!1,reverseButtons:!0},response.swalOptions),{type:response.type})},tryParseJson=function(json){if(!json)return!1;try{var object=JSON.parse(json);if(object&&"object"===_typeof(object))return object}catch(e){}return!1},resetClone=function(clone,excludeOptions){that.data={action:"wpstg_reset",accessToken:wpstg.accessToken,nonce:wpstg.nonce,cloneID:clone},that.data=_objectSpread2(_objectSpread2({},that.data),excludeOptions);var $workFlow=cache.get("#wpstg-workflow");sendCloningAjax($workFlow)},loadOverview=function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){return _regeneratorRuntime().wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if("wpstg_clone"!==getActivePage()||!wpstg.isCloneable){_context3.next=3;break}return _context3.next=3,WPStagingSites.fetchListing();case 3:that.switchStep(1);case 4:case"end":return _context3.stop()}}),_callee3)})));return function(){return _ref2.apply(this,arguments)}}(),_cancelCloning=function(){if(that.timer("stop"),!0===that.isFinished)return!0;_ajax({action:"wpstg_cancel_clone",clone:that.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(response){if(response&&void 0!==response.delete&&"finished"===response.delete)return hideWpstgLoader(),void loadOverview();!0===response?loadOverview():_cancelCloning()}))},_cancelCloningUpdate=function(){if(!0===that.isFinished)return!0;_ajax({action:"wpstg_cancel_update",clone:that.data.cloneID,accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(response){response&&void 0!==response.delete&&"finished"===response.delete||!0===response?loadOverview():_cancelCloningUpdate()}))},restart=function(){if(!0===that.isFinished)return!0;_ajax({action:"wpstg_restart",accessToken:wpstg.accessToken,nonce:wpstg.nonce},(function(response){response&&void 0!==response.delete&&"finished"===response.delete||!0===response?loadOverview():_cancelCloningUpdate()}))},getLogs=function(log){that.wpstgProcessLogs.logMessages(log)},checkDiskSpace=function(){cache.get("#wpstg-check-space").on("click",(function(e){cache.get(".wpstg-loader").show(),showLoadingBar();var excludedDirectories=encodeURIComponent(that.directoryNavigator.getExcludedDirectories()),extraDirectories=encodeURIComponent(that.directoryNavigator.getExtraDirectoriesRootOnly()),isUploadsSymlinked=document.getElementById("wpstg_symlink_upload").checked;_ajax({action:"wpstg_check_disk_space",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedDirectories:excludedDirectories,extraDirectories:extraDirectories,isUploadsSymlinked:isUploadsSymlinked},(function(response){hideWpstgLoader(),hideLoadingBar(),!1!==response?cache.get("#wpstg-clone-id-error").html("<strong>"+wpstg.i18n.admin_check_disk_space.error_disk_space_html_1+response.requiredSpace+"</strong>"+(null!==response.errorMessage?"<br>"+response.errorMessage:"")+'<br><span class="wpstg--grey">'+wpstg.i18n.admin_check_disk_space.error_disk_space_html_2+"</span>").show():cache.get("#wpstg-clone-id-error").text(wpstg.i18n.admin_check_disk_space.admin_check_disk_space).show()}),"json",!1)}))};that.timer=function(status){if("stop"===status){var time=that.time;return that.time=1,clearInterval(that.executionTime),that.convertSeconds(time)}that.executionTime=setInterval((function(){null!==document.getElementById("wpstg-processing-timer")&&(document.getElementById("wpstg-processing-timer").innerHTML=wpstg.i18n.admin_that_timer.elapsed_time+that.convertSeconds(that.time)),that.time++,"stop"===status&&(that.time=1,clearInterval(that.executionTime))}),1e3)},that.convertSeconds=function(seconds){var date=new Date(null);return date.setSeconds(seconds),date.toISOString().substr(11,8)},that.startCloning=function(){if(resetErrors(),checkDiskSpace(),"wpstg_cloning"===that.data.action||"wpstg_update"===that.data.action||"wpstg_reset"===that.data.action){that.isCancelled=!1,cache.get(".wpstg-loader").show(),cache.get("#wpstg-cancel-cloning").text("Cancel"),cache.get("#wpstg-resume-cloning").hide(),cache.get("#wpstg-error-details").hide(),setTimeout((function(){window.addEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess),_processing()}),wpstg.delayReq);var _processing=function(){if(!0===that.isCancelled)return window.removeEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess),!1;var _isLoading;(_isLoading=!0)&&!1!==_isLoading?cache.get(".wpstg-loader").show():hideWpstgLoader();var excludedTables,excludedDirectories="",extraDirectories="";null!==that.directoryNavigator&&(excludedDirectories=that.directoryNavigator.getExcludedDirectories(),extraDirectories=that.directoryNavigator.getExtraDirectoriesRootOnly()),WPStaging$1.requestType="wpstg_cloning",WPStaging$1.ajax({action:"wpstg_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,excludedTables:(excludedTables=[],$(".wpstg-db-table input:not(:checked)").each((function(){excludedTables.push(this.name)})),excludedTables),excludedDirectories:encodeURIComponent(excludedDirectories),extraDirectories:encodeURIComponent(extraDirectories)},(function(response){!function(response,prependMessage,appendMessage){prependMessage=prependMessage?prependMessage+"<br/><br/>":wpstg.i18n.something_went_wrong+"!<br/><br/>",appendMessage=appendMessage?appendMessage+"<br/><br/>":"<br/><br/>"+wpstg.i18n.small_server_settings_text,!1===response?(showError(prependMessage+" Error: No response."+appendMessage),window.removeEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess)):void 0!==response.error&&response.error&&(console.error(response.message),showError(prependMessage+" Error: "+response.message+appendMessage),window.removeEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess))}(response),void 0!==response.last_msg&&response.last_msg&&getLogs(response.last_msg),!1===response.status?(progressBar(response),setTimeout((function(){_processing()}),wpstg.delayReq)):!0===response.status&&"finished"!==response.status?(cache.get("#wpstg-error-details").hide(),cache.get("#wpstg-error-wrapper").hide(),progressBar(response),_processing()):("finished"===response.status||void 0!==response.job_done&&response.job_done)&&(window.removeEventListener("beforeunload",WPStaging$1.warnIfClosingDuringProcess),WPStaging$1.requestType="",function(response){!0===that.getLogs&&getLogs();progressBar(response),void 0!==response.last_msg&&getLogs(response.last_msg);var action=that.data.action.replace("wpstg_","");null!==wpstg.i18n[action]&&that.wpstgProcessModal.openSuccessModal(wpstg.i18n[action],!0,response.url)}(response))}),"json",!1)},progressBar=function(response,restart){null!==response&&that.wpstgProcessModal.openProcessModal(that.data,response,!0)}}};var isCloneDestinationPathSameAsRoot=function(){return new Promise((function(resolve){var _dom$qs,_dom$qs2;((null===(_dom$qs=qs("#wpstg-use-target-dir"))||void 0===_dom$qs?void 0:_dom$qs.dataset.basePath)||"")!==((null===(_dom$qs2=qs("#wpstg_clone_dir"))||void 0===_dom$qs2?void 0:_dom$qs2.value)||"")?resolve(!1):(qs("#wpstg_clone_dir").style.borderColor="red",notify("error",wpstg.i18n.admin_is_clone_destination_path_same_as_root_error),resolve(!0))}))};return that.switchStep=function(step){cache.get(".wpstg-current-step").removeClass("wpstg-current-step"),cache.get(".wpstg-step"+step).addClass("wpstg-current-step")},that.checkUserDbPermissions=function(operationType){return new Promise((function(resolve){WPStaging$1.ajax({action:"wpstg_check_user_permissions",accessToken:wpstg.accessToken,nonce:wpstg.nonce,type:operationType},(function(response){response.success?resolve(!0):(WPStagingCommon.getSwalModal(!0,{container:"wpstg-swal-push-container"}).fire({title:"",icon:"warning",html:response.data.message,width:"750px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_check_user_db_permissions_confirm_button_text,showCancelButton:!0}).then((function(result){result.isConfirmed&&resolve(!0)})),document.getElementById("wpstg-db-permission-show-full-message").addEventListener("click",(function(){var infoOutput=document.getElementById("wpstg-permission-info-output"),infoData=document.getElementById("wpstg-permission-info-data"),isShowingFullMessage="none"!==window.getComputedStyle(infoOutput).display;infoOutput.style.display=isShowingFullMessage?"none":"block",infoData.style.display=isShowingFullMessage?"block":"none",this.textContent="none"===infoData.style.display?wpstg.i18n.admin_verify_external_database.show_full_message:wpstg.i18n.admin_verify_external_database.hide_full_message})))}),"json",!1)}))},that.init=function(){var timer,$workFlow,urlSpinner;loadOverview(),$workFlow=cache.get("#wpstg-workflow"),urlSpinner=ajaxurl.replace("/admin-ajax.php","")+"/images/spinner",2<window.devicePixelRatio&&(urlSpinner+="-2x"),ajaxSpinner="<img src=''"+(urlSpinner+=".gif")+"' alt='' class='ajax-spinner general-spinner' />",$workFlow.on("click",".wpstg-button-unselect",(function(e){e.preventDefault(),!1===that.areAllTablesChecked?(cache.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected","selected"),cache.get(".wpstg-button-unselect").text(wpstg.i18n.unselect_all),cache.get(".wpstg-db-table-checkboxes").prop("checked",!0),that.areAllTablesChecked=!0):(cache.get("#wpstg_select_tables_cloning .wpstg-db-table").prop("selected",!1),cache.get(".wpstg-button-unselect").text(wpstg.i18n.select_all),cache.get(".wpstg-db-table-checkboxes").prop("checked",!1),that.areAllTablesChecked=!1)})).on("keyup","#wpstg-new-clone-id",(function(){if(document.getElementById("wpstg-error-details").style.display="none","number"==typeof timer&&clearInterval(timer),void 0===this.value||""===this.value)return cache.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),cache.get("#wpstg-start-cloning").removeAttr("disabled"),void cache.get("#wpstg-clone-id-error").text("").hide();var cloneDirectoryName=WPStagingCommon.slugify(this.value);timer=setTimeout((function(){_ajax({action:"wpstg_check_clone",accessToken:wpstg.accessToken,nonce:wpstg.nonce,directoryName:cloneDirectoryName},(function(response){if(!response)return cache.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),cache.get("#wpstg-start-cloning").prop("disabled",!0),void notify("error",wpstg.i18n.admin_elements.wpstg_check_clone_error);"success"===response.status?(cache.get("#wpstg-new-clone-id").removeClass("wpstg-error-input"),cache.get("#wpstg-start-cloning").removeAttr("disabled"),cache.get("#wpstg-clone-id-error").text("").hide()):(cache.get("#wpstg-new-clone-id").addClass("wpstg-error-input"),cache.get("#wpstg-start-cloning").prop("disabled",!0),cache.get("#wpstg-clone-id-error").text(response.message).show())}))}),500)})).on("click","#wpstg-start-cloning",(function(){resetErrors(),that.isCancelled=!1,that.progressBar=0})).on("input","#wpstg-new-clone-id",(function(){if(!($("#wpstg-clone-directory").length<1)){var slug=WPStagingCommon.slugify(this.value).substring(0,16).trim(),$targetDir=$("#wpstg-use-target-dir"),$targetUri=$("#wpstg-use-target-hostname"),path=$targetDir.data("base-path"),uri=$targetUri.data("base-uri");path&&slug&&(path=function(path,slug){var normalizedPath=path.replace(/\/+$/g,"");return(normalizedPath+="/"+slug+"/").replace(/\/+/g,"/")}(path,slug)),uri&&(uri=uri.replace(/\/+$/g,"")+"/"+slug),$(".wpstg-use-target-dir--value").text(path),$(".wpstg-use-target-hostname--value").text(uri),$targetDir.attr("data-path",path),$targetUri.attr("data-uri",uri),$("#wpstg_clone_dir").attr("placeholder",path),$("#wpstg_clone_hostname").attr("placeholder",uri)}})).on("input","#wpstg_clone_hostname",(function(){""===$(this).val()||validateTargetHost()?$("#wpstg_clone_hostname_error").remove():validateTargetHost()||$("#wpstg_clone_hostname_error").length||$("#wpstg-clone-directory tr:last-of-type").after('<tr><td>&nbsp;</td><td><p id="wpstg_clone_hostname_error" style="color: red;">&nbsp;'+wpstg.i18n.admin_elements.wpstg_clone_hostname_error+"</p></td></tr>")})),cloneActions(),function(){var $workFlow=cache.get("#wpstg-workflow");$workFlow.on("click",".wpstg-next-step-link",(function(e){e.preventDefault();var $this=$(this);if($("#wpstg_clone_hostname").length&&!validateTargetHost())return $("#wpstg_clone_hostname").focus(),!1;if(("wpstg_update"===$this.data("action")||"wpstg_reset"===$this.data("action"))&&"wpstg_update"===$this.data("action")){var selectedSite=$this,selectedSiteWorkFlow=$workFlow,selectedAction=$this.data("action");return WPStagingCommon.getSwalModal(!1,{popup:"wpstg-update-staging-site-modal wpstg-swal-popup wpstg-centered-modal",content:"wpstg--process--content"}).fire({title:wpstg.i18n.admin_step_buttons.popup_title,icon:"warning",html:'<div class="wpstg-confirm-text-line-height">'+wpstg.i18n.admin_step_buttons.popup_html.replace("{URL}",$this.data("url"))+"</div>",width:"610px",focusConfirm:!1,confirmButtonText:wpstg.i18n.admin_step_buttons.confirm_button_text,showCancelButton:!0,onRender:function(){document.querySelector(".wpstg--swal2-html-container").classList.remove("wpstg--swal2-html-container");var _btnCancel=WPStagingCommon.getSwalContainer().getElementsByClassName("wpstg--swal2-cancel wpstg--btn--cancel")[0],btnCancel=_btnCancel.cloneNode(!0);_btnCancel.parentNode.replaceChild(btnCancel,_btnCancel),btnCancel.addEventListener("click",(function(e){WPStagingCommon.closeSwalModal()}))}}).then((function(result){if(result.value){var selectedSiteDbCheck=document.querySelector("#wpstg-ext-db");if("wpstg_cloning"===selectedAction&&selectedSiteDbCheck.checked)return void verifyExternalDatabase(selectedSite,selectedSiteWorkFlow);WPStagingCommon.closeSwalModal(),proceedCloning(selectedSite,selectedSiteWorkFlow)}})),!1}if($this.attr("disabled"))return!1;"wpstg_cloning"===$this.data("action")&&$("#wpstg-ext-db").is(":checked")?verifyExternalDatabase($this,$workFlow):proceedCloning($this,$workFlow)})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),hideWpstgLoader(),cache.get(".wpstg-loader").removeClass("wpstg-finished"),loadOverview()}))}(),cache.get("#wpstg-workflow").on("click",".wpstg-tab-header",(function(e){e.preventDefault();var $this=$(this),$section=cache.get($this.data("id"));$this.toggleClass("expand"),$section.slideToggle();var tabTriangle=$this.find(".wpstg-tab-triangle");$this.hasClass("expand")?(tabTriangle.text(""),tabTriangle.addClass("wpstg-rotate-90")):tabTriangle.removeClass("wpstg-rotate-90")})),WPStagingCommon.listenTooltip(),new WpstgMainMenu,new WpstgCloneStaging,new WpstgCloningAdvanceSettings,new WpstgProcessModal,new WpstgSidebarMenu,new WpstgProcessLogs},that.ajax=_ajax,that.showError=showError,that.getLogs=getLogs,that.loadOverview=loadOverview,that.initBackgroundLogger=BackgroundLogger.init,that}(jQuery);jQuery(document).ready(_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){return _regeneratorRuntime().wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if("wpstg_clone"!==getActivePage()||!wpstg.isCloneable){_context4.next=3;break}return _context4.next=3,Staging.init();case 3:WPStaging$1.init(),window.WPStaging=WPStaging$1;case 5:case"end":return _context4.stop()}}),_callee4)})))),jQuery(document).ready((function($){function validateFormFields(elementId,errorMessage,substring){var element=document.getElementById(elementId);if(element){var inputBorderColor=null!=errorMessage&&errorMessage.includes(substring)?"#e01e5a":"";"checkbox"!==element.type?element.style.borderColor=inputBorderColor:document.querySelector("#"+elementId+" ~ svg .wpstg--checkbox-border").style.stroke=inputBorderColor}}function sendIssueReport(button){var forceSend=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false",email=$(".wpstg--tab--header .wpstg-report-email").val(),hosting_provider=$(".wpstg--tab--header .wpstg-report-hosting-provider").val(),message=$(".wpstg--tab--header .wpstg-report-description").val(),syslog=$(".wpstg--tab--header .wpstg-report-syslog").is(":checked"),terms=$(".wpstg--tab--header .wpstg-report-terms").is(":checked");button.attr("disabled",!0),show("#wpstg-contact-us-loader"),$.ajax({url:ajaxurl,type:"POST",dataType:"json",async:!0,data:{action:"wpstg_send_report",accessToken:wpstg.accessToken,nonce:wpstg.nonce,wpstg_email:email,wpstg_provider:hosting_provider,wpstg_message:message,wpstg_syslog:+syslog,wpstg_terms:+terms,wpstg_force_send:forceSend}}).done((function(data){if(button.attr("disabled",!1),hide("#wpstg-contact-us-loader"),data.errors.length>0){$(".wpstg-report-issue-form .wpstg-message").remove();var errorMessage="";$.each(data.errors,(function(key,value){"already_submitted"===value.status?(errorMessage="",WPStagingCommon.getSwalModal(!0,{container:"wpstg-issue-resubmit-confirmation"}).fire({title:"",icon:"warning",html:value.message,showCancelButton:!0,focusConfirm:!1,confirmButtonText:wpstg.i18n.yes,cancelButtonText:wpstg.i18n.no}).then((function(result){result.isConfirmed&&sendIssueReport(button,"true")}))):errorMessage+=value+"<br/>"})),validateFormFields("wpstg-report-email",errorMessage,"email"),validateFormFields("wpstg-report-description",errorMessage,"issue"),validateFormFields("wpstg-report-terms",errorMessage,"privacy policy"),""!==errorMessage&&notify("error",errorMessage)}else{var successMessage=$("<div />").addClass("wpstg-message wpstg-success-message");successMessage.append("<p>"+wpstg.i18n.admin_send_issue_report_success_message+"</p>"),$(".wpstg--tab--header .wpstg-report-issue-form").html(successMessage),null!==document.getElementById("wpstg-modal-close")&&void 0!==document.getElementById("wpstg-modal-close")||$(".wpstg--tab--header .wpstg-success-message").append('<div class="wpstg-float-right"><button id="wpstg-success-button" class="wpstg-close-button"><a href="javascript:void(0)" class="wpstg-report-cancel wpstg--red">'+wpstg.i18n.close+"</a></button></div>"),setTimeout((function(){$(".wpstg--tab--header .wpstg-report-issue-form").removeClass("wpstg-report-active")}),2e3)}}))}document.addEventListener("click",(function(event){var target=event.target.closest(".wpstg-open-clone, .wpstg-open-staging-site");if(target){event.preventDefault();var cloneId=target.getAttribute("data-clone"),stagingUrl=target.getAttribute("data-url");void 0!==window.wpstgPro&&"function"==typeof window.wpstgPro.createLoginUrl?window.wpstgPro.createLoginUrl(cloneId,stagingUrl):window.open(stagingUrl,"_blank")}})),$("body").on("click",".wpstg-report-issue-button",(function(e){e.preventDefault();var contactUsModal=document.querySelector("#wpstg-contact-us-modal");null!=contactUsModal&&void 0!==contactUsModal&&(show("#wpstg-contact-us-modal"),new WpstgContactUs),$(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),$("body").on("click",".wpstg-backups-report-issue-button",(function(e){e.preventDefault(),$(".wpstg-report-issue-form").toggleClass("wpstg-report-show")})),$("body").on("click","#wpstg-report-cancel",(function(e){e.preventDefault(),$(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),$("body").on("click","#wpstg-report-submit",(function(e){e.preventDefault(),sendIssueReport($(this),"false")})),$("body").on("click","#wpstg-success-button",(function(e){e.preventDefault(),$(".wpstg-report-issue-form").removeClass("wpstg-report-show")})),$(document).on("click",".wpstg-dropdown>.wpstg-dropdown-toggler",(function(e){e.preventDefault(),$(e.target).next(".wpstg-dropdown-menu").toggleClass("shown"),$(e.target).find(".wpstg-caret").toggleClass("wpstg-caret-up")})),$(document).on("click",".wpstg-caret",(function(e){e.preventDefault();var toggler=$(e.target).closest(".wpstg-dropdown-toggler");toggler&&toggler.trigger("click")})),document.addEventListener("click",(function(event){if(!event.target.closest(".wpstg-dropdown-toggler")){for(var dropDown=document.getElementsByClassName("wpstg-dropdown-menu"),i=0;i<dropDown.length;i++)dropDown[i].classList.remove("shown");$(".wpstg-caret").removeClass("wpstg-caret-up")}})),window.addEventListener("finishedProcessWithError",(function(customEvent){$.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpstg_job_error",accessToken:wpstg.accessToken,nonce:wpstg.nonce,error_message:customEvent.detail.error,job_id:WPStagingCommon.getJobId()}})})),document.addEventListener("click",(function(event){"wpstg-login-link"===event.target.id&&(event.preventDefault(),window.open("/wp-login.php","_blank"),window.WPStaging&&window.WPStaging.wpstgProcessModal&&(window.WPStaging.wpstgProcessModal.stop(),window.WPStaging.loadOverview()))})),document.addEventListener("click",(function(event){var targetId=event.target.id;if(["wpstg-send-schedules-error-report","wpstg-send-schedules-slack-error-report"].includes(targetId)){var inputField=document.getElementById(targetId+"-input");inputField&&inputField.classList.toggle("hidden")}}))})),window.addEventListener("load",_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var eventLogger;return _regeneratorRuntime().wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if("true"!==localStorage.getItem("wpstgPushProcessCompleted")){_context5.next=5;break}return eventLogger=new WpstgProcessModal,_context5.next=4,eventLogger.logEventSuccess("push");case 4:localStorage.removeItem("wpstgPushProcessCompleted");case 5:case"end":return _context5.stop()}}),_callee5)})))),document.addEventListener("DOMContentLoaded",(function(){var activePage=getActivePage(),activeTab=getActiveTab(),isSettingsPage="wpstg-settings"===activePage,isBasicTemporaryLogin="undefined"!=typeof wpstg&&!wpstg.isPro&&"temporary-login"===activeTab;(isSettingsPage&&(isBasicTemporaryLogin||"temporary-login"!==activeTab)||["wpstg-tools","wpstg-license"].includes(activePage))&&loadingPlaceholder("hidden")}))}();
