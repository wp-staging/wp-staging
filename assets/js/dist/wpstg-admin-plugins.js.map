{"version":3,"file":"wpstg-admin-plugins.js","sources":["../src/wpstg-admin-plugins.js"],"sourcesContent":["let strict;\n\njQuery(document).ready(function($) {\n  /**\n   * DEACTIVATION FEEDBACK FORM\n   */\n  // show overlay when clicked on \"deactivate\"\n  const wpstg_deactivate_link = $('.wp-admin.plugins-php tr[data-slug=\"wp-staging\"] .row-actions .deactivate a');\n  const wpstg_deactivate_link_url = wpstg_deactivate_link.attr('href');\n\n  console.log('wpstg feedback loaded');\n\n  wpstg_deactivate_link.on('click', function(e) {\n    e.preventDefault();\n\n    // only show feedback form once per 30 days\n    const c_value = wpstg_admin_get_cookie('wpstg_hide_feedback');\n\n    if (c_value === undefined) {\n      $('#wpstg-feedback-overlay').show();\n    } else {\n      // click on the link\n      window.location.href = wpstg_deactivate_link_url;\n    }\n  });\n  // show text fields\n  $('#wpstg-feedback-content input[type=\"checkbox\"]').on('click', function() {\n    const $this = $(this);\n    if ($this.is(':checked')) {\n      // show text field if there is one\n      $(this).parents('li').next('li').children('input[type=\"text\"], textarea').show();\n    } else {\n      // hide text field if there is one\n      $(this).parents('li').next('li').children('input[type=\"text\"], textarea').hide();\n    }\n  });\n  // send form or close it\n  $('#wpstg-feedback-content .button').on('click', function(e) {\n    e.preventDefault();\n    // set cookie for 30 days\n    const exdate = new Date();\n    exdate.setSeconds(exdate.getSeconds() + 2592000);\n    document.cookie = 'wpstg_hide_feedback=1; expires=' + exdate.toUTCString() + '; path=/';\n\n    $('#wpstg-feedback-overlay').hide();\n    if ('wpstg-feedback-submit' === this.id) {\n      // Send form data\n      $.ajax({\n        type: 'POST',\n        url: ajaxurl,\n        dataType: 'json',\n        data: {\n          action: 'wpstg_send_feedback',\n          data: $('#wpstg-feedback-content form').serialize(),\n          nonce: wpstg.nonce,\n        },\n        complete: function(MLHttpRequest, textStatus, errorThrown) {\n          // deactivate the plugin and close the popup\n          $('#wpstg-feedback-overlay').remove();\n          window.location.href = wpstg_deactivate_link_url;\n        },\n      });\n    } else {\n      $('#wpstg-feedback-overlay').remove();\n      window.location.href = wpstg_deactivate_link_url;\n    }\n  });\n  // close form without doing anything\n  $('.wpstg-feedback-not-deactivate').on('click', function(e) {\n    $('#wpstg-feedback-overlay').hide();\n  });\n\n  function wpstg_admin_get_cookie(name) {\n    let i; let x; let y; const wpstg_cookies = document.cookie.split( ';' );\n    for (i = 0; i < wpstg_cookies.length; i++) {\n      x = wpstg_cookies[i].substr( 0, wpstg_cookies[i].indexOf( '=' ) );\n      y = wpstg_cookies[i].substr( wpstg_cookies[i].indexOf( '=' ) + 1 );\n      x = x.replace( /^\\s+|\\s+$/g, '' );\n      if (x === name) {\n        return unescape( y );\n      }\n    }\n  }\n});\n"],"names":["jQuery","document","ready","$","wpstg_deactivate_link","wpstg_deactivate_link_url","attr","console","log","on","e","preventDefault","c_value","wpstg_admin_get_cookie","undefined","show","window","location","href","$this","is","parents","next","children","hide","exdate","Date","setSeconds","getSeconds","cookie","toUTCString","id","ajax","type","url","ajaxurl","dataType","data","action","serialize","nonce","wpstg","complete","MLHttpRequest","textStatus","errorThrown","remove","name","i","x","y","wpstg_cookies","split","length","substr","indexOf","replace","unescape"],"mappings":"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"}